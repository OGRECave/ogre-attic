<html>
<head>
<title>OGRE Documentation</title> <meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1"> 
<link type="text/css" rel="stylesheet" href="style.css">
</head>

<body>
<!-- Generated by Doxygen 1.2.16 -->
<center>
<a class="qindex" href="index.html">Main Page</a> &nbsp; <a class="qindex" href="namespaces.html">Namespace List</a> &nbsp; <a class="qindex" href="hierarchy.html">Class Hierarchy</a> &nbsp; <a class="qindex" href="classes.html">Alphabetical List</a> &nbsp; <a class="qindex" href="annotated.html">Compound List</a> &nbsp; <a class="qindex" href="files.html">File List</a> &nbsp; <a class="qindex" href="namespacemembers.html">Namespace Members</a> &nbsp; <a class="qindex" href="functions.html">Compound Members</a> &nbsp; <a class="qindex" href="globals.html">File Members</a> &nbsp; <a class="qindex" href="pages.html">Related Pages</a> &nbsp; </center>
<hr><h1>OgreSubMesh.cpp</h1><a href="OgreSubMesh_8cpp.html">Go to the documentation of this file.</a><div class="fragment"><pre>00001 <font class="comment">/*</font>
00002 <font class="comment">-----------------------------------------------------------------------------</font>
00003 <font class="comment">This source file is part of OGRE</font>
00004 <font class="comment">    (Object-oriented Graphics Rendering Engine)</font>
00005 <font class="comment">For the latest info, see http://www.stevestreeting.com/ogre/</font>
00006 <font class="comment"></font>
00007 <font class="comment">Copyright © 2000-2001 Steven J. Streeting</font>
00008 <font class="comment">Also see acknowledgements in Readme.html</font>
00009 <font class="comment"></font>
00010 <font class="comment">This program is free software; you can redistribute it and/or modify it under</font>
00011 <font class="comment">the terms of the GNU General Public License as published by the Free Software</font>
00012 <font class="comment">Foundation; either version 2 of the License, or (at your option) any later</font>
00013 <font class="comment">version.</font>
00014 <font class="comment"></font>
00015 <font class="comment">This program is distributed in the hope that it will be useful, but WITHOUT</font>
00016 <font class="comment">ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or FITNESS</font>
00017 <font class="comment">FOR A PARTICULAR PURPOSE. See the GNU General Public License for more details.</font>
00018 <font class="comment"></font>
00019 <font class="comment">You should have received a copy of the GNU General Public License along with</font>
00020 <font class="comment">this program; if not, write to the Free Software Foundation, Inc., 59 Temple</font>
00021 <font class="comment">Place - Suite 330, Boston, MA 02111-1307, USA, or go to</font>
00022 <font class="comment">http://www.gnu.org/copyleft/gpl.html.</font>
00023 <font class="comment">-----------------------------------------------------------------------------</font>
00024 <font class="comment">*/</font>
00025 <font class="preprocessor">#include "<a class="code" href="OgreSubMesh_8h.html">OgreSubMesh.h</a>"</font>
00026 
00027 <font class="preprocessor">#include "<a class="code" href="OgreMesh_8h.html">OgreMesh.h</a>"</font>
00028 
00029 <font class="keyword">namespace </font>Ogre {
00030     <font class="comment">//-----------------------------------------------------------------------</font>
<a name="l00031"></a><a class="code" href="classOgre_1_1SubMesh.html#Ogre_1_1SubMesha0">00031</a>     SubMesh::SubMesh()
00032     {
00033         <a class="code" href="classOgre_1_1SubMesh.html#Ogre_1_1SubMeshm0">useSharedVertices</a> = <font class="keyword">true</font>;
00034         <a class="code" href="classOgre_1_1SubMesh.html#Ogre_1_1SubMeshm1">useTriStrips</a> = <font class="keyword">false</font>;
00035         <a class="code" href="classOgre_1_1SubMesh.html#Ogre_1_1SubMeshm4">faceVertexIndices</a> = 0;
00036         <a class="code" href="classOgre_1_1SubMesh.html#Ogre_1_1SubMeshm3">numFaces</a> = 0;
00037         <a class="code" href="classOgre_1_1SubMesh.html#Ogre_1_1SubMeshm2">geometry</a>.<a class="code" href="structOgre_1_1GeometryData.html#Ogre_1_1GeometryDatam4">hasColours</a> = <font class="keyword">false</font>;
00038         <a class="code" href="classOgre_1_1SubMesh.html#Ogre_1_1SubMeshm2">geometry</a>.<a class="code" href="structOgre_1_1GeometryData.html#Ogre_1_1GeometryDatam1">hasNormals</a> = <font class="keyword">false</font>;
00039         <a class="code" href="classOgre_1_1SubMesh.html#Ogre_1_1SubMeshm2">geometry</a>.<a class="code" href="structOgre_1_1GeometryData.html#Ogre_1_1GeometryDatam9">vertexStride</a> = 0;
00040         <a class="code" href="classOgre_1_1SubMesh.html#Ogre_1_1SubMeshm2">geometry</a>.<a class="code" href="structOgre_1_1GeometryData.html#Ogre_1_1GeometryDatam10">normalStride</a> =0;
00041         <a class="code" href="classOgre_1_1SubMesh.html#Ogre_1_1SubMeshm2">geometry</a>.<a class="code" href="structOgre_1_1GeometryData.html#Ogre_1_1GeometryDatam12">colourStride</a> = 0;
00042         <a class="code" href="classOgre_1_1SubMesh.html#Ogre_1_1SubMeshm2">geometry</a>.<a class="code" href="structOgre_1_1GeometryData.html#Ogre_1_1GeometryDatam2">numTexCoords</a> = 1;
00043         <a class="code" href="classOgre_1_1SubMesh.html#Ogre_1_1SubMeshm2">geometry</a>.<a class="code" href="structOgre_1_1GeometryData.html#Ogre_1_1GeometryDatam3">numTexCoordDimensions</a>[0] = 2;
00044         <a class="code" href="classOgre_1_1SubMesh.html#Ogre_1_1SubMeshm2">geometry</a>.<a class="code" href="structOgre_1_1GeometryData.html#Ogre_1_1GeometryDatam0">numVertices</a> = 0;
00045         <a class="code" href="classOgre_1_1SubMesh.html#Ogre_1_1SubMeshm2">geometry</a>.<a class="code" href="structOgre_1_1GeometryData.html#Ogre_1_1GeometryDatam8">pColours</a> = 0;
00046         <a class="code" href="classOgre_1_1SubMesh.html#Ogre_1_1SubMeshm2">geometry</a>.<a class="code" href="structOgre_1_1GeometryData.html#Ogre_1_1GeometryDatam7">pNormals</a> = 0;
00047         <a class="code" href="classOgre_1_1SubMesh.html#Ogre_1_1SubMeshm2">geometry</a>.<a class="code" href="structOgre_1_1GeometryData.html#Ogre_1_1GeometryDatam14">pBlendingWeights</a> = 0;
00048         <a class="code" href="classOgre_1_1SubMesh.html#Ogre_1_1SubMeshm2">geometry</a>.<a class="code" href="structOgre_1_1GeometryData.html#Ogre_1_1GeometryDatam13">numBlendWeightsPerVertex</a> = 0;
00049 
00050         <font class="keywordflow">for</font> (<font class="keywordtype">int</font> i = 0; i &lt; <a class="code" href="OgreConfig_8h.html#a5">OGRE_MAX_TEXTURE_COORD_SETS</a>; ++i)
00051         {
00052             <a class="code" href="classOgre_1_1SubMesh.html#Ogre_1_1SubMeshm2">geometry</a>.<a class="code" href="structOgre_1_1GeometryData.html#Ogre_1_1GeometryDatam6">pTexCoords</a>[i] = 0;
00053             <a class="code" href="classOgre_1_1SubMesh.html#Ogre_1_1SubMeshm2">geometry</a>.<a class="code" href="structOgre_1_1GeometryData.html#Ogre_1_1GeometryDatam11">texCoordStride</a>[i] = 0;
00054         }
00055         <a class="code" href="classOgre_1_1SubMesh.html#Ogre_1_1SubMeshm2">geometry</a>.<a class="code" href="structOgre_1_1GeometryData.html#Ogre_1_1GeometryDatam5">pVertices</a> = 0;
00056 
00057         <a class="code" href="classOgre_1_1SubMesh.html#Ogre_1_1SubMeshn1">mMatInitialised</a> = <font class="keyword">false</font>;
00058 
00059     }
00060     <font class="comment">//-----------------------------------------------------------------------</font>
<a name="l00061"></a><a class="code" href="classOgre_1_1SubMesh.html#Ogre_1_1SubMesha1">00061</a>     SubMesh::~SubMesh()
00062     {
00063         <font class="keywordflow">if</font> (<a class="code" href="classOgre_1_1SubMesh.html#Ogre_1_1SubMeshm2">geometry</a>.<a class="code" href="structOgre_1_1GeometryData.html#Ogre_1_1GeometryDatam5">pVertices</a>)
00064         {
00065             <font class="keyword">delete</font>[] <a class="code" href="classOgre_1_1SubMesh.html#Ogre_1_1SubMeshm2">geometry</a>.<a class="code" href="structOgre_1_1GeometryData.html#Ogre_1_1GeometryDatam5">pVertices</a>;
00066             <a class="code" href="classOgre_1_1SubMesh.html#Ogre_1_1SubMeshm2">geometry</a>.<a class="code" href="structOgre_1_1GeometryData.html#Ogre_1_1GeometryDatam5">pVertices</a> = 0;
00067         }
00068         <font class="comment">// Deallocate individual components if they have their own buffers</font>
00069         <font class="comment">// NB Assuming that if some components use the same buffer, all do and vice versa</font>
00070         <font class="keywordflow">if</font> (<a class="code" href="classOgre_1_1SubMesh.html#Ogre_1_1SubMeshm2">geometry</a>.<a class="code" href="structOgre_1_1GeometryData.html#Ogre_1_1GeometryDatam9">vertexStride</a> == 0)
00071         {
00072             <font class="keywordflow">if</font> (<a class="code" href="classOgre_1_1SubMesh.html#Ogre_1_1SubMeshm2">geometry</a>.<a class="code" href="structOgre_1_1GeometryData.html#Ogre_1_1GeometryDatam4">hasColours</a> &amp;&amp; <a class="code" href="classOgre_1_1SubMesh.html#Ogre_1_1SubMeshm2">geometry</a>.<a class="code" href="structOgre_1_1GeometryData.html#Ogre_1_1GeometryDatam8">pColours</a>)
00073             {
00074                 <font class="keyword">delete</font>[] <a class="code" href="classOgre_1_1SubMesh.html#Ogre_1_1SubMeshm2">geometry</a>.<a class="code" href="structOgre_1_1GeometryData.html#Ogre_1_1GeometryDatam8">pColours</a>;
00075                 <a class="code" href="classOgre_1_1SubMesh.html#Ogre_1_1SubMeshm2">geometry</a>.<a class="code" href="structOgre_1_1GeometryData.html#Ogre_1_1GeometryDatam8">pColours</a> = 0;
00076             }
00077             <font class="keywordflow">if</font> (<a class="code" href="classOgre_1_1SubMesh.html#Ogre_1_1SubMeshm2">geometry</a>.<a class="code" href="structOgre_1_1GeometryData.html#Ogre_1_1GeometryDatam1">hasNormals</a> &amp;&amp; <a class="code" href="classOgre_1_1SubMesh.html#Ogre_1_1SubMeshm2">geometry</a>.<a class="code" href="structOgre_1_1GeometryData.html#Ogre_1_1GeometryDatam7">pNormals</a>)
00078             {
00079                 <font class="keyword">delete</font>[] <a class="code" href="classOgre_1_1SubMesh.html#Ogre_1_1SubMeshm2">geometry</a>.<a class="code" href="structOgre_1_1GeometryData.html#Ogre_1_1GeometryDatam7">pNormals</a>;
00080                 <a class="code" href="classOgre_1_1SubMesh.html#Ogre_1_1SubMeshm2">geometry</a>.<a class="code" href="structOgre_1_1GeometryData.html#Ogre_1_1GeometryDatam7">pNormals</a> = 0;
00081             }
00082             <font class="keywordflow">for</font> (<font class="keywordtype">int</font> i = 0; i &lt; <a class="code" href="classOgre_1_1SubMesh.html#Ogre_1_1SubMeshm2">geometry</a>.<a class="code" href="structOgre_1_1GeometryData.html#Ogre_1_1GeometryDatam2">numTexCoords</a>; ++i)
00083             {
00084                 <font class="keywordflow">if</font> (<a class="code" href="classOgre_1_1SubMesh.html#Ogre_1_1SubMeshm2">geometry</a>.<a class="code" href="structOgre_1_1GeometryData.html#Ogre_1_1GeometryDatam6">pTexCoords</a>[i])
00085                 {
00086                     <font class="keyword">delete</font>[] <a class="code" href="classOgre_1_1SubMesh.html#Ogre_1_1SubMeshm2">geometry</a>.<a class="code" href="structOgre_1_1GeometryData.html#Ogre_1_1GeometryDatam6">pTexCoords</a>[i];
00087                     <a class="code" href="classOgre_1_1SubMesh.html#Ogre_1_1SubMeshm2">geometry</a>.<a class="code" href="structOgre_1_1GeometryData.html#Ogre_1_1GeometryDatam6">pTexCoords</a>[i] = 0;
00088                 }
00089             }
00090         }
00091         <font class="keywordflow">if</font> (faceVertexIndices)
00092         {
00093             <font class="keyword">delete</font>[] <a class="code" href="classOgre_1_1SubMesh.html#Ogre_1_1SubMeshm4">faceVertexIndices</a>;
00094             <a class="code" href="classOgre_1_1SubMesh.html#Ogre_1_1SubMeshm4">faceVertexIndices</a> = 0;
00095         }
00096     }
00097 
00098     <font class="comment">//-----------------------------------------------------------------------</font>
<a name="l00099"></a><a class="code" href="classOgre_1_1SubMesh.html#Ogre_1_1SubMesha2">00099</a>     <font class="keywordtype">void</font> SubMesh::setMaterialName(<font class="keyword">const</font> <a class="code" href="classOgre_1_1String.html">String</a>&amp; name)
00100     {
00101         <a class="code" href="classOgre_1_1SubMesh.html#Ogre_1_1SubMeshn0">mMaterialName</a> = name;
00102         <a class="code" href="classOgre_1_1SubMesh.html#Ogre_1_1SubMeshn1">mMatInitialised</a> = <font class="keyword">true</font>;
00103     }
00104     <font class="comment">//-----------------------------------------------------------------------</font>
<a name="l00105"></a><a class="code" href="classOgre_1_1SubMesh.html#Ogre_1_1SubMesha3">00105</a>     <font class="keyword">const</font> <a class="code" href="classOgre_1_1String.html">String</a>&amp; SubMesh::getMaterialName()<font class="keyword"> const</font>
00106 <font class="keyword">    </font>{
00107         <font class="keywordflow">return</font> <a class="code" href="classOgre_1_1SubMesh.html#Ogre_1_1SubMeshn0">mMaterialName</a>;
00108     }
00109     <font class="comment">//-----------------------------------------------------------------------</font>
<a name="l00110"></a><a class="code" href="classOgre_1_1SubMesh.html#Ogre_1_1SubMesha4">00110</a>     <font class="keywordtype">bool</font> SubMesh::isMatInitialised(<font class="keywordtype">void</font>)<font class="keyword"> const</font>
00111 <font class="keyword">    </font>{
00112         <font class="keywordflow">return</font> <a class="code" href="classOgre_1_1SubMesh.html#Ogre_1_1SubMeshn1">mMatInitialised</a>;
00113 
00114     }
00115     <font class="comment">//-----------------------------------------------------------------------</font>
<a name="l00116"></a><a class="code" href="classOgre_1_1SubMesh.html#Ogre_1_1SubMesha5">00116</a>     <font class="keywordtype">void</font> SubMesh::_getRenderOperation(<a class="code" href="classOgre_1_1RenderOperation.html">RenderOperation</a>&amp; ro) 
00117     {
00118 
00119         <font class="comment">// SubMeshes always use indexes</font>
00120         ro.<a class="code" href="classOgre_1_1RenderOperation.html#Ogre_1_1RenderOperationm0">useIndexes</a> = <font class="keyword">true</font>;
00121         ro.<a class="code" href="classOgre_1_1RenderOperation.html#Ogre_1_1RenderOperationm18">vertexOptions</a> = 0;
00122         <a class="code" href="structOgre_1_1GeometryData.html">GeometryData</a>* geom;
00123 
00124         <font class="keywordflow">if</font> (useTriStrips)
00125             ro.<a class="code" href="classOgre_1_1RenderOperation.html#Ogre_1_1RenderOperationm19">operationType</a> = RenderOperation::OT_TRIANGLE_STRIP;
00126         <font class="keywordflow">else</font>
00127             ro.<a class="code" href="classOgre_1_1RenderOperation.html#Ogre_1_1RenderOperationm19">operationType</a> = RenderOperation::OT_TRIANGLE_LIST;
00128 
00129         <font class="keywordflow">if</font> (useSharedVertices)
00130         {
00131             geom = &amp;(<a class="code" href="classOgre_1_1SubMesh.html#Ogre_1_1SubMeshm5">parent</a>-&gt;<a class="code" href="classOgre_1_1Mesh.html#Ogre_1_1Meshm0">sharedGeometry</a>);
00132         }
00133         <font class="keywordflow">else</font>
00134         {
00135             geom = &amp;(geometry);
00136         }
00137 
00138         <font class="keywordflow">if</font> (geom-&gt;<a class="code" href="structOgre_1_1GeometryData.html#Ogre_1_1GeometryDatam2">numTexCoords</a> &gt; 0)
00139         {
00140             ro.<a class="code" href="classOgre_1_1RenderOperation.html#Ogre_1_1RenderOperationm18">vertexOptions</a> |= RenderOperation::VO_TEXTURE_COORDS;
00141             ro.<a class="code" href="classOgre_1_1RenderOperation.html#Ogre_1_1RenderOperationm9">numTextureCoordSets</a> = geom-&gt;<a class="code" href="structOgre_1_1GeometryData.html#Ogre_1_1GeometryDatam2">numTexCoords</a>;
00142             <font class="keywordflow">for</font> (<font class="keywordtype">int</font> tex = 0; tex &lt; ro.<a class="code" href="classOgre_1_1RenderOperation.html#Ogre_1_1RenderOperationm9">numTextureCoordSets</a>; ++tex)
00143             {
00144                 ro.<a class="code" href="classOgre_1_1RenderOperation.html#Ogre_1_1RenderOperationm10">numTextureDimensions</a>[tex] = geom-&gt;<a class="code" href="structOgre_1_1GeometryData.html#Ogre_1_1GeometryDatam3">numTexCoordDimensions</a>[tex];
00145                 ro.<a class="code" href="classOgre_1_1RenderOperation.html#Ogre_1_1RenderOperationm7">pTexCoords</a>[tex] = geom-&gt;<a class="code" href="structOgre_1_1GeometryData.html#Ogre_1_1GeometryDatam6">pTexCoords</a>[tex];
00146                 ro.<a class="code" href="classOgre_1_1RenderOperation.html#Ogre_1_1RenderOperationm8">texCoordStride</a>[tex] = geom-&gt;<a class="code" href="structOgre_1_1GeometryData.html#Ogre_1_1GeometryDatam11">texCoordStride</a>[tex];
00147             }
00148 
00149         }
00150 
00151         <font class="keywordflow">if</font> (geom-&gt;<a class="code" href="structOgre_1_1GeometryData.html#Ogre_1_1GeometryDatam1">hasNormals</a>)
00152         {
00153             ro.<a class="code" href="classOgre_1_1RenderOperation.html#Ogre_1_1RenderOperationm18">vertexOptions</a> |= RenderOperation::VO_NORMALS;
00154             ro.<a class="code" href="classOgre_1_1RenderOperation.html#Ogre_1_1RenderOperationm5">pNormals</a> = geom-&gt;<a class="code" href="structOgre_1_1GeometryData.html#Ogre_1_1GeometryDatam7">pNormals</a>;
00155         }
00156 
00157         <font class="keywordflow">if</font> (geom-&gt;<a class="code" href="structOgre_1_1GeometryData.html#Ogre_1_1GeometryDatam4">hasColours</a>)
00158         {
00159             ro.<a class="code" href="classOgre_1_1RenderOperation.html#Ogre_1_1RenderOperationm18">vertexOptions</a> |= RenderOperation::VO_DIFFUSE_COLOURS;
00160             ro.<a class="code" href="classOgre_1_1RenderOperation.html#Ogre_1_1RenderOperationm11">pDiffuseColour</a> = geom-&gt;<a class="code" href="structOgre_1_1GeometryData.html#Ogre_1_1GeometryDatam8">pColours</a>;
00161         }
00162 
00163         ro.<a class="code" href="classOgre_1_1RenderOperation.html#Ogre_1_1RenderOperationm1">numVertices</a> = geom-&gt;<a class="code" href="structOgre_1_1GeometryData.html#Ogre_1_1GeometryDatam0">numVertices</a>;
00164         ro.<a class="code" href="classOgre_1_1RenderOperation.html#Ogre_1_1RenderOperationm3">pVertices</a> = geom-&gt;<a class="code" href="structOgre_1_1GeometryData.html#Ogre_1_1GeometryDatam5">pVertices</a>;
00165         ro.<a class="code" href="classOgre_1_1RenderOperation.html#Ogre_1_1RenderOperationm12">diffuseStride</a> = geom-&gt;<a class="code" href="structOgre_1_1GeometryData.html#Ogre_1_1GeometryDatam12">colourStride</a>;
00166         ro.<a class="code" href="classOgre_1_1RenderOperation.html#Ogre_1_1RenderOperationm6">normalStride</a>= geom-&gt;<a class="code" href="structOgre_1_1GeometryData.html#Ogre_1_1GeometryDatam10">normalStride</a>;
00167         ro.<a class="code" href="classOgre_1_1RenderOperation.html#Ogre_1_1RenderOperationm4">vertexStride</a> = geom-&gt;<a class="code" href="structOgre_1_1GeometryData.html#Ogre_1_1GeometryDatam9">vertexStride</a>;
00168 
00169         <font class="keywordflow">if</font> (useTriStrips)
00170             ro.<a class="code" href="classOgre_1_1RenderOperation.html#Ogre_1_1RenderOperationm17">numIndexes</a> = <a class="code" href="classOgre_1_1SubMesh.html#Ogre_1_1SubMeshm3">numFaces</a> + 2;
00171         <font class="keywordflow">else</font>
00172             ro.<a class="code" href="classOgre_1_1RenderOperation.html#Ogre_1_1RenderOperationm17">numIndexes</a> = <a class="code" href="classOgre_1_1SubMesh.html#Ogre_1_1SubMeshm3">numFaces</a> * 3;
00173 
00174         ro.<a class="code" href="classOgre_1_1RenderOperation.html#Ogre_1_1RenderOperationm16">pIndexes</a> = <a class="code" href="classOgre_1_1SubMesh.html#Ogre_1_1SubMeshm4">faceVertexIndices</a>;
00175 
00176         <font class="keywordflow">if</font> (geom-&gt;<a class="code" href="structOgre_1_1GeometryData.html#Ogre_1_1GeometryDatam13">numBlendWeightsPerVertex</a> &gt; 0)
00177         {
00178             ro.<a class="code" href="classOgre_1_1RenderOperation.html#Ogre_1_1RenderOperationm18">vertexOptions</a> |= RenderOperation::VO_BLEND_WEIGHTS;
00179             ro.<a class="code" href="classOgre_1_1RenderOperation.html#Ogre_1_1RenderOperationm2">numBlendWeightsPerVertex</a> = geom-&gt;<a class="code" href="structOgre_1_1GeometryData.html#Ogre_1_1GeometryDatam13">numBlendWeightsPerVertex</a>;
00180             ro.<a class="code" href="classOgre_1_1RenderOperation.html#Ogre_1_1RenderOperationm15">pBlendingWeights</a> = geom-&gt;<a class="code" href="structOgre_1_1GeometryData.html#Ogre_1_1GeometryDatam14">pBlendingWeights</a>;
00181         }
00182     }
00183 
00184 
00185 
00186 }
</pre></div><p>
Copyright &copy; 2002 by The OGRE Team<br />
<script type="text/javascript">
<!--//hide script from old browsers
document.write( "Last modified "+ document.lastModified );
//end hiding contents -->
</script>
</p>
</body>
</html>
