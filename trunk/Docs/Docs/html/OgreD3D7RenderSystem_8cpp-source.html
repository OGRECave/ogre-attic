<html>
<head>
<title>OGRE Documentation</title> <meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1"> 
<link type="text/css" rel="stylesheet" href="style.css">
</head>

<body>
<!-- Generated by Doxygen 1.2.16 -->
<center>
<a class="qindex" href="index.html">Main Page</a> &nbsp; <a class="qindex" href="namespaces.html">Namespace List</a> &nbsp; <a class="qindex" href="hierarchy.html">Class Hierarchy</a> &nbsp; <a class="qindex" href="classes.html">Alphabetical List</a> &nbsp; <a class="qindex" href="annotated.html">Compound List</a> &nbsp; <a class="qindex" href="files.html">File List</a> &nbsp; <a class="qindex" href="namespacemembers.html">Namespace Members</a> &nbsp; <a class="qindex" href="functions.html">Compound Members</a> &nbsp; <a class="qindex" href="globals.html">File Members</a> &nbsp; <a class="qindex" href="pages.html">Related Pages</a> &nbsp; </center>
<hr><h1>OgreD3D7RenderSystem.cpp</h1><a href="OgreD3D7RenderSystem_8cpp.html">Go to the documentation of this file.</a><div class="fragment"><pre>00001 <font class="comment">/*</font>
00002 <font class="comment">-----------------------------------------------------------------------------</font>
00003 <font class="comment">This source file is part of OGRE</font>
00004 <font class="comment">    (Object-oriented Graphics Rendering Engine)</font>
00005 <font class="comment">For the latest info, see http://www.stevestreeting.com/ogre/</font>
00006 <font class="comment"></font>
00007 <font class="comment">Copyright © 2000-2001 Steven J. Streeting</font>
00008 <font class="comment">Also see acknowledgements in Readme.html</font>
00009 <font class="comment"></font>
00010 <font class="comment">This program is free software; you can redistribute it and/or modify it under</font>
00011 <font class="comment">the terms of the GNU General Public License as published by the Free Software</font>
00012 <font class="comment">Foundation; either version 2 of the License, or (at your option) any later</font>
00013 <font class="comment">version.</font>
00014 <font class="comment"></font>
00015 <font class="comment">This program is distributed in the hope that it will be useful, but WITHOUT</font>
00016 <font class="comment">ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or FITNESS</font>
00017 <font class="comment">FOR A PARTICULAR PURPOSE. See the GNU General Public License for more details.</font>
00018 <font class="comment"></font>
00019 <font class="comment">You should have received a copy of the GNU General Public License along with</font>
00020 <font class="comment">this program; if not, write to the Free Software Foundation, Inc., 59 Temple</font>
00021 <font class="comment">Place - Suite 330, Boston, MA 02111-1307, USA, or go to</font>
00022 <font class="comment">http://www.gnu.org/copyleft/gpl.html.</font>
00023 <font class="comment">-----------------------------------------------------------------------------</font>
00024 <font class="comment">*/</font>
00025 <font class="preprocessor">#include "<a class="code" href="OgreD3D7RenderSystem_8h.html">OgreD3D7RenderSystem.h</a>"</font>
00026 <font class="preprocessor">#include "<a class="code" href="OgreDDDriver_8h.html">OgreDDDriver.h</a>"</font>
00027 <font class="preprocessor">#include "<a class="code" href="OgreD3D7Device_8h.html">OgreD3D7Device.h</a>"</font>
00028 <font class="preprocessor">#include "<a class="code" href="OgreD3D7DeviceList_8h.html">OgreD3D7DeviceList.h</a>"</font>
00029 <font class="preprocessor">#include "<a class="code" href="OgreDDDriverList_8h.html">OgreDDDriverList.h</a>"</font>
00030 <font class="preprocessor">#include "<a class="code" href="OgreDDVideoModeList_8h.html">OgreDDVideoModeList.h</a>"</font>
00031 <font class="preprocessor">#include "<a class="code" href="OgreDDVideoMode_8h.html">OgreDDVideoMode.h</a>"</font>
00032 <font class="preprocessor">#include "<a class="code" href="OgreRenderWindow_8h.html">OgreRenderWindow.h</a>"</font>
00033 <font class="preprocessor">#include "<a class="code" href="OgreLogManager_8h.html">OgreLogManager.h</a>"</font>
00034 <font class="preprocessor">#include "<a class="code" href="OgreRenderSystem_8h.html">OgreRenderSystem.h</a>"</font>
00035 <font class="preprocessor">#include "<a class="code" href="OgreException_8h.html">OgreException.h</a>"</font>
00036 <font class="preprocessor">#include "<a class="code" href="OgreSceneManager_8h.html">OgreSceneManager.h</a>"</font>
00037 <font class="preprocessor">#include "<a class="code" href="OgreD3D7TextureManager_8h.html">OgreD3D7TextureManager.h</a>"</font>
00038 <font class="preprocessor">#include "<a class="code" href="OgreViewport_8h.html">OgreViewport.h</a>"</font>
00039 <font class="preprocessor">#include "<a class="code" href="OgreLight_8h.html">OgreLight.h</a>"</font>
00040 <font class="preprocessor">#include "<a class="code" href="OgreMatrix4_8h.html">OgreMatrix4.h</a>"</font>
00041 <font class="preprocessor">#include "<a class="code" href="OgreMath_8h.html">OgreMath.h</a>"</font>
00042 <font class="preprocessor">#include "<a class="code" href="OgreD3D7RenderWindow_8h.html">OgreD3D7RenderWindow.h</a>"</font>
00043 
00044 <font class="preprocessor">#include &lt;d3dx.h&gt;</font>
00045 <font class="preprocessor">#include "d3dutil.h"</font>
00046 
00047 <font class="keyword">namespace </font>Ogre {
00048     <font class="comment">//-----------------------------------------------------------------------</font>
<a name="l00049"></a><a class="code" href="classOgre_1_1D3DRenderSystem.html#Ogre_1_1D3DRenderSystema0">00049</a>     D3DRenderSystem::D3DRenderSystem(HINSTANCE hInstance)
00050     {
00051         <a class="code" href="OgreException_8h.html#a1">OgreGuard</a>( <font class="stringliteral">"D3DRenderSystem::D3DRenderSystem"</font> );
00052 
00053         LogManager::getSingleton().logMessage(<a class="code" href="classOgre_1_1D3DRenderSystem.html#Ogre_1_1D3DRenderSystema2">getName</a>() + <font class="stringliteral">" created."</font>);
00054 
00055         <a class="code" href="classOgre_1_1D3DRenderSystem.html#Ogre_1_1D3DRenderSystemo0">mlpD3DDevice</a> = NULL;
00056         <font class="comment">// Reset driver list</font>
00057         <a class="code" href="classOgre_1_1D3DRenderSystem.html#Ogre_1_1D3DRenderSystemo2">mDriverList</a> = NULL;
00058         <a class="code" href="classOgre_1_1D3DRenderSystem.html#Ogre_1_1D3DRenderSystemo3">mActiveDDDriver</a> = NULL;
00059         <a class="code" href="classOgre_1_1D3DRenderSystem.html#Ogre_1_1D3DRenderSystemo5">mhInstance</a> = hInstance;
00060 
00061         <font class="comment">// Init light array</font>
00062         <font class="keywordflow">for</font> (<font class="keywordtype">int</font> i = 0; i &lt; MAX_LIGHTS; ++i)
00063             <a class="code" href="classOgre_1_1D3DRenderSystem.html#Ogre_1_1D3DRenderSystemo4">mLights</a>[i] = 0;
00064 
00065 
00066         <a class="code" href="classOgre_1_1D3DRenderSystem.html#Ogre_1_1D3DRenderSystemc4">initConfigOptions</a>();
00067 
00068         <font class="comment">// Initialise D3DX library</font>
00069         D3DXInitialize();
00070 
00071         <a class="code" href="OgreException_8h.html#a2">OgreUnguard</a>();
00072     }
00073 
00074     <font class="comment">//-----------------------------------------------------------------------</font>
<a name="l00075"></a><a class="code" href="classOgre_1_1D3DRenderSystem.html#Ogre_1_1D3DRenderSystema1">00075</a>     D3DRenderSystem::~D3DRenderSystem()
00076     {
00077         <a class="code" href="OgreException_8h.html#a1">OgreGuard</a>( <font class="stringliteral">"D3DRenderSystem::~D3DRenderSystem"</font> );
00078 
00079         <font class="keywordflow">if</font> (mTextureManager)
00080             <font class="keyword">delete</font> <a class="code" href="classOgre_1_1RenderSystem.html#Ogre_1_1SDLRenderSystemn3">mTextureManager</a>;
00081         D3DXUninitialize();
00082         LogManager::getSingleton().logMessage(<a class="code" href="classOgre_1_1D3DRenderSystem.html#Ogre_1_1D3DRenderSystema2">getName</a>() + <font class="stringliteral">" destroyed."</font>);
00083 
00084         <a class="code" href="OgreException_8h.html#a2">OgreUnguard</a>();
00085     }
00086 
00087     <font class="comment">//-----------------------------------------------------------------------</font>
<a name="l00088"></a><a class="code" href="classOgre_1_1D3DRenderSystem.html#Ogre_1_1D3DRenderSystema2">00088</a>     <font class="keyword">const</font> <a class="code" href="classOgre_1_1String.html">String</a>&amp; D3DRenderSystem::getName(<font class="keywordtype">void</font>)<font class="keyword"> const</font>
00089 <font class="keyword">    </font>{
00090         <font class="keyword">static</font> <a class="code" href="classOgre_1_1String.html">String</a> strName(<font class="stringliteral">"Direct3D Rendering Subsystem"</font>);
00091         <font class="keywordflow">return</font> strName;
00092     }
00093 
00094     <font class="comment">//-----------------------------------------------------------------------</font>
<a name="l00095"></a><a class="code" href="classOgre_1_1D3DRenderSystem.html#Ogre_1_1D3DRenderSystemc4">00095</a>     <font class="keywordtype">void</font> D3DRenderSystem::initConfigOptions(<font class="keywordtype">void</font>)
00096     {
00097         <a class="code" href="OgreException_8h.html#a1">OgreGuard</a>( <font class="stringliteral">"D3DRenderSystem::initConfigOptions"</font> );
00098 
00099         <a class="code" href="classOgre_1_1DDDriverList.html">DDDriverList</a>* ddList;
00100         <a class="code" href="classOgre_1_1DDDriver.html">DDDriver</a>* dd;
00101 
00102         <a class="code" href="structOgre_1_1__ConfigOption.html">ConfigOption</a> optDevice;
00103         <a class="code" href="structOgre_1_1__ConfigOption.html">ConfigOption</a> optVideoMode;
00104         <a class="code" href="structOgre_1_1__ConfigOption.html">ConfigOption</a> optFullScreen;
00105         <a class="code" href="structOgre_1_1__ConfigOption.html">ConfigOption</a> optVSync;
00106 
00107         ddList = this-&gt;<a class="code" href="classOgre_1_1D3DRenderSystem.html#Ogre_1_1D3DRenderSystemc0">getDirectDrawDrivers</a>();
00108 
00109         <font class="comment">// Create option for devices</font>
00110         optDevice.<a class="code" href="structOgre_1_1__ConfigOption.html#Ogre_1_1__ConfigOptionm0">name</a> = <font class="stringliteral">"Rendering Device"</font>;
00111         optDevice.<a class="code" href="structOgre_1_1__ConfigOption.html#Ogre_1_1__ConfigOptionm1">currentValue</a> = <font class="stringliteral">""</font>;
00112         optDevice.<a class="code" href="structOgre_1_1__ConfigOption.html#Ogre_1_1__ConfigOptionm2">possibleValues</a>.clear();
00113         optDevice.<a class="code" href="structOgre_1_1__ConfigOption.html#Ogre_1_1__ConfigOptionm3">immutable</a> = <font class="keyword">false</font>;
00114 
00115         <font class="comment">// Option for video modes</font>
00116         optVideoMode.<a class="code" href="structOgre_1_1__ConfigOption.html#Ogre_1_1__ConfigOptionm0">name</a> = <font class="stringliteral">"Video Mode"</font>;
00117         optVideoMode.<a class="code" href="structOgre_1_1__ConfigOption.html#Ogre_1_1__ConfigOptionm1">currentValue</a> = <font class="stringliteral">""</font>;
00118         optVideoMode.<a class="code" href="structOgre_1_1__ConfigOption.html#Ogre_1_1__ConfigOptionm3">immutable</a> = <font class="keyword">false</font>;
00119 
00120         <font class="comment">// Option for full screen</font>
00121         optFullScreen.<a class="code" href="structOgre_1_1__ConfigOption.html#Ogre_1_1__ConfigOptionm0">name</a> = <font class="stringliteral">"Full Screen"</font>;
00122         optFullScreen.<a class="code" href="structOgre_1_1__ConfigOption.html#Ogre_1_1__ConfigOptionm2">possibleValues</a>.push_back(<font class="stringliteral">"Yes"</font>);
00123         optFullScreen.<a class="code" href="structOgre_1_1__ConfigOption.html#Ogre_1_1__ConfigOptionm2">possibleValues</a>.push_back(<font class="stringliteral">"No"</font>);
00124         optFullScreen.<a class="code" href="structOgre_1_1__ConfigOption.html#Ogre_1_1__ConfigOptionm1">currentValue</a> = <font class="stringliteral">"Yes"</font>;
00125 
00126 
00127 
00128         <font class="comment">// First, get DirectDraw driver options</font>
00129         <font class="keywordflow">for</font>( <font class="keywordtype">unsigned</font> j = 0; j &lt; ddList-&gt;<a class="code" href="classOgre_1_1DDDriverList.html#Ogre_1_1DDDriverLista4">count</a>(); j++ )
00130         {
00131             dd = ddList-&gt;<a class="code" href="classOgre_1_1DDDriverList.html#Ogre_1_1DDDriverLista3">item</a>(j);
00132             <font class="comment">// Add to device option list</font>
00133             optDevice.<a class="code" href="structOgre_1_1__ConfigOption.html#Ogre_1_1__ConfigOptionm2">possibleValues</a>.push_back(dd-&gt;<a class="code" href="classOgre_1_1DDDriver.html#Ogre_1_1DDDrivera9">DriverDescription</a>());
00134 
00135             <font class="comment">// Make first one default</font>
00136             <font class="keywordflow">if</font>( j==0 )
00137             {
00138                 optDevice.<a class="code" href="structOgre_1_1__ConfigOption.html#Ogre_1_1__ConfigOptionm1">currentValue</a> = dd-&gt;<a class="code" href="classOgre_1_1DDDriver.html#Ogre_1_1DDDrivera9">DriverDescription</a>();
00139 
00140             }
00141 
00142 
00143         }
00144 
00145         <font class="comment">// VSync option</font>
00146         optVSync.<a class="code" href="structOgre_1_1__ConfigOption.html#Ogre_1_1__ConfigOptionm0">name</a> = <font class="stringliteral">"VSync"</font>;
00147         optVSync.<a class="code" href="structOgre_1_1__ConfigOption.html#Ogre_1_1__ConfigOptionm3">immutable</a> = <font class="keyword">false</font>;
00148         optVSync.<a class="code" href="structOgre_1_1__ConfigOption.html#Ogre_1_1__ConfigOptionm2">possibleValues</a>.push_back(<font class="stringliteral">"Yes"</font>);
00149         optVSync.<a class="code" href="structOgre_1_1__ConfigOption.html#Ogre_1_1__ConfigOptionm2">possibleValues</a>.push_back(<font class="stringliteral">"No"</font>);
00150         optVSync.<a class="code" href="structOgre_1_1__ConfigOption.html#Ogre_1_1__ConfigOptionm1">currentValue</a> = <font class="stringliteral">"Yes"</font>;
00151 
00152 
00153         <a class="code" href="classOgre_1_1RenderSystem.html#Ogre_1_1SDLRenderSystemn1">mOptions</a>[optDevice.<a class="code" href="structOgre_1_1__ConfigOption.html#Ogre_1_1__ConfigOptionm0">name</a>] = optDevice;
00154         <a class="code" href="classOgre_1_1RenderSystem.html#Ogre_1_1SDLRenderSystemn1">mOptions</a>[optVideoMode.<a class="code" href="structOgre_1_1__ConfigOption.html#Ogre_1_1__ConfigOptionm0">name</a>] = optVideoMode;
00155         <a class="code" href="classOgre_1_1RenderSystem.html#Ogre_1_1SDLRenderSystemn1">mOptions</a>[optFullScreen.<a class="code" href="structOgre_1_1__ConfigOption.html#Ogre_1_1__ConfigOptionm0">name</a>] = optFullScreen;
00156         <a class="code" href="classOgre_1_1RenderSystem.html#Ogre_1_1SDLRenderSystemn1">mOptions</a>[optVSync.<a class="code" href="structOgre_1_1__ConfigOption.html#Ogre_1_1__ConfigOptionm0">name</a>] = optVSync;
00157 
00158         <font class="comment">// Set default-based settings</font>
00159         <a class="code" href="classOgre_1_1D3DRenderSystem.html#Ogre_1_1D3DRenderSystemc1">refreshDDSettings</a>();
00160 
00161         <a class="code" href="OgreException_8h.html#a2">OgreUnguard</a>();
00162     }
00163 
00164     <font class="comment">//-----------------------------------------------------------------------</font>
<a name="l00165"></a><a class="code" href="classOgre_1_1D3DRenderSystem.html#Ogre_1_1D3DRenderSystemc1">00165</a>     <font class="keywordtype">void</font> D3DRenderSystem::refreshDDSettings(<font class="keywordtype">void</font>)
00166     {
00167         <a class="code" href="OgreException_8h.html#a1">OgreGuard</a>( <font class="stringliteral">"D3DRenderSystem::refreshDDSettings"</font> );
00168 
00169         <a class="code" href="classOgre_1_1DDVideoMode.html">DDVideoMode</a>* vid;
00170         <a class="code" href="structOgre_1_1__ConfigOption.html">ConfigOption</a>* optVideoMode;
00171         <a class="code" href="structOgre_1_1__ConfigOption.html">ConfigOption</a>* optFullScreen;
00172         <a class="code" href="classOgre_1_1DDDriver.html">DDDriver</a>* dd;
00173 
00174         <font class="comment">// Stuffs DD-Driver specific settings</font>
00175 
00176         <font class="comment">// Find DD Driver selected in options</font>
00177         ConfigOptionMap::iterator opt = <a class="code" href="classOgre_1_1RenderSystem.html#Ogre_1_1SDLRenderSystemn1">mOptions</a>.find(<font class="stringliteral">"Rendering Device"</font>);
00178 
00179         <font class="keywordflow">if</font>( opt != <a class="code" href="classOgre_1_1RenderSystem.html#Ogre_1_1SDLRenderSystemn1">mOptions</a>.end() )
00180         {
00181             <font class="keywordflow">for</font>( <font class="keywordtype">unsigned</font> j = 0; j &lt; <a class="code" href="classOgre_1_1D3DRenderSystem.html#Ogre_1_1D3DRenderSystemc0">getDirectDrawDrivers</a>()-&gt;<a class="code" href="classOgre_1_1DDDriverList.html#Ogre_1_1DDDriverLista4">count</a>(); j++ )
00182             {
00183                 dd = <a class="code" href="classOgre_1_1D3DRenderSystem.html#Ogre_1_1D3DRenderSystemc0">getDirectDrawDrivers</a>()-&gt;<a class="code" href="classOgre_1_1DDDriverList.html#Ogre_1_1DDDriverLista3">item</a>(j);
00184                 <font class="keywordflow">if</font>( dd-&gt;<a class="code" href="classOgre_1_1DDDriver.html#Ogre_1_1DDDrivera9">DriverDescription</a>() == opt-&gt;second.currentValue )
00185                     <font class="keywordflow">break</font>;
00186             }
00187 
00188             <font class="comment">// Get fullScreen and Video mode options</font>
00189             opt = <a class="code" href="classOgre_1_1RenderSystem.html#Ogre_1_1SDLRenderSystemn1">mOptions</a>.find(<font class="stringliteral">"Video Mode"</font>);
00190             optVideoMode = &amp;opt-&gt;second;
00191             opt = <a class="code" href="classOgre_1_1RenderSystem.html#Ogre_1_1SDLRenderSystemn1">mOptions</a>.find(<font class="stringliteral">"Full Screen"</font>);
00192             optFullScreen = &amp;opt-&gt;second;
00193 
00194             <font class="comment">// Full screen forced?</font>
00195             <font class="keywordflow">if</font> (!(dd-&gt;<a class="code" href="classOgre_1_1DDDriver.html#Ogre_1_1DDDrivera20">CanRenderWindowed</a>()))
00196             {
00197                 <a class="code" href="classOgre_1_1D3DRenderSystem.html#Ogre_1_1D3DRenderSystema4">setConfigOption</a>(<font class="stringliteral">"Full Screen"</font>, <font class="stringliteral">"Yes"</font>);
00198                 optFullScreen-&gt;<a class="code" href="structOgre_1_1__ConfigOption.html#Ogre_1_1__ConfigOptionm3">immutable</a> = <font class="keyword">true</font>;
00199             }
00200             <font class="keywordflow">else</font>
00201                 optFullScreen-&gt;<a class="code" href="structOgre_1_1__ConfigOption.html#Ogre_1_1__ConfigOptionm3">immutable</a> = <font class="keyword">false</font>;
00202 
00203             <font class="comment">// Get video modes for this device</font>
00204             optVideoMode-&gt;<a class="code" href="structOgre_1_1__ConfigOption.html#Ogre_1_1__ConfigOptionm2">possibleValues</a>.clear();
00205 
00206             <font class="keywordflow">for</font>( <font class="keywordtype">unsigned</font> k = 0; k&lt;dd-&gt;<a class="code" href="classOgre_1_1DDDriver.html#Ogre_1_1DDDrivera12">getVideoModeList</a>()-&gt;<a class="code" href="classOgre_1_1DDVideoModeList.html#Ogre_1_1DDVideoModeLista4">count</a>(); k++ )
00207             {
00208                 vid = dd-&gt;<a class="code" href="classOgre_1_1DDDriver.html#Ogre_1_1DDDrivera12">getVideoModeList</a>()-&gt;<a class="code" href="classOgre_1_1DDVideoModeList.html#Ogre_1_1DDVideoModeLista3">item</a>(k);
00209                 optVideoMode-&gt;<a class="code" href="structOgre_1_1__ConfigOption.html#Ogre_1_1__ConfigOptionm2">possibleValues</a>.push_back(vid-&gt;<a class="code" href="classOgre_1_1DDVideoMode.html#Ogre_1_1DDVideoModea0">Description</a>());
00210             }
00211         }
00212 
00213         <a class="code" href="OgreException_8h.html#a2">OgreUnguard</a>();
00214     }
00215 
00216 
00217     <font class="comment">//-----------------------------------------------------------------------</font>
<a name="l00218"></a><a class="code" href="classOgre_1_1D3DRenderSystem.html#Ogre_1_1D3DRenderSystema3">00218</a>     <a class="code" href="namespaceOgre.html#a97">ConfigOptionMap</a>&amp; D3DRenderSystem::getConfigOptions(<font class="keywordtype">void</font>)
00219     {
00220         <font class="comment">// Return a COPY of the current config options</font>
00221         <font class="keywordflow">return</font> <a class="code" href="classOgre_1_1RenderSystem.html#Ogre_1_1SDLRenderSystemn1">mOptions</a>;
00222 
00223     }
00224 
00225     <font class="comment">//-----------------------------------------------------------------------</font>
<a name="l00226"></a><a class="code" href="classOgre_1_1D3DRenderSystem.html#Ogre_1_1D3DRenderSystema4">00226</a>     <font class="keywordtype">void</font> D3DRenderSystem::setConfigOption(<font class="keyword">const</font> <a class="code" href="classOgre_1_1String.html">String</a> &amp;name, <font class="keyword">const</font> <a class="code" href="classOgre_1_1String.html">String</a> &amp;value)
00227     {
00228         <a class="code" href="OgreException_8h.html#a1">OgreGuard</a>( <font class="stringliteral">"D3DRenderSystem::setConfigOption"</font> );
00229 
00230         <font class="keywordtype">char</font> msg[128];
00231 
00232         sprintf(msg, <font class="stringliteral">"RenderSystem Option: %s = %s"</font>, name.c_str(), value.c_str());
00233         LogManager::getSingleton().logMessage(msg);
00234 
00235         <font class="comment">// Find option</font>
00236         ConfigOptionMap::iterator it = <a class="code" href="classOgre_1_1RenderSystem.html#Ogre_1_1SDLRenderSystemn1">mOptions</a>.find(name);
00237 
00238         <font class="comment">// Update</font>
00239         <font class="keywordflow">if</font>( it != <a class="code" href="classOgre_1_1RenderSystem.html#Ogre_1_1SDLRenderSystemn1">mOptions</a>.end())
00240             it-&gt;second.currentValue = value;
00241         <font class="keywordflow">else</font>
00242         {
00243             sprintf(msg, <font class="stringliteral">"Option named %s does not exist."</font>, name.c_str());
00244             <a class="code" href="OgreException_8h.html#a0">Except</a>(Exception::ERR_INVALIDPARAMS,
00245                 msg, <font class="stringliteral">"D3DRenderSystem::setConfigOption"</font>);
00246         }
00247 
00248         <font class="comment">// Refresh other options if DD Driver changed</font>
00249         <font class="keywordflow">if</font> (name == <font class="stringliteral">"Rendering Device"</font>)
00250             <a class="code" href="classOgre_1_1D3DRenderSystem.html#Ogre_1_1D3DRenderSystemc1">refreshDDSettings</a>();
00251 
00252         <font class="keywordflow">if</font> (name == <font class="stringliteral">"Full Screen"</font>)
00253         {
00254             <font class="keywordflow">if</font> (value == <font class="stringliteral">"No"</font>)
00255             {
00256                 <font class="comment">// Video mode is not applicable</font>
00257                 it = <a class="code" href="classOgre_1_1RenderSystem.html#Ogre_1_1SDLRenderSystemn1">mOptions</a>.find(<font class="stringliteral">"Video Mode"</font>);
00258                 it-&gt;second.currentValue = <font class="stringliteral">"N/A"</font>;
00259                 it-&gt;second.immutable = <font class="keyword">true</font>;
00260             }
00261             <font class="keywordflow">else</font>
00262             {
00263                 <font class="comment">// Video mode is applicable</font>
00264                 it = <a class="code" href="classOgre_1_1RenderSystem.html#Ogre_1_1SDLRenderSystemn1">mOptions</a>.find(<font class="stringliteral">"Video Mode"</font>);
00265                 <font class="comment">// default to 640 x 480 x 16</font>
00266                 it-&gt;second.currentValue = <font class="stringliteral">"640 x 480 @ 16-bit colour"</font>;
00267                 it-&gt;second.immutable = <font class="keyword">false</font>;
00268             }
00269         }
00270 
00271         <a class="code" href="OgreException_8h.html#a2">OgreUnguard</a>();
00272     }
00273     <font class="comment">//-----------------------------------------------------------------------</font>
<a name="l00274"></a><a class="code" href="classOgre_1_1D3DRenderSystem.html#Ogre_1_1D3DRenderSystema5">00274</a>     <a class="code" href="classOgre_1_1String.html">String</a> D3DRenderSystem::validateConfigOptions(<font class="keywordtype">void</font>)
00275     {
00276         <font class="comment">// Check video mode specified in full screen mode</font>
00277         ConfigOptionMap::iterator o = <a class="code" href="classOgre_1_1RenderSystem.html#Ogre_1_1SDLRenderSystemn1">mOptions</a>.find(<font class="stringliteral">"Full Screen"</font>);
00278         <font class="keywordflow">if</font> (o-&gt;second.currentValue == <font class="stringliteral">"Yes"</font>)
00279         {
00280             <font class="comment">// Check video mode</font>
00281             o = <a class="code" href="classOgre_1_1RenderSystem.html#Ogre_1_1SDLRenderSystemn1">mOptions</a>.find(<font class="stringliteral">"Video Mode"</font>);
00282             <font class="keywordflow">if</font> (o-&gt;second.currentValue == <font class="stringliteral">""</font>)
00283             {
00284                 <font class="keywordflow">return</font> <font class="stringliteral">"A video mode must be selected for running in full-screen mode."</font>;
00285             }
00286         }
00287         <font class="keywordflow">return</font> <font class="stringliteral">""</font>;
00288 
00289     }
00290     <font class="comment">//-----------------------------------------------------------------------</font>
<a name="l00291"></a><a class="code" href="classOgre_1_1D3DRenderSystem.html#Ogre_1_1D3DRenderSystema6">00291</a>     <a class="code" href="classOgre_1_1RenderWindow.html">RenderWindow</a>* D3DRenderSystem::initialise(<font class="keywordtype">bool</font> autoCreateWindow)
00292     {
00293         <a class="code" href="classOgre_1_1RenderWindow.html">RenderWindow</a>* autoWindow = 0;
00294 
00295         <font class="comment">// call superclass method</font>
00296         RenderSystem::initialise(autoCreateWindow);
00297 
00298         LogManager::getSingleton().logMessage(
00299             <font class="stringliteral">"***************************************\n"</font>
00300             <font class="stringliteral">"*** Direct3D Subsystem Initialising ***\n"</font>
00301             <font class="stringliteral">"***************************************"</font> );
00302 
00303         <font class="comment">// ---------------------------</font>
00304         <font class="comment">// Init using current settings</font>
00305         <font class="comment">// ---------------------------</font>
00306 
00307         <font class="comment">// DirectDraw driver</font>
00308         <a class="code" href="classOgre_1_1D3DRenderSystem.html#Ogre_1_1D3DRenderSystemo3">mActiveDDDriver</a> = 0;
00309         ConfigOptionMap::iterator opt = <a class="code" href="classOgre_1_1RenderSystem.html#Ogre_1_1SDLRenderSystemn1">mOptions</a>.find(<font class="stringliteral">"Rendering Device"</font>);
00310         <font class="keywordflow">for</font>( <font class="keywordtype">unsigned</font> j = 0; j&lt;<a class="code" href="classOgre_1_1D3DRenderSystem.html#Ogre_1_1D3DRenderSystemc0">getDirectDrawDrivers</a>()-&gt;<a class="code" href="classOgre_1_1DDDriverList.html#Ogre_1_1DDDriverLista4">count</a>(); j++ )
00311         {
00312             <font class="keywordflow">if</font> (<a class="code" href="classOgre_1_1D3DRenderSystem.html#Ogre_1_1D3DRenderSystemc0">getDirectDrawDrivers</a>()-&gt;<a class="code" href="classOgre_1_1DDDriverList.html#Ogre_1_1DDDriverLista3">item</a>(j)-&gt;<a class="code" href="classOgre_1_1DDDriver.html#Ogre_1_1DDDrivera9">DriverDescription</a>() == opt-&gt;second.currentValue)
00313             {
00314                 <a class="code" href="classOgre_1_1D3DRenderSystem.html#Ogre_1_1D3DRenderSystemo3">mActiveDDDriver</a> = <a class="code" href="classOgre_1_1D3DRenderSystem.html#Ogre_1_1D3DRenderSystemc0">getDirectDrawDrivers</a>()-&gt;<a class="code" href="classOgre_1_1DDDriverList.html#Ogre_1_1DDDriverLista3">item</a>(j);
00315                 <font class="keywordflow">break</font>;
00316             }
00317         }
00318 
00319         <font class="keywordflow">if</font> (!<a class="code" href="classOgre_1_1D3DRenderSystem.html#Ogre_1_1D3DRenderSystemo3">mActiveDDDriver</a>)
00320             <a class="code" href="OgreException_8h.html#a0">Except</a>(Exception::ERR_INVALIDPARAMS, <font class="stringliteral">"Problems finding requested DirectDraw driver!"</font>,
00321                 <font class="stringliteral">"D3DRenderSystem::initialise"</font>);
00322 
00323 
00324         <font class="comment">// Sort out the creation of a new window if required</font>
00325         <font class="keywordflow">if</font> (autoCreateWindow)
00326         {
00327             <font class="comment">// Full screen?</font>
00328             <font class="keywordtype">bool</font> fullScreen;
00329             opt = <a class="code" href="classOgre_1_1RenderSystem.html#Ogre_1_1SDLRenderSystemn1">mOptions</a>.find(<font class="stringliteral">"Full Screen"</font>);
00330             <font class="keywordflow">if</font>( opt == <a class="code" href="classOgre_1_1RenderSystem.html#Ogre_1_1SDLRenderSystemn1">mOptions</a>.end() )
00331                 <a class="code" href="OgreException_8h.html#a0">Except</a>(999, <font class="stringliteral">"Can't find full screen option!"</font>,
00332                     <font class="stringliteral">"D3DRenderSystem::initialise"</font>);
00333             <font class="keywordflow">if</font> (opt-&gt;second.currentValue == <font class="stringliteral">"Yes"</font>)
00334                 fullScreen = <font class="keyword">true</font>;
00335             <font class="keywordflow">else</font>
00336                 fullScreen = <font class="keyword">false</font>;
00337 
00338             <font class="comment">// Get video mode</font>
00339             <a class="code" href="classOgre_1_1DDVideoMode.html">DDVideoMode</a>* vid;
00340             <font class="keywordtype">int</font> height, width, colourDepth;
00341 
00342             vid = 0;
00343             <a class="code" href="classOgre_1_1String.html">String</a> temp;
00344             <font class="keywordflow">if</font> (fullScreen)
00345             {
00346                 opt = <a class="code" href="classOgre_1_1RenderSystem.html#Ogre_1_1SDLRenderSystemn1">mOptions</a>.find(<font class="stringliteral">"Video Mode"</font>);
00347 
00348                 <font class="keywordflow">for</font>( <font class="keywordtype">unsigned</font> j=0; j&lt;<a class="code" href="classOgre_1_1D3DRenderSystem.html#Ogre_1_1D3DRenderSystemo3">mActiveDDDriver</a>-&gt;<a class="code" href="classOgre_1_1DDDriver.html#Ogre_1_1DDDrivera12">getVideoModeList</a>()-&gt;<a class="code" href="classOgre_1_1DDVideoModeList.html#Ogre_1_1DDVideoModeLista4">count</a>(); j++ )
00349                 {
00350                     temp = <a class="code" href="classOgre_1_1D3DRenderSystem.html#Ogre_1_1D3DRenderSystemo3">mActiveDDDriver</a>-&gt;<a class="code" href="classOgre_1_1DDDriver.html#Ogre_1_1DDDrivera12">getVideoModeList</a>()-&gt;<a class="code" href="classOgre_1_1DDVideoModeList.html#Ogre_1_1DDVideoModeLista3">item</a>(j)-&gt;<a class="code" href="classOgre_1_1DDVideoMode.html#Ogre_1_1DDVideoModea0">Description</a>();
00351                     <font class="keywordflow">if</font> (temp == opt-&gt;second.currentValue)
00352                     {
00353                         vid = <a class="code" href="classOgre_1_1D3DRenderSystem.html#Ogre_1_1D3DRenderSystemo3">mActiveDDDriver</a>-&gt;<a class="code" href="classOgre_1_1DDDriver.html#Ogre_1_1DDDrivera12">getVideoModeList</a>()-&gt;<a class="code" href="classOgre_1_1DDVideoModeList.html#Ogre_1_1DDVideoModeLista3">item</a>(j);
00354                         <font class="keywordflow">break</font>;
00355                     }
00356                 }
00357 
00358                 <font class="keywordflow">if</font> (!vid)
00359                     <a class="code" href="OgreException_8h.html#a0">Except</a>(9999, <font class="stringliteral">"Can't find requested video mode."</font>,
00360                         <font class="stringliteral">"D3DRenderSystem::initilise"</font>);
00361                 width = vid-&gt;<a class="code" href="classOgre_1_1DDVideoMode.html#Ogre_1_1DDVideoModem0">mWidth</a>;
00362                 height = vid-&gt;<a class="code" href="classOgre_1_1DDVideoMode.html#Ogre_1_1DDVideoModem1">mHeight</a>;
00363                 colourDepth = vid-&gt;<a class="code" href="classOgre_1_1DDVideoMode.html#Ogre_1_1DDVideoModem2">mColourDepth</a>;
00364 
00365             }
00366             <font class="keywordflow">else</font>
00367             {
00368                 <font class="comment">// Notional height / width</font>
00369                 width = 640;
00370                 height = 480;
00371                 colourDepth = 0; <font class="comment">// colour depth based on desktop</font>
00372             }
00373 
00374             <font class="comment">// Create myself a window</font>
00375             autoWindow = this-&gt;<a class="code" href="classOgre_1_1D3DRenderSystem.html#Ogre_1_1D3DRenderSystema14">createRenderWindow</a>(<font class="stringliteral">"OGRE Render Window"</font>, width, height, colourDepth, fullScreen);
00376 
00377 
00378 
00379         }
00380 
00381         opt = <a class="code" href="classOgre_1_1RenderSystem.html#Ogre_1_1SDLRenderSystemn1">mOptions</a>.find(<font class="stringliteral">"VSync"</font>);
00382         <font class="keywordflow">if</font> (opt!=<a class="code" href="classOgre_1_1RenderSystem.html#Ogre_1_1SDLRenderSystemn1">mOptions</a>.end())
00383         {
00384             <font class="keywordflow">if</font> (opt-&gt;second.currentValue == <font class="stringliteral">"Yes"</font>)
00385             {
00386                 <a class="code" href="classOgre_1_1RenderSystem.html#Ogre_1_1SDLRenderSystema51">setWaitForVerticalBlank</a>(<font class="keyword">true</font>);
00387             }
00388             <font class="keywordflow">else</font>
00389             {
00390                 <a class="code" href="classOgre_1_1RenderSystem.html#Ogre_1_1SDLRenderSystema51">setWaitForVerticalBlank</a>(<font class="keyword">false</font>);
00391             }
00392         }
00393 
00394 
00395         LogManager::getSingleton().logMessage(<font class="stringliteral">"*****************************************"</font>);
00396         LogManager::getSingleton().logMessage(<font class="stringliteral">"*** Direct3D Subsystem Initialised Ok ***"</font>);
00397         LogManager::getSingleton().logMessage(<font class="stringliteral">"*****************************************"</font>);
00398 
00399 
00400 
00401         <font class="keywordflow">return</font> autoWindow;
00402 
00403     }
00404 
00405     <font class="comment">//-----------------------------------------------------------------------</font>
<a name="l00406"></a><a class="code" href="classOgre_1_1D3DRenderSystem.html#Ogre_1_1D3DRenderSystema7">00406</a>     <font class="keywordtype">void</font> D3DRenderSystem::reinitialise(<font class="keywordtype">void</font>)
00407     {
00408         this-&gt;<a class="code" href="classOgre_1_1D3DRenderSystem.html#Ogre_1_1D3DRenderSystema8">shutdown</a>();
00409         this-&gt;<a class="code" href="classOgre_1_1D3DRenderSystem.html#Ogre_1_1D3DRenderSystema6">initialise</a>(<font class="keyword">true</font>);
00410     }
00411 
00412 
00413     <font class="comment">//-----------------------------------------------------------------------</font>
<a name="l00414"></a><a class="code" href="classOgre_1_1D3DRenderSystem.html#Ogre_1_1D3DRenderSystema8">00414</a>     <font class="keywordtype">void</font> D3DRenderSystem::shutdown(<font class="keywordtype">void</font>)
00415     {
00416         RenderSystem::shutdown();
00417 
00418         <font class="comment">// Cleanup</font>
00419         <font class="comment">// Release all DirectX resources</font>
00420         <font class="comment">//D3DTextr_InvalidateAllTextures();</font>
00421         <font class="keywordflow">if</font> (mActiveDDDriver)
00422         {
00423             <a class="code" href="classOgre_1_1D3DRenderSystem.html#Ogre_1_1D3DRenderSystemo3">mActiveDDDriver</a>-&gt;<a class="code" href="classOgre_1_1DDDriver.html#Ogre_1_1DDDrivera5">Cleanup</a>();
00424         }
00425 
00426         <font class="comment">// Delete system objects</font>
00427         <font class="keywordflow">if</font> (mDriverList)
00428             <font class="keyword">delete</font> <a class="code" href="classOgre_1_1D3DRenderSystem.html#Ogre_1_1D3DRenderSystemo2">mDriverList</a>;
00429 
00430         <a class="code" href="classOgre_1_1D3DRenderSystem.html#Ogre_1_1D3DRenderSystemo3">mActiveDDDriver</a> = NULL;
00431 
00432 
00433 
00434         <font class="comment">// Write termination message</font>
00435         LogManager::getSingleton().logMessage(<font class="stringliteral">"*-*-* Direct3D Subsystem shutting down cleanly."</font>);
00436 
00437 
00438     }
00439 
00440     <font class="comment">//-----------------------------------------------------------------------</font>
<a name="l00441"></a><a class="code" href="classOgre_1_1D3DRenderSystem.html#Ogre_1_1D3DRenderSystema9">00441</a>     <font class="keywordtype">void</font> D3DRenderSystem::startRendering(<font class="keywordtype">void</font>)
00442     {
00443         <a class="code" href="OgreException_8h.html#a1">OgreGuard</a>( <font class="stringliteral">"D3DRenderSystem::startRendering"</font> );
00444 
00445         BOOL bGotMsg;
00446         <font class="keywordtype">bool</font> isActive;
00447         <font class="keywordtype">bool</font> allWindowsClosed;
00448         MSG  msg;
00449         <font class="keyword">static</font> <font class="keywordtype">float</font> lastStartTime;
00450         <font class="keyword">static</font> <font class="keywordtype">float</font> lastEndTime;
00451 
00452         <font class="comment">// Init times to avoid large first-frame time</font>
00453         lastStartTime = lastEndTime = ((float)clock())/CLOCKS_PER_SEC;
00454 
00455         <font class="comment">// Call superclass</font>
00456         RenderSystem::startRendering();
00457 
00458         <font class="comment">// Render this window</font>
00459         PeekMessage( &amp;msg, NULL, 0U, 0U, PM_NOREMOVE );
00460 
00461         <font class="keywordflow">while</font>( WM_QUIT != msg.message  )
00462         {
00463             <font class="comment">// Check all windows to see if any are active / closed</font>
00464             isActive = <font class="keyword">false</font>;
00465             allWindowsClosed = <font class="keyword">true</font>; <font class="comment">// assume all closed unless we find otherwise</font>
00466             <font class="keywordflow">for</font>(RenderWindowMap::iterator i = <a class="code" href="classOgre_1_1RenderSystem.html#Ogre_1_1SDLRenderSystemn2">mRenderWindows</a>.begin(); i != <a class="code" href="classOgre_1_1RenderSystem.html#Ogre_1_1SDLRenderSystemn2">mRenderWindows</a>.end(); )
00467             {
00468                 <font class="keywordflow">if</font> (i-&gt;second-&gt;isActive())
00469                     isActive = <font class="keyword">true</font>;
00470 
00471                 <font class="keywordflow">if</font> (i-&gt;second-&gt;isClosed())
00472                 {
00473                     <font class="comment">// Window has been closed, destroy</font>
00474                     <a class="code" href="classOgre_1_1D3DRenderSystem.html#Ogre_1_1D3DRenderSystema15">destroyRenderWindow</a>(i-&gt;second);
00475 
00476                     RenderWindowMap::iterator j = i; ++j;
00477                     <a class="code" href="classOgre_1_1RenderSystem.html#Ogre_1_1SDLRenderSystemn2">mRenderWindows</a>.erase(i);
00478                     i = j;
00479                 }
00480                 <font class="keywordflow">else</font>
00481                 {
00482                     allWindowsClosed = <font class="keyword">false</font>;
00483                     ++i;
00484                 }
00485 
00486             }
00487 
00488             <font class="comment">// Break out if all windows closed</font>
00489             <font class="keywordflow">if</font> (allWindowsClosed)
00490             {
00491                 <font class="keywordflow">return</font>;
00492             }
00493 
00494 
00495             <font class="comment">// Use PeekMessage() if any windows are active, so we can use idle time to</font>
00496             <font class="comment">// render the scene. Else, use GetMessage() to avoid eating CPU time.</font>
00497             <font class="keywordflow">if</font>( isActive )
00498             {
00499                 bGotMsg = PeekMessage( &amp;msg, NULL, 0U, 0U, PM_REMOVE );
00500             }
00501             <font class="keywordflow">else</font>
00502             {
00503                 bGotMsg = GetMessage( &amp;msg, NULL, 0U, 0U );
00504             }
00505             <font class="keywordflow">if</font>( bGotMsg )
00506             {
00507                 TranslateMessage( &amp;msg );
00508                 DispatchMessage( &amp;msg );
00509             }
00510             <font class="keywordflow">else</font>
00511             {
00512                 <a class="code" href="structOgre_1_1FrameEvent.html">FrameEvent</a> evt;
00513 
00514                 <font class="comment">// Do frame start event</font>
00515                 <font class="keywordtype">float</font> fTime = ((float)clock())/CLOCKS_PER_SEC; <font class="comment">// Get current time in seconds</font>
00516                 evt.<a class="code" href="structOgre_1_1FrameEvent.html#Ogre_1_1FrameEventm1">timeSinceLastFrame</a> = fTime - lastStartTime;
00517                 evt.<a class="code" href="structOgre_1_1FrameEvent.html#Ogre_1_1FrameEventm0">timeSinceLastEvent</a> = fTime - lastEndTime;
00518 
00519                 <font class="comment">// Stop rendering if frame callback says so</font>
00520                 <font class="keywordflow">if</font>(!<a class="code" href="classOgre_1_1RenderSystem.html#Ogre_1_1SDLRenderSystemb0">fireFrameStarted</a>(evt))
00521                     <font class="keywordflow">return</font>;
00522 
00523                 lastStartTime = fTime;
00524 
00525                 <font class="comment">// Render a frame during idle time (no messages are waiting)</font>
00526                 <font class="keywordflow">for</font>(i = <a class="code" href="classOgre_1_1RenderSystem.html#Ogre_1_1SDLRenderSystemn2">mRenderWindows</a>.begin(); i!=<a class="code" href="classOgre_1_1RenderSystem.html#Ogre_1_1SDLRenderSystemn2">mRenderWindows</a>.end(); ++i)
00527                 {
00528                     <font class="keywordflow">if</font> (i-&gt;second-&gt;isActive())
00529                     {
00530                         i-&gt;second-&gt;update();
00531                     }
00532                 }
00533 
00534                 <font class="comment">// Do frame ended event</font>
00535                 fTime = ((float)clock())/CLOCKS_PER_SEC; <font class="comment">// Get current time in seconds</font>
00536                 evt.<a class="code" href="structOgre_1_1FrameEvent.html#Ogre_1_1FrameEventm1">timeSinceLastFrame</a> = fTime - lastEndTime;
00537                 evt.<a class="code" href="structOgre_1_1FrameEvent.html#Ogre_1_1FrameEventm0">timeSinceLastEvent</a> = fTime - lastStartTime;
00538 
00539                 <font class="comment">// Stop rendering if frame callback says so</font>
00540                 <font class="keywordflow">if</font>(!<a class="code" href="classOgre_1_1RenderSystem.html#Ogre_1_1SDLRenderSystemb1">fireFrameEnded</a>(evt))
00541                     <font class="keywordflow">return</font>;
00542 
00543                 lastEndTime = fTime;
00544 
00545             }
00546         }
00547 
00548         <a class="code" href="OgreException_8h.html#a2">OgreUnguard</a>();
00549     }
00550 
00551     <font class="comment">//-----------------------------------------------------------------------</font>
<a name="l00552"></a><a class="code" href="classOgre_1_1D3DRenderSystem.html#Ogre_1_1D3DRenderSystema10">00552</a>     <font class="keywordtype">void</font> D3DRenderSystem::setAmbientLight(<font class="keywordtype">float</font> r, <font class="keywordtype">float</font> g, <font class="keywordtype">float</font> b)
00553     {
00554         <font class="comment">// Call D3D</font>
00555         D3DCOLOR col = D3DRGB(r,g,b);
00556 
00557         HRESULT hr = <a class="code" href="classOgre_1_1D3DRenderSystem.html#Ogre_1_1D3DRenderSystemo0">mlpD3DDevice</a>-&gt;SetRenderState(D3DRENDERSTATE_AMBIENT, col);
00558         <font class="keywordflow">if</font> (FAILED(hr))
00559             <a class="code" href="OgreException_8h.html#a0">Except</a>(hr, <font class="stringliteral">"Error setting ambient light."</font>, <font class="stringliteral">"D3DRenderSystem::setAmbientLight"</font>);
00560     }
00561 
00562     <font class="comment">//-----------------------------------------------------------------------</font>
<a name="l00563"></a><a class="code" href="classOgre_1_1D3DRenderSystem.html#Ogre_1_1D3DRenderSystema11">00563</a>     <font class="keywordtype">void</font> D3DRenderSystem::setShadingType(<a class="code" href="namespaceOgre.html#a428">ShadeOptions</a> so)
00564     {
00565         D3DSHADEMODE d3dMode;
00566         <font class="keywordflow">switch</font>(so)
00567         {
00568         <font class="keywordflow">case</font> <a class="code" href="namespaceOgre.html#a428a77">SO_FLAT</a>:
00569             d3dMode = D3DSHADE_FLAT;
00570             <font class="keywordflow">break</font>;
00571         <font class="keywordflow">case</font> <a class="code" href="namespaceOgre.html#a428a78">SO_GOURAUD</a>:
00572             d3dMode = D3DSHADE_GOURAUD;
00573             <font class="keywordflow">break</font>;
00574         <font class="keywordflow">case</font> <a class="code" href="namespaceOgre.html#a428a79">SO_PHONG</a>:
00575             d3dMode = D3DSHADE_PHONG;
00576             <font class="keywordflow">break</font>;
00577 
00578         }
00579 
00580         HRESULT hr = <a class="code" href="classOgre_1_1D3DRenderSystem.html#Ogre_1_1D3DRenderSystemo0">mlpD3DDevice</a>-&gt;SetRenderState(D3DRENDERSTATE_SHADEMODE, d3dMode);
00581         <font class="keywordflow">if</font> (FAILED(hr))
00582             <a class="code" href="OgreException_8h.html#a0">Except</a>(hr, <font class="stringliteral">"Error setting shading mode."</font>, <font class="stringliteral">"D3DRenderSystem::setShadingType"</font>);
00583 
00584     }
00585 
00586     <font class="comment">//-----------------------------------------------------------------------</font>
<a name="l00587"></a><a class="code" href="classOgre_1_1D3DRenderSystem.html#Ogre_1_1D3DRenderSystema12">00587</a>     <font class="keywordtype">void</font> D3DRenderSystem::setTextureFiltering(<a class="code" href="namespaceOgre.html#a427">TextureFilterOptions</a> fo)
00588     {
00589         <font class="keywordtype">int</font> units = <a class="code" href="classOgre_1_1D3DRenderSystem.html#Ogre_1_1D3DRenderSystema28">_getNumTextureUnits</a>();
00590         <font class="keywordflow">for</font> (<font class="keywordtype">int</font> i = 0; i &lt; units; ++i)
00591         {
00592             <font class="keywordflow">switch</font>(fo)
00593             {
00594                 <font class="comment">// Note fall-through if device doesn't support requested type</font>
00595             <font class="keywordflow">case</font> <a class="code" href="namespaceOgre.html#a427a76">TFO_TRILINEAR</a>:
00596                 <font class="keywordflow">if</font> ((<a class="code" href="classOgre_1_1D3DRenderSystem.html#Ogre_1_1D3DRenderSystemo1">mD3DDeviceDesc</a>.dpcTriCaps.dwTextureFilterCaps &amp; D3DPTFILTERCAPS_LINEARMIPLINEAR) &gt; 0)
00597                 {
00598                     <a class="code" href="classOgre_1_1D3DRenderSystem.html#Ogre_1_1D3DRenderSystemo0">mlpD3DDevice</a>-&gt;SetTextureStageState(i,D3DTSS_MAGFILTER, D3DTFG_LINEAR);
00599                     <a class="code" href="classOgre_1_1D3DRenderSystem.html#Ogre_1_1D3DRenderSystemo0">mlpD3DDevice</a>-&gt;SetTextureStageState(i,D3DTSS_MINFILTER, D3DTFN_LINEAR);
00600                     <a class="code" href="classOgre_1_1D3DRenderSystem.html#Ogre_1_1D3DRenderSystemo0">mlpD3DDevice</a>-&gt;SetTextureStageState(i,D3DTSS_MIPFILTER, D3DTFP_LINEAR);
00601                     LogManager::getSingleton().logMessage(<font class="stringliteral">"Texture filtering set to: TRILINEAR"</font>);
00602                     <font class="keywordflow">break</font>;
00603                 }
00604             <font class="keywordflow">case</font> <a class="code" href="namespaceOgre.html#a427a75">TFO_BILINEAR</a>:
00605                 <font class="keywordflow">if</font> ((<a class="code" href="classOgre_1_1D3DRenderSystem.html#Ogre_1_1D3DRenderSystemo1">mD3DDeviceDesc</a>.dpcTriCaps.dwTextureFilterCaps &amp; D3DPTFILTERCAPS_LINEAR) &gt; 0)
00606                 {
00607                     <a class="code" href="classOgre_1_1D3DRenderSystem.html#Ogre_1_1D3DRenderSystemo0">mlpD3DDevice</a>-&gt;SetTextureStageState(i,D3DTSS_MAGFILTER, D3DTFG_LINEAR);
00608                     <a class="code" href="classOgre_1_1D3DRenderSystem.html#Ogre_1_1D3DRenderSystemo0">mlpD3DDevice</a>-&gt;SetTextureStageState(i,D3DTSS_MINFILTER, D3DTFN_LINEAR);
00609                     <a class="code" href="classOgre_1_1D3DRenderSystem.html#Ogre_1_1D3DRenderSystemo0">mlpD3DDevice</a>-&gt;SetTextureStageState(i,D3DTSS_MIPFILTER, D3DTFP_POINT);
00610                     LogManager::getSingleton().logMessage(<font class="stringliteral">"Texture filtering set to: BILINEAR"</font>);
00611                     <font class="keywordflow">break</font>;
00612                 }
00613             <font class="keywordflow">case</font> <a class="code" href="namespaceOgre.html#a427a74">TFO_NONE</a>:
00614                 <a class="code" href="classOgre_1_1D3DRenderSystem.html#Ogre_1_1D3DRenderSystemo0">mlpD3DDevice</a>-&gt;SetTextureStageState(i,D3DTSS_MAGFILTER, D3DTFG_POINT);
00615                 <a class="code" href="classOgre_1_1D3DRenderSystem.html#Ogre_1_1D3DRenderSystemo0">mlpD3DDevice</a>-&gt;SetTextureStageState(i,D3DTSS_MINFILTER, D3DTFN_POINT);
00616                 <a class="code" href="classOgre_1_1D3DRenderSystem.html#Ogre_1_1D3DRenderSystemo0">mlpD3DDevice</a>-&gt;SetTextureStageState(i,D3DTSS_MIPFILTER, D3DTFP_NONE);
00617                 LogManager::getSingleton().logMessage(<font class="stringliteral">"Texture filtering disabled."</font>);
00618                 <font class="keywordflow">break</font>;
00619             }
00620         }
00621     }
00622 
00623 
00624     <font class="comment">//-----------------------------------------------------------------------</font>
<a name="l00625"></a><a class="code" href="classOgre_1_1D3DRenderSystem.html#Ogre_1_1D3DRenderSystema14">00625</a>     <a class="code" href="classOgre_1_1RenderWindow.html">RenderWindow</a>* D3DRenderSystem::createRenderWindow(<font class="keyword">const</font> <a class="code" href="classOgre_1_1String.html">String</a> &amp;name, <font class="keywordtype">int</font> width, <font class="keywordtype">int</font> height, <font class="keywordtype">int</font> colourDepth,
00626         <font class="keywordtype">bool</font> fullScreen, <font class="keywordtype">int</font> left, <font class="keywordtype">int</font> top, <font class="keywordtype">bool</font> depthBuffer, <a class="code" href="classOgre_1_1RenderWindow.html">RenderWindow</a>* parentWindowHandle)
00627     {
00628         <a class="code" href="OgreException_8h.html#a1">OgreGuard</a>( <font class="stringliteral">"D3DRenderSystem::createRenderWindow"</font> );
00629 
00630         <a class="code" href="classOgre_1_1String.html">String</a> msg;
00631 
00632         <font class="comment">// Make sure we don't already have a render target of the</font>
00633         <font class="comment">// same name as the one supplied</font>
00634         <font class="keywordflow">if</font> (<a class="code" href="classOgre_1_1RenderSystem.html#Ogre_1_1SDLRenderSystemn2">mRenderWindows</a>.find(name) != <a class="code" href="classOgre_1_1RenderSystem.html#Ogre_1_1SDLRenderSystemn2">mRenderWindows</a>.end() )
00635         {
00636             msg = msg + <font class="stringliteral">"A render target of the same name ("</font> + name + <font class="stringliteral">") already "</font>
00637                 <font class="stringliteral">"exists. You cannot create a new window with this name."</font>;
00638             <a class="code" href="OgreException_8h.html#a0">Except</a>(999,msg,<font class="stringliteral">"D3DRenderSystem::createRenderWindow"</font>);
00639         }
00640 
00641         <a class="code" href="classOgre_1_1RenderWindow.html">RenderWindow</a>* win = <font class="keyword">new</font> <a class="code" href="classOgre_1_1Win32Window.html">Win32Window</a>();
00642         <font class="comment">// Create window, supplying DD interface &amp; hInstance</font>
00643         win-&gt;<a class="code" href="classOgre_1_1RenderWindow.html#Ogre_1_1RenderWindowa0">create</a>(name, width, height, colourDepth, fullScreen,
00644             left, top, depthBuffer, &amp;<a class="code" href="classOgre_1_1D3DRenderSystem.html#Ogre_1_1D3DRenderSystemo5">mhInstance</a>, <a class="code" href="classOgre_1_1D3DRenderSystem.html#Ogre_1_1D3DRenderSystemo3">mActiveDDDriver</a>, parentWindowHandle);
00645 
00646         <font class="comment">// Add window to render target list</font>
00647         <a class="code" href="classOgre_1_1RenderSystem.html#Ogre_1_1SDLRenderSystemn2">mRenderWindows</a>[name] = win;
00648 
00649         <font class="comment">// If this is the parent window, get the D3D device</font>
00650         <font class="comment">//  and create the texture manager</font>
00651         <font class="keywordflow">if</font> (parentWindowHandle == 0)
00652         {
00653             win-&gt;<a class="code" href="classOgre_1_1RenderTarget.html#Ogre_1_1SDLWindowa28">getCustomAttribute</a>(<font class="stringliteral">"D3DDEVICE"</font>, &amp;<a class="code" href="classOgre_1_1D3DRenderSystem.html#Ogre_1_1D3DRenderSystemo0">mlpD3DDevice</a>);
00654             <font class="comment">// Get caps</font>
00655             <a class="code" href="classOgre_1_1D3DRenderSystem.html#Ogre_1_1D3DRenderSystemo0">mlpD3DDevice</a>-&gt;GetCaps(&amp;<a class="code" href="classOgre_1_1D3DRenderSystem.html#Ogre_1_1D3DRenderSystemo1">mD3DDeviceDesc</a>);
00656             <font class="comment">// Create my texture manager for use by others</font>
00657             <font class="comment">// Note this is a Singleton; pointer is held static by superclass</font>
00658             <a class="code" href="classOgre_1_1RenderSystem.html#Ogre_1_1SDLRenderSystemn3">mTextureManager</a> = <font class="keyword">new</font> <a class="code" href="classOgre_1_1D3DTextureManager.html">D3DTextureManager</a>(<a class="code" href="classOgre_1_1D3DRenderSystem.html#Ogre_1_1D3DRenderSystemo0">mlpD3DDevice</a>);
00659         }
00660 
00661         <a class="code" href="OgreException_8h.html#a3">OgreUnguardRet</a>( win );
00662     }
00663     <font class="comment">//-----------------------------------------------------------------------</font>
<a name="l00664"></a><a class="code" href="classOgre_1_1D3DRenderSystem.html#Ogre_1_1D3DRenderSystema15">00664</a>     <font class="keywordtype">void</font> D3DRenderSystem::destroyRenderWindow(<a class="code" href="classOgre_1_1RenderWindow.html">RenderWindow</a>* pWin)
00665     {
00666         <font class="comment">// Find it to remove from list</font>
00667         RenderWindowMap::iterator i = <a class="code" href="classOgre_1_1RenderSystem.html#Ogre_1_1SDLRenderSystemn2">mRenderWindows</a>.begin();
00668 
00669         <font class="keywordflow">while</font> (i-&gt;second != pWin &amp;&amp; i != <a class="code" href="classOgre_1_1RenderSystem.html#Ogre_1_1SDLRenderSystemn2">mRenderWindows</a>.end())
00670         {
00671             <font class="keywordflow">if</font> (i-&gt;second == pWin)
00672             {
00673                 <a class="code" href="classOgre_1_1RenderSystem.html#Ogre_1_1SDLRenderSystemn2">mRenderWindows</a>.erase(i);
00674                 <font class="keyword">delete</font> pWin;
00675                 <font class="keywordflow">break</font>;
00676             }
00677         }
00678 
00679     }
00680     <font class="comment">//-----------------------------------------------------------------------</font>
00681     <font class="comment">// Low-level overridden members</font>
00682     <font class="comment">//-----------------------------------------------------------------------</font>
<a name="l00683"></a><a class="code" href="classOgre_1_1D3DRenderSystem.html#Ogre_1_1D3DRenderSystema18">00683</a>     <font class="keywordtype">void</font> D3DRenderSystem::_addLight(<a class="code" href="classOgre_1_1Light.html">Light</a> *lt)
00684     {
00685 
00686         <font class="comment">// Find first free slot</font>
00687         <font class="keywordtype">int</font> i;
00688         <font class="keywordflow">for</font> (i =0; i &lt; MAX_LIGHTS; ++i)
00689         {
00690             <font class="keywordflow">if</font> (!<a class="code" href="classOgre_1_1D3DRenderSystem.html#Ogre_1_1D3DRenderSystemo4">mLights</a>[i])
00691             {
00692                 <a class="code" href="classOgre_1_1D3DRenderSystem.html#Ogre_1_1D3DRenderSystemo4">mLights</a>[i] = lt;
00693                 <font class="keywordflow">break</font>;
00694             }
00695         }
00696         <font class="comment">// No space in array?</font>
00697         <font class="keywordflow">if</font> (i == MAX_LIGHTS)
00698             <a class="code" href="OgreException_8h.html#a0">Except</a>(999, <font class="stringliteral">"No free light slots - cannot add light."</font>, <font class="stringliteral">"D3DRenderSystem::addLight"</font>);
00699 
00700         <a class="code" href="classOgre_1_1D3DRenderSystem.html#Ogre_1_1D3DRenderSystemc7">setD3DLight</a>(i, lt);
00701 
00702 
00703 
00704     }
00705     <font class="comment">//-----------------------------------------------------------------------</font>
<a name="l00706"></a><a class="code" href="classOgre_1_1D3DRenderSystem.html#Ogre_1_1D3DRenderSystema20">00706</a>     <font class="keywordtype">void</font> D3DRenderSystem::_modifyLight(<a class="code" href="classOgre_1_1Light.html">Light</a>* lt)
00707     {
00708         <font class="comment">// Locate light in list</font>
00709         <font class="keywordtype">int</font> lightIndex;
00710         <font class="keywordflow">for</font> (<font class="keywordtype">int</font> i = 0; i &lt; MAX_LIGHTS; ++i)
00711         {
00712             <font class="keywordflow">if</font> (<a class="code" href="classOgre_1_1D3DRenderSystem.html#Ogre_1_1D3DRenderSystemo4">mLights</a>[i] == lt)
00713             {
00714                 lightIndex = i;
00715                 <font class="keywordflow">break</font>;
00716             }
00717         }
00718 
00719         <font class="keywordflow">if</font> (i == MAX_LIGHTS)
00720             <a class="code" href="OgreException_8h.html#a0">Except</a>(Exception::ERR_INVALIDPARAMS, <font class="stringliteral">"Cannot locate light to modify."</font>,
00721                 <font class="stringliteral">"D3DRenderSystem::_modifyLight"</font>);
00722 
00723         <a class="code" href="classOgre_1_1D3DRenderSystem.html#Ogre_1_1D3DRenderSystemc7">setD3DLight</a>(lightIndex, lt);
00724 
00725     }
00726     <font class="comment">//-----------------------------------------------------------------------</font>
<a name="l00727"></a><a class="code" href="classOgre_1_1D3DRenderSystem.html#Ogre_1_1D3DRenderSystemc7">00727</a>     <font class="keywordtype">void</font> D3DRenderSystem::setD3DLight(<font class="keywordtype">int</font> index, <a class="code" href="classOgre_1_1Light.html">Light</a>* lt)
00728     {
00729         <font class="comment">// Add to D3D</font>
00730         HRESULT hr;
00731         D3DLIGHT7 d3dLight;
00732 
00733         <font class="keywordflow">switch</font> (lt-&gt;<a class="code" href="classOgre_1_1Light.html#Ogre_1_1Lighta5">getType</a>())
00734         {
00735         <font class="keywordflow">case</font> Light::LT_POINT:
00736             d3dLight.dltType = D3DLIGHT_POINT;
00737             <font class="keywordflow">break</font>;
00738         <font class="keywordflow">case</font> Light::LT_DIRECTIONAL:
00739             d3dLight.dltType = D3DLIGHT_DIRECTIONAL;
00740             <font class="keywordflow">break</font>;
00741         <font class="keywordflow">case</font> Light::LT_SPOTLIGHT:
00742             d3dLight.dltType = D3DLIGHT_SPOT;
00743             d3dLight.dvFalloff = lt-&gt;<a class="code" href="classOgre_1_1Light.html#Ogre_1_1Lighta26">getSpotlightFalloff</a>();
00744             d3dLight.dvTheta = Math::getSingleton().DegreesToRadians(lt-&gt;<a class="code" href="classOgre_1_1Light.html#Ogre_1_1Lighta24">getSpotlightInnerAngle</a>());
00745             d3dLight.dvPhi = Math::getSingleton().DegreesToRadians(lt-&gt;<a class="code" href="classOgre_1_1Light.html#Ogre_1_1Lighta25">getSpotlightOuterAngle</a>());
00746             <font class="keywordflow">break</font>;
00747         }
00748 
00749         <font class="comment">// Colours</font>
00750         <a class="code" href="classOgre_1_1ColourValue.html">ColourValue</a> col;
00751         col = lt-&gt;<a class="code" href="classOgre_1_1Light.html#Ogre_1_1Lighta8">getDiffuseColour</a>();
00752         d3dLight.dcvDiffuse.r = col.<a class="code" href="classOgre_1_1ColourValue.html#Ogre_1_1ColourValuem0">r</a>;
00753         d3dLight.dcvDiffuse.g = col.<a class="code" href="classOgre_1_1ColourValue.html#Ogre_1_1ColourValuem1">g</a>;
00754         d3dLight.dcvDiffuse.b = col.<a class="code" href="classOgre_1_1ColourValue.html#Ogre_1_1ColourValuem2">b</a>;
00755         d3dLight.dcvDiffuse.a = col.<a class="code" href="classOgre_1_1ColourValue.html#Ogre_1_1ColourValuem3">a</a>;
00756 
00757         col = lt-&gt;<a class="code" href="classOgre_1_1Light.html#Ogre_1_1Lighta11">getSpecularColour</a>();
00758         d3dLight.dcvSpecular.r = col.<a class="code" href="classOgre_1_1ColourValue.html#Ogre_1_1ColourValuem0">r</a>;
00759         d3dLight.dcvSpecular.g = col.<a class="code" href="classOgre_1_1ColourValue.html#Ogre_1_1ColourValuem1">g</a>;
00760         d3dLight.dcvSpecular.b = col.<a class="code" href="classOgre_1_1ColourValue.html#Ogre_1_1ColourValuem2">b</a>;
00761         d3dLight.dcvSpecular.a = col.<a class="code" href="classOgre_1_1ColourValue.html#Ogre_1_1ColourValuem3">a</a>;
00762 
00763         <font class="comment">// Never use ambient for a movable light</font>
00764         d3dLight.dcvAmbient.r = 0.0;
00765         d3dLight.dcvAmbient.g = 0.0;
00766         d3dLight.dcvAmbient.b = 0.0;
00767         d3dLight.dcvAmbient.a = 0.0;
00768 
00769         <font class="comment">// Position (Irrelevant for directional)</font>
00770         <a class="code" href="classOgre_1_1Vector3.html">Vector3</a> vec;
00771         <font class="keywordflow">if</font> (lt-&gt;<a class="code" href="classOgre_1_1Light.html#Ogre_1_1Lighta5">getType</a>() != Light::LT_DIRECTIONAL)
00772         {
00773             vec = lt-&gt;<a class="code" href="classOgre_1_1Light.html#Ogre_1_1Lighta33">getDerivedPosition</a>();
00774 
00775             d3dLight.dvPosition.x = vec.<a class="code" href="classOgre_1_1Vector3.html#Ogre_1_1Vector3m0">x</a>;
00776             d3dLight.dvPosition.y = vec.<a class="code" href="classOgre_1_1Vector3.html#Ogre_1_1Vector3m1">y</a>;
00777             d3dLight.dvPosition.z = vec.<a class="code" href="classOgre_1_1Vector3.html#Ogre_1_1Vector3m2">z</a>;
00778         }
00779         <font class="comment">// Direction (Irrelevant for point lights)</font>
00780         <font class="keywordflow">if</font> (lt-&gt;<a class="code" href="classOgre_1_1Light.html#Ogre_1_1Lighta5">getType</a>() != Light::LT_POINT)
00781         {
00782             vec = lt-&gt;<a class="code" href="classOgre_1_1Light.html#Ogre_1_1Lighta34">getDerivedDirection</a>();
00783             d3dLight.dvDirection.x = vec.<a class="code" href="classOgre_1_1Vector3.html#Ogre_1_1Vector3m0">x</a>;
00784             d3dLight.dvDirection.y = vec.<a class="code" href="classOgre_1_1Vector3.html#Ogre_1_1Vector3m1">y</a>;
00785             d3dLight.dvDirection.z = vec.<a class="code" href="classOgre_1_1Vector3.html#Ogre_1_1Vector3m2">z</a>;
00786         }
00787         <font class="comment">// Attenuation parameters</font>
00788         d3dLight.dvRange = lt-&gt;<a class="code" href="classOgre_1_1Light.html#Ogre_1_1Lighta13">getAttenuationRange</a>();
00789         d3dLight.dvAttenuation0 = lt-&gt;<a class="code" href="classOgre_1_1Light.html#Ogre_1_1Lighta14">getAttenuationConstant</a>();
00790         d3dLight.dvAttenuation1 = lt-&gt;<a class="code" href="classOgre_1_1Light.html#Ogre_1_1Lighta15">getAttenuationLinear</a>();
00791         d3dLight.dvAttenuation2 = lt-&gt;<a class="code" href="classOgre_1_1Light.html#Ogre_1_1Lighta16">getAttenuationQuadric</a>();
00792 
00793 
00794 
00795         <font class="comment">// Set light state</font>
00796         hr = <a class="code" href="classOgre_1_1D3DRenderSystem.html#Ogre_1_1D3DRenderSystemo0">mlpD3DDevice</a>-&gt;SetLight(index, &amp;d3dLight);
00797 
00798         <font class="keywordflow">if</font> (FAILED(hr))
00799             <a class="code" href="OgreException_8h.html#a0">Except</a>(hr, <font class="stringliteral">"Unable to set light details"</font>, <font class="stringliteral">"D3DRenderSystem::setD3DLight"</font>);
00800 
00801         hr = <a class="code" href="classOgre_1_1D3DRenderSystem.html#Ogre_1_1D3DRenderSystemo0">mlpD3DDevice</a>-&gt;LightEnable(index, TRUE);
00802         <font class="keywordflow">if</font> (FAILED(hr))
00803             <a class="code" href="OgreException_8h.html#a0">Except</a>(hr, <font class="stringliteral">"Unable to enable light."</font>, <font class="stringliteral">"D3DRenderSystem::setD3DLight"</font>);
00804 
00805 
00806         lt-&gt;<a class="code" href="classOgre_1_1Light.html#Ogre_1_1Lighta28">_clearModified</a>();
00807 
00808     }
00809     <font class="comment">//-----------------------------------------------------------------------</font>
<a name="l00810"></a><a class="code" href="classOgre_1_1D3DRenderSystem.html#Ogre_1_1D3DRenderSystema19">00810</a>     <font class="keywordtype">void</font> D3DRenderSystem::_removeLight(<a class="code" href="classOgre_1_1Light.html">Light</a> *lt)
00811     {
00812         <font class="comment">// Remove &amp; disable light</font>
00813         <font class="keywordflow">for</font> (<font class="keywordtype">int</font> i = 0; i &lt; MAX_LIGHTS; ++i)
00814         {
00815             <font class="keywordflow">if</font> (<a class="code" href="classOgre_1_1D3DRenderSystem.html#Ogre_1_1D3DRenderSystemo4">mLights</a>[i] == lt)
00816             {
00817                 <a class="code" href="classOgre_1_1D3DRenderSystem.html#Ogre_1_1D3DRenderSystemo0">mlpD3DDevice</a>-&gt;LightEnable(i, FALSE);
00818                 <a class="code" href="classOgre_1_1D3DRenderSystem.html#Ogre_1_1D3DRenderSystemo4">mLights</a>[i] = 0;
00819                 <font class="keywordflow">break</font>;
00820             }
00821         }
00822 
00823     }
00824 
00825     <font class="comment">//-----------------------------------------------------------------------</font>
<a name="l00826"></a><a class="code" href="classOgre_1_1D3DRenderSystem.html#Ogre_1_1D3DRenderSystema21">00826</a>     <font class="keywordtype">void</font> D3DRenderSystem::_removeAllLights(<font class="keywordtype">void</font>)
00827     {
00828         <font class="comment">// Remove &amp; disable all lights</font>
00829         <font class="keywordflow">for</font> (<font class="keywordtype">int</font> i = 0; i &lt; MAX_LIGHTS; ++i)
00830         {
00831             <font class="keywordflow">if</font> (<a class="code" href="classOgre_1_1D3DRenderSystem.html#Ogre_1_1D3DRenderSystemo4">mLights</a>[i])
00832             {
00833                 <a class="code" href="classOgre_1_1D3DRenderSystem.html#Ogre_1_1D3DRenderSystemo0">mlpD3DDevice</a>-&gt;LightEnable(i, FALSE);
00834                 <a class="code" href="classOgre_1_1D3DRenderSystem.html#Ogre_1_1D3DRenderSystemo4">mLights</a>[i] = 0;
00835             }
00836         }
00837 
00838     }
00839 
00840     <font class="comment">//-----------------------------------------------------------------------</font>
<a name="l00841"></a><a class="code" href="classOgre_1_1D3DRenderSystem.html#Ogre_1_1D3DRenderSystema22">00841</a>     <font class="keywordtype">void</font> D3DRenderSystem::_pushRenderState(<font class="keywordtype">void</font>)
00842     {
00843         <a class="code" href="OgreException_8h.html#a0">Except</a>(Exception::UNIMPLEMENTED_FEATURE,
00844             <font class="stringliteral">"Sorry, this feature is not yet available."</font>,
00845             <font class="stringliteral">"D3DRenderSystem::_pushRenderState"</font>);
00846     }
00847 
00848     <font class="comment">//-----------------------------------------------------------------------</font>
<a name="l00849"></a><a class="code" href="classOgre_1_1D3DRenderSystem.html#Ogre_1_1D3DRenderSystema23">00849</a>     <font class="keywordtype">void</font> D3DRenderSystem::_popRenderState(<font class="keywordtype">void</font>)
00850     {
00851         <a class="code" href="OgreException_8h.html#a0">Except</a>(Exception::UNIMPLEMENTED_FEATURE,
00852             <font class="stringliteral">"Sorry, this feature is not yet available."</font>,
00853             <font class="stringliteral">"D3DRenderSystem::_popRenderState"</font>);
00854     }
00855 
00856     <font class="comment">//-----------------------------------------------------------------------</font>
<a name="l00857"></a><a class="code" href="classOgre_1_1D3DRenderSystem.html#Ogre_1_1D3DRenderSystemc2">00857</a>     D3DMATRIX D3DRenderSystem::makeD3DMatrix(<font class="keyword">const</font> <a class="code" href="classOgre_1_1Matrix4.html">Matrix4</a>&amp; mat)
00858     {
00859         <font class="comment">// Transpose matrix</font>
00860         <font class="comment">// D3D uses row vectors i.e. V*M</font>
00861         <font class="comment">// Ogre, OpenGL and everything else uses coloumn vectors i.e. M*V</font>
00862         D3DMATRIX d3dMat;
00863 
00864         d3dMat.m[0][0] = mat[0][0];
00865         d3dMat.<a class="code" href="classOgre_1_1Matrix4.html#Ogre_1_1Matrix4n0">m</a>[0][1] = mat[1][0];
00866         d3dMat.<a class="code" href="classOgre_1_1Matrix4.html#Ogre_1_1Matrix4n0">m</a>[0][2] = mat[2][0];
00867         d3dMat.<a class="code" href="classOgre_1_1Matrix4.html#Ogre_1_1Matrix4n0">m</a>[0][3] = mat[3][0];
00868 
00869         d3dMat.<a class="code" href="classOgre_1_1Matrix4.html#Ogre_1_1Matrix4n0">m</a>[1][0] = mat[0][1];
00870         d3dMat.<a class="code" href="classOgre_1_1Matrix4.html#Ogre_1_1Matrix4n0">m</a>[1][1] = mat[1][1];
00871         d3dMat.<a class="code" href="classOgre_1_1Matrix4.html#Ogre_1_1Matrix4n0">m</a>[1][2] = mat[2][1];
00872         d3dMat.<a class="code" href="classOgre_1_1Matrix4.html#Ogre_1_1Matrix4n0">m</a>[1][3] = mat[3][1];
00873 
00874         d3dMat.<a class="code" href="classOgre_1_1Matrix4.html#Ogre_1_1Matrix4n0">m</a>[2][0] = mat[0][2];
00875         d3dMat.<a class="code" href="classOgre_1_1Matrix4.html#Ogre_1_1Matrix4n0">m</a>[2][1] = mat[1][2];
00876         d3dMat.<a class="code" href="classOgre_1_1Matrix4.html#Ogre_1_1Matrix4n0">m</a>[2][2] = mat[2][2];
00877         d3dMat.<a class="code" href="classOgre_1_1Matrix4.html#Ogre_1_1Matrix4n0">m</a>[2][3] = mat[3][2];
00878 
00879         d3dMat.<a class="code" href="classOgre_1_1Matrix4.html#Ogre_1_1Matrix4n0">m</a>[3][0] = mat[0][3];
00880         d3dMat.<a class="code" href="classOgre_1_1Matrix4.html#Ogre_1_1Matrix4n0">m</a>[3][1] = mat[1][3];
00881         d3dMat.<a class="code" href="classOgre_1_1Matrix4.html#Ogre_1_1Matrix4n0">m</a>[3][2] = mat[2][3];
00882         d3dMat.<a class="code" href="classOgre_1_1Matrix4.html#Ogre_1_1Matrix4n0">m</a>[3][3] = mat[3][3];
00883 
00884         <font class="comment">/*</font>
00885 <font class="comment">        for (int row = 0; row &lt; 4; ++row)</font>
00886 <font class="comment">            for (int col = 0; col &lt; 4; ++col)</font>
00887 <font class="comment">                d3dMat.m[col][row] = mat[row][col];</font>
00888 <font class="comment">        */</font>
00889 
00890         <font class="keywordflow">return</font> d3dMat;
00891 
00892 
00893     }
00894 
<a name="l00895"></a><a class="code" href="classOgre_1_1D3DRenderSystem.html#Ogre_1_1D3DRenderSystemc3">00895</a>     <a class="code" href="classOgre_1_1Matrix4.html">Matrix4</a> D3DRenderSystem::convertD3DMatrix(<font class="keyword">const</font> D3DMATRIX&amp; d3dmat)
00896     {
00897         <font class="comment">// The reverse of makeD3DMatrix</font>
00898         <font class="comment">// Transpose matrix</font>
00899         <font class="comment">// D3D uses row vectors i.e. V*M</font>
00900         <font class="comment">// Ogre, OpenGL and everything else uses coloumn vectors i.e. M*V</font>
00901         <a class="code" href="classOgre_1_1Matrix4.html">Matrix4</a> mat;
00902         <font class="keywordflow">for</font> (<font class="keywordtype">int</font> row = 0; row &lt; 4; ++row)
00903             <font class="keywordflow">for</font> (<font class="keywordtype">int</font> col = 0; col &lt; 4; ++col)
00904                 mat[col][row] = d3dmat.<a class="code" href="classOgre_1_1Matrix4.html#Ogre_1_1Matrix4n0">m</a>[row][col];
00905 
00906         <font class="keywordflow">return</font> mat;
00907 
00908 
00909     }
00910     <font class="comment">//-----------------------------------------------------------------------</font>
<a name="l00911"></a><a class="code" href="classOgre_1_1D3DRenderSystem.html#Ogre_1_1D3DRenderSystema24">00911</a>     <font class="keywordtype">void</font> D3DRenderSystem::_setWorldMatrix(<font class="keyword">const</font> <a class="code" href="classOgre_1_1Matrix4.html">Matrix4</a> &amp;m)
00912     {
00913         D3DMATRIX d3dmat = <a class="code" href="classOgre_1_1D3DRenderSystem.html#Ogre_1_1D3DRenderSystemc2">makeD3DMatrix</a>(m);
00914 
00915         HRESULT hr = <a class="code" href="classOgre_1_1D3DRenderSystem.html#Ogre_1_1D3DRenderSystemo0">mlpD3DDevice</a>-&gt;SetTransform(D3DTRANSFORMSTATE_WORLD, &amp;d3dmat);
00916 
00917         <font class="keywordflow">if</font> (FAILED(hr))
00918             <a class="code" href="OgreException_8h.html#a0">Except</a>(hr, <font class="stringliteral">"Cannot set D3D world matrix"</font>,
00919                 <font class="stringliteral">"D3DRenderSystem::_setWorldMatrix"</font>);
00920 
00921     }
00922 
00923     <font class="comment">//-----------------------------------------------------------------------</font>
<a name="l00924"></a><a class="code" href="classOgre_1_1D3DRenderSystem.html#Ogre_1_1D3DRenderSystema25">00924</a>     <font class="keywordtype">void</font> D3DRenderSystem::_setViewMatrix(<font class="keyword">const</font> <a class="code" href="classOgre_1_1Matrix4.html">Matrix4</a> &amp;m)
00925     {
00926         D3DMATRIX d3dmat = <a class="code" href="classOgre_1_1D3DRenderSystem.html#Ogre_1_1D3DRenderSystemc2">makeD3DMatrix</a>(m);
00927 
00928         <font class="comment">// Flip the Z to compensate for D3D's left-handed co-ordinate system</font>
00929         <font class="comment">// No, don't do this! Because: Camera already flips Z ready for screen space</font>
00930         <font class="comment">//d3dmat.m[2][0] = -d3dmat.m[2][0];</font>
00931         <font class="comment">//d3dmat.m[2][1] = -d3dmat.m[2][1];</font>
00932         <font class="comment">//d3dmat.m[2][2] = -d3dmat.m[2][2];</font>
00933         <font class="comment">//d3dmat.m[2][3] = -d3dmat.m[2][3];</font>
00934 
00935 
00936         HRESULT hr = <a class="code" href="classOgre_1_1D3DRenderSystem.html#Ogre_1_1D3DRenderSystemo0">mlpD3DDevice</a>-&gt;SetTransform(D3DTRANSFORMSTATE_VIEW, &amp;d3dmat);
00937 
00938         <font class="keywordflow">if</font> (FAILED(hr))
00939             <a class="code" href="OgreException_8h.html#a0">Except</a>(hr, <font class="stringliteral">"Cannot set D3D view matrix"</font>,
00940                 <font class="stringliteral">"D3DRenderSystem::_setViewMatrix"</font>);
00941 
00942     }
00943     <font class="comment">//-----------------------------------------------------------------------</font>
<a name="l00944"></a><a class="code" href="classOgre_1_1D3DRenderSystem.html#Ogre_1_1D3DRenderSystema26">00944</a>     <font class="keywordtype">void</font> D3DRenderSystem::_setProjectionMatrix(<font class="keyword">const</font> <a class="code" href="classOgre_1_1Matrix4.html">Matrix4</a> &amp;m)
00945     {
00946 
00947         D3DMATRIX d3dmat = <a class="code" href="classOgre_1_1D3DRenderSystem.html#Ogre_1_1D3DRenderSystemc2">makeD3DMatrix</a>(m);
00948         <font class="comment">// Flip a number of entries for d3d</font>
00949         <font class="comment">//d3dmat.m[2][3] = -d3dmat.m[2][3];</font>
00950         <font class="comment">//d3dmat.m[2][2] = -d3dmat.m[2][2];</font>
00951         <font class="comment">//d3dmat.m[3][2] = -d3dmat.m[3][2];</font>
00952 
00953 
00954         HRESULT hr = <a class="code" href="classOgre_1_1D3DRenderSystem.html#Ogre_1_1D3DRenderSystemo0">mlpD3DDevice</a>-&gt;SetTransform(D3DTRANSFORMSTATE_PROJECTION, &amp;d3dmat);
00955 
00956         <font class="keywordflow">if</font> (FAILED(hr))
00957             <a class="code" href="OgreException_8h.html#a0">Except</a>(hr, <font class="stringliteral">"Cannot set D3D projection matrix"</font>,
00958                 <font class="stringliteral">"D3DRenderSystem::_setProjectionMatrix"</font>);
00959 
00960 
00961     }
00962 
00963 
00964     <font class="comment">//-----------------------------------------------------------------------</font>
<a name="l00965"></a><a class="code" href="classOgre_1_1D3DRenderSystem.html#Ogre_1_1D3DRenderSystema27">00965</a>     <font class="keywordtype">void</font> D3DRenderSystem::_setSurfaceParams(<a class="code" href="classOgre_1_1ColourValue.html">ColourValue</a> &amp;ambient,
00966         <a class="code" href="classOgre_1_1ColourValue.html">ColourValue</a> &amp;diffuse, <a class="code" href="classOgre_1_1ColourValue.html">ColourValue</a> &amp;specular,
00967         <a class="code" href="classOgre_1_1ColourValue.html">ColourValue</a> &amp;emissive, <a class="code" href="namespaceOgre.html#a281">Real</a> shininess)
00968     {
00969         <font class="comment">// Remember last call</font>
00970         <font class="keyword">static</font> <a class="code" href="classOgre_1_1ColourValue.html">ColourValue</a> lastAmbient = ColourValue::Black;
00971         <font class="keyword">static</font> <a class="code" href="classOgre_1_1ColourValue.html">ColourValue</a> lastDiffuse = ColourValue::Black;
00972         <font class="keyword">static</font> <a class="code" href="classOgre_1_1ColourValue.html">ColourValue</a> lastSpecular = ColourValue::Black;
00973         <font class="keyword">static</font> <a class="code" href="classOgre_1_1ColourValue.html">ColourValue</a> lastEmissive = ColourValue::Black;
00974         <font class="keyword">static</font> <a class="code" href="namespaceOgre.html#a281">Real</a> lastShininess = 0.0;
00975 
00976         <font class="comment">// Only update if changed</font>
00977         <font class="keywordflow">if</font> (ambient != lastAmbient || diffuse != lastDiffuse ||
00978             specular != lastSpecular || emissive != lastEmissive ||
00979             shininess != lastShininess)
00980         {
00981 
00982             <font class="comment">// Convert to D3D</font>
00983             D3DMATERIAL7 d3dMat;
00984 
00985             d3dMat.dcvDiffuse.r = diffuse.<a class="code" href="classOgre_1_1ColourValue.html#Ogre_1_1ColourValuem0">r</a>;
00986             d3dMat.dcvDiffuse.g = diffuse.<a class="code" href="classOgre_1_1ColourValue.html#Ogre_1_1ColourValuem1">g</a>;
00987             d3dMat.dcvDiffuse.b = diffuse.<a class="code" href="classOgre_1_1ColourValue.html#Ogre_1_1ColourValuem2">b</a>;
00988             d3dMat.dcvDiffuse.a = diffuse.<a class="code" href="classOgre_1_1ColourValue.html#Ogre_1_1ColourValuem3">a</a>;
00989 
00990             d3dMat.dcvAmbient.r = ambient.<a class="code" href="classOgre_1_1ColourValue.html#Ogre_1_1ColourValuem0">r</a>;
00991             d3dMat.dcvAmbient.g = ambient.<a class="code" href="classOgre_1_1ColourValue.html#Ogre_1_1ColourValuem1">g</a>;
00992             d3dMat.dcvAmbient.b = ambient.<a class="code" href="classOgre_1_1ColourValue.html#Ogre_1_1ColourValuem2">b</a>;
00993             d3dMat.dcvAmbient.a = ambient.<a class="code" href="classOgre_1_1ColourValue.html#Ogre_1_1ColourValuem3">a</a>;
00994 
00995             d3dMat.dcvSpecular.r = specular.<a class="code" href="classOgre_1_1ColourValue.html#Ogre_1_1ColourValuem0">r</a>;
00996             d3dMat.dcvSpecular.g = specular.<a class="code" href="classOgre_1_1ColourValue.html#Ogre_1_1ColourValuem1">g</a>;
00997             d3dMat.dcvSpecular.b = specular.<a class="code" href="classOgre_1_1ColourValue.html#Ogre_1_1ColourValuem2">b</a>;
00998             d3dMat.dcvSpecular.a = specular.<a class="code" href="classOgre_1_1ColourValue.html#Ogre_1_1ColourValuem3">a</a>;
00999 
01000             d3dMat.dcvEmissive.r = emissive.<a class="code" href="classOgre_1_1ColourValue.html#Ogre_1_1ColourValuem0">r</a>;
01001             d3dMat.dcvEmissive.g = emissive.<a class="code" href="classOgre_1_1ColourValue.html#Ogre_1_1ColourValuem1">g</a>;
01002             d3dMat.dcvEmissive.b = emissive.<a class="code" href="classOgre_1_1ColourValue.html#Ogre_1_1ColourValuem2">b</a>;
01003             d3dMat.dcvEmissive.a = emissive.<a class="code" href="classOgre_1_1ColourValue.html#Ogre_1_1ColourValuem3">a</a>;
01004 
01005             d3dMat.dvPower = shininess;
01006 
01007             HRESULT hr = <a class="code" href="classOgre_1_1D3DRenderSystem.html#Ogre_1_1D3DRenderSystemo0">mlpD3DDevice</a>-&gt;SetMaterial(&amp;d3dMat);
01008             <font class="keywordflow">if</font> (FAILED(hr))
01009                 <a class="code" href="OgreException_8h.html#a0">Except</a>(hr, <font class="stringliteral">"Error setting D3D material."</font>, <font class="stringliteral">"D3DRenderSystem::_setSurfaceParams"</font>);
01010 
01011         }
01012     }
01013 
01014     <font class="comment">//-----------------------------------------------------------------------</font>
<a name="l01015"></a><a class="code" href="classOgre_1_1D3DRenderSystem.html#Ogre_1_1D3DRenderSystema28">01015</a>     <font class="keywordtype">unsigned</font> <font class="keywordtype">short</font> D3DRenderSystem::_getNumTextureUnits(<font class="keywordtype">void</font>)
01016     {
01017         <font class="comment">// Get details from current device</font>
01018         <font class="keywordflow">return</font> <a class="code" href="classOgre_1_1D3DRenderSystem.html#Ogre_1_1D3DRenderSystemo1">mD3DDeviceDesc</a>.wMaxSimultaneousTextures;
01019 
01020     }
01021 
01022     <font class="comment">//-----------------------------------------------------------------------</font>
<a name="l01023"></a><a class="code" href="classOgre_1_1D3DRenderSystem.html#Ogre_1_1D3DRenderSystema29">01023</a>     <font class="keywordtype">void</font> D3DRenderSystem::_setTexture(<font class="keywordtype">int</font> stage, <font class="keywordtype">bool</font> enabled, <font class="keyword">const</font> <a class="code" href="classOgre_1_1String.html">String</a> &amp;texname)
01024     {
01025         HRESULT hr;
01026 
01027         <a class="code" href="classOgre_1_1D3DTexture.html">D3DTexture</a>* dt = (<a class="code" href="classOgre_1_1D3DTexture.html">D3DTexture</a>*)TextureManager::getSingleton().getByName(texname);
01028         <font class="keywordflow">if</font> (enabled &amp;&amp; dt)
01029         {
01030             hr = <a class="code" href="classOgre_1_1D3DRenderSystem.html#Ogre_1_1D3DRenderSystemo0">mlpD3DDevice</a>-&gt;SetTexture(stage, dt-&gt;<a class="code" href="classOgre_1_1D3DTexture.html#Ogre_1_1D3DTexturea6">getDDSurface</a>());
01031         }
01032         <font class="keywordflow">else</font>
01033         {
01034             hr = <a class="code" href="classOgre_1_1D3DRenderSystem.html#Ogre_1_1D3DRenderSystemo0">mlpD3DDevice</a>-&gt;SetTexture(stage, 0);
01035         }
01036 
01037         <font class="keywordflow">if</font> (FAILED(hr))
01038             <a class="code" href="OgreException_8h.html#a0">Except</a>(hr, <font class="stringliteral">"Unable to set texture in D3D."</font>, <font class="stringliteral">"D3DRenderSystem::_setTexture"</font>);
01039 
01040     }
01041 
01042     <font class="comment">//-----------------------------------------------------------------------</font>
<a name="l01043"></a><a class="code" href="classOgre_1_1D3DRenderSystem.html#Ogre_1_1D3DRenderSystema30">01043</a>     <font class="keywordtype">void</font> D3DRenderSystem::_setTextureCoordSet(<font class="keywordtype">int</font> stage, <font class="keywordtype">int</font> index)
01044     {
01045         HRESULT hr;
01046         hr = <a class="code" href="classOgre_1_1D3DRenderSystem.html#Ogre_1_1D3DRenderSystemo0">mlpD3DDevice</a>-&gt;SetTextureStageState(stage, D3DTSS_TEXCOORDINDEX, index);
01047     }
01048     <font class="comment">//-----------------------------------------------------------------------</font>
<a name="l01049"></a><a class="code" href="classOgre_1_1D3DRenderSystem.html#Ogre_1_1D3DRenderSystema31">01049</a>     <font class="keywordtype">void</font> D3DRenderSystem::_setTextureCoordCalculation(<font class="keywordtype">int</font> stage, <a class="code" href="namespaceOgre.html#a438">TexCoordCalcMethod</a> m)
01050     {
01051         HRESULT hr;
01052         <font class="comment">// Turn stage number into D3D constant (WHY Microsoft??!)</font>
01053         D3DTRANSFORMSTATETYPE tst;
01054         <font class="keywordflow">switch</font>(stage)
01055         {
01056         <font class="keywordflow">case</font> 0:
01057             tst = D3DTRANSFORMSTATE_TEXTURE0;
01058             <font class="keywordflow">break</font>;
01059         <font class="keywordflow">case</font> 1:
01060             tst = D3DTRANSFORMSTATE_TEXTURE1;
01061             <font class="keywordflow">break</font>;
01062         <font class="keywordflow">case</font> 2:
01063             tst = D3DTRANSFORMSTATE_TEXTURE2;
01064             <font class="keywordflow">break</font>;
01065         <font class="keywordflow">case</font> 3:
01066             tst = D3DTRANSFORMSTATE_TEXTURE3;
01067             <font class="keywordflow">break</font>;
01068         <font class="keywordflow">case</font> 4:
01069             tst = D3DTRANSFORMSTATE_TEXTURE4;
01070             <font class="keywordflow">break</font>;
01071         <font class="keywordflow">case</font> 5:
01072             tst = D3DTRANSFORMSTATE_TEXTURE5;
01073             <font class="keywordflow">break</font>;
01074         <font class="keywordflow">case</font> 6:
01075             tst = D3DTRANSFORMSTATE_TEXTURE6;
01076             <font class="keywordflow">break</font>;
01077         <font class="keywordflow">case</font> 7:
01078             tst = D3DTRANSFORMSTATE_TEXTURE7;
01079             <font class="keywordflow">break</font>;
01080         }
01081 
01082         D3DMATRIX matTrans;
01083         <font class="keywordflow">switch</font>(m)
01084         {
01085         <font class="keywordflow">case</font> <a class="code" href="namespaceOgre.html#a438a296">TEXCALC_NONE</a>:
01086             hr = <a class="code" href="classOgre_1_1D3DRenderSystem.html#Ogre_1_1D3DRenderSystemo0">mlpD3DDevice</a>-&gt;SetTextureStageState(stage, D3DTSS_TEXTURETRANSFORMFLAGS, D3DTTFF_DISABLE);
01087             <font class="comment">// Also set identity incase texture mods come later</font>
01088             D3DUtil_SetIdentityMatrix(matTrans);
01089             hr = <a class="code" href="classOgre_1_1D3DRenderSystem.html#Ogre_1_1D3DRenderSystemo0">mlpD3DDevice</a>-&gt;SetTransform(tst, &amp;matTrans);
01090             <font class="keywordflow">break</font>;
01091         <font class="keywordflow">case</font> <a class="code" href="namespaceOgre.html#a438a297">TEXCALC_ENVIRONMENT_MAP</a>:
01092             <font class="comment">// Sets the flags required for an environment map effect</font>
01093             hr = <a class="code" href="classOgre_1_1D3DRenderSystem.html#Ogre_1_1D3DRenderSystemo0">mlpD3DDevice</a>-&gt;SetRenderState(D3DRENDERSTATE_NORMALIZENORMALS,TRUE);
01094             hr = <a class="code" href="classOgre_1_1D3DRenderSystem.html#Ogre_1_1D3DRenderSystemo0">mlpD3DDevice</a>-&gt;SetTextureStageState(stage, D3DTSS_TEXCOORDINDEX , D3DTSS_TCI_CAMERASPACENORMAL );
01095             hr = <a class="code" href="classOgre_1_1D3DRenderSystem.html#Ogre_1_1D3DRenderSystemo0">mlpD3DDevice</a>-&gt;SetTextureStageState(stage, D3DTSS_TEXTURETRANSFORMFLAGS, D3DTTFF_COUNT2);
01096             D3DUtil_SetIdentityMatrix(matTrans);
01097             
01098             matTrans(0,0) = 0.5f;
01099             matTrans(3,0) = 0.5f;
01100             matTrans(1,1) = -0.5f;
01101             matTrans(3,1) = 0.5f;
01102             
01103 
01104             hr = <a class="code" href="classOgre_1_1D3DRenderSystem.html#Ogre_1_1D3DRenderSystemo0">mlpD3DDevice</a>-&gt;SetTransform(tst, &amp;matTrans);
01105             <font class="keywordflow">break</font>;
01106         <font class="keywordflow">case</font> <a class="code" href="namespaceOgre.html#a438a298">TEXCALC_ENVIRONMENT_MAP_PLANAR</a>:
01107             <font class="comment">// Sets the flags required for an environment map effect</font>
01108             hr = <a class="code" href="classOgre_1_1D3DRenderSystem.html#Ogre_1_1D3DRenderSystemo0">mlpD3DDevice</a>-&gt;SetRenderState(D3DRENDERSTATE_NORMALIZENORMALS,FALSE);
01109             hr = <a class="code" href="classOgre_1_1D3DRenderSystem.html#Ogre_1_1D3DRenderSystemo0">mlpD3DDevice</a>-&gt;SetTextureStageState(stage, D3DTSS_TEXCOORDINDEX , D3DTSS_TCI_CAMERASPACEREFLECTIONVECTOR );
01110             hr = <a class="code" href="classOgre_1_1D3DRenderSystem.html#Ogre_1_1D3DRenderSystemo0">mlpD3DDevice</a>-&gt;SetTextureStageState(stage, D3DTSS_TEXTURETRANSFORMFLAGS, D3DTTFF_COUNT2);
01111             D3DUtil_SetIdentityMatrix(matTrans);
01112             matTrans(0,0) = 0.5f;
01113             matTrans(3,0) = 0.5f;
01114             matTrans(1,1) = -0.5f;
01115             matTrans(3,1) = 0.5f;
01116 
01117             hr = <a class="code" href="classOgre_1_1D3DRenderSystem.html#Ogre_1_1D3DRenderSystemo0">mlpD3DDevice</a>-&gt;SetTransform(tst, &amp;matTrans);
01118             <font class="keywordflow">break</font>;
01119         }
01120     }
01121     <font class="comment">//-----------------------------------------------------------------------</font>
<a name="l01122"></a><a class="code" href="classOgre_1_1D3DRenderSystem.html#Ogre_1_1D3DRenderSystema32">01122</a>     <font class="keywordtype">void</font> D3DRenderSystem::_setTextureBlendMode(<font class="keywordtype">int</font> stage, <font class="keyword">const</font> <a class="code" href="classOgre_1_1LayerBlendModeEx.html">LayerBlendModeEx</a>&amp; bm)
01123     {
01124         HRESULT hr;
01125         D3DTEXTURESTAGESTATETYPE tss;
01126         DWORD value;
01127 
01128         <font class="keywordflow">if</font> (bm.<a class="code" href="classOgre_1_1LayerBlendModeEx.html#Ogre_1_1LayerBlendModeExm0">blendType</a> == <a class="code" href="namespaceOgre.html#a417a13">LBT_COLOUR</a>)
01129         {
01130             tss = D3DTSS_COLOROP;
01131         }
01132         <font class="keywordflow">else</font> <font class="keywordflow">if</font> (bm.<a class="code" href="classOgre_1_1LayerBlendModeEx.html#Ogre_1_1LayerBlendModeExm0">blendType</a> == <a class="code" href="namespaceOgre.html#a417a14">LBT_ALPHA</a>)
01133         {
01134             tss= D3DTSS_ALPHAOP;
01135         }
01136 
01137         <font class="keywordflow">switch</font> (bm.<a class="code" href="classOgre_1_1LayerBlendModeEx.html#Ogre_1_1LayerBlendModeExm1">operation</a>)
01138         {
01139         <font class="keywordflow">case</font> <a class="code" href="namespaceOgre.html#a419a19">LBX_SOURCE1</a>:
01140             value = D3DTOP_SELECTARG1;
01141             <font class="keywordflow">break</font>;
01142         <font class="keywordflow">case</font> <a class="code" href="namespaceOgre.html#a419a20">LBX_SOURCE2</a>:
01143             value = D3DTOP_SELECTARG2;
01144             <font class="keywordflow">break</font>;
01145         <font class="keywordflow">case</font> <a class="code" href="namespaceOgre.html#a419a21">LBX_MODULATE</a>:
01146             value = D3DTOP_MODULATE;
01147             <font class="keywordflow">break</font>;
01148         <font class="keywordflow">case</font> <a class="code" href="namespaceOgre.html#a419a22">LBX_MODULATE_X2</a>:
01149             value = D3DTOP_MODULATE2X;
01150             <font class="keywordflow">break</font>;
01151         <font class="keywordflow">case</font> <a class="code" href="namespaceOgre.html#a419a23">LBX_MODULATE_X4</a>:
01152             value = D3DTOP_MODULATE4X;
01153             <font class="keywordflow">break</font>;
01154         <font class="keywordflow">case</font> <a class="code" href="namespaceOgre.html#a419a24">LBX_ADD</a>:
01155             value = D3DTOP_ADD;
01156             <font class="keywordflow">break</font>;
01157         <font class="keywordflow">case</font> <a class="code" href="namespaceOgre.html#a419a25">LBX_ADD_SIGNED</a>:
01158             value = D3DTOP_ADDSIGNED;
01159             <font class="keywordflow">break</font>;
01160         <font class="keywordflow">case</font> <a class="code" href="namespaceOgre.html#a419a26">LBX_ADD_SMOOTH</a>:
01161             value = D3DTOP_ADDSMOOTH;
01162             <font class="keywordflow">break</font>;
01163         <font class="keywordflow">case</font> <a class="code" href="namespaceOgre.html#a419a27">LBX_SUBTRACT</a>:
01164             value = D3DTOP_SUBTRACT;
01165             <font class="keywordflow">break</font>;
01166         <font class="keywordflow">case</font> <a class="code" href="namespaceOgre.html#a419a28">LBX_BLEND_DIFFUSE_ALPHA</a>:
01167             value = D3DTOP_BLENDDIFFUSEALPHA;
01168             <font class="keywordflow">break</font>;
01169         <font class="keywordflow">case</font> <a class="code" href="namespaceOgre.html#a419a29">LBX_BLEND_TEXTURE_ALPHA</a>:
01170             value = D3DTOP_BLENDTEXTUREALPHA;
01171             <font class="keywordflow">break</font>;
01172         <font class="keywordflow">case</font> <a class="code" href="namespaceOgre.html#a419a30">LBX_BLEND_CURRENT_ALPHA</a>:
01173             value = D3DTOP_BLENDCURRENTALPHA;
01174             <font class="keywordflow">break</font>;
01175         <font class="keywordflow">case</font> <a class="code" href="namespaceOgre.html#a419a31">LBX_BLEND_MANUAL</a>:
01176             value = D3DTOP_BLENDFACTORALPHA;
01177             <font class="comment">// Set factor in render state</font>
01178             hr = <a class="code" href="classOgre_1_1D3DRenderSystem.html#Ogre_1_1D3DRenderSystemo0">mlpD3DDevice</a>-&gt;SetRenderState(D3DRENDERSTATE_TEXTUREFACTOR,
01179                 D3DRGBA(0,0,0,bm.<a class="code" href="classOgre_1_1LayerBlendModeEx.html#Ogre_1_1LayerBlendModeExm8">factor</a>));
01180             <font class="keywordflow">break</font>;
01181         }
01182 
01183         <font class="comment">// Make call to set operation</font>
01184         hr = <a class="code" href="classOgre_1_1D3DRenderSystem.html#Ogre_1_1D3DRenderSystemo0">mlpD3DDevice</a>-&gt;SetTextureStageState(stage, tss, value);
01185 
01186         <font class="comment">// Now set up sources</font>
01187         D3DCOLOR manualD3D;
01188         <font class="keywordflow">if</font> (bm.<a class="code" href="classOgre_1_1LayerBlendModeEx.html#Ogre_1_1LayerBlendModeExm0">blendType</a> == <a class="code" href="namespaceOgre.html#a417a13">LBT_COLOUR</a>)
01189         {
01190             tss = D3DTSS_COLORARG1;
01191             manualD3D = D3DRGBA(bm.<a class="code" href="classOgre_1_1LayerBlendModeEx.html#Ogre_1_1LayerBlendModeExm4">colourArg1</a>.<a class="code" href="classOgre_1_1ColourValue.html#Ogre_1_1ColourValuem0">r</a>,bm.<a class="code" href="classOgre_1_1LayerBlendModeEx.html#Ogre_1_1LayerBlendModeExm4">colourArg1</a>.<a class="code" href="classOgre_1_1ColourValue.html#Ogre_1_1ColourValuem1">g</a>,bm.<a class="code" href="classOgre_1_1LayerBlendModeEx.html#Ogre_1_1LayerBlendModeExm4">colourArg1</a>.<a class="code" href="classOgre_1_1ColourValue.html#Ogre_1_1ColourValuem2">b</a>,1.0);
01192         }
01193         <font class="keywordflow">else</font> <font class="keywordflow">if</font> (bm.<a class="code" href="classOgre_1_1LayerBlendModeEx.html#Ogre_1_1LayerBlendModeExm0">blendType</a> == <a class="code" href="namespaceOgre.html#a417a14">LBT_ALPHA</a>)
01194         {
01195             tss = D3DTSS_ALPHAARG1;
01196             manualD3D = D3DRGBA(0,0,0,bm.<a class="code" href="classOgre_1_1LayerBlendModeEx.html#Ogre_1_1LayerBlendModeExm6">alphaArg1</a>);
01197         }
01198         <a class="code" href="namespaceOgre.html#a420">LayerBlendSource</a> bs = bm.<a class="code" href="classOgre_1_1LayerBlendModeEx.html#Ogre_1_1LayerBlendModeExm2">source1</a>;
01199         <font class="keywordflow">for</font> (<font class="keywordtype">int</font> i = 0; i &lt; 2; ++i)
01200         {
01201             <font class="keywordflow">switch</font> (bs)
01202             {
01203             <font class="keywordflow">case</font> <a class="code" href="namespaceOgre.html#a420a32">LBS_CURRENT</a>:
01204                 value = D3DTA_CURRENT;
01205                 <font class="keywordflow">break</font>;
01206             <font class="keywordflow">case</font> <a class="code" href="namespaceOgre.html#a420a33">LBS_TEXTURE</a>:
01207                 value = D3DTA_TEXTURE;
01208                 <font class="keywordflow">break</font>;
01209             <font class="keywordflow">case</font> <a class="code" href="namespaceOgre.html#a420a34">LBS_DIFFUSE</a>:
01210                 value = D3DTA_DIFFUSE;
01211                 <font class="keywordflow">break</font>;
01212             <font class="keywordflow">case</font> <a class="code" href="namespaceOgre.html#a420a35">LBS_SPECULAR</a>:
01213                 value = D3DTA_SPECULAR;
01214                 <font class="keywordflow">break</font>;
01215             <font class="keywordflow">case</font> <a class="code" href="namespaceOgre.html#a420a36">LBS_MANUAL</a>:
01216                 value = D3DTA_TFACTOR;
01217                 <font class="comment">// Set factor in render state</font>
01218                 hr = <a class="code" href="classOgre_1_1D3DRenderSystem.html#Ogre_1_1D3DRenderSystemo0">mlpD3DDevice</a>-&gt;SetRenderState(D3DRENDERSTATE_TEXTUREFACTOR,    manualD3D);
01219                 <font class="keywordflow">break</font>;
01220 
01221             }
01222 
01223             <font class="comment">// Set source</font>
01224             hr = <a class="code" href="classOgre_1_1D3DRenderSystem.html#Ogre_1_1D3DRenderSystemo0">mlpD3DDevice</a>-&gt;SetTextureStageState(stage,tss,value);
01225 
01226             <font class="comment">// Source2</font>
01227             bs = bm.<a class="code" href="classOgre_1_1LayerBlendModeEx.html#Ogre_1_1LayerBlendModeExm3">source2</a>;
01228             <font class="keywordflow">if</font> (bm.<a class="code" href="classOgre_1_1LayerBlendModeEx.html#Ogre_1_1LayerBlendModeExm0">blendType</a> == <a class="code" href="namespaceOgre.html#a417a13">LBT_COLOUR</a>)
01229             {
01230                 tss = D3DTSS_COLORARG2;
01231                 manualD3D = D3DRGBA(bm.<a class="code" href="classOgre_1_1LayerBlendModeEx.html#Ogre_1_1LayerBlendModeExm5">colourArg2</a>.<a class="code" href="classOgre_1_1ColourValue.html#Ogre_1_1ColourValuem0">r</a>,bm.<a class="code" href="classOgre_1_1LayerBlendModeEx.html#Ogre_1_1LayerBlendModeExm5">colourArg2</a>.<a class="code" href="classOgre_1_1ColourValue.html#Ogre_1_1ColourValuem1">g</a>,bm.<a class="code" href="classOgre_1_1LayerBlendModeEx.html#Ogre_1_1LayerBlendModeExm5">colourArg2</a>.<a class="code" href="classOgre_1_1ColourValue.html#Ogre_1_1ColourValuem2">b</a>,1.0);
01232             }
01233             <font class="keywordflow">else</font> <font class="keywordflow">if</font> (bm.<a class="code" href="classOgre_1_1LayerBlendModeEx.html#Ogre_1_1LayerBlendModeExm0">blendType</a> == <a class="code" href="namespaceOgre.html#a417a14">LBT_ALPHA</a>)
01234             {
01235                 tss = D3DTSS_ALPHAARG2;
01236                 manualD3D = D3DRGBA(0,0,0,bm.<a class="code" href="classOgre_1_1LayerBlendModeEx.html#Ogre_1_1LayerBlendModeExm7">alphaArg2</a>);
01237             }
01238         }
01239 
01240 
01241 
01242 
01243     }
01244     <font class="comment">//-----------------------------------------------------------------------</font>
<a name="l01245"></a><a class="code" href="classOgre_1_1D3DRenderSystem.html#Ogre_1_1D3DRenderSystema33">01245</a>     <font class="keywordtype">void</font> D3DRenderSystem::_setTextureAddressingMode(<font class="keywordtype">int</font> stage, Material::TextureLayer::TextureAddressingMode tam)
01246     {
01247         HRESULT hr;
01248         D3DTEXTUREADDRESS d3dType;
01249 
01250         <font class="keywordflow">switch</font>(tam)
01251         {
01252         <font class="keywordflow">case</font> Material::TextureLayer::TAM_WRAP:
01253             d3dType = D3DTADDRESS_WRAP;
01254             <font class="keywordflow">break</font>;
01255         <font class="keywordflow">case</font> Material::TextureLayer::TAM_MIRROR:
01256             d3dType = D3DTADDRESS_MIRROR;
01257             <font class="keywordflow">break</font>;
01258         <font class="keywordflow">case</font> Material::TextureLayer::TAM_CLAMP:
01259             d3dType = D3DTADDRESS_CLAMP;
01260             <font class="keywordflow">break</font>;
01261         }
01262 
01263 
01264         hr = <a class="code" href="classOgre_1_1D3DRenderSystem.html#Ogre_1_1D3DRenderSystemo0">mlpD3DDevice</a>-&gt;SetTextureStageState(stage, D3DTSS_ADDRESS, d3dType);
01265     }
01266     <font class="comment">//-----------------------------------------------------------------------</font>
<a name="l01267"></a><a class="code" href="classOgre_1_1D3DRenderSystem.html#Ogre_1_1D3DRenderSystema34">01267</a>     <font class="keywordtype">void</font> D3DRenderSystem::_setTextureMatrix(<font class="keywordtype">int</font> stage, <font class="keyword">const</font> <a class="code" href="classOgre_1_1Matrix4.html">Matrix4</a>&amp; xform)
01268     {
01269         HRESULT hr;
01270         D3DTRANSFORMSTATETYPE d3dType;
01271         D3DMATRIX d3dMat, d3dMatCur;
01272 
01273         <font class="keywordflow">if</font> (xform == Matrix4::IDENTITY)
01274         {
01275             hr = <a class="code" href="classOgre_1_1D3DRenderSystem.html#Ogre_1_1D3DRenderSystemo0">mlpD3DDevice</a>-&gt;SetTextureStageState(stage, D3DTSS_TEXTURETRANSFORMFLAGS, D3DTTFF_DISABLE);
01276         }
01277         <font class="keywordflow">else</font>
01278         {
01279             <font class="comment">// Set 2D input</font>
01280             <font class="comment">// TODO: deal with 3D coordinates when cubic environment mapping supported</font>
01281             hr = <a class="code" href="classOgre_1_1D3DRenderSystem.html#Ogre_1_1D3DRenderSystemo0">mlpD3DDevice</a>-&gt;SetTextureStageState(stage, D3DTSS_TEXTURETRANSFORMFLAGS, D3DTTFF_COUNT2);
01282 
01283             <font class="comment">// Set texture stage xform</font>
01284             d3dType = (D3DTRANSFORMSTATETYPE)(D3DTRANSFORMSTATE_TEXTURE0 + stage);
01285             d3dMat = <a class="code" href="classOgre_1_1D3DRenderSystem.html#Ogre_1_1D3DRenderSystemc2">makeD3DMatrix</a>(xform);
01286 
01287 
01288             hr = <a class="code" href="classOgre_1_1D3DRenderSystem.html#Ogre_1_1D3DRenderSystemo0">mlpD3DDevice</a>-&gt;SetTransform(d3dType, &amp;d3dMat);
01289 
01290             <font class="keywordflow">if</font> (FAILED(hr))
01291                 <a class="code" href="OgreException_8h.html#a0">Except</a>(Exception::ERR_RENDERINGAPI_ERROR, <font class="stringliteral">"Unable to set texture transform."</font>,
01292                     <font class="stringliteral">"D3DRenderSystem::_setTextureMatrix"</font>);
01293         }
01294 
01295     }
01296     <font class="comment">//-----------------------------------------------------------------------</font>
<a name="l01297"></a><a class="code" href="classOgre_1_1D3DRenderSystem.html#Ogre_1_1D3DRenderSystema35">01297</a>     <font class="keywordtype">void</font> D3DRenderSystem::_setSceneBlending(<a class="code" href="namespaceOgre.html#a422">SceneBlendFactor</a> sourceFactor, <a class="code" href="namespaceOgre.html#a422">SceneBlendFactor</a> destFactor)
01298     {
01299         HRESULT hr;
01300         D3DBLEND d3dSrcBlend, d3dDestBlend;
01301 
01302         D3DBLEND* pBlend = &amp;d3dSrcBlend;
01303         <a class="code" href="namespaceOgre.html#a422">SceneBlendFactor</a> ogreBlend = sourceFactor;
01304 
01305         <font class="keywordflow">for</font> (<font class="keywordtype">int</font> i = 0 ; i &lt; 2; ++i)
01306         {
01307             <font class="keywordflow">switch</font>(ogreBlend)
01308             {
01309             <font class="keywordflow">case</font> <a class="code" href="namespaceOgre.html#a422a40">SBF_ONE</a>:
01310                 *pBlend = D3DBLEND_ONE;
01311                 <font class="keywordflow">break</font>;
01312             <font class="keywordflow">case</font> <a class="code" href="namespaceOgre.html#a422a41">SBF_ZERO</a>:
01313                 *pBlend = D3DBLEND_ZERO;
01314                 <font class="keywordflow">break</font>;
01315             <font class="keywordflow">case</font> <a class="code" href="namespaceOgre.html#a422a42">SBF_DEST_COLOUR</a>:
01316                 *pBlend = D3DBLEND_DESTCOLOR;
01317                 <font class="keywordflow">break</font>;
01318             <font class="keywordflow">case</font> <a class="code" href="namespaceOgre.html#a422a43">SBF_SOURCE_COLOUR</a>:
01319                 *pBlend = D3DBLEND_SRCCOLOR;
01320                 <font class="keywordflow">break</font>;
01321             <font class="keywordflow">case</font> <a class="code" href="namespaceOgre.html#a422a44">SBF_ONE_MINUS_DEST_COLOUR</a>:
01322                 *pBlend = D3DBLEND_INVDESTCOLOR;
01323                 <font class="keywordflow">break</font>;
01324             <font class="keywordflow">case</font> <a class="code" href="namespaceOgre.html#a422a45">SBF_ONE_MINUS_SOURCE_COLOUR</a>:
01325                 *pBlend = D3DBLEND_INVSRCCOLOR;
01326                 <font class="keywordflow">break</font>;
01327             <font class="keywordflow">case</font> <a class="code" href="namespaceOgre.html#a422a46">SBF_DEST_ALPHA</a>:
01328                 *pBlend = D3DBLEND_DESTALPHA;
01329                 <font class="keywordflow">break</font>;
01330             <font class="keywordflow">case</font> <a class="code" href="namespaceOgre.html#a422a47">SBF_SOURCE_ALPHA</a>:
01331                 *pBlend = D3DBLEND_SRCALPHA;
01332                 <font class="keywordflow">break</font>;
01333             <font class="keywordflow">case</font> <a class="code" href="namespaceOgre.html#a422a48">SBF_ONE_MINUS_DEST_ALPHA</a>:
01334                 *pBlend = D3DBLEND_INVDESTALPHA;
01335                 <font class="keywordflow">break</font>;
01336             <font class="keywordflow">case</font> <a class="code" href="namespaceOgre.html#a422a49">SBF_ONE_MINUS_SOURCE_ALPHA</a>:
01337                 *pBlend = D3DBLEND_INVSRCALPHA;
01338                 <font class="keywordflow">break</font>;
01339             }
01340             ogreBlend = destFactor;
01341             pBlend = &amp;d3dDestBlend;
01342 
01343         }
01344 
01345         hr = <a class="code" href="classOgre_1_1D3DRenderSystem.html#Ogre_1_1D3DRenderSystemo0">mlpD3DDevice</a>-&gt;SetRenderState(D3DRENDERSTATE_SRCBLEND, d3dSrcBlend);
01346 
01347         hr = <a class="code" href="classOgre_1_1D3DRenderSystem.html#Ogre_1_1D3DRenderSystemo0">mlpD3DDevice</a>-&gt;SetRenderState(D3DRENDERSTATE_DESTBLEND, d3dDestBlend);
01348 
01349 
01350     }
01351     <font class="comment">//-----------------------------------------------------------------------</font>
<a name="l01352"></a><a class="code" href="classOgre_1_1D3DRenderSystem.html#Ogre_1_1D3DRenderSystema36">01352</a>     <font class="keywordtype">void</font> D3DRenderSystem::_setAlphaRejectSettings(<a class="code" href="namespaceOgre.html#a426">CompareFunction</a> func, <font class="keywordtype">unsigned</font> <font class="keywordtype">char</font> value)
01353     {
01354         HRESULT hr;
01355         D3DCMPFUNC d3dfunc;
01356 
01357         <font class="keywordflow">switch</font>(func)
01358         {
01359         <font class="keywordflow">case</font> <a class="code" href="namespaceOgre.html#a426a66">CMPF_ALWAYS_FAIL</a>:
01360             d3dfunc = D3DCMP_NEVER;
01361             <font class="keywordflow">break</font>;
01362         <font class="keywordflow">case</font> <a class="code" href="namespaceOgre.html#a426a67">CMPF_ALWAYS_PASS</a>:
01363             d3dfunc = D3DCMP_ALWAYS;
01364             <font class="keywordflow">break</font>;
01365         <font class="keywordflow">case</font> <a class="code" href="namespaceOgre.html#a426a68">CMPF_LESS</a>:
01366             d3dfunc = D3DCMP_LESS;
01367             <font class="keywordflow">break</font>;
01368         <font class="keywordflow">case</font> <a class="code" href="namespaceOgre.html#a426a69">CMPF_LESS_EQUAL</a>:
01369             d3dfunc = D3DCMP_LESSEQUAL;
01370             <font class="keywordflow">break</font>;
01371         <font class="keywordflow">case</font> <a class="code" href="namespaceOgre.html#a426a70">CMPF_EQUAL</a>:
01372             d3dfunc = D3DCMP_EQUAL;
01373             <font class="keywordflow">break</font>;
01374         <font class="keywordflow">case</font> <a class="code" href="namespaceOgre.html#a426a71">CMPF_NOT_EQUAL</a>:
01375             d3dfunc = D3DCMP_NOTEQUAL;
01376             <font class="keywordflow">break</font>;
01377         <font class="keywordflow">case</font> <a class="code" href="namespaceOgre.html#a426a72">CMPF_GREATER_EQUAL</a>:
01378             d3dfunc = D3DCMP_GREATEREQUAL;
01379             <font class="keywordflow">break</font>;
01380         <font class="keywordflow">case</font> <a class="code" href="namespaceOgre.html#a426a73">CMPF_GREATER</a>:
01381             d3dfunc = D3DCMP_GREATER;
01382             <font class="keywordflow">break</font>;
01383         };
01384 
01385         hr = <a class="code" href="classOgre_1_1D3DRenderSystem.html#Ogre_1_1D3DRenderSystemo0">mlpD3DDevice</a>-&gt;SetRenderState(D3DRENDERSTATE_ALPHAFUNC, d3dfunc);
01386 
01387         hr = <a class="code" href="classOgre_1_1D3DRenderSystem.html#Ogre_1_1D3DRenderSystemo0">mlpD3DDevice</a>-&gt;SetRenderState(D3DRENDERSTATE_ALPHAREF, value);
01388     }
01389     <font class="comment">//-----------------------------------------------------------------------</font>
<a name="l01390"></a><a class="code" href="classOgre_1_1D3DRenderSystem.html#Ogre_1_1D3DRenderSystema37">01390</a>     <font class="keywordtype">void</font> D3DRenderSystem::_setViewport(<a class="code" href="classOgre_1_1Viewport.html">Viewport</a> *vp)
01391     {
01392         <font class="comment">// Check if viewport is different</font>
01393         <font class="keywordflow">if</font> (vp != <a class="code" href="classOgre_1_1RenderSystem.html#Ogre_1_1SDLRenderSystemn4">mActiveViewport</a> || vp-&gt;<a class="code" href="classOgre_1_1Viewport.html#Ogre_1_1Viewporta20">_isUpdated</a>())
01394         {
01395             <a class="code" href="classOgre_1_1RenderSystem.html#Ogre_1_1SDLRenderSystemn4">mActiveViewport</a> = vp;
01396             <font class="comment">// Ok, it's different. Time to set render target (maybe)</font>
01397             <font class="comment">//  and viewport params.</font>
01398             D3DVIEWPORT7 d3dvp;
01399             HRESULT hr;
01400 
01401             <font class="comment">// Set render target</font>
01402             <font class="comment">// TODO - maybe only set when required?</font>
01403             <font class="comment">// TODO - deal with rendering to textures</font>
01404             <a class="code" href="classOgre_1_1RenderTarget.html">RenderTarget</a>* target;
01405             target = vp-&gt;<a class="code" href="classOgre_1_1Viewport.html#Ogre_1_1Viewporta4">getTarget</a>();
01406             <font class="comment">// Get DD Back buffer</font>
01407             LPDIRECTDRAWSURFACE7 pBack;
01408             target-&gt;<a class="code" href="classOgre_1_1RenderTarget.html#Ogre_1_1SDLWindowa28">getCustomAttribute</a>(<font class="stringliteral">"DDBACKBUFFER"</font>, &amp;pBack);
01409             hr = <a class="code" href="classOgre_1_1D3DRenderSystem.html#Ogre_1_1D3DRenderSystemo0">mlpD3DDevice</a>-&gt;SetRenderTarget(pBack,0);
01410 
01411             <font class="comment">// Set viewport dimensions</font>
01412             d3dvp.dwX = vp-&gt;<a class="code" href="classOgre_1_1Viewport.html#Ogre_1_1Viewporta10">getActualLeft</a>();
01413             d3dvp.dwY = vp-&gt;<a class="code" href="classOgre_1_1Viewport.html#Ogre_1_1Viewporta11">getActualTop</a>();
01414             d3dvp.dwWidth = vp-&gt;<a class="code" href="classOgre_1_1Viewport.html#Ogre_1_1Viewporta12">getActualWidth</a>();
01415             d3dvp.dwHeight = vp-&gt;<a class="code" href="classOgre_1_1Viewport.html#Ogre_1_1Viewporta13">getActualHeight</a>();
01416 
01417             <font class="comment">// Z-values from 0.0 to 1.0 (TODO - standardise with OpenGL?)</font>
01418             d3dvp.dvMinZ = 0.0f;
01419             d3dvp.dvMaxZ = 1.0f;
01420 
01421             hr = <a class="code" href="classOgre_1_1D3DRenderSystem.html#Ogre_1_1D3DRenderSystemo0">mlpD3DDevice</a>-&gt;SetViewport(&amp;d3dvp);
01422 
01423             <font class="keywordflow">if</font> (FAILED(hr))
01424                 <a class="code" href="OgreException_8h.html#a0">Except</a>(hr, <font class="stringliteral">"Error setting D3D viewport."</font>,
01425                     <font class="stringliteral">"D3DRenderSystem::_setViewport"</font>);
01426 
01427             vp-&gt;<a class="code" href="classOgre_1_1Viewport.html#Ogre_1_1Viewporta21">_clearUpdatedFlag</a>();
01428 
01429         }
01430     }
01431 
01432     <font class="comment">//-----------------------------------------------------------------------</font>
<a name="l01433"></a><a class="code" href="classOgre_1_1D3DRenderSystem.html#Ogre_1_1D3DRenderSystema38">01433</a>     <font class="keywordtype">void</font> D3DRenderSystem::_beginFrame(<font class="keywordtype">void</font>)
01434     {
01435         <a class="code" href="OgreException_8h.html#a1">OgreGuard</a>( <font class="stringliteral">"D3DRenderSystem::_beginFrame"</font> );
01436 
01437         HRESULT hr;
01438 
01439         <font class="keywordflow">if</font> (!<a class="code" href="classOgre_1_1RenderSystem.html#Ogre_1_1SDLRenderSystemn4">mActiveViewport</a>)
01440             <a class="code" href="OgreException_8h.html#a0">Except</a>(999, <font class="stringliteral">"Cannot begin frame - no viewport selected."</font>,
01441                 <font class="stringliteral">"D3DRenderSystem::_beginFrame"</font>);
01442 
01443         <font class="comment">// Clear the viewport if required</font>
01444         <font class="keywordflow">if</font> (<a class="code" href="classOgre_1_1RenderSystem.html#Ogre_1_1SDLRenderSystemn4">mActiveViewport</a>-&gt;<a class="code" href="classOgre_1_1Viewport.html#Ogre_1_1Viewporta18">getClearEveryFrame</a>())
01445         {
01446             hr = <a class="code" href="classOgre_1_1D3DRenderSystem.html#Ogre_1_1D3DRenderSystemo0">mlpD3DDevice</a>-&gt;Clear(0,0,D3DCLEAR_TARGET | D3DCLEAR_ZBUFFER,
01447                 <a class="code" href="classOgre_1_1RenderSystem.html#Ogre_1_1SDLRenderSystemn4">mActiveViewport</a>-&gt;<a class="code" href="classOgre_1_1Viewport.html#Ogre_1_1Viewporta16">getBackgroundColour</a>().<a class="code" href="classOgre_1_1ColourValue.html#Ogre_1_1ColourValuea4">getAsLongARGB</a>(),
01448                 1.0f, 0);
01449             <font class="keywordflow">if</font> (FAILED(hr))
01450                 <a class="code" href="OgreException_8h.html#a0">Except</a>(hr, <font class="stringliteral">"Error clearing viewport."</font>,
01451                     <font class="stringliteral">"D3DRenderSystem::_beginFrame"</font>);
01452         }
01453 
01454         hr = <a class="code" href="classOgre_1_1D3DRenderSystem.html#Ogre_1_1D3DRenderSystemo0">mlpD3DDevice</a>-&gt;BeginScene();
01455         <font class="keywordflow">if</font> (FAILED(hr))
01456             <a class="code" href="OgreException_8h.html#a0">Except</a>(hr, <font class="stringliteral">"Error beginning frame."</font>,
01457                 <font class="stringliteral">"D3DRenderSystem::_beginFrame"</font>);
01458 
01459         <a class="code" href="OgreException_8h.html#a2">OgreUnguard</a>();
01460     }
01461 
01462     <font class="comment">//-----------------------------------------------------------------------</font>
<a name="l01463"></a><a class="code" href="classOgre_1_1D3DRenderSystem.html#Ogre_1_1D3DRenderSystema39">01463</a>     <font class="keywordtype">void</font> D3DRenderSystem::_render(<a class="code" href="classOgre_1_1RenderOperation.html">RenderOperation</a>&amp; op)
01464     {
01465         <a class="code" href="OgreException_8h.html#a1">OgreGuard</a>( <font class="stringliteral">"D3DRenderSystem::_render"</font> );
01466 
01467         <font class="keyword">static</font> <font class="keywordtype">bool</font> <a class="code" href="namespaceOgre.html#a347">firstTime</a> = <font class="keyword">true</font>;
01468         HRESULT hr;
01469 
01470         <font class="comment">// call superclass</font>
01471         RenderSystem::_render(op);
01472 
01473         <font class="keywordflow">if</font> (firstTime)
01474         {
01475             <font class="comment">// First-time render</font>
01476             <font class="comment">// Set up some defaults</font>
01477 
01478             <font class="comment">// Allow alpha blending</font>
01479             hr = <a class="code" href="classOgre_1_1D3DRenderSystem.html#Ogre_1_1D3DRenderSystemo0">mlpD3DDevice</a>-&gt;SetRenderState(D3DRENDERSTATE_ALPHABLENDENABLE, TRUE);
01480             <a class="code" href="namespaceOgre.html#a347">firstTime</a> = <font class="keyword">false</font>;
01481         }
01482 
01483         <font class="comment">// Set up vertex flags</font>
01484         DWORD d3dVertexFormat = 0;
01485         <font class="keywordtype">int</font> i;
01486 
01487         <font class="keywordflow">if</font> (op.<a class="code" href="classOgre_1_1RenderOperation.html#Ogre_1_1RenderOperationm18">vertexOptions</a> == 0)
01488         {
01489             <font class="comment">// Must include at least vertex normal, colour or tex coords</font>
01490             <a class="code" href="OgreException_8h.html#a0">Except</a>(999, <font class="stringliteral">"You must specify at least vertex normals, "</font>
01491                 <font class="stringliteral">"vertex colours or texture co-ordinates to render."</font>, <font class="stringliteral">"D3DRenderSystem::_renderIndexedTriangleList"</font>);
01492         }
01493         d3dVertexFormat |= D3DFVF_XYZ; <font class="comment">// Untransformed  TODO - support transformed?</font>
01494 
01495         <font class="comment">// Normal</font>
01496         <font class="keywordflow">if</font> (op.<a class="code" href="classOgre_1_1RenderOperation.html#Ogre_1_1RenderOperationm18">vertexOptions</a> &amp; RenderOperation::VO_NORMALS)
01497             d3dVertexFormat |= D3DFVF_NORMAL;
01498 
01499         <font class="comment">// Do texture co-ords</font>
01500         <font class="comment">// Because D3D defines as separately named macros/constants, and refuses to make them</font>
01501         <font class="comment">// derivable via numerical means, I have to use</font>
01502         <font class="comment">// lots of ifs/switches - yuck! Why can't D3D be more elegant?</font>
01503         <font class="keywordflow">if</font> (op.<a class="code" href="classOgre_1_1RenderOperation.html#Ogre_1_1RenderOperationm18">vertexOptions</a> &amp; RenderOperation::VO_TEXTURE_COORDS)
01504         {
01505             <font class="comment">// Specify number of co-ords</font>
01506             <font class="keywordflow">switch</font>(op.<a class="code" href="classOgre_1_1RenderOperation.html#Ogre_1_1RenderOperationm9">numTextureCoordSets</a>)
01507             {
01508             <font class="keywordflow">case</font> 1:
01509                 d3dVertexFormat |= D3DFVF_TEX1;
01510                 <font class="keywordflow">break</font>;
01511             <font class="keywordflow">case</font> 2:
01512                 d3dVertexFormat |= D3DFVF_TEX2;
01513                 <font class="keywordflow">break</font>;
01514             <font class="keywordflow">case</font> 3:
01515                 d3dVertexFormat |= D3DFVF_TEX3;
01516                 <font class="keywordflow">break</font>;
01517             <font class="keywordflow">case</font> 4:
01518                 d3dVertexFormat |= D3DFVF_TEX4;
01519                 <font class="keywordflow">break</font>;
01520             <font class="keywordflow">case</font> 5:
01521                 d3dVertexFormat |= D3DFVF_TEX5;
01522                 <font class="keywordflow">break</font>;
01523             <font class="keywordflow">case</font> 6:
01524                 d3dVertexFormat |= D3DFVF_TEX6;
01525                 <font class="keywordflow">break</font>;
01526             <font class="keywordflow">case</font> 7:
01527                 d3dVertexFormat |= D3DFVF_TEX7;
01528                 <font class="keywordflow">break</font>;
01529             <font class="keywordflow">case</font> 8:
01530                 d3dVertexFormat |= D3DFVF_TEX8;
01531                 <font class="keywordflow">break</font>;
01532             }
01533 
01534             <font class="comment">// Do formats (dimensions per texture co-ord set)</font>
01535             <font class="keywordflow">for</font> (i = 0; i &lt; op.<a class="code" href="classOgre_1_1RenderOperation.html#Ogre_1_1RenderOperationm9">numTextureCoordSets</a>; ++i)
01536             {
01537                 <font class="keywordflow">switch</font> (op.<a class="code" href="classOgre_1_1RenderOperation.html#Ogre_1_1RenderOperationm10">numTextureDimensions</a>[i])
01538                 {
01539                 <font class="keywordflow">case</font> 1:
01540                     d3dVertexFormat |= D3DFVF_TEXCOORDSIZE1(i);
01541                     <font class="keywordflow">break</font>;
01542                 <font class="keywordflow">case</font> 2:
01543                     d3dVertexFormat |= D3DFVF_TEXCOORDSIZE2(i);
01544                     <font class="keywordflow">break</font>;
01545                 <font class="keywordflow">case</font> 3:
01546                     d3dVertexFormat |= D3DFVF_TEXCOORDSIZE3(i);
01547                     <font class="keywordflow">break</font>;
01548                 <font class="keywordflow">case</font> 4:
01549                     d3dVertexFormat |= D3DFVF_TEXCOORDSIZE4(i);
01550                     <font class="keywordflow">break</font>;
01551                 }
01552             }
01553         }
01554         <font class="keywordflow">else</font>
01555         {
01556             <font class="comment">// No textures</font>
01557             d3dVertexFormat |= D3DFVF_TEX0;
01558         }
01559 
01560         <font class="comment">// Vertex colours</font>
01561         <font class="keywordflow">if</font> (op.<a class="code" href="classOgre_1_1RenderOperation.html#Ogre_1_1RenderOperationm18">vertexOptions</a> &amp; RenderOperation::VO_DIFFUSE_COLOURS)
01562             d3dVertexFormat |= D3DFVF_DIFFUSE;
01563         <font class="keywordflow">if</font> (op.<a class="code" href="classOgre_1_1RenderOperation.html#Ogre_1_1RenderOperationm18">vertexOptions</a> &amp; RenderOperation::VO_SPECULAR_COLOURS)
01564             d3dVertexFormat |= D3DFVF_SPECULAR;
01565 
01566         <font class="comment">// Determine rendering operation</font>
01567         D3DPRIMITIVETYPE primType;
01568         <font class="keywordflow">switch</font> (op.<a class="code" href="classOgre_1_1RenderOperation.html#Ogre_1_1RenderOperationm19">operationType</a>)
01569         {
01570         <font class="keywordflow">case</font> RenderOperation::OT_POINT_LIST:
01571             primType = D3DPT_POINTLIST;
01572             <font class="keywordflow">break</font>;
01573         <font class="keywordflow">case</font> RenderOperation::OT_LINE_LIST:
01574             primType = D3DPT_LINELIST;
01575             <font class="keywordflow">break</font>;
01576         <font class="keywordflow">case</font> RenderOperation::OT_LINE_STRIP:
01577             primType = D3DPT_LINESTRIP;
01578             <font class="keywordflow">break</font>;
01579         <font class="keywordflow">case</font> RenderOperation::OT_TRIANGLE_LIST:
01580             primType = D3DPT_TRIANGLELIST;
01581             <font class="keywordflow">break</font>;
01582         <font class="keywordflow">case</font> RenderOperation::OT_TRIANGLE_STRIP:
01583             primType = D3DPT_TRIANGLESTRIP;
01584             <font class="keywordflow">break</font>;
01585         <font class="keywordflow">case</font> RenderOperation::OT_TRIANGLE_FAN:
01586             primType = D3DPT_TRIANGLEFAN;
01587             <font class="keywordflow">break</font>;
01588         }
01589 
01590         <font class="comment">// Set up separate buffer info if required</font>
01591         D3DDRAWPRIMITIVESTRIDEDDATA strideData;
01592         <font class="comment">// Set all pointers - FVF will indicate which is valid</font>
01593         <font class="comment">// NB Strides in D3D are not gaps, but include size of data</font>
01594         <font class="comment">// So add data size and Ogre's gap stride</font>
01595         strideData.position.lpvData = op.<a class="code" href="classOgre_1_1RenderOperation.html#Ogre_1_1RenderOperationm3">pVertices</a>;
01596         strideData.position.dwStride = op.<a class="code" href="classOgre_1_1RenderOperation.html#Ogre_1_1RenderOperationm4">vertexStride</a> + (<font class="keyword">sizeof</font>(float)*3);
01597         strideData.normal.lpvData = op.<a class="code" href="classOgre_1_1RenderOperation.html#Ogre_1_1RenderOperationm5">pNormals</a>;
01598         strideData.normal.dwStride = op.<a class="code" href="classOgre_1_1RenderOperation.html#Ogre_1_1RenderOperationm6">normalStride</a> + (<font class="keyword">sizeof</font>(float)*3);
01599         strideData.diffuse.lpvData = op.<a class="code" href="classOgre_1_1RenderOperation.html#Ogre_1_1RenderOperationm11">pDiffuseColour</a>;
01600         strideData.diffuse.dwStride = op.<a class="code" href="classOgre_1_1RenderOperation.html#Ogre_1_1RenderOperationm12">diffuseStride</a> + <font class="keyword">sizeof</font>(long);
01601         strideData.specular.lpvData = op.<a class="code" href="classOgre_1_1RenderOperation.html#Ogre_1_1RenderOperationm13">pSpecularColour</a>;
01602         strideData.specular.dwStride = op.<a class="code" href="classOgre_1_1RenderOperation.html#Ogre_1_1RenderOperationm14">specularStride</a> + <font class="keyword">sizeof</font>(long);
01603         <font class="keywordflow">for</font> (i = 0; i &lt; <a class="code" href="OgreConfig_8h.html#a5">OGRE_MAX_TEXTURE_COORD_SETS</a>; ++i)
01604         {
01605             strideData.textureCoords[i].lpvData = op.<a class="code" href="classOgre_1_1RenderOperation.html#Ogre_1_1RenderOperationm7">pTexCoords</a>[i];
01606             strideData.textureCoords[i].dwStride = op.<a class="code" href="classOgre_1_1RenderOperation.html#Ogre_1_1RenderOperationm8">texCoordStride</a>[i] + (<font class="keyword">sizeof</font>(float) * op.<a class="code" href="classOgre_1_1RenderOperation.html#Ogre_1_1RenderOperationm10">numTextureDimensions</a>[i]);
01607         }
01608 
01609         <font class="keywordflow">if</font> (op.<a class="code" href="classOgre_1_1RenderOperation.html#Ogre_1_1RenderOperationm0">useIndexes</a>)
01610         {
01611             hr = <a class="code" href="classOgre_1_1D3DRenderSystem.html#Ogre_1_1D3DRenderSystemo0">mlpD3DDevice</a>-&gt;DrawIndexedPrimitiveStrided(primType,
01612                 d3dVertexFormat, &amp;strideData, op.<a class="code" href="classOgre_1_1RenderOperation.html#Ogre_1_1RenderOperationm1">numVertices</a>,
01613                 op.<a class="code" href="classOgre_1_1RenderOperation.html#Ogre_1_1RenderOperationm16">pIndexes</a>, op.<a class="code" href="classOgre_1_1RenderOperation.html#Ogre_1_1RenderOperationm17">numIndexes</a>, 0);
01614         }
01615         <font class="keywordflow">else</font>
01616         {
01617             hr = <a class="code" href="classOgre_1_1D3DRenderSystem.html#Ogre_1_1D3DRenderSystemo0">mlpD3DDevice</a>-&gt;DrawPrimitiveStrided(primType,
01618                 d3dVertexFormat, &amp;strideData, op.<a class="code" href="classOgre_1_1RenderOperation.html#Ogre_1_1RenderOperationm1">numVertices</a>, 0);
01619         }
01620 
01621         <font class="keywordflow">if</font> (FAILED(hr))
01622         {
01623             <font class="keywordtype">char</font> szBuffer[512];
01624             D3DXGetErrorString( hr, 512, szBuffer );
01625             <a class="code" href="OgreException_8h.html#a0">Except</a>( hr, szBuffer, <font class="stringliteral">"D3DRenderSystem::_render"</font>);
01626         }
01627 
01628         <a class="code" href="OgreException_8h.html#a2">OgreUnguard</a>();
01629     }
01630 
01631     <font class="comment">//-----------------------------------------------------------------------</font>
<a name="l01632"></a><a class="code" href="classOgre_1_1D3DRenderSystem.html#Ogre_1_1D3DRenderSystema40">01632</a>     <font class="keywordtype">void</font> D3DRenderSystem::_endFrame(<font class="keywordtype">void</font>)
01633     {
01634         <a class="code" href="OgreException_8h.html#a1">OgreGuard</a>( <font class="stringliteral">"D3DRenderSystem::_endFrame"</font> );
01635 
01636         HRESULT hr;
01637         hr = <a class="code" href="classOgre_1_1D3DRenderSystem.html#Ogre_1_1D3DRenderSystemo0">mlpD3DDevice</a>-&gt;EndScene();
01638         <font class="keywordflow">if</font> (FAILED(hr))
01639             <a class="code" href="OgreException_8h.html#a0">Except</a>(hr, <font class="stringliteral">"Error ending frame."</font>,
01640                 <font class="stringliteral">"D3DRenderSystem::_endFrame"</font>);
01641 
01642         <a class="code" href="OgreException_8h.html#a2">OgreUnguard</a>();
01643     }
01644 
01645     <font class="comment">//-----------------------------------------------------------------------</font>
<a name="l01646"></a><a class="code" href="classOgre_1_1D3DRenderSystem.html#Ogre_1_1D3DRenderSystema41">01646</a>     <font class="keywordtype">void</font> D3DRenderSystem::_setCullingMode(<a class="code" href="namespaceOgre.html#a430">CullingMode</a> mode)
01647     {
01648         HRESULT hr;
01649         DWORD d3dMode;
01650 
01651         <font class="keywordflow">if</font> (mode == <a class="code" href="namespaceOgre.html#a430a84">CULL_NONE</a>)
01652         {
01653             d3dMode = D3DCULL_NONE;
01654         }
01655         <font class="keywordflow">else</font> <font class="keywordflow">if</font> (mode == <a class="code" href="namespaceOgre.html#a430a85">CULL_CLOCKWISE</a>)
01656         {
01657             d3dMode = D3DCULL_CW;
01658         }
01659         <font class="keywordflow">else</font> <font class="keywordflow">if</font> (mode == <a class="code" href="namespaceOgre.html#a430a86">CULL_ANTICLOCKWISE</a>)
01660         {
01661             d3dMode = D3DCULL_CCW;
01662         }
01663 
01664         hr = <a class="code" href="classOgre_1_1D3DRenderSystem.html#Ogre_1_1D3DRenderSystemo0">mlpD3DDevice</a>-&gt;SetRenderState(D3DRENDERSTATE_CULLMODE, d3dMode);
01665         <font class="keywordflow">if</font> (FAILED(hr))
01666             <a class="code" href="OgreException_8h.html#a0">Except</a>(hr, <font class="stringliteral">"Unable to set D3D culling mode."</font>,
01667                 <font class="stringliteral">"D3DRenderSystem::_setCullingMode"</font>);
01668 
01669     }
01670 
01671     <font class="comment">//-----------------------------------------------------------------------</font>
<a name="l01672"></a><a class="code" href="classOgre_1_1D3DRenderSystem.html#Ogre_1_1D3DRenderSystema42">01672</a>     <font class="keywordtype">void</font> D3DRenderSystem::_setDepthBufferParams(<font class="keywordtype">bool</font> depthTest, <font class="keywordtype">bool</font> depthWrite, <a class="code" href="namespaceOgre.html#a426">CompareFunction</a> depthFunction)
01673     {
01674         <a class="code" href="classOgre_1_1D3DRenderSystem.html#Ogre_1_1D3DRenderSystema43">_setDepthBufferCheckEnabled</a>(depthTest);
01675         <a class="code" href="classOgre_1_1D3DRenderSystem.html#Ogre_1_1D3DRenderSystema44">_setDepthBufferWriteEnabled</a>(depthWrite);
01676         <a class="code" href="classOgre_1_1D3DRenderSystem.html#Ogre_1_1D3DRenderSystema45">_setDepthBufferFunction</a>(depthFunction);
01677 
01678     }
01679     <font class="comment">//-----------------------------------------------------------------------</font>
<a name="l01680"></a><a class="code" href="classOgre_1_1D3DRenderSystem.html#Ogre_1_1D3DRenderSystema43">01680</a>     <font class="keywordtype">void</font> D3DRenderSystem::_setDepthBufferCheckEnabled(<font class="keywordtype">bool</font> enabled)
01681     {
01682         HRESULT hr;
01683 
01684         <font class="keywordflow">if</font> (enabled)
01685         {
01686             <font class="comment">// Use w-buffer if available</font>
01687             <font class="keywordflow">if</font> (<a class="code" href="classOgre_1_1D3DRenderSystem.html#Ogre_1_1D3DRenderSystemo1">mD3DDeviceDesc</a>.dpcTriCaps.dwRasterCaps &amp; D3DPRASTERCAPS_WBUFFER)
01688                 hr = <a class="code" href="classOgre_1_1D3DRenderSystem.html#Ogre_1_1D3DRenderSystemo0">mlpD3DDevice</a>-&gt;SetRenderState(D3DRENDERSTATE_ZENABLE, D3DZB_USEW);
01689             <font class="keywordflow">else</font>
01690                 hr = <a class="code" href="classOgre_1_1D3DRenderSystem.html#Ogre_1_1D3DRenderSystemo0">mlpD3DDevice</a>-&gt;SetRenderState(D3DRENDERSTATE_ZENABLE, D3DZB_TRUE);
01691             <font class="keywordflow">if</font> (FAILED(hr))
01692                 <a class="code" href="OgreException_8h.html#a0">Except</a>(hr, <font class="stringliteral">"Error setting depth buffer test state."</font>,
01693                     <font class="stringliteral">"D3DRenderSystem::_setDepthBufferCheckEnabled"</font>);
01694         }
01695         <font class="keywordflow">else</font>
01696         {
01697             hr = <a class="code" href="classOgre_1_1D3DRenderSystem.html#Ogre_1_1D3DRenderSystemo0">mlpD3DDevice</a>-&gt;SetRenderState(D3DRENDERSTATE_ZENABLE, D3DZB_FALSE);
01698             <font class="keywordflow">if</font> (FAILED(hr))
01699                 <a class="code" href="OgreException_8h.html#a0">Except</a>(hr, <font class="stringliteral">"Error setting depth buffer test state."</font>,
01700                     <font class="stringliteral">"D3DRenderSystem::_setDepthBufferCheckEnabled"</font>);
01701         }
01702     }
01703     <font class="comment">//-----------------------------------------------------------------------</font>
<a name="l01704"></a><a class="code" href="classOgre_1_1D3DRenderSystem.html#Ogre_1_1D3DRenderSystema44">01704</a>     <font class="keywordtype">void</font> D3DRenderSystem::_setDepthBufferWriteEnabled(<font class="keywordtype">bool</font> enabled)
01705     {
01706         HRESULT hr;
01707 
01708         hr = <a class="code" href="classOgre_1_1D3DRenderSystem.html#Ogre_1_1D3DRenderSystemo0">mlpD3DDevice</a>-&gt;SetRenderState(D3DRENDERSTATE_ZWRITEENABLE, enabled);
01709         <font class="keywordflow">if</font> (FAILED(hr))
01710             <a class="code" href="OgreException_8h.html#a0">Except</a>(hr, <font class="stringliteral">"Error setting depth buffer write state."</font>,
01711                 <font class="stringliteral">"D3DRenderSystem::_setDepthBufferWriteEnabled"</font>);
01712     }
01713     <font class="comment">//-----------------------------------------------------------------------</font>
<a name="l01714"></a><a class="code" href="classOgre_1_1D3DRenderSystem.html#Ogre_1_1D3DRenderSystema45">01714</a>     <font class="keywordtype">void</font> D3DRenderSystem::_setDepthBufferFunction(<a class="code" href="namespaceOgre.html#a426">CompareFunction</a> func)
01715     {
01716         HRESULT hr;
01717         D3DCMPFUNC d3dfunc;
01718 
01719         <font class="keywordflow">switch</font>(func)
01720         {
01721         <font class="keywordflow">case</font> <a class="code" href="namespaceOgre.html#a426a66">CMPF_ALWAYS_FAIL</a>:
01722             d3dfunc = D3DCMP_NEVER;
01723             <font class="keywordflow">break</font>;
01724         <font class="keywordflow">case</font> <a class="code" href="namespaceOgre.html#a426a67">CMPF_ALWAYS_PASS</a>:
01725             d3dfunc = D3DCMP_ALWAYS;
01726             <font class="keywordflow">break</font>;
01727         <font class="keywordflow">case</font> <a class="code" href="namespaceOgre.html#a426a68">CMPF_LESS</a>:
01728             d3dfunc = D3DCMP_LESS;
01729             <font class="keywordflow">break</font>;
01730         <font class="keywordflow">case</font> <a class="code" href="namespaceOgre.html#a426a69">CMPF_LESS_EQUAL</a>:
01731             d3dfunc = D3DCMP_LESSEQUAL;
01732             <font class="keywordflow">break</font>;
01733         <font class="keywordflow">case</font> <a class="code" href="namespaceOgre.html#a426a70">CMPF_EQUAL</a>:
01734             d3dfunc = D3DCMP_EQUAL;
01735             <font class="keywordflow">break</font>;
01736         <font class="keywordflow">case</font> <a class="code" href="namespaceOgre.html#a426a71">CMPF_NOT_EQUAL</a>:
01737             d3dfunc = D3DCMP_NOTEQUAL;
01738             <font class="keywordflow">break</font>;
01739         <font class="keywordflow">case</font> <a class="code" href="namespaceOgre.html#a426a72">CMPF_GREATER_EQUAL</a>:
01740             d3dfunc = D3DCMP_GREATEREQUAL;
01741             <font class="keywordflow">break</font>;
01742         <font class="keywordflow">case</font> <a class="code" href="namespaceOgre.html#a426a73">CMPF_GREATER</a>:
01743             d3dfunc = D3DCMP_GREATER;
01744             <font class="keywordflow">break</font>;
01745         };
01746 
01747         hr = <a class="code" href="classOgre_1_1D3DRenderSystem.html#Ogre_1_1D3DRenderSystemo0">mlpD3DDevice</a>-&gt;SetRenderState(D3DRENDERSTATE_ZFUNC, d3dfunc);
01748         <font class="keywordflow">if</font> (FAILED(hr))
01749             <a class="code" href="OgreException_8h.html#a0">Except</a>(hr, <font class="stringliteral">"Error setting depth buffer test function."</font>,
01750                 <font class="stringliteral">"D3DRenderSystem::_setDepthBufferFunction"</font>);
01751     }
01752     <font class="comment">//-----------------------------------------------------------------------</font>
<a name="l01753"></a><a class="code" href="classOgre_1_1D3DRenderSystem.html#Ogre_1_1D3DRenderSystema16">01753</a>     <a class="code" href="classOgre_1_1String.html">String</a> D3DRenderSystem::getErrorDescription(<font class="keywordtype">long</font> errCode)
01754     {
01755         <font class="keywordtype">char</font>* errDesc;
01756         <font class="keywordtype">int</font> i;
01757 
01758         errDesc = <font class="keyword">new</font> <font class="keywordtype">char</font>[255];
01759         <font class="comment">// Try windows errors first</font>
01760         i = FormatMessage(
01761             FORMAT_MESSAGE_FROM_HMODULE |
01762             FORMAT_MESSAGE_FROM_SYSTEM |
01763             FORMAT_MESSAGE_IGNORE_INSERTS,
01764             NULL,
01765             DDERR_SURFACELOST,
01766             MAKELANGID(LANG_NEUTRAL, SUBLANG_DEFAULT), <font class="comment">// Default language</font>
01767             (LPTSTR) errDesc,
01768             255,
01769             NULL
01770         );
01771 
01772 
01773         <font class="keywordflow">if</font> (i == 0)
01774         {
01775             <font class="comment">// Not found in windows message descriptions</font>
01776             <font class="keywordflow">switch</font> (errCode)
01777             {
01778             <font class="keywordflow">case</font> DD_OK:
01779                 strcpy(errDesc, <font class="stringliteral">"DD_OK: The request completed successfully."</font>);
01780                 <font class="keywordflow">break</font>;
01781             <font class="keywordflow">case</font> DDERR_ALREADYINITIALIZED:
01782                 strcpy(errDesc, <font class="stringliteral">"DDERR_ALREADYINITIALIZED: The object has already been initialized."</font>);
01783                 <font class="keywordflow">break</font>;
01784             <font class="keywordflow">case</font> DDERR_BLTFASTCANTCLIP :
01785                 strcpy(errDesc, <font class="stringliteral">"DDERR_BLTFASTCANTCLIP: A DirectDrawClipper object is attached to a source surface that has passed into a call to the IDirectDrawSurface7::BltFast method."</font>);
01786                 <font class="keywordflow">break</font>;
01787             <font class="keywordflow">case</font> DDERR_CANNOTATTACHSURFACE:
01788                 strcpy(errDesc, <font class="stringliteral">"DDERR_CANNOTATTACHSURFACE: A surface cannot be attached to another requested surface."</font>);
01789                 <font class="keywordflow">break</font>;
01790             <font class="keywordflow">case</font> DDERR_CANNOTDETACHSURFACE:
01791                 strcpy(errDesc, <font class="stringliteral">"DDERR_CANNOTATTACHSURFACE: A surface cannot be detached from another requested surface."</font>);
01792                 <font class="keywordflow">break</font>;
01793             <font class="keywordflow">case</font> DDERR_CANTCREATEDC:
01794                 strcpy(errDesc, <font class="stringliteral">"DDERR_CANTCREATEDC: Windows can not create any more device contexts (DCs), or a DC was requested for a palette-indexed surface when the surface had no palette and the display mode was not palette-indexed."</font>);
01795                 <font class="keywordflow">break</font>;
01796             <font class="keywordflow">case</font> DDERR_CANTDUPLICATE:
01797                 strcpy(errDesc, <font class="stringliteral">"DDERR_CANTDUPLICATE: Primary and 3-D surfaces, or surfaces that are implicitly created, cannot be duplicated."</font>);
01798                 <font class="keywordflow">break</font>;
01799             <font class="keywordflow">case</font> DDERR_CANTLOCKSURFACE:
01800                 strcpy(errDesc, <font class="stringliteral">"DDERR_CANTLOCKSURFACE: Access to this surface is refused because an attempt was made to lock the primary surface without DCI support."</font>);
01801                 <font class="keywordflow">break</font>;
01802             <font class="keywordflow">case</font> DDERR_CANTPAGELOCK:
01803                 strcpy(errDesc, <font class="stringliteral">"DDERR_CANTPAGELOCK: An attempt to page lock a surface failed. Page lock will not work on a display-memory surface or an emulated primary surface."</font>);
01804                 <font class="keywordflow">break</font>;
01805             <font class="keywordflow">case</font> DDERR_CANTPAGEUNLOCK:
01806                 strcpy(errDesc, <font class="stringliteral">"DDERR_CANTPAGEUNLOCK: An attempt to page unlock a surface failed. Page unlock will not work on a display-memory surface or an emulated primary surface."</font>);
01807                 <font class="keywordflow">break</font>;
01808             <font class="keywordflow">case</font> DDERR_CLIPPERISUSINGHWND:
01809                 strcpy(errDesc, <font class="stringliteral">"DDERR_CLIPPERISUSINGHWND: An attempt was made to set a clip list for a DirectDrawClipper object that is already monitoring a window handle."</font>);
01810                 <font class="keywordflow">break</font>;
01811             <font class="keywordflow">case</font> DDERR_COLORKEYNOTSET:
01812                 strcpy(errDesc, <font class="stringliteral">"DDERR_COLORKEYNOTSET: No source color key is specified for this operation."</font>);
01813                 <font class="keywordflow">break</font>;
01814             <font class="keywordflow">case</font> DDERR_CURRENTLYNOTAVAIL:
01815                 strcpy(errDesc, <font class="stringliteral">"DDERR_CURRENTLYNOTAVAIL: No support is currently available."</font>);
01816                 <font class="keywordflow">break</font>;
01817             <font class="keywordflow">case</font> DDERR_DCALREADYCREATED:
01818                 strcpy(errDesc, <font class="stringliteral">"DDERR_DCALREADYCREATED: A device context (DC) has already been returned for this surface. Only one DC can be retrieved for each surface."</font>);
01819                 <font class="keywordflow">break</font>;
01820             <font class="keywordflow">case</font> DDERR_DEVICEDOESNTOWNSURFACE:
01821                 strcpy(errDesc, <font class="stringliteral">"DDERR_DEVICEDOESNTOWNSURFACE: Surfaces created by one DirectDraw device cannot be used directly by another DirectDraw device."</font>);
01822                 <font class="keywordflow">break</font>;
01823             <font class="keywordflow">case</font> DDERR_DIRECTDRAWALREADYCREATED:
01824                 strcpy(errDesc, <font class="stringliteral">"DDERR_DIRECTDRAWALREADYCREATED: A DirectDraw object representing this driver has already been created for this process."</font>);
01825                 <font class="keywordflow">break</font>;
01826             <font class="keywordflow">case</font> DDERR_EXCEPTION:
01827                 strcpy(errDesc, <font class="stringliteral">"DDERR_EXCEPTION: An exception was encountered while performing the requested operation."</font>);
01828                 <font class="keywordflow">break</font>;
01829             <font class="keywordflow">case</font> DDERR_EXCLUSIVEMODEALREADYSET:
01830                 strcpy(errDesc, <font class="stringliteral">"DDERR_EXCLUSIVEMODEALREADYSET: An attempt was made to set the cooperative level when it was already set to exclusive."</font>);
01831                 <font class="keywordflow">break</font>;
01832             <font class="keywordflow">case</font> DDERR_EXPIRED:
01833                 strcpy(errDesc, <font class="stringliteral">"DDERR_EXPIRED: The data has expired and is therefore no longer valid."</font>);
01834                 <font class="keywordflow">break</font>;
01835             <font class="keywordflow">case</font> DDERR_GENERIC:
01836                 strcpy(errDesc, <font class="stringliteral">"DDERR_GENERIC: There is an undefined error condition."</font>);
01837                 <font class="keywordflow">break</font>;
01838             <font class="keywordflow">case</font> DDERR_HEIGHTALIGN:
01839                 strcpy(errDesc, <font class="stringliteral">"DDERR_HEIGHTALIGN: The height of the provided rectangle is not a multiple of the required alignment."</font>);
01840                 <font class="keywordflow">break</font>;
01841             <font class="keywordflow">case</font> DDERR_HWNDALREADYSET:
01842                 strcpy(errDesc, <font class="stringliteral">"DDERR_HWNDALREADYSET: The DirectDraw cooperative level window handle has already been set. It cannot be reset while the process has surfaces or palettes created."</font>);
01843                 <font class="keywordflow">break</font>;
01844             <font class="keywordflow">case</font> DDERR_HWNDSUBCLASSED:
01845                 strcpy(errDesc, <font class="stringliteral">"DDERR_HWNDSUBCLASSED: DirectDraw is prevented from restoring state because the DirectDraw cooperative level window handle has been subclassed."</font>);
01846                 <font class="keywordflow">break</font>;
01847             <font class="keywordflow">case</font> DDERR_IMPLICITLYCREATED:
01848                 strcpy(errDesc, <font class="stringliteral">"DDERR_IMPLICITLYCREATED: The surface cannot be restored because it is an implicitly created surface."</font>);
01849                 <font class="keywordflow">break</font>;
01850             <font class="keywordflow">case</font> DDERR_INCOMPATIBLEPRIMARY:
01851                 strcpy(errDesc, <font class="stringliteral">"DDERR_INCOMPATIBLEPRIMARY: The primary surface creation request does not match with the existing primary surface."</font>);
01852                 <font class="keywordflow">break</font>;
01853             <font class="keywordflow">case</font> DDERR_INVALIDCAPS:
01854                 strcpy(errDesc, <font class="stringliteral">"DDERR_INVALIDCAPS: One or more of the capability bits passed to the callback function are incorrect."</font>);
01855                 <font class="keywordflow">break</font>;
01856             <font class="keywordflow">case</font> DDERR_INVALIDCLIPLIST:
01857                 strcpy(errDesc, <font class="stringliteral">"DDERR_INVALIDCLIPLIST: DirectDraw does not support the provided clip list."</font>);
01858                 <font class="keywordflow">break</font>;
01859             <font class="keywordflow">case</font> DDERR_INVALIDDIRECTDRAWGUID:
01860                 strcpy(errDesc, <font class="stringliteral">"DDERR_INVALIDDIRECTDRAWGUID: The globally unique identifier (GUID) passed to the DirectDrawCreate function is not a valid DirectDraw driver identifier."</font>);
01861                 <font class="keywordflow">break</font>;
01862             <font class="keywordflow">case</font> DDERR_INVALIDMODE:
01863                 strcpy(errDesc, <font class="stringliteral">"DDERR_INVALIDMODE: DirectDraw does not support the requested mode."</font>);
01864                 <font class="keywordflow">break</font>;
01865             <font class="keywordflow">case</font> DDERR_INVALIDOBJECT:
01866                 strcpy(errDesc, <font class="stringliteral">"DDERR_INVALIDOBJECT: DirectDraw received a pointer that was an invalid DirectDraw object."</font>);
01867                 <font class="keywordflow">break</font>;
01868             <font class="keywordflow">case</font> DDERR_INVALIDPARAMS:
01869                 strcpy(errDesc, <font class="stringliteral">"DDERR_INVALIDPARAMS: One or more of the parameters passed to the method are incorrect."</font>);
01870                 <font class="keywordflow">break</font>;
01871             <font class="keywordflow">case</font> DDERR_INVALIDPIXELFORMAT:
01872                 strcpy(errDesc, <font class="stringliteral">"DDERR_INVALIDPIXELFORMAT: The pixel format was invalid as specified."</font>);
01873                 <font class="keywordflow">break</font>;
01874             <font class="keywordflow">case</font> DDERR_INVALIDPOSITION:
01875                 strcpy(errDesc, <font class="stringliteral">"DDERR_INVALIDPOSITION: The position of the overlay on the destination is no longer legal."</font>);
01876                 <font class="keywordflow">break</font>;
01877             <font class="keywordflow">case</font> DDERR_INVALIDRECT:
01878                 strcpy(errDesc, <font class="stringliteral">"DDERR_INVALIDRECT: The provided rectangle was invalid."</font>);
01879                 <font class="keywordflow">break</font>;
01880             <font class="keywordflow">case</font> DDERR_INVALIDSTREAM:
01881                 strcpy(errDesc, <font class="stringliteral">"DDERR_INVALIDSTREAM: The specified stream contains invalid data."</font>);
01882                 <font class="keywordflow">break</font>;
01883             <font class="keywordflow">case</font> DDERR_INVALIDSURFACETYPE:
01884                 strcpy(errDesc, <font class="stringliteral">"DDERR_INVALIDSURFACETYPE: The requested operation could not be performed because the surface was of the wrong type."</font>);
01885                 <font class="keywordflow">break</font>;
01886             <font class="keywordflow">case</font> DDERR_LOCKEDSURFACES:
01887                 strcpy(errDesc, <font class="stringliteral">"DDERR_LOCKEDSURFACES: One or more surfaces are locked, causing the failure of the requested operation."</font>);
01888                 <font class="keywordflow">break</font>;
01889             <font class="keywordflow">case</font> DDERR_MOREDATA:
01890                 strcpy(errDesc, <font class="stringliteral">"DDERR_MOREDATA: There is more data available than the specified buffer size can hold."</font>);
01891                 <font class="keywordflow">break</font>;
01892             <font class="keywordflow">case</font> DDERR_NO3D:
01893                 strcpy(errDesc, <font class="stringliteral">"DDERR_NO3D: No 3-D hardware or emulation is present."</font>);
01894                 <font class="keywordflow">break</font>;
01895             <font class="keywordflow">case</font> DDERR_NOALPHAHW:
01896                 strcpy(errDesc, <font class="stringliteral">"DDERR_NOALPHAHW: No alpha acceleration hardware is present or available, causing the failure of the requested operation."</font>);
01897                 <font class="keywordflow">break</font>;
01898             <font class="keywordflow">case</font> DDERR_NOBLTHW:
01899                 strcpy(errDesc, <font class="stringliteral">"DDERR_NOBLTHW: No blitter hardware is present."</font>);
01900                 <font class="keywordflow">break</font>;
01901             <font class="keywordflow">case</font> DDERR_NOCLIPLIST:
01902                 strcpy(errDesc, <font class="stringliteral">"DDERR_NOCLIPLIST: No clip list is available."</font>);
01903                 <font class="keywordflow">break</font>;
01904             <font class="keywordflow">case</font> DDERR_NOCLIPPERATTACHED:
01905                 strcpy(errDesc, <font class="stringliteral">"DDERR_NOCLIPPERATTACHED: No DirectDrawClipper object is attached to the surface object."</font>);
01906                 <font class="keywordflow">break</font>;
01907             <font class="keywordflow">case</font> DDERR_NOCOLORCONVHW:
01908                 strcpy(errDesc, <font class="stringliteral">"DDERR_NOCOLORCONVHW: The operation cannot be carried out because no color-conversion hardware is present or available."</font>);
01909                 <font class="keywordflow">break</font>;
01910             <font class="keywordflow">case</font> DDERR_NOCOLORKEY:
01911                 strcpy(errDesc, <font class="stringliteral">"DDERR_NOCOLORKEY: The surface does not currently have a color key."</font>);
01912                 <font class="keywordflow">break</font>;
01913             <font class="keywordflow">case</font> DDERR_NOCOLORKEYHW:
01914                 strcpy(errDesc, <font class="stringliteral">"DDERR_NOCOLORKEYHW: The operation cannot be carried out because there is no hardware support for the destination color key."</font>);
01915                 <font class="keywordflow">break</font>;
01916             <font class="keywordflow">case</font> DDERR_NOCOOPERATIVELEVELSET:
01917                 strcpy(errDesc, <font class="stringliteral">"DDERR_NOCOOPERATIVELEVELSET: A create function is called without the IDirectDraw7::SetCooperativeLevel method being called."</font>);
01918                 <font class="keywordflow">break</font>;
01919             <font class="keywordflow">case</font> DDERR_NODC:
01920                 strcpy(errDesc, <font class="stringliteral">"DDERR_NODC: No DC has ever been created for this surface."</font>);
01921                 <font class="keywordflow">break</font>;
01922             <font class="keywordflow">case</font> DDERR_NODDROPSHW:
01923                 strcpy(errDesc, <font class="stringliteral">"DDERR_NODDROPSHW: No DirectDraw raster operation (ROP) hardware is available."</font>);
01924                 <font class="keywordflow">break</font>;
01925             <font class="keywordflow">case</font> DDERR_NODIRECTDRAWHW:
01926                 strcpy(errDesc, <font class="stringliteral">"DDERR_NODIRECTDRAWHW: Hardware-only DirectDraw object creation is not possible; the driver does not support any hardware."</font>);
01927                 <font class="keywordflow">break</font>;
01928             <font class="keywordflow">case</font> DDERR_NODIRECTDRAWSUPPORT:
01929                 strcpy(errDesc, <font class="stringliteral">"DDERR_NODIRECTDRAWSUPPORT: DirectDraw support is not possible with the current display driver."</font>);
01930                 <font class="keywordflow">break</font>;
01931             <font class="keywordflow">case</font> DDERR_NOEMULATION:
01932                 strcpy(errDesc, <font class="stringliteral">"DDERR_NOEMULATION: Software emulation is not available."</font>);
01933                 <font class="keywordflow">break</font>;
01934             <font class="keywordflow">case</font> DDERR_NOEXCLUSIVEMODE:
01935                 strcpy(errDesc, <font class="stringliteral">"DDERR_NOEXCLUSIVEMODE: The operation requires the application to have exclusive mode, but the application does not have exclusive mode."</font>);
01936                 <font class="keywordflow">break</font>;
01937             <font class="keywordflow">case</font> DDERR_NOFLIPHW:
01938                 strcpy(errDesc, <font class="stringliteral">"DDERR_NOFLIPHW: Flipping visible surfaces is not supported."</font>);
01939                 <font class="keywordflow">break</font>;
01940             <font class="keywordflow">case</font> DDERR_NOFOCUSWINDOW:
01941                 strcpy(errDesc, <font class="stringliteral">"DDERR_NOFOCUSWINDOW: An attempt was made to create or set a device window without first setting the focus window."</font>);
01942                 <font class="keywordflow">break</font>;
01943             <font class="keywordflow">case</font> DDERR_NOGDI:
01944                 strcpy(errDesc, <font class="stringliteral">"DDERR_NOGDI: No GDI is present."</font>);
01945                 <font class="keywordflow">break</font>;
01946             <font class="keywordflow">case</font> DDERR_NOHWND:
01947                 strcpy(errDesc, <font class="stringliteral">"DDERR_NOHWND: Clipper notification requires a window handle, or no window handle has been previously set as the cooperative level window handle."</font>);
01948                 <font class="keywordflow">break</font>;
01949             <font class="keywordflow">case</font> DDERR_NOMIPMAPHW:
01950                 strcpy(errDesc, <font class="stringliteral">"DDERR_NOMIPMAPHW: The operation cannot be carried out because no mipmap capable texture mapping hardware is present or available."</font>);
01951                 <font class="keywordflow">break</font>;
01952             <font class="keywordflow">case</font> DDERR_NOMIRRORHW:
01953                 strcpy(errDesc, <font class="stringliteral">"DDERR_NOMIRRORHW: The operation cannot be carried out because no mirroring hardware is present or available."</font>);
01954                 <font class="keywordflow">break</font>;
01955             <font class="keywordflow">case</font> DDERR_NONONLOCALVIDMEM:
01956                 strcpy(errDesc, <font class="stringliteral">"DDERR_NONONLOCALVIDMEM: An attempt was made to allocate non-local video memory from a device that does not support non-local video memory."</font>);
01957                 <font class="keywordflow">break</font>;
01958             <font class="keywordflow">case</font> DDERR_NOOPTIMIZEHW:
01959                 strcpy(errDesc, <font class="stringliteral">"DDERR_NOOPTIMIZEHW: The device does not support optimized surfaces."</font>);
01960                 <font class="keywordflow">break</font>;
01961             <font class="keywordflow">case</font> DDERR_NOOVERLAYDEST:
01962                 strcpy(errDesc, <font class="stringliteral">"DDERR_NOOVERLAYDEST: The IDirectDrawSurface4::GetOverlayPosition method is called on an overlay that the IDirectDrawSurface7::UpdateOverlay method has not been called on to establish a destination."</font>);
01963                 <font class="keywordflow">break</font>;
01964             <font class="keywordflow">case</font> DDERR_NOOVERLAYHW:
01965                 strcpy(errDesc, <font class="stringliteral">"DDERR_NOOVERLAYHW: The operation cannot be carried out because no overlay hardware is present or available."</font>);
01966                 <font class="keywordflow">break</font>;
01967             <font class="keywordflow">case</font> DDERR_NOPALETTEATTACHED:
01968                 strcpy(errDesc, <font class="stringliteral">"DDERR_NOPALETTEATTACHED: No palette object is attached to this surface."</font>);
01969                 <font class="keywordflow">break</font>;
01970             <font class="keywordflow">case</font> DDERR_NOPALETTEHW:
01971                 strcpy(errDesc, <font class="stringliteral">"DDERR_NOPALETTEHW: There is no hardware support for 16- or 256-color palettes."</font>);
01972                 <font class="keywordflow">break</font>;
01973             <font class="keywordflow">case</font> DDERR_NORASTEROPHW:
01974                 strcpy(errDesc, <font class="stringliteral">"DDERR_NORASTEROPHW: The operation cannot be carried out because no appropriate raster operation hardware is present or available."</font>);
01975                 <font class="keywordflow">break</font>;
01976             <font class="keywordflow">case</font> DDERR_NOROTATIONHW:
01977                 strcpy(errDesc, <font class="stringliteral">"DDERR_NOROTATIONHW: The operation cannot be carried out because no rotation hardware is present or available."</font>);
01978                 <font class="keywordflow">break</font>;
01979             <font class="keywordflow">case</font> DDERR_NOSTRETCHHW:
01980                 strcpy(errDesc, <font class="stringliteral">"DDERR_NOSTRETCHHW: The operation cannot be carried out because there is no hardware support for stretching."</font>);
01981                 <font class="keywordflow">break</font>;
01982             <font class="keywordflow">case</font> DDERR_NOT4BITCOLOR:
01983                 strcpy(errDesc, <font class="stringliteral">"DDERR_NOT4BITCOLOR: The DirectDrawSurface object is not using a 4-bit color palette and the requested operation requires a 4-bit color palette."</font>);
01984                 <font class="keywordflow">break</font>;
01985             <font class="keywordflow">case</font> DDERR_NOT4BITCOLORINDEX:
01986                 strcpy(errDesc, <font class="stringliteral">"DDERR_NOT4BITCOLORINDEX: The DirectDrawSurface object is not using a 4-bit color index palette and the requested operation requires a 4-bit color index palette."</font>);
01987                 <font class="keywordflow">break</font>;
01988             <font class="keywordflow">case</font> DDERR_NOT8BITCOLOR:
01989                 strcpy(errDesc, <font class="stringliteral">"DDERR_NOT8BITCOLOR: The DirectDrawSurface object is not using an 8-bit color palette and the requested operation requires an 8-bit color palette."</font>);
01990                 <font class="keywordflow">break</font>;
01991             <font class="keywordflow">case</font> DDERR_NOTAOVERLAYSURFACE:
01992                 strcpy(errDesc, <font class="stringliteral">"DDERR_NOTAOVERLAYSURFACE: An overlay component is called for a non-overlay surface."</font>);
01993                 <font class="keywordflow">break</font>;
01994             <font class="keywordflow">case</font> DDERR_NOTEXTUREHW:
01995                 strcpy(errDesc, <font class="stringliteral">"DDERR_NOTEXTUREHW: The operation cannot be carried out because no texture-mapping hardware is present or available."</font>);
01996                 <font class="keywordflow">break</font>;
01997             <font class="keywordflow">case</font> DDERR_NOTFLIPPABLE:
01998                 strcpy(errDesc, <font class="stringliteral">"DDERR_NOTFLIPPABLE: An attempt has been made to flip a surface that cannot be flipped."</font>);
01999                 <font class="keywordflow">break</font>;
02000             <font class="keywordflow">case</font> DDERR_NOTFOUND:
02001                 strcpy(errDesc, <font class="stringliteral">"DDERR_NOTFOUND: The requested item was not found."</font>);
02002                 <font class="keywordflow">break</font>;
02003             <font class="keywordflow">case</font> DDERR_NOTINITIALIZED:
02004                 strcpy(errDesc, <font class="stringliteral">"DDERR_NOTINITIALIZED: An attempt was made to call an interface method of a DirectDraw object created by CoCreateInstance before the object was initialized."</font>);
02005                 <font class="keywordflow">break</font>;
02006             <font class="keywordflow">case</font> DDERR_NOTLOADED:
02007                 strcpy(errDesc, <font class="stringliteral">"DDERR_NOTLOADED: The surface is an optimized surface, but it has not yet been allocated any memory."</font>);
02008                 <font class="keywordflow">break</font>;
02009             <font class="keywordflow">case</font> DDERR_NOTLOCKED:
02010                 strcpy(errDesc, <font class="stringliteral">"DDERR_NOTLOCKED: An attempt is made to unlock a surface that was not locked."</font>);
02011                 <font class="keywordflow">break</font>;
02012             <font class="keywordflow">case</font> DDERR_NOTPAGELOCKED:
02013                 strcpy(errDesc, <font class="stringliteral">"DDERR_NOTPAGELOCKED: An attempt is made to page unlock a surface with no outstanding page locks."</font>);
02014                 <font class="keywordflow">break</font>;
02015             <font class="keywordflow">case</font> DDERR_NOTPALETTIZED:
02016                 strcpy(errDesc, <font class="stringliteral">"DDERR_NOTPALETTIZED: The surface being used is not a palette-based surface."</font>);
02017                 <font class="keywordflow">break</font>;
02018             <font class="keywordflow">case</font> DDERR_NOVSYNCHW:
02019                 strcpy(errDesc, <font class="stringliteral">"DDERR_NOVSYNCHW: The operation cannot be carried out because there is no hardware support for vertical blank synchronized operations."</font>);
02020                 <font class="keywordflow">break</font>;
02021             <font class="keywordflow">case</font> DDERR_NOZBUFFERHW:
02022                 strcpy(errDesc, <font class="stringliteral">"DDERR_NOZBUFFERHW: The operation to create a z-buffer in display memory or to perform a blit using a z-buffer cannot be carried out because there is no hardware support for z-buffers."</font>);
02023                 <font class="keywordflow">break</font>;
02024             <font class="keywordflow">case</font> DDERR_NOZOVERLAYHW:
02025                 strcpy(errDesc, <font class="stringliteral">"DDERR_NOZOVERLAYHW: The overlay surfaces cannot be z-layered based on the z-order because the hardware does not support z-ordering of overlays."</font>);
02026                 <font class="keywordflow">break</font>;
02027             <font class="keywordflow">case</font> DDERR_OUTOFCAPS:
02028                 strcpy(errDesc, <font class="stringliteral">"DDERR_OUTOFCAPS: The hardware needed for the requested operation has already been allocated."</font>);
02029                 <font class="keywordflow">break</font>;
02030             <font class="keywordflow">case</font> DDERR_OUTOFMEMORY:
02031                 strcpy(errDesc, <font class="stringliteral">"DDERR_OUTOFMEMORY: DirectDraw does not have enough memory to perform the operation."</font>);
02032                 <font class="keywordflow">break</font>;
02033             <font class="keywordflow">case</font> DDERR_OUTOFVIDEOMEMORY:
02034                 strcpy(errDesc, <font class="stringliteral">"DDERR_OUTOFVIDEOMEMORY: DirectDraw does not have enough display memory to perform the operation."</font>);
02035                 <font class="keywordflow">break</font>;
02036             <font class="keywordflow">case</font> DDERR_OVERLAPPINGRECTS:
02037                 strcpy(errDesc, <font class="stringliteral">"DDERR_OVERLAPPINGRECTS: Operation could not be carried out because the source and destination rectangles are on the same surface and overlap each other."</font>);
02038                 <font class="keywordflow">break</font>;
02039             <font class="keywordflow">case</font> DDERR_OVERLAYCANTCLIP:
02040                 strcpy(errDesc, <font class="stringliteral">"DDERR_OVERLAYCANTCLIP: The hardware does not support clipped overlays."</font>);
02041                 <font class="keywordflow">break</font>;
02042             <font class="keywordflow">case</font> DDERR_OVERLAYCOLORKEYONLYONEACTIVE:
02043                 strcpy(errDesc, <font class="stringliteral">"DDERR_OVERLAYCOLORKEYONLYONEACTIVE: An attempt was made to have more than one color key active on an overlay."</font>);
02044                 <font class="keywordflow">break</font>;
02045             <font class="keywordflow">case</font> DDERR_OVERLAYNOTVISIBLE:
02046                 strcpy(errDesc, <font class="stringliteral">"DDERR_OVERLAYNOTVISIBLE: The IDirectDrawSurface7::GetOverlayPosition method is called on a hidden overlay."</font>);
02047                 <font class="keywordflow">break</font>;
02048             <font class="keywordflow">case</font> DDERR_PALETTEBUSY:
02049                 strcpy(errDesc, <font class="stringliteral">"DDERR_PALETTEBUSY: Access to this palette is refused because the palette is locked by another thread."</font>);
02050                 <font class="keywordflow">break</font>;
02051             <font class="keywordflow">case</font> DDERR_PRIMARYSURFACEALREADYEXISTS:
02052                 strcpy(errDesc, <font class="stringliteral">"DDERR_PRIMARYSURFACEALREADYEXISTS: This process has already created a primary surface."</font>);
02053                 <font class="keywordflow">break</font>;
02054             <font class="keywordflow">case</font> DDERR_REGIONTOOSMALL:
02055                 strcpy(errDesc, <font class="stringliteral">"DDERR_REGIONTOOSMALL: The region passed to the IDirectDrawClipper::GetClipList method is too small."</font>);
02056                 <font class="keywordflow">break</font>;
02057             <font class="keywordflow">case</font> DDERR_SURFACEALREADYATTACHED:
02058                 strcpy(errDesc, <font class="stringliteral">"DDERR_SURFACEALREADYATTACHED: An attempt was made to attach a surface to another surface to which it is already attached."</font>);
02059                 <font class="keywordflow">break</font>;
02060             <font class="keywordflow">case</font> DDERR_SURFACEALREADYDEPENDENT:
02061                 strcpy(errDesc, <font class="stringliteral">"DDERR_SURFACEALREADYDEPENDENT: An attempt was made to make a surface a dependency of another surface to which it is already dependent."</font>);
02062                 <font class="keywordflow">break</font>;
02063             <font class="keywordflow">case</font> DDERR_SURFACEBUSY:
02064                 strcpy(errDesc, <font class="stringliteral">"DDERR_SURFACEBUSY: Access to the surface is refused because the surface is locked by another thread."</font>);
02065                 <font class="keywordflow">break</font>;
02066             <font class="keywordflow">case</font> DDERR_SURFACEISOBSCURED:
02067                 strcpy(errDesc, <font class="stringliteral">"DDERR_SURFACEISOBSCURED: Access to the surface is refused because the surface is obscured."</font>);
02068                 <font class="keywordflow">break</font>;
02069             <font class="keywordflow">case</font> DDERR_SURFACELOST:
02070                 strcpy(errDesc, <font class="stringliteral">"DDERR_SURFACELOST: Access to the surface is refused because the surface memory is gone. Call the IDirectDrawSurface7::Restore method on this surface to restore the memory associated with it."</font>);
02071                 <font class="keywordflow">break</font>;
02072             <font class="keywordflow">case</font> DDERR_SURFACENOTATTACHED:
02073                 strcpy(errDesc, <font class="stringliteral">"DDERR_SURFACENOTATTACHED: The requested surface is not attached."</font>);
02074                 <font class="keywordflow">break</font>;
02075             <font class="keywordflow">case</font> DDERR_TOOBIGHEIGHT:
02076                 strcpy(errDesc, <font class="stringliteral">"DDERR_TOOBIGHEIGHT: The height requested by DirectDraw is too large."</font>);
02077                 <font class="keywordflow">break</font>;
02078             <font class="keywordflow">case</font> DDERR_TOOBIGSIZE:
02079                 strcpy(errDesc, <font class="stringliteral">"DDERR_TOOBIGSIZE: The size requested by DirectDraw is too large. However, the individual height and width are valid sizes."</font>);
02080                 <font class="keywordflow">break</font>;
02081             <font class="keywordflow">case</font> DDERR_TOOBIGWIDTH:
02082                 strcpy(errDesc, <font class="stringliteral">"DDERR_TOOBIGWIDTH: The width requested by DirectDraw is too large."</font>);
02083                 <font class="keywordflow">break</font>;
02084             <font class="keywordflow">case</font> DDERR_UNSUPPORTED:
02085                 strcpy(errDesc, <font class="stringliteral">"DDERR_UNSUPPORTED: The operation is not supported."</font>);
02086                 <font class="keywordflow">break</font>;
02087             <font class="keywordflow">case</font> DDERR_UNSUPPORTEDFORMAT:
02088                 strcpy(errDesc, <font class="stringliteral">"DDERR_UNSUPPORTEDFORMAT: The FourCC format requested is not supported by DirectDraw."</font>);
02089                 <font class="keywordflow">break</font>;
02090             <font class="keywordflow">case</font> DDERR_UNSUPPORTEDMASK:
02091                 strcpy(errDesc, <font class="stringliteral">"DDERR_UNSUPPORTEDMASK: The bitmask in the pixel format requested is not supported by DirectDraw."</font>);
02092                 <font class="keywordflow">break</font>;
02093             <font class="keywordflow">case</font> DDERR_UNSUPPORTEDMODE:
02094                 strcpy(errDesc, <font class="stringliteral">"DDERR_UNSUPPORTEDMODE: The display is currently in an unsupported mode."</font>);
02095                 <font class="keywordflow">break</font>;
02096             <font class="keywordflow">case</font> DDERR_VERTICALBLANKINPROGRESS:
02097                 strcpy(errDesc, <font class="stringliteral">"DDERR_VERTICALBLANKINPROGRESS: A vertical blank is in progress."</font>);
02098                 <font class="keywordflow">break</font>;
02099             <font class="keywordflow">case</font> DDERR_VIDEONOTACTIVE:
02100                 strcpy(errDesc, <font class="stringliteral">"DDERR_VIDEONOTACTIVE: The video port is not active."</font>);
02101                 <font class="keywordflow">break</font>;
02102             <font class="keywordflow">case</font> DDERR_WASSTILLDRAWING:
02103                 strcpy(errDesc, <font class="stringliteral">"DDERR_WASSTILLDRAWING: The previous blit operation that is transferring information to or from this surface is incomplete."</font>);
02104                 <font class="keywordflow">break</font>;
02105             <font class="keywordflow">case</font> DDERR_WRONGMODE:
02106                 strcpy(errDesc, <font class="stringliteral">"DDERR_WRONGMODE: This surface cannot be restored because it was created in a different mode."</font>);
02107                 <font class="keywordflow">break</font>;
02108             <font class="keywordflow">case</font> DDERR_XALIGN:
02109                 strcpy(errDesc, <font class="stringliteral">"DDERR_XALIGN: The provided rectangle was not horizontally aligned on a required boundary."</font>);
02110                 <font class="keywordflow">break</font>;
02111             <font class="keywordflow">default</font>:
02112                 strcpy(errDesc, <font class="stringliteral">"Unknown error code."</font>);
02113             }
02114         }
02115         <font class="keywordflow">return</font> errDesc;
02116     }
02117 
02118     <font class="comment">/*</font>
02119 <font class="comment">    D3D_OK</font>
02120 <font class="comment">    D3DERR_BADMAJORVERSION</font>
02121 <font class="comment">    D3DERR_BADMINORVERSION</font>
02122 <font class="comment">    D3DERR_COLORKEYATTACHED</font>
02123 <font class="comment">    D3DERR_CONFLICTINGTEXTUREFILTER</font>
02124 <font class="comment">    D3DERR_CONFLICTINGTEXTUREPALETTE</font>
02125 <font class="comment">    D3DERR_CONFLICTINGRENDERSTATE</font>
02126 <font class="comment">    D3DERR_DEVICEAGGREGATED (new for DirectX 5.0)</font>
02127 <font class="comment">    D3DERR_EXECUTE_CLIPPED_FAILED</font>
02128 <font class="comment">    D3DERR_EXECUTE_CREATE_FAILED</font>
02129 <font class="comment">    D3DERR_EXECUTE_DESTROY_FAILED</font>
02130 <font class="comment">    D3DERR_EXECUTE_FAILED</font>
02131 <font class="comment">    D3DERR_EXECUTE_LOCK_FAILED</font>
02132 <font class="comment">    D3DERR_EXECUTE_LOCKED</font>
02133 <font class="comment">    D3DERR_EXECUTE_NOT_LOCKED</font>
02134 <font class="comment">    D3DERR_EXECUTE_UNLOCK_FAILED</font>
02135 <font class="comment">    D3DERR_INITFAILED (new for DirectX 5.0)</font>
02136 <font class="comment">    D3DERR_INBEGIN (new for DirectX 5.0)</font>
02137 <font class="comment">    D3DERR_INVALID_DEVICE (new for DirectX 5.0)</font>
02138 <font class="comment">    D3DERR_INVALIDCURRENTVIEWPORT (new for DirectX 5.0)</font>
02139 <font class="comment">    D3DERR_INVALIDMATRIX</font>
02140 <font class="comment">    D3DERR_INVALIDPALETTE(new for DirectX 5.0)</font>
02141 <font class="comment">    D3DERR_INVALIDPRIMITIVETYPE (new for DirectX 5.0)</font>
02142 <font class="comment">    D3DERR_INVALIDRAMPTEXTURE (new for DirectX 5.0)</font>
02143 <font class="comment">    D3DERR_INVALIDVERTEXFORMAT (new for DirectX 6.0)</font>
02144 <font class="comment">    D3DERR_INVALIDVERTEXTYPE (new for DirectX 5.0)</font>
02145 <font class="comment">    D3DERR_LIGHT_SET_FAILED</font>
02146 <font class="comment">    D3DERR_LIGHTHASVIEWPORT (new for DirectX 5.0)</font>
02147 <font class="comment">    D3DERR_LIGHTNOTINTHISVIEWPORT (new for DirectX 5.0)</font>
02148 <font class="comment">    D3DERR_MATERIAL_CREATE_FAILED</font>
02149 <font class="comment">    D3DERR_MATERIAL_DESTROY_FAILED</font>
02150 <font class="comment">    D3DERR_MATERIAL_GETDATA_FAILED</font>
02151 <font class="comment">    D3DERR_MATERIAL_SETDATA_FAILED</font>
02152 <font class="comment">    D3DERR_MATRIX_CREATE_FAILED</font>
02153 <font class="comment">    D3DERR_MATRIX_DESTROY_FAILED</font>
02154 <font class="comment">    D3DERR_MATRIX_GETDATA_FAILED</font>
02155 <font class="comment">    D3DERR_MATRIX_SETDATA_FAILED</font>
02156 <font class="comment">    D3DERR_NOCURRENTVIEWPORT (new for DirectX 5.0)</font>
02157 <font class="comment">    D3DERR_NOTINBEGIN (new for DirectX 5.0)</font>
02158 <font class="comment">    D3DERR_NOVIEWPORTS (new for DirectX 5.0)</font>
02159 <font class="comment">    D3DERR_SCENE_BEGIN_FAILED</font>
02160 <font class="comment">    D3DERR_SCENE_END_FAILED</font>
02161 <font class="comment">    D3DERR_SCENE_IN_SCENE</font>
02162 <font class="comment">    D3DERR_SCENE_NOT_IN_SCENE</font>
02163 <font class="comment">    D3DERR_SETVIEWPORTDATA_FAILED</font>
02164 <font class="comment">    D3DERR_STENCILBUFFER_NOTPRESENT</font>
02165 <font class="comment">    D3DERR_SURFACENOTINVIDMEM (new for DirectX 5.0)</font>
02166 <font class="comment">    D3DERR_TEXTURE_BADSIZE (new for DirectX 5.0)</font>
02167 <font class="comment">    D3DERR_TEXTURE_CREATE_FAILED</font>
02168 <font class="comment">    D3DERR_TEXTURE_DESTROY_FAILED</font>
02169 <font class="comment">    D3DERR_TEXTURE_GETSURF_FAILED</font>
02170 <font class="comment">    D3DERR_TEXTURE_LOAD_FAILED</font>
02171 <font class="comment">    D3DERR_TEXTURE_LOCK_FAILED</font>
02172 <font class="comment">    D3DERR_TEXTURE_LOCKED</font>
02173 <font class="comment">    D3DERR_TEXTURE_NO_SUPPORT</font>
02174 <font class="comment">    D3DERR_TEXTURE_NOT_LOCKED</font>
02175 <font class="comment">    D3DERR_TEXTURE_SWAP_FAILED</font>
02176 <font class="comment">    D3DERR_TEXTURE_UNLOCK_FAILED</font>
02177 <font class="comment">    D3DERR_TOOMANYOPERATIONS</font>
02178 <font class="comment">    D3DERR_TOOMANYPRIMITIVES</font>
02179 <font class="comment">    D3DERR_UNSUPPORTEDALPHAARG</font>
02180 <font class="comment">    D3DERR_UNSUPPORTEDALPHAOPERATION</font>
02181 <font class="comment">    D3DERR_UNSUPPORTEDCOLORARG</font>
02182 <font class="comment">    D3DERR_UNSUPPORTEDCOLOROPERATION</font>
02183 <font class="comment">    D3DERR_UNSUPPORTEDFACTORVALUE</font>
02184 <font class="comment">    D3DERR_UNSUPPORTEDTEXTUREFILTER</font>
02185 <font class="comment">    D3DERR_VBUF_CREATE_FAILED</font>
02186 <font class="comment">    D3DERR_VERTEXBUFFERLOCKED</font>
02187 <font class="comment">    D3DERR_VERTEXBUFFEROPTIMIZED</font>
02188 <font class="comment">    D3DERR_VIEWPORTDATANOTSET (new for DirectX 5.0)</font>
02189 <font class="comment">    D3DERR_VIEWPORTHASNODEVICE (new for DirectX 5.0)</font>
02190 <font class="comment">    D3DERR_WRONGTEXTUREFORMAT</font>
02191 <font class="comment">    D3DERR_ZBUFF_NEEDS_SYSTEMMEMORY (new for DirectX 5.0)</font>
02192 <font class="comment">    D3DERR_ZBUFF_NEEDS_VIDEOMEMORY (new for DirectX 5.0)</font>
02193 <font class="comment">    D3DERR_ZBUFFER_NOTPRESENT</font>
02194 <font class="comment">    */</font>
02195 
02196     <font class="comment">//-----------------------------------------------------------------------</font>
<a name="l02197"></a><a class="code" href="classOgre_1_1D3DRenderSystem.html#Ogre_1_1D3DRenderSystemc0">02197</a>     <a class="code" href="classOgre_1_1DDDriverList.html">DDDriverList</a>* D3DRenderSystem::getDirectDrawDrivers(<font class="keywordtype">void</font>)
02198     {
02199         <font class="keywordflow">if</font> (!<a class="code" href="classOgre_1_1D3DRenderSystem.html#Ogre_1_1D3DRenderSystemo2">mDriverList</a>)
02200         {
02201             <a class="code" href="classOgre_1_1D3DRenderSystem.html#Ogre_1_1D3DRenderSystemo2">mDriverList</a> = <font class="keyword">new</font> <a class="code" href="classOgre_1_1DDDriverList.html">DDDriverList</a>;
02202         }
02203 
02204         <font class="keywordflow">return</font> <a class="code" href="classOgre_1_1D3DRenderSystem.html#Ogre_1_1D3DRenderSystemo2">mDriverList</a>;
02205     }
02206     <font class="comment">//-----------------------------------------------------------------------</font>
<a name="l02207"></a><a class="code" href="classOgre_1_1D3DRenderSystem.html#Ogre_1_1D3DRenderSystema13">02207</a>     <font class="keywordtype">void</font> D3DRenderSystem::setLightingEnabled(<font class="keywordtype">bool</font> enabled)
02208     {
02209         <font class="comment">// Call D3D</font>
02210         HRESULT hr = <a class="code" href="classOgre_1_1D3DRenderSystem.html#Ogre_1_1D3DRenderSystemo0">mlpD3DDevice</a>-&gt;SetRenderState(D3DRENDERSTATE_LIGHTING, enabled);
02211         <font class="keywordflow">if</font> (FAILED(hr))
02212             <a class="code" href="OgreException_8h.html#a0">Except</a>(hr, <font class="stringliteral">"Error lighting status."</font>, <font class="stringliteral">"D3DRenderSystem::setLightingEnabled"</font>);
02213     }
02214     <font class="comment">//-----------------------------------------------------------------------</font>
<a name="l02215"></a><a class="code" href="classOgre_1_1D3DRenderSystem.html#Ogre_1_1D3DRenderSystema46">02215</a>     <font class="keywordtype">void</font> D3DRenderSystem::_setFog(<a class="code" href="namespaceOgre.html#a429">FogMode</a> mode, <a class="code" href="classOgre_1_1ColourValue.html">ColourValue</a> colour, <a class="code" href="namespaceOgre.html#a281">Real</a> density, <a class="code" href="namespaceOgre.html#a281">Real</a> start, <a class="code" href="namespaceOgre.html#a281">Real</a> end)
02216     {
02217         HRESULT hr;
02218 
02219         <font class="keywordflow">if</font> (mode == <a class="code" href="namespaceOgre.html#a429a80">FOG_NONE</a>)
02220         {
02221             <font class="comment">// Just disable</font>
02222             hr = <a class="code" href="classOgre_1_1D3DRenderSystem.html#Ogre_1_1D3DRenderSystemo0">mlpD3DDevice</a>-&gt;SetRenderState(D3DRENDERSTATE_FOGTABLEMODE, D3DFOG_NONE);
02223         }
02224         <font class="keywordflow">else</font>
02225         {
02226             <font class="comment">// Allow fog</font>
02227             hr = <a class="code" href="classOgre_1_1D3DRenderSystem.html#Ogre_1_1D3DRenderSystemo0">mlpD3DDevice</a>-&gt;SetRenderState(D3DRENDERSTATE_FOGENABLE, TRUE);
02228 
02229             <font class="comment">// Set pixel fog mode</font>
02230             D3DFOGMODE d3dFogMode;
02231             <font class="keywordflow">switch</font> (mode)
02232             {
02233             <font class="keywordflow">case</font> <a class="code" href="namespaceOgre.html#a429a81">FOG_EXP</a>:
02234                 d3dFogMode = D3DFOG_EXP;
02235                 <font class="keywordflow">break</font>;
02236             <font class="keywordflow">case</font> <a class="code" href="namespaceOgre.html#a429a82">FOG_EXP2</a>:
02237                 d3dFogMode = D3DFOG_EXP2;
02238                 <font class="keywordflow">break</font>;
02239             <font class="keywordflow">case</font> <a class="code" href="namespaceOgre.html#a429a83">FOG_LINEAR</a>:
02240                 d3dFogMode = D3DFOG_LINEAR;
02241                 <font class="keywordflow">break</font>;
02242             }
02243             <a class="code" href="classOgre_1_1D3DRenderSystem.html#Ogre_1_1D3DRenderSystemo0">mlpD3DDevice</a>-&gt;SetRenderState( D3DRENDERSTATE_FOGVERTEXMODE,  D3DFOG_NONE);
02244             hr = <a class="code" href="classOgre_1_1D3DRenderSystem.html#Ogre_1_1D3DRenderSystemo0">mlpD3DDevice</a>-&gt;SetRenderState(D3DRENDERSTATE_FOGTABLEMODE, d3dFogMode);
02245 
02246             <font class="comment">// Set colour</font>
02247             hr = <a class="code" href="classOgre_1_1D3DRenderSystem.html#Ogre_1_1D3DRenderSystemo0">mlpD3DDevice</a>-&gt;SetRenderState(D3DRENDERSTATE_FOGCOLOR, colour.<a class="code" href="classOgre_1_1ColourValue.html#Ogre_1_1ColourValuea4">getAsLongARGB</a>());
02248             hr = <a class="code" href="classOgre_1_1D3DRenderSystem.html#Ogre_1_1D3DRenderSystemo0">mlpD3DDevice</a>-&gt;SetRenderState(D3DRENDERSTATE_FOGTABLESTART, *((LPDWORD) (&amp;start)) );
02249             hr = <a class="code" href="classOgre_1_1D3DRenderSystem.html#Ogre_1_1D3DRenderSystemo0">mlpD3DDevice</a>-&gt;SetRenderState(D3DRENDERSTATE_FOGTABLEEND, *((LPDWORD) (&amp;end)) );
02250             hr = <a class="code" href="classOgre_1_1D3DRenderSystem.html#Ogre_1_1D3DRenderSystemo0">mlpD3DDevice</a>-&gt;SetRenderState(D3DRENDERSTATE_FOGTABLEDENSITY, *((LPDWORD) (&amp;density)) );
02251 
02252             <font class="comment">/*</font>
02253 <font class="comment">            if (mode == FOG_LINEAR)</font>
02254 <font class="comment">            {</font>
02255 <font class="comment">                // Set start &amp; end</font>
02256 <font class="comment">                // Note the crap casting required because D3D likes DWORD values</font>
02257 <font class="comment">                hr = mlpD3DDevice-&gt;SetRenderState(D3DRENDERSTATE_FOGSTART, *((LPDWORD) (&amp;start)) );</font>
02258 <font class="comment">                hr = mlpD3DDevice-&gt;SetRenderState(D3DRENDERSTATE_FOGEND, *((LPDWORD) (&amp;end)) );</font>
02259 <font class="comment">            }</font>
02260 <font class="comment">            else</font>
02261 <font class="comment">            {</font>
02262 <font class="comment">                // Set density</font>
02263 <font class="comment">                hr = mlpD3DDevice-&gt;SetRenderState(D3DRENDERSTATE_FOGDENSITY, *((LPDWORD) (&amp;density)) );</font>
02264 <font class="comment">            }</font>
02265 <font class="comment">            */</font>
02266 
02267         }
02268 
02269 
02270     }
02271 
02272     <font class="comment">//---------------------------------------------------------------------</font>
<a name="l02273"></a><a class="code" href="classOgre_1_1D3DRenderSystem.html#Ogre_1_1D3DRenderSystema17">02273</a>     <font class="keywordtype">void</font> D3DRenderSystem::convertColourValue(<font class="keyword">const</font> <a class="code" href="classOgre_1_1ColourValue.html">ColourValue</a>&amp; colour, <font class="keywordtype">unsigned</font> <font class="keywordtype">long</font>* pDest)
02274     {
02275         *pDest = colour.<a class="code" href="classOgre_1_1ColourValue.html#Ogre_1_1ColourValuea4">getAsLongARGB</a>();
02276     }
02277 
02278 
02279 }
</pre></div><p>
Copyright &copy; 2002 by The OGRE Team<br />
<script type="text/javascript">
<!--//hide script from old browsers
document.write( "Last modified "+ document.lastModified );
//end hiding contents -->
</script>
</p>
</body>
</html>
