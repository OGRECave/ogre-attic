<html>
<head>
<title>OGRE Documentation</title> <meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1"> 
<link type="text/css" rel="stylesheet" href="style.css">
</head>

<body>
<!-- Generated by Doxygen 1.2.16 -->
<center>
<a class="qindex" href="index.html">Main Page</a> &nbsp; <a class="qindex" href="namespaces.html">Namespace List</a> &nbsp; <a class="qindex" href="hierarchy.html">Class Hierarchy</a> &nbsp; <a class="qindex" href="classes.html">Alphabetical List</a> &nbsp; <a class="qindex" href="annotated.html">Compound List</a> &nbsp; <a class="qindex" href="files.html">File List</a> &nbsp; <a class="qindex" href="namespacemembers.html">Namespace Members</a> &nbsp; <a class="qindex" href="functions.html">Compound Members</a> &nbsp; <a class="qindex" href="globals.html">File Members</a> &nbsp; <a class="qindex" href="pages.html">Related Pages</a> &nbsp; </center>
<hr><h1>OgrePatchSurface.cpp</h1><a href="OgrePatchSurface_8cpp.html">Go to the documentation of this file.</a><div class="fragment"><pre>00001 <font class="comment">/*</font>
00002 <font class="comment">-----------------------------------------------------------------------------</font>
00003 <font class="comment">This source file is part of OGRE</font>
00004 <font class="comment">    (Object-oriented Graphics Rendering Engine)</font>
00005 <font class="comment">For the latest info, see http://www.stevestreeting.com/ogre/</font>
00006 <font class="comment"></font>
00007 <font class="comment">Copyright © 2000-2001 Steven J. Streeting</font>
00008 <font class="comment">Also see acknowledgements in Readme.html</font>
00009 <font class="comment"></font>
00010 <font class="comment">This program is free software; you can redistribute it and/or modify it under</font>
00011 <font class="comment">the terms of the GNU General Public License as published by the Free Software</font>
00012 <font class="comment">Foundation; either version 2 of the License, or (at your option) any later</font>
00013 <font class="comment">version.</font>
00014 <font class="comment"></font>
00015 <font class="comment">This program is distributed in the hope that it will be useful, but WITHOUT</font>
00016 <font class="comment">ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or FITNESS</font>
00017 <font class="comment">FOR A PARTICULAR PURPOSE. See the GNU General Public License for more details.</font>
00018 <font class="comment"></font>
00019 <font class="comment">You should have received a copy of the GNU General Public License along with</font>
00020 <font class="comment">this program; if not, write to the Free Software Foundation, Inc., 59 Temple</font>
00021 <font class="comment">Place - Suite 330, Boston, MA 02111-1307, USA, or go to</font>
00022 <font class="comment">http://www.gnu.org/copyleft/gpl.html.</font>
00023 <font class="comment">-----------------------------------------------------------------------------</font>
00024 <font class="comment">*/</font>
00025 
00026 <font class="preprocessor">#include "<a class="code" href="OgrePatchSurface_8h.html">OgrePatchSurface.h</a>"</font>
00027 
00028 <font class="preprocessor">#include "<a class="code" href="OgreMeshManager_8h.html">OgreMeshManager.h</a>"</font>
00029 <font class="preprocessor">#include "<a class="code" href="OgreMesh_8h.html">OgreMesh.h</a>"</font>
00030 <font class="preprocessor">#include "<a class="code" href="OgreSubMesh_8h.html">OgreSubMesh.h</a>"</font>
00031 <font class="preprocessor">#include "<a class="code" href="OgreException_8h.html">OgreException.h</a>"</font>
00032 
<a name="l00033"></a><a class="code" href="OgrePatchSurface_8cpp.html#a0">00033</a> <font class="preprocessor">#define LEVEL_WIDTH(lvl) ((1 &lt;&lt; (lvl+1)) + 1)</font>
00034 <font class="preprocessor"></font>
00035 <font class="keyword">namespace </font>Ogre {
00036 
00037 
00038     <font class="comment">//-----------------------------------------------------------------------</font>
<a name="l00039"></a><a class="code" href="classOgre_1_1PatchSurface.html#Ogre_1_1PatchSurfacea0">00039</a>     PatchSurface::PatchSurface()
00040     {
00041         <a class="code" href="classOgre_1_1PatchSurface.html#Ogre_1_1PatchSurfacen2">mMesh</a> = 0;
00042         <a class="code" href="classOgre_1_1PatchSurface.html#Ogre_1_1PatchSurfacen4">mType</a> = <a class="code" href="classOgre_1_1PatchSurface.html#Ogre_1_1PatchSurfaces5Ogre_1_1PatchSurfaces0">PST_BEZIER</a>;
00043         <a class="code" href="classOgre_1_1PatchSurface.html#Ogre_1_1PatchSurfacen1">mCtlPointData</a>.<a class="code" href="structOgre_1_1GeometryData.html#Ogre_1_1GeometryDatam0">numVertices</a> = 0;
00044         <a class="code" href="classOgre_1_1PatchSurface.html#Ogre_1_1PatchSurfacen13">mMemoryAllocated</a> = <font class="keyword">false</font>;
00045     }
00046     <font class="comment">//-----------------------------------------------------------------------</font>
<a name="l00047"></a><a class="code" href="classOgre_1_1PatchSurface.html#Ogre_1_1PatchSurfacea1">00047</a>     PatchSurface::~PatchSurface()
00048     {
00049         <font class="comment">/*</font>
00050 <font class="comment">        if (mMesh)</font>
00051 <font class="comment">        {</font>
00052 <font class="comment">            delete mMesh;</font>
00053 <font class="comment">            mMesh = 0;</font>
00054 <font class="comment">        }</font>
00055 <font class="comment">        */</font>
00056 
00057     }
00058     <font class="comment">//-----------------------------------------------------------------------</font>
<a name="l00059"></a><a class="code" href="classOgre_1_1PatchSurface.html#Ogre_1_1PatchSurfacea2">00059</a>     <font class="keywordtype">void</font> PatchSurface::defineSurface(<a class="code" href="classOgre_1_1String.html">String</a> meshName, <font class="keyword">const</font> <a class="code" href="structOgre_1_1GeometryData.html">GeometryData</a>&amp; controlPoints, <font class="keywordtype">int</font> width,
00060         PatchSurface::PatchSurfaceType pType, <font class="keywordtype">int</font> subdivisionLevel, VisibleSide visibleSide)
00061     {
00062         <font class="keywordflow">if</font> (controlPoints.<a class="code" href="structOgre_1_1GeometryData.html#Ogre_1_1GeometryDatam0">numVertices</a> == 0 || width == 0)
00063             <font class="keywordflow">return</font>; <font class="comment">// Do nothing - garbage</font>
00064 
00065         <a class="code" href="classOgre_1_1PatchSurface.html#Ogre_1_1PatchSurfacen0">mMeshName</a> = meshName;
00066         <a class="code" href="classOgre_1_1PatchSurface.html#Ogre_1_1PatchSurfacen1">mCtlPointData</a> = controlPoints;
00067         <a class="code" href="classOgre_1_1PatchSurface.html#Ogre_1_1PatchSurfacen4">mType</a> = pType;
00068         <a class="code" href="classOgre_1_1PatchSurface.html#Ogre_1_1PatchSurfacen5">mCtlWidth</a> = width;
00069         <font class="keywordflow">if</font> (<a class="code" href="classOgre_1_1PatchSurface.html#Ogre_1_1PatchSurfacen1">mCtlPointData</a>.<a class="code" href="structOgre_1_1GeometryData.html#Ogre_1_1GeometryDatam0">numVertices</a> % <a class="code" href="classOgre_1_1PatchSurface.html#Ogre_1_1PatchSurfacen5">mCtlWidth</a> != 0)
00070         {
00071             <a class="code" href="OgreException_8h.html#a0">Except</a>(Exception::ERR_INVALIDPARAMS, <font class="stringliteral">"Invalid patch width - does not divide equally into number of control points."</font>,
00072                 <font class="stringliteral">"PatchSurface::defineSurface"</font>);
00073         }
00074         <a class="code" href="classOgre_1_1PatchSurface.html#Ogre_1_1PatchSurfacen6">mCtlHeight</a> = <a class="code" href="classOgre_1_1PatchSurface.html#Ogre_1_1PatchSurfacen1">mCtlPointData</a>.<a class="code" href="structOgre_1_1GeometryData.html#Ogre_1_1GeometryDatam0">numVertices</a> / <a class="code" href="classOgre_1_1PatchSurface.html#Ogre_1_1PatchSurfacen5">mCtlWidth</a>;
00075 
00076         <font class="comment">// Make a copy of the control point positions as Vector3 objects</font>
00077         <font class="keywordtype">int</font> vertCount = <a class="code" href="classOgre_1_1PatchSurface.html#Ogre_1_1PatchSurfacen1">mCtlPointData</a>.<a class="code" href="structOgre_1_1GeometryData.html#Ogre_1_1GeometryDatam0">numVertices</a>;
00078         <a class="code" href="namespaceOgre.html#a281">Real</a>* pVerts = <a class="code" href="classOgre_1_1PatchSurface.html#Ogre_1_1PatchSurfacen1">mCtlPointData</a>.<a class="code" href="structOgre_1_1GeometryData.html#Ogre_1_1GeometryDatam5">pVertices</a>;
00079         <a class="code" href="classOgre_1_1PatchSurface.html#Ogre_1_1PatchSurfacen14">mVecCtlPoints</a>.clear();
00080         <font class="keywordflow">while</font>(vertCount--)
00081         {
00082             <a class="code" href="classOgre_1_1PatchSurface.html#Ogre_1_1PatchSurfacen14">mVecCtlPoints</a>.push_back(<a class="code" href="classOgre_1_1Vector3.html">Vector3</a>(pVerts));
00083             pVerts = (<a class="code" href="namespaceOgre.html#a281">Real</a>*)((<font class="keywordtype">char</font>*)pVerts + (<font class="keyword">sizeof</font>(Real) * 3) + <a class="code" href="classOgre_1_1PatchSurface.html#Ogre_1_1PatchSurfacen1">mCtlPointData</a>.<a class="code" href="structOgre_1_1GeometryData.html#Ogre_1_1GeometryDatam9">vertexStride</a>);
00084         }
00085 
00086         <a class="code" href="classOgre_1_1PatchSurface.html#Ogre_1_1PatchSurfacea4">setSubdivisionLevel</a>(subdivisionLevel);
00087 
00088         <a class="code" href="classOgre_1_1PatchSurface.html#Ogre_1_1PatchSurfacen11">mVSide</a> = visibleSide;
00089 
00090         <a class="code" href="classOgre_1_1PatchSurface.html#Ogre_1_1PatchSurfacen3">mNeedsBuild</a> = <font class="keyword">true</font>;
00091 
00092     }
00093     <font class="comment">//-----------------------------------------------------------------------</font>
<a name="l00094"></a><a class="code" href="classOgre_1_1PatchSurface.html#Ogre_1_1PatchSurfacea3">00094</a>     <font class="keywordtype">void</font> PatchSurface::build(<font class="keywordtype">void</font>)
00095     {
00096 
00097         <font class="keywordflow">if</font> (<a class="code" href="classOgre_1_1PatchSurface.html#Ogre_1_1PatchSurfacen1">mCtlPointData</a>.<a class="code" href="structOgre_1_1GeometryData.html#Ogre_1_1GeometryDatam0">numVertices</a> == 0)
00098             <font class="keywordflow">return</font>;
00099 
00100         <a class="code" href="classOgre_1_1PatchSurface.html#Ogre_1_1PatchSurfaceb1">allocateMemory</a>();
00101 
00102         <a class="code" href="classOgre_1_1PatchSurface.html#Ogre_1_1PatchSurfaceb3">distributeControlPoints</a>();
00103 
00104         <font class="comment">// DEBUG</font>
00105         <font class="comment">//mMesh-&gt;_dumpContents(mMesh-&gt;getName() + "_preSubdivision.log");</font>
00106 
00107 
00108         <font class="comment">// Subdivide the curve</font>
00109         <font class="comment">// Do u direction first, so need to step over v levels not done yet</font>
00110         <font class="keywordtype">int</font> vStep = 1 &lt;&lt; <a class="code" href="classOgre_1_1PatchSurface.html#Ogre_1_1PatchSurfacen8">mVLevel</a>;
00111         <font class="keywordtype">int</font> uStep = 1 &lt;&lt; <a class="code" href="classOgre_1_1PatchSurface.html#Ogre_1_1PatchSurfacen7">mULevel</a>;
00112 
00113         <font class="keywordtype">int</font> v, u;
00114         <font class="keywordflow">for</font> (v = 0; v &lt; <a class="code" href="classOgre_1_1PatchSurface.html#Ogre_1_1PatchSurfacen10">mMeshHeight</a>; v += vStep)
00115         {
00116             <font class="comment">// subdivide this row in u</font>
00117             <a class="code" href="classOgre_1_1PatchSurface.html#Ogre_1_1PatchSurfaceb4">subdivideCurve</a>(v*<a class="code" href="classOgre_1_1PatchSurface.html#Ogre_1_1PatchSurfacen9">mMeshWidth</a>, uStep, <a class="code" href="classOgre_1_1PatchSurface.html#Ogre_1_1PatchSurfacen9">mMeshWidth</a> / uStep, <a class="code" href="classOgre_1_1PatchSurface.html#Ogre_1_1PatchSurfacen7">mULevel</a>);
00118         }
00119 
00120         <font class="comment">// DEBUG</font>
00121         <font class="comment">//mMesh-&gt;_dumpContents(mMesh-&gt;getName() + "_postSubdivisionU.log");</font>
00122 
00123         <font class="comment">// Now subdivide in v direction, this time all the u direction points are there so no step</font>
00124         <font class="keywordflow">for</font> (u = 0; u &lt; <a class="code" href="classOgre_1_1PatchSurface.html#Ogre_1_1PatchSurfacen9">mMeshWidth</a>; ++u)
00125         {
00126             <a class="code" href="classOgre_1_1PatchSurface.html#Ogre_1_1PatchSurfaceb4">subdivideCurve</a>(u, vStep*<a class="code" href="classOgre_1_1PatchSurface.html#Ogre_1_1PatchSurfacen9">mMeshWidth</a>, <a class="code" href="classOgre_1_1PatchSurface.html#Ogre_1_1PatchSurfacen10">mMeshHeight</a> / vStep, <a class="code" href="classOgre_1_1PatchSurface.html#Ogre_1_1PatchSurfacen8">mVLevel</a>);
00127         }
00128 
00129         <font class="comment">// DEBUG</font>
00130         <font class="comment">//mMesh-&gt;_dumpContents(mMesh-&gt;getName() + "_postSubdivisionV.log");</font>
00131 
00132         <font class="comment">// Make triangles from mesh</font>
00133         <a class="code" href="classOgre_1_1PatchSurface.html#Ogre_1_1PatchSurfaceb6">makeTriangles</a>();
00134 
00135         <font class="comment">// Set bounds based on control points</font>
00136         std::vector&lt;Vector3&gt;::iterator ctli;
00137         <a class="code" href="classOgre_1_1Vector3.html">Vector3</a> min, max;
00138         <font class="keywordtype">bool</font> first = <font class="keyword">true</font>;
00139         <font class="keywordflow">for</font> (ctli = <a class="code" href="classOgre_1_1PatchSurface.html#Ogre_1_1PatchSurfacen14">mVecCtlPoints</a>.begin(); ctli != <a class="code" href="classOgre_1_1PatchSurface.html#Ogre_1_1PatchSurfacen14">mVecCtlPoints</a>.end(); ++ctli)
00140         {
00141             <font class="keywordflow">if</font> (first || ctli-&gt;x &lt; min.<a class="code" href="classOgre_1_1Vector3.html#Ogre_1_1Vector3m0">x</a>)
00142                 min.<a class="code" href="classOgre_1_1Vector3.html#Ogre_1_1Vector3m0">x</a> = ctli-&gt;x;
00143             <font class="keywordflow">if</font> (first || ctli-&gt;y &lt; min.<a class="code" href="classOgre_1_1Vector3.html#Ogre_1_1Vector3m1">y</a>)
00144                 min.<a class="code" href="classOgre_1_1Vector3.html#Ogre_1_1Vector3m1">y</a> = ctli-&gt;y;
00145             <font class="keywordflow">if</font> (first || ctli-&gt;z &lt; min.<a class="code" href="classOgre_1_1Vector3.html#Ogre_1_1Vector3m2">z</a>)
00146                 min.<a class="code" href="classOgre_1_1Vector3.html#Ogre_1_1Vector3m2">z</a> = ctli-&gt;z;
00147             <font class="keywordflow">if</font> (first || ctli-&gt;x &gt; max.<a class="code" href="classOgre_1_1Vector3.html#Ogre_1_1Vector3m0">x</a>)
00148                 max.<a class="code" href="classOgre_1_1Vector3.html#Ogre_1_1Vector3m0">x</a> = ctli-&gt;x;
00149             <font class="keywordflow">if</font> (first || ctli-&gt;y &gt; max.<a class="code" href="classOgre_1_1Vector3.html#Ogre_1_1Vector3m1">y</a>)
00150                 max.<a class="code" href="classOgre_1_1Vector3.html#Ogre_1_1Vector3m1">y</a> = ctli-&gt;y;
00151             <font class="keywordflow">if</font> (first || ctli-&gt;z &gt; max.<a class="code" href="classOgre_1_1Vector3.html#Ogre_1_1Vector3m2">z</a>)
00152                 max.<a class="code" href="classOgre_1_1Vector3.html#Ogre_1_1Vector3m2">z</a> = ctli-&gt;z;
00153             first = <font class="keyword">false</font>;
00154         }
00155         <a class="code" href="classOgre_1_1PatchSurface.html#Ogre_1_1PatchSurfacen2">mMesh</a>-&gt;<a class="code" href="classOgre_1_1Mesh.html#Ogre_1_1Mesha13">_setBounds</a>(<a class="code" href="classOgre_1_1AxisAlignedBox.html">AxisAlignedBox</a>(min,max));
00156 
00157         <font class="comment">// Done!</font>
00158         <a class="code" href="classOgre_1_1PatchSurface.html#Ogre_1_1PatchSurfacen3">mNeedsBuild</a> = <font class="keyword">false</font>;
00159 
00160     }
00161     <font class="comment">//-----------------------------------------------------------------------</font>
<a name="l00162"></a><a class="code" href="classOgre_1_1PatchSurface.html#Ogre_1_1PatchSurfacea4">00162</a>     <font class="keywordtype">void</font> PatchSurface::setSubdivisionLevel(<font class="keywordtype">int</font> level)
00163     {
00164         <font class="keywordflow">if</font> (level != <a class="code" href="classOgre_1_1PatchSurface.html#Ogre_1_1PatchSurfaces6Ogre_1_1PatchSurfaces1">AUTO_LEVEL</a>)
00165         {
00166             <a class="code" href="classOgre_1_1PatchSurface.html#Ogre_1_1PatchSurfacen7">mULevel</a> = level;
00167             <a class="code" href="classOgre_1_1PatchSurface.html#Ogre_1_1PatchSurfacen8">mVLevel</a> = level;
00168         }
00169         <font class="keywordflow">else</font>
00170         {
00171             <font class="comment">// determine levels</font>
00172             <font class="comment">// Derived from work by Bart Sekura in Rogl</font>
00173             <a class="code" href="classOgre_1_1Vector3.html">Vector3</a> a,b,c;
00174             <font class="keywordtype">int</font> u,v;
00175             <font class="keywordtype">bool</font> found=<font class="keyword">false</font>;
00176             <font class="comment">// Find u level</font>
00177             <font class="keywordflow">for</font>(v = 0; v &lt; <a class="code" href="classOgre_1_1PatchSurface.html#Ogre_1_1PatchSurfacen6">mCtlHeight</a>; v++) {
00178                 <font class="keywordflow">for</font>(u = 0; u &lt; <a class="code" href="classOgre_1_1PatchSurface.html#Ogre_1_1PatchSurfacen5">mCtlWidth</a>-1; u += 2) {
00179                     a = <a class="code" href="classOgre_1_1PatchSurface.html#Ogre_1_1PatchSurfacen14">mVecCtlPoints</a>[v * <a class="code" href="classOgre_1_1PatchSurface.html#Ogre_1_1PatchSurfacen5">mCtlWidth</a> + u];
00180                     b = <a class="code" href="classOgre_1_1PatchSurface.html#Ogre_1_1PatchSurfacen14">mVecCtlPoints</a>[v * <a class="code" href="classOgre_1_1PatchSurface.html#Ogre_1_1PatchSurfacen5">mCtlWidth</a> + u+1];
00181                     c = <a class="code" href="classOgre_1_1PatchSurface.html#Ogre_1_1PatchSurfacen14">mVecCtlPoints</a>[v * <a class="code" href="classOgre_1_1PatchSurface.html#Ogre_1_1PatchSurfacen5">mCtlWidth</a> + u+2];
00182                     <font class="keywordflow">if</font>(a!=c) {
00183                         found=<font class="keyword">true</font>;
00184                         <font class="keywordflow">break</font>;
00185                     }
00186                 }
00187                 <font class="keywordflow">if</font>(found) <font class="keywordflow">break</font>;
00188             }
00189             <font class="keywordflow">if</font>(!found) {
00190                 <a class="code" href="OgreException_8h.html#a0">Except</a>(Exception::ERR_INTERNAL_ERROR, <font class="stringliteral">"Can't find suitable control points for determining U subdivision level"</font>,
00191                     <font class="stringliteral">"PatchSurface::setSubdivisionLevel"</font>);
00192             }
00193 
00194             <a class="code" href="classOgre_1_1PatchSurface.html#Ogre_1_1PatchSurfacen7">mULevel</a> = <a class="code" href="classOgre_1_1PatchSurface.html#Ogre_1_1PatchSurfaceb0">findLevel</a>(a,b,c);
00195 
00196 
00197             found=<font class="keyword">false</font>;
00198             <font class="keywordflow">for</font>(u = 0; u &lt; <a class="code" href="classOgre_1_1PatchSurface.html#Ogre_1_1PatchSurfacen5">mCtlWidth</a>; u++) {
00199                 <font class="keywordflow">for</font>(v = 0; v &lt; <a class="code" href="classOgre_1_1PatchSurface.html#Ogre_1_1PatchSurfacen6">mCtlHeight</a>-1; v += 2) {
00200                     a = <a class="code" href="classOgre_1_1PatchSurface.html#Ogre_1_1PatchSurfacen14">mVecCtlPoints</a>[v * <a class="code" href="classOgre_1_1PatchSurface.html#Ogre_1_1PatchSurfacen5">mCtlWidth</a> + u];
00201                     b = <a class="code" href="classOgre_1_1PatchSurface.html#Ogre_1_1PatchSurfacen14">mVecCtlPoints</a>[(v+1) * <a class="code" href="classOgre_1_1PatchSurface.html#Ogre_1_1PatchSurfacen5">mCtlWidth</a> + u];
00202                     c = <a class="code" href="classOgre_1_1PatchSurface.html#Ogre_1_1PatchSurfacen14">mVecCtlPoints</a>[(v+2) * <a class="code" href="classOgre_1_1PatchSurface.html#Ogre_1_1PatchSurfacen5">mCtlWidth</a> + u];
00203                     <font class="keywordflow">if</font>(a!=c) {
00204                         found=<font class="keyword">true</font>;
00205                         <font class="keywordflow">break</font>;
00206                     }
00207                 }
00208                 <font class="keywordflow">if</font>(found) <font class="keywordflow">break</font>;
00209             }
00210             <font class="keywordflow">if</font>(!found) {
00211                 <a class="code" href="OgreException_8h.html#a0">Except</a>(Exception::ERR_INTERNAL_ERROR, <font class="stringliteral">"Can't find suitable control points for determining V subdivision level"</font>,
00212                     <font class="stringliteral">"PatchSurface::setSubdivisionLevel"</font>);
00213             }
00214 
00215             <a class="code" href="classOgre_1_1PatchSurface.html#Ogre_1_1PatchSurfacen8">mVLevel</a> = <a class="code" href="classOgre_1_1PatchSurface.html#Ogre_1_1PatchSurfaceb0">findLevel</a>(a,b,c);
00216 
00217 
00218         }
00219         <font class="comment">// Derive mesh width / height</font>
00220         <a class="code" href="classOgre_1_1PatchSurface.html#Ogre_1_1PatchSurfacen9">mMeshWidth</a>  = (<a class="code" href="OgrePatchSurface_8cpp.html#a0">LEVEL_WIDTH</a>(<a class="code" href="classOgre_1_1PatchSurface.html#Ogre_1_1PatchSurfacen7">mULevel</a>)-1) * ((<a class="code" href="classOgre_1_1PatchSurface.html#Ogre_1_1PatchSurfacen5">mCtlWidth</a>-1)/2) + 1;
00221         <a class="code" href="classOgre_1_1PatchSurface.html#Ogre_1_1PatchSurfacen10">mMeshHeight</a> = (<a class="code" href="OgrePatchSurface_8cpp.html#a0">LEVEL_WIDTH</a>(<a class="code" href="classOgre_1_1PatchSurface.html#Ogre_1_1PatchSurfacen8">mVLevel</a>)-1) * ((<a class="code" href="classOgre_1_1PatchSurface.html#Ogre_1_1PatchSurfacen6">mCtlHeight</a>-1)/2) + 1;
00222 
00223         <a class="code" href="classOgre_1_1PatchSurface.html#Ogre_1_1PatchSurfacen3">mNeedsBuild</a> = <font class="keyword">true</font>;
00224     }
00225     <font class="comment">//-----------------------------------------------------------------------</font>
<a name="l00226"></a><a class="code" href="classOgre_1_1PatchSurface.html#Ogre_1_1PatchSurfacea5">00226</a>     <a class="code" href="classOgre_1_1Mesh.html">Mesh</a>* PatchSurface::getMesh(<font class="keywordtype">void</font>)
00227     {
00228         <font class="keywordflow">if</font> (mNeedsBuild)
00229             <a class="code" href="classOgre_1_1PatchSurface.html#Ogre_1_1PatchSurfacea3">build</a>();
00230 
00231         <font class="keywordflow">return</font> <a class="code" href="classOgre_1_1PatchSurface.html#Ogre_1_1PatchSurfacen2">mMesh</a>;
00232     }
00233     <font class="comment">//-----------------------------------------------------------------------</font>
<a name="l00234"></a><a class="code" href="classOgre_1_1PatchSurface.html#Ogre_1_1PatchSurfaceb0">00234</a>     <font class="keywordtype">int</font> PatchSurface::findLevel(<a class="code" href="classOgre_1_1Vector3.html">Vector3</a>&amp; a, <a class="code" href="classOgre_1_1Vector3.html">Vector3</a>&amp; b, <a class="code" href="classOgre_1_1Vector3.html">Vector3</a>&amp; c)
00235     {
00236         <font class="comment">// Derived from work by Bart Sekura in rogl</font>
00237         <font class="comment">// Apart from I think I fixed a bug - see below</font>
00238         <font class="comment">// I also commented the code, the only thing wrong with rogl is almost no comments!!</font>
00239 
00240         <font class="keyword">const</font> <font class="keywordtype">int</font> max_levels = 5;
00241         <font class="keyword">const</font> <font class="keywordtype">float</font> subdiv = 10;
00242         <font class="keywordtype">int</font> level;
00243 
00244         <font class="keywordtype">float</font> test=subdiv*subdiv;
00245         <a class="code" href="classOgre_1_1Vector3.html">Vector3</a> s,t,d;
00246         <font class="keywordflow">for</font>(level=0; level&lt;max_levels-1; level++)
00247         {
00248             <font class="comment">// Subdivide the 2 lines</font>
00249             s = a.<a class="code" href="classOgre_1_1Vector3.html#Ogre_1_1Vector3a26">midPoint</a>(b);
00250             t = b.<a class="code" href="classOgre_1_1Vector3.html#Ogre_1_1Vector3a26">midPoint</a>(c);
00251             <font class="comment">// Find the midpoint between the 2 midpoints</font>
00252             c = s.<a class="code" href="classOgre_1_1Vector3.html#Ogre_1_1Vector3a26">midPoint</a>(t);
00253             <font class="comment">// Get the vector between this subdivided midpoint and the middle point of the original line</font>
00254             d = c - b;
00255             <font class="comment">// Find the squared length, and break when small enough</font>
00256             <font class="keywordflow">if</font>(d.<a class="code" href="classOgre_1_1Vector3.html#Ogre_1_1Vector3a23">dotProduct</a>(d) &lt; test) {
00257                 <font class="keywordflow">break</font>;
00258             }
00259             b=a; <font class="comment">// BUG?</font>
00260             <font class="comment">//b = s; // SJS fix</font>
00261         }
00262 
00263         <font class="keywordflow">return</font> level;
00264 
00265     }
00266 
00267     <font class="comment">//-----------------------------------------------------------------------</font>
<a name="l00268"></a><a class="code" href="classOgre_1_1PatchSurface.html#Ogre_1_1PatchSurfaceb1">00268</a>     <font class="keywordtype">void</font> PatchSurface::allocateMemory(<font class="keywordtype">void</font>)
00269     {
00270         <font class="keywordflow">if</font> (mMemoryAllocated)
00271             <a class="code" href="classOgre_1_1PatchSurface.html#Ogre_1_1PatchSurfaceb2">deallocateMemory</a>();
00272 
00273         <font class="keywordtype">int</font> tex;
00274 
00275         <font class="comment">// Is the input geometry sharing a buffer for all components?</font>
00276         <font class="keywordflow">if</font> (<a class="code" href="classOgre_1_1PatchSurface.html#Ogre_1_1PatchSurfacen1">mCtlPointData</a>.<a class="code" href="structOgre_1_1GeometryData.html#Ogre_1_1GeometryDatam9">vertexStride</a> == 0)
00277             <font class="comment">// Not shared, separate allocation buffers per vertex component</font>
00278             <a class="code" href="classOgre_1_1PatchSurface.html#Ogre_1_1PatchSurfacen12">mSharedVertexData</a> = <font class="keyword">false</font>;
00279         <font class="keywordflow">else</font>
00280             <a class="code" href="classOgre_1_1PatchSurface.html#Ogre_1_1PatchSurfacen12">mSharedVertexData</a> = <font class="keyword">true</font>;
00281 
00282         <font class="comment">// Create mesh</font>
00283         <a class="code" href="classOgre_1_1PatchSurface.html#Ogre_1_1PatchSurfacen2">mMesh</a> = MeshManager::getSingleton().createManual(<a class="code" href="classOgre_1_1PatchSurface.html#Ogre_1_1PatchSurfacen0">mMeshName</a>);
00284         <font class="comment">// Copy all vertex parameters</font>
00285         <a class="code" href="classOgre_1_1PatchSurface.html#Ogre_1_1PatchSurfacen2">mMesh</a>-&gt;<a class="code" href="classOgre_1_1Mesh.html#Ogre_1_1Meshm0">sharedGeometry</a>.<a class="code" href="structOgre_1_1GeometryData.html#Ogre_1_1GeometryDatam0">numVertices</a> = <a class="code" href="classOgre_1_1PatchSurface.html#Ogre_1_1PatchSurfacen9">mMeshWidth</a> * <a class="code" href="classOgre_1_1PatchSurface.html#Ogre_1_1PatchSurfacen10">mMeshHeight</a>;
00286         <a class="code" href="classOgre_1_1PatchSurface.html#Ogre_1_1PatchSurfacen2">mMesh</a>-&gt;<a class="code" href="classOgre_1_1Mesh.html#Ogre_1_1Meshm0">sharedGeometry</a>.<a class="code" href="structOgre_1_1GeometryData.html#Ogre_1_1GeometryDatam4">hasColours</a> =     <a class="code" href="classOgre_1_1PatchSurface.html#Ogre_1_1PatchSurfacen1">mCtlPointData</a>.<a class="code" href="structOgre_1_1GeometryData.html#Ogre_1_1GeometryDatam4">hasColours</a>;
00287         <a class="code" href="classOgre_1_1PatchSurface.html#Ogre_1_1PatchSurfacen2">mMesh</a>-&gt;<a class="code" href="classOgre_1_1Mesh.html#Ogre_1_1Meshm0">sharedGeometry</a>.<a class="code" href="structOgre_1_1GeometryData.html#Ogre_1_1GeometryDatam1">hasNormals</a> = <a class="code" href="classOgre_1_1PatchSurface.html#Ogre_1_1PatchSurfacen1">mCtlPointData</a>.<a class="code" href="structOgre_1_1GeometryData.html#Ogre_1_1GeometryDatam1">hasNormals</a>;
00288         <a class="code" href="classOgre_1_1PatchSurface.html#Ogre_1_1PatchSurfacen2">mMesh</a>-&gt;<a class="code" href="classOgre_1_1Mesh.html#Ogre_1_1Meshm0">sharedGeometry</a>.<a class="code" href="structOgre_1_1GeometryData.html#Ogre_1_1GeometryDatam2">numTexCoords</a> = <a class="code" href="classOgre_1_1PatchSurface.html#Ogre_1_1PatchSurfacen1">mCtlPointData</a>.<a class="code" href="structOgre_1_1GeometryData.html#Ogre_1_1GeometryDatam2">numTexCoords</a>;
00289         <font class="keywordflow">for</font> ( tex = 0; tex &lt; <a class="code" href="classOgre_1_1PatchSurface.html#Ogre_1_1PatchSurfacen1">mCtlPointData</a>.<a class="code" href="structOgre_1_1GeometryData.html#Ogre_1_1GeometryDatam2">numTexCoords</a>; ++tex)
00290         {
00291             <a class="code" href="classOgre_1_1PatchSurface.html#Ogre_1_1PatchSurfacen2">mMesh</a>-&gt;<a class="code" href="classOgre_1_1Mesh.html#Ogre_1_1Meshm0">sharedGeometry</a>.<a class="code" href="structOgre_1_1GeometryData.html#Ogre_1_1GeometryDatam3">numTexCoordDimensions</a>[tex] = <a class="code" href="classOgre_1_1PatchSurface.html#Ogre_1_1PatchSurfacen1">mCtlPointData</a>.<a class="code" href="structOgre_1_1GeometryData.html#Ogre_1_1GeometryDatam3">numTexCoordDimensions</a>[tex];
00292             <a class="code" href="classOgre_1_1PatchSurface.html#Ogre_1_1PatchSurfacen2">mMesh</a>-&gt;<a class="code" href="classOgre_1_1Mesh.html#Ogre_1_1Meshm0">sharedGeometry</a>.<a class="code" href="structOgre_1_1GeometryData.html#Ogre_1_1GeometryDatam11">texCoordStride</a>[tex] = <a class="code" href="classOgre_1_1PatchSurface.html#Ogre_1_1PatchSurfacen1">mCtlPointData</a>.<a class="code" href="structOgre_1_1GeometryData.html#Ogre_1_1GeometryDatam11">texCoordStride</a>[tex];
00293         }
00294         <a class="code" href="classOgre_1_1PatchSurface.html#Ogre_1_1PatchSurfacen2">mMesh</a>-&gt;<a class="code" href="classOgre_1_1Mesh.html#Ogre_1_1Meshm0">sharedGeometry</a>.<a class="code" href="structOgre_1_1GeometryData.html#Ogre_1_1GeometryDatam10">normalStride</a> = <a class="code" href="classOgre_1_1PatchSurface.html#Ogre_1_1PatchSurfacen1">mCtlPointData</a>.<a class="code" href="structOgre_1_1GeometryData.html#Ogre_1_1GeometryDatam10">normalStride</a>;
00295         <a class="code" href="classOgre_1_1PatchSurface.html#Ogre_1_1PatchSurfacen2">mMesh</a>-&gt;<a class="code" href="classOgre_1_1Mesh.html#Ogre_1_1Meshm0">sharedGeometry</a>.<a class="code" href="structOgre_1_1GeometryData.html#Ogre_1_1GeometryDatam9">vertexStride</a> = <a class="code" href="classOgre_1_1PatchSurface.html#Ogre_1_1PatchSurfacen1">mCtlPointData</a>.<a class="code" href="structOgre_1_1GeometryData.html#Ogre_1_1GeometryDatam9">vertexStride</a>;
00296         <a class="code" href="classOgre_1_1PatchSurface.html#Ogre_1_1PatchSurfacen2">mMesh</a>-&gt;<a class="code" href="classOgre_1_1Mesh.html#Ogre_1_1Meshm0">sharedGeometry</a>.<a class="code" href="structOgre_1_1GeometryData.html#Ogre_1_1GeometryDatam12">colourStride</a> = <a class="code" href="classOgre_1_1PatchSurface.html#Ogre_1_1PatchSurfacen1">mCtlPointData</a>.<a class="code" href="structOgre_1_1GeometryData.html#Ogre_1_1GeometryDatam12">colourStride</a>;
00297 
00298         <font class="comment">/* SubMesh* sm = */</font> <a class="code" href="classOgre_1_1PatchSurface.html#Ogre_1_1PatchSurfacen2">mMesh</a>-&gt;<a class="code" href="classOgre_1_1Mesh.html#Ogre_1_1Mesha4">createSubMesh</a>();
00299 
00300         <font class="comment">// Allocate geometry data</font>
00301         <font class="keywordflow">if</font> (mSharedVertexData)
00302         {
00303             <font class="comment">// 1 buffer for all data</font>
00304             <font class="comment">// Assume size is vertexStride + vertex pos size</font>
00305             <font class="keywordtype">int</font> vertSize = <font class="keyword">sizeof</font>(Real) * 3; <font class="comment">// position data mandatory</font>
00306             vertSize += <a class="code" href="classOgre_1_1PatchSurface.html#Ogre_1_1PatchSurfacen1">mCtlPointData</a>.<a class="code" href="structOgre_1_1GeometryData.html#Ogre_1_1GeometryDatam9">vertexStride</a>;
00307             <font class="comment">/*</font>
00308 <font class="comment">            if (mCtlPointData.hasNormals)</font>
00309 <font class="comment">                vertSize += sizeof(Real) * 3;</font>
00310 <font class="comment">            if (mCtlPointData.hasColours)</font>
00311 <font class="comment">                vertSize += sizeof(int);</font>
00312 <font class="comment">            for (tex = 0; tex &lt; mCtlPointData.numTexCoords; ++tex)</font>
00313 <font class="comment">            {</font>
00314 <font class="comment">                vertSize += sizeof(Real) * mCtlPointData.numTexCoordDimensions[tex];</font>
00315 <font class="comment">            }</font>
00316 <font class="comment">            */</font>
00317 
00318             <font class="comment">// Allocate whole at once</font>
00319             <a class="code" href="classOgre_1_1PatchSurface.html#Ogre_1_1PatchSurfacen2">mMesh</a>-&gt;<a class="code" href="classOgre_1_1Mesh.html#Ogre_1_1Meshm0">sharedGeometry</a>.<a class="code" href="structOgre_1_1GeometryData.html#Ogre_1_1GeometryDatam5">pVertices</a> = (<a class="code" href="namespaceOgre.html#a281">Real</a>*)<a class="code" href="OgreMemoryMacros_8h.html#a2">malloc</a>(vertSize *  <a class="code" href="classOgre_1_1PatchSurface.html#Ogre_1_1PatchSurfacen9">mMeshWidth</a> * <a class="code" href="classOgre_1_1PatchSurface.html#Ogre_1_1PatchSurfacen10">mMeshHeight</a>);
00320 
00321             <font class="comment">// Set other pointers relative to this</font>
00322             <font class="keywordflow">if</font> (<a class="code" href="classOgre_1_1PatchSurface.html#Ogre_1_1PatchSurfacen1">mCtlPointData</a>.<a class="code" href="structOgre_1_1GeometryData.html#Ogre_1_1GeometryDatam1">hasNormals</a>)
00323                 <a class="code" href="classOgre_1_1PatchSurface.html#Ogre_1_1PatchSurfacen2">mMesh</a>-&gt;<a class="code" href="classOgre_1_1Mesh.html#Ogre_1_1Meshm0">sharedGeometry</a>.<a class="code" href="structOgre_1_1GeometryData.html#Ogre_1_1GeometryDatam7">pNormals</a> = <a class="code" href="classOgre_1_1PatchSurface.html#Ogre_1_1PatchSurfacen2">mMesh</a>-&gt;<a class="code" href="classOgre_1_1Mesh.html#Ogre_1_1Meshm0">sharedGeometry</a>.<a class="code" href="structOgre_1_1GeometryData.html#Ogre_1_1GeometryDatam5">pVertices</a> +
00324                     (<a class="code" href="classOgre_1_1PatchSurface.html#Ogre_1_1PatchSurfacen1">mCtlPointData</a>.<a class="code" href="structOgre_1_1GeometryData.html#Ogre_1_1GeometryDatam7">pNormals</a> - <a class="code" href="classOgre_1_1PatchSurface.html#Ogre_1_1PatchSurfacen1">mCtlPointData</a>.<a class="code" href="structOgre_1_1GeometryData.html#Ogre_1_1GeometryDatam5">pVertices</a>);
00325             <font class="keywordflow">if</font> (<a class="code" href="classOgre_1_1PatchSurface.html#Ogre_1_1PatchSurfacen1">mCtlPointData</a>.<a class="code" href="structOgre_1_1GeometryData.html#Ogre_1_1GeometryDatam4">hasColours</a>)
00326                 <a class="code" href="classOgre_1_1PatchSurface.html#Ogre_1_1PatchSurfacen2">mMesh</a>-&gt;<a class="code" href="classOgre_1_1Mesh.html#Ogre_1_1Meshm0">sharedGeometry</a>.<a class="code" href="structOgre_1_1GeometryData.html#Ogre_1_1GeometryDatam8">pColours</a> = (<font class="keywordtype">unsigned</font> <font class="keywordtype">long</font>*)((<font class="keywordtype">char</font>*)<a class="code" href="classOgre_1_1PatchSurface.html#Ogre_1_1PatchSurfacen2">mMesh</a>-&gt;<a class="code" href="classOgre_1_1Mesh.html#Ogre_1_1Meshm0">sharedGeometry</a>.<a class="code" href="structOgre_1_1GeometryData.html#Ogre_1_1GeometryDatam5">pVertices</a> +
00327                     ((<font class="keywordtype">char</font>*)<a class="code" href="classOgre_1_1PatchSurface.html#Ogre_1_1PatchSurfacen1">mCtlPointData</a>.<a class="code" href="structOgre_1_1GeometryData.html#Ogre_1_1GeometryDatam8">pColours</a> - (<font class="keywordtype">char</font>*)<a class="code" href="classOgre_1_1PatchSurface.html#Ogre_1_1PatchSurfacen1">mCtlPointData</a>.<a class="code" href="structOgre_1_1GeometryData.html#Ogre_1_1GeometryDatam5">pVertices</a>));
00328             <font class="keywordflow">for</font> (tex = 0; tex &lt; <a class="code" href="classOgre_1_1PatchSurface.html#Ogre_1_1PatchSurfacen1">mCtlPointData</a>.<a class="code" href="structOgre_1_1GeometryData.html#Ogre_1_1GeometryDatam2">numTexCoords</a>; ++tex)
00329             {
00330                 <a class="code" href="classOgre_1_1PatchSurface.html#Ogre_1_1PatchSurfacen2">mMesh</a>-&gt;<a class="code" href="classOgre_1_1Mesh.html#Ogre_1_1Meshm0">sharedGeometry</a>.<a class="code" href="structOgre_1_1GeometryData.html#Ogre_1_1GeometryDatam6">pTexCoords</a>[tex] = <a class="code" href="classOgre_1_1PatchSurface.html#Ogre_1_1PatchSurfacen2">mMesh</a>-&gt;<a class="code" href="classOgre_1_1Mesh.html#Ogre_1_1Meshm0">sharedGeometry</a>.<a class="code" href="structOgre_1_1GeometryData.html#Ogre_1_1GeometryDatam5">pVertices</a> +
00331                     (<a class="code" href="classOgre_1_1PatchSurface.html#Ogre_1_1PatchSurfacen1">mCtlPointData</a>.<a class="code" href="structOgre_1_1GeometryData.html#Ogre_1_1GeometryDatam6">pTexCoords</a>[tex] - <a class="code" href="classOgre_1_1PatchSurface.html#Ogre_1_1PatchSurfacen1">mCtlPointData</a>.<a class="code" href="structOgre_1_1GeometryData.html#Ogre_1_1GeometryDatam5">pVertices</a>);
00332             }
00333 
00334 
00335         }
00336         <font class="keywordflow">else</font>
00337         {
00338             <font class="comment">// Separate buffers</font>
00339             <a class="code" href="classOgre_1_1PatchSurface.html#Ogre_1_1PatchSurfacen2">mMesh</a>-&gt;<a class="code" href="classOgre_1_1Mesh.html#Ogre_1_1Meshm0">sharedGeometry</a>.<a class="code" href="structOgre_1_1GeometryData.html#Ogre_1_1GeometryDatam5">pVertices</a> = <font class="keyword">new</font> <a class="code" href="namespaceOgre.html#a281">Real</a>[3 * <a class="code" href="classOgre_1_1PatchSurface.html#Ogre_1_1PatchSurfacen9">mMeshWidth</a> * <a class="code" href="classOgre_1_1PatchSurface.html#Ogre_1_1PatchSurfacen10">mMeshHeight</a>];
00340             <font class="keywordflow">if</font> (<a class="code" href="classOgre_1_1PatchSurface.html#Ogre_1_1PatchSurfacen1">mCtlPointData</a>.<a class="code" href="structOgre_1_1GeometryData.html#Ogre_1_1GeometryDatam1">hasNormals</a>)
00341                 <a class="code" href="classOgre_1_1PatchSurface.html#Ogre_1_1PatchSurfacen2">mMesh</a>-&gt;<a class="code" href="classOgre_1_1Mesh.html#Ogre_1_1Meshm0">sharedGeometry</a>.<a class="code" href="structOgre_1_1GeometryData.html#Ogre_1_1GeometryDatam7">pNormals</a> = <font class="keyword">new</font> <a class="code" href="namespaceOgre.html#a281">Real</a>[3 * <a class="code" href="classOgre_1_1PatchSurface.html#Ogre_1_1PatchSurfacen9">mMeshWidth</a> * <a class="code" href="classOgre_1_1PatchSurface.html#Ogre_1_1PatchSurfacen10">mMeshHeight</a>];
00342             <font class="keywordflow">if</font> (<a class="code" href="classOgre_1_1PatchSurface.html#Ogre_1_1PatchSurfacen1">mCtlPointData</a>.<a class="code" href="structOgre_1_1GeometryData.html#Ogre_1_1GeometryDatam4">hasColours</a>)
00343                 <a class="code" href="classOgre_1_1PatchSurface.html#Ogre_1_1PatchSurfacen2">mMesh</a>-&gt;<a class="code" href="classOgre_1_1Mesh.html#Ogre_1_1Meshm0">sharedGeometry</a>.<a class="code" href="structOgre_1_1GeometryData.html#Ogre_1_1GeometryDatam8">pColours</a> = <font class="keyword">new</font> <font class="keywordtype">unsigned</font> <font class="keywordtype">long</font>[<a class="code" href="classOgre_1_1PatchSurface.html#Ogre_1_1PatchSurfacen9">mMeshWidth</a> * <a class="code" href="classOgre_1_1PatchSurface.html#Ogre_1_1PatchSurfacen10">mMeshHeight</a>];
00344             <font class="keywordflow">for</font> (tex = 0; tex &lt; <a class="code" href="classOgre_1_1PatchSurface.html#Ogre_1_1PatchSurfacen1">mCtlPointData</a>.<a class="code" href="structOgre_1_1GeometryData.html#Ogre_1_1GeometryDatam2">numTexCoords</a>; ++tex)
00345             {
00346                 <a class="code" href="classOgre_1_1PatchSurface.html#Ogre_1_1PatchSurfacen2">mMesh</a>-&gt;<a class="code" href="classOgre_1_1Mesh.html#Ogre_1_1Meshm0">sharedGeometry</a>.<a class="code" href="structOgre_1_1GeometryData.html#Ogre_1_1GeometryDatam6">pTexCoords</a>[tex] = <font class="keyword">new</font> <a class="code" href="namespaceOgre.html#a281">Real</a>[<a class="code" href="classOgre_1_1PatchSurface.html#Ogre_1_1PatchSurfacen1">mCtlPointData</a>.<a class="code" href="structOgre_1_1GeometryData.html#Ogre_1_1GeometryDatam3">numTexCoordDimensions</a>[tex] * <a class="code" href="classOgre_1_1PatchSurface.html#Ogre_1_1PatchSurfacen9">mMeshWidth</a> * <a class="code" href="classOgre_1_1PatchSurface.html#Ogre_1_1PatchSurfacen10">mMeshHeight</a>];
00347             }
00348 
00349         }
00350 
00351         <a class="code" href="classOgre_1_1PatchSurface.html#Ogre_1_1PatchSurfacen2">mMesh</a>-&gt;<a class="code" href="classOgre_1_1Mesh.html#Ogre_1_1Mesha2">load</a>();
00352 
00353     }
00354     <font class="comment">//-----------------------------------------------------------------------</font>
<a name="l00355"></a><a class="code" href="classOgre_1_1PatchSurface.html#Ogre_1_1PatchSurfaceb2">00355</a>     <font class="keywordtype">void</font> PatchSurface::deallocateMemory(<font class="keywordtype">void</font>)
00356     {
00357         <font class="comment">// All detailed deallocation will be done by Mesh</font>
00358         MeshManager::getSingleton().unload((<a class="code" href="classOgre_1_1Resource.html">Resource</a>*)<a class="code" href="classOgre_1_1PatchSurface.html#Ogre_1_1PatchSurfacen2">mMesh</a>);
00359 
00360         <font class="keyword">delete</font> <a class="code" href="classOgre_1_1PatchSurface.html#Ogre_1_1PatchSurfacen2">mMesh</a>;
00361         <a class="code" href="classOgre_1_1PatchSurface.html#Ogre_1_1PatchSurfacen13">mMemoryAllocated</a> = <font class="keyword">false</font>;
00362 
00363     }
00364     <font class="comment">//-----------------------------------------------------------------------</font>
<a name="l00365"></a><a class="code" href="classOgre_1_1PatchSurface.html#Ogre_1_1PatchSurfaceb3">00365</a>     <font class="keywordtype">void</font> PatchSurface::distributeControlPoints(<font class="keywordtype">void</font>)
00366     {
00367         <font class="comment">// Insert original control points into expanded mesh</font>
00368         <font class="keywordtype">int</font> uStep = 1 &lt;&lt; <a class="code" href="classOgre_1_1PatchSurface.html#Ogre_1_1PatchSurfacen7">mULevel</a>;
00369         <font class="keywordtype">int</font> vStep = 1 &lt;&lt; <a class="code" href="classOgre_1_1PatchSurface.html#Ogre_1_1PatchSurfacen8">mVLevel</a>;
00370         <font class="keywordtype">int</font> tex;
00371 
00372         <font class="comment">// Set up the 'step' variables for indexing into the source and destination buffers</font>
00373         <font class="comment">// These are required in order to support both vertex data which all components share a</font>
00374         <font class="comment">// single buffer, AND vertex data in which each component has its own buffer</font>
00375         <a class="code" href="classOgre_1_1PatchSurface.html#Ogre_1_1PatchSurfacen15">mBufPosStep</a> = (<font class="keyword">sizeof</font>(Real) * 3) + <a class="code" href="classOgre_1_1PatchSurface.html#Ogre_1_1PatchSurfacen1">mCtlPointData</a>.<a class="code" href="structOgre_1_1GeometryData.html#Ogre_1_1GeometryDatam9">vertexStride</a>;
00376         <a class="code" href="classOgre_1_1PatchSurface.html#Ogre_1_1PatchSurfacen16">mBufNormStep</a> = (<font class="keyword">sizeof</font>(Real) * 3) + <a class="code" href="classOgre_1_1PatchSurface.html#Ogre_1_1PatchSurfacen1">mCtlPointData</a>.<a class="code" href="structOgre_1_1GeometryData.html#Ogre_1_1GeometryDatam10">normalStride</a>;
00377         <a class="code" href="classOgre_1_1PatchSurface.html#Ogre_1_1PatchSurfacen17">mBufColourStep</a> = (<font class="keyword">sizeof</font>(Real) * 3) + <a class="code" href="classOgre_1_1PatchSurface.html#Ogre_1_1PatchSurfacen1">mCtlPointData</a>.<a class="code" href="structOgre_1_1GeometryData.html#Ogre_1_1GeometryDatam12">colourStride</a>;
00378         <font class="keywordflow">for</font> ( tex = 0; tex &lt; <a class="code" href="classOgre_1_1PatchSurface.html#Ogre_1_1PatchSurfacen1">mCtlPointData</a>.<a class="code" href="structOgre_1_1GeometryData.html#Ogre_1_1GeometryDatam2">numTexCoords</a>; ++tex)
00379             <a class="code" href="classOgre_1_1PatchSurface.html#Ogre_1_1PatchSurfacen18">mBufTexCoordStep</a>[tex] = (<font class="keyword">sizeof</font>(Real) * <a class="code" href="classOgre_1_1PatchSurface.html#Ogre_1_1PatchSurfacen1">mCtlPointData</a>.<a class="code" href="structOgre_1_1GeometryData.html#Ogre_1_1GeometryDatam3">numTexCoordDimensions</a>[tex]) + <a class="code" href="classOgre_1_1PatchSurface.html#Ogre_1_1PatchSurfacen1">mCtlPointData</a>.<a class="code" href="structOgre_1_1GeometryData.html#Ogre_1_1GeometryDatam11">texCoordStride</a>[tex];
00380 
00381         <font class="keywordtype">int</font> u, v;
00382         <font class="keywordtype">int</font> destIdx, srcIdx;
00383         <a class="code" href="structOgre_1_1__GeomVector.html">GeomVertexPosition</a> *pDestVert, *pSrcVert;
00384         <a class="code" href="structOgre_1_1__GeomVector.html">GeomVertexNormal</a> *pDestNorm, *pSrcNorm;
00385         <a class="code" href="namespaceOgre.html#a281">Real</a> *pDestReal, *pSrcReal;
00386 
00387         srcIdx = 0;
00388         <font class="keywordflow">for</font> (v = 0; v &lt; <a class="code" href="classOgre_1_1PatchSurface.html#Ogre_1_1PatchSurfacen10">mMeshHeight</a>; v += vStep)
00389         {
00390             <font class="keywordflow">for</font> (u = 0; u &lt; <a class="code" href="classOgre_1_1PatchSurface.html#Ogre_1_1PatchSurfacen9">mMeshWidth</a>; u += uStep)
00391             {
00392                 destIdx = (v * <a class="code" href="classOgre_1_1PatchSurface.html#Ogre_1_1PatchSurfacen9">mMeshWidth</a>) + u;
00393                 <font class="comment">// Copy Position</font>
00394                 pDestVert = (<a class="code" href="structOgre_1_1__GeomVector.html">GeomVertexPosition</a>*)((<font class="keywordtype">char</font>*)<a class="code" href="classOgre_1_1PatchSurface.html#Ogre_1_1PatchSurfacen2">mMesh</a>-&gt;<a class="code" href="classOgre_1_1Mesh.html#Ogre_1_1Meshm0">sharedGeometry</a>.<a class="code" href="structOgre_1_1GeometryData.html#Ogre_1_1GeometryDatam5">pVertices</a> + (destIdx * <a class="code" href="classOgre_1_1PatchSurface.html#Ogre_1_1PatchSurfacen15">mBufPosStep</a>));
00395                 pSrcVert = (<a class="code" href="structOgre_1_1__GeomVector.html">GeomVertexPosition</a>*)((<font class="keywordtype">char</font>*)<a class="code" href="classOgre_1_1PatchSurface.html#Ogre_1_1PatchSurfacen1">mCtlPointData</a>.<a class="code" href="structOgre_1_1GeometryData.html#Ogre_1_1GeometryDatam5">pVertices</a> + (srcIdx * <a class="code" href="classOgre_1_1PatchSurface.html#Ogre_1_1PatchSurfacen15">mBufPosStep</a>));
00396                 *pDestVert = *pSrcVert;
00397 
00398                 <font class="comment">// Copy Normals</font>
00399                 <font class="keywordflow">if</font> (<a class="code" href="classOgre_1_1PatchSurface.html#Ogre_1_1PatchSurfacen1">mCtlPointData</a>.<a class="code" href="structOgre_1_1GeometryData.html#Ogre_1_1GeometryDatam1">hasNormals</a>)
00400                 {
00401                     pDestNorm = (<a class="code" href="structOgre_1_1__GeomVector.html">GeomVertexNormal</a>*)((<font class="keywordtype">char</font>*)<a class="code" href="classOgre_1_1PatchSurface.html#Ogre_1_1PatchSurfacen2">mMesh</a>-&gt;<a class="code" href="classOgre_1_1Mesh.html#Ogre_1_1Meshm0">sharedGeometry</a>.<a class="code" href="structOgre_1_1GeometryData.html#Ogre_1_1GeometryDatam7">pNormals</a> + (destIdx * <a class="code" href="classOgre_1_1PatchSurface.html#Ogre_1_1PatchSurfacen16">mBufNormStep</a>));
00402                     pSrcNorm = (<a class="code" href="structOgre_1_1__GeomVector.html">GeomVertexNormal</a>*)((<font class="keywordtype">char</font>*)<a class="code" href="classOgre_1_1PatchSurface.html#Ogre_1_1PatchSurfacen1">mCtlPointData</a>.<a class="code" href="structOgre_1_1GeometryData.html#Ogre_1_1GeometryDatam7">pNormals</a> + (srcIdx * <a class="code" href="classOgre_1_1PatchSurface.html#Ogre_1_1PatchSurfacen16">mBufNormStep</a>));
00403                     *pDestNorm = *pSrcNorm;
00404                 }
00405 
00406                 <font class="comment">// Copy texture coords</font>
00407                 <font class="keywordflow">for</font> (tex = 0; tex &lt; <a class="code" href="classOgre_1_1PatchSurface.html#Ogre_1_1PatchSurfacen1">mCtlPointData</a>.<a class="code" href="structOgre_1_1GeometryData.html#Ogre_1_1GeometryDatam2">numTexCoords</a>; ++tex)
00408                 {
00409                     pDestReal = (<a class="code" href="namespaceOgre.html#a281">Real</a>*)((<font class="keywordtype">char</font>*)<a class="code" href="classOgre_1_1PatchSurface.html#Ogre_1_1PatchSurfacen2">mMesh</a>-&gt;<a class="code" href="classOgre_1_1Mesh.html#Ogre_1_1Meshm0">sharedGeometry</a>.<a class="code" href="structOgre_1_1GeometryData.html#Ogre_1_1GeometryDatam6">pTexCoords</a>[tex] + (destIdx * <a class="code" href="classOgre_1_1PatchSurface.html#Ogre_1_1PatchSurfacen18">mBufTexCoordStep</a>[tex]));
00410                     pSrcReal = (<a class="code" href="namespaceOgre.html#a281">Real</a>*)((<font class="keywordtype">char</font>*)<a class="code" href="classOgre_1_1PatchSurface.html#Ogre_1_1PatchSurfacen1">mCtlPointData</a>.<a class="code" href="structOgre_1_1GeometryData.html#Ogre_1_1GeometryDatam6">pTexCoords</a>[tex] + (srcIdx * <a class="code" href="classOgre_1_1PatchSurface.html#Ogre_1_1PatchSurfacen18">mBufTexCoordStep</a>[tex]));
00411                     <font class="keywordflow">for</font> (<font class="keywordtype">int</font> dim = 0; dim &lt; <a class="code" href="classOgre_1_1PatchSurface.html#Ogre_1_1PatchSurfacen1">mCtlPointData</a>.<a class="code" href="structOgre_1_1GeometryData.html#Ogre_1_1GeometryDatam3">numTexCoordDimensions</a>[tex]; ++dim)
00412                         *pDestReal++ = *pSrcReal++;
00413                 }
00414                 ++srcIdx;
00415             } <font class="comment">// u</font>
00416         } <font class="comment">// v</font>
00417     }
00418     <font class="comment">//-----------------------------------------------------------------------</font>
<a name="l00419"></a><a class="code" href="classOgre_1_1PatchSurface.html#Ogre_1_1PatchSurfaceb4">00419</a>     <font class="keywordtype">void</font> PatchSurface::subdivideCurve(<font class="keywordtype">int</font> startIdx, <font class="keywordtype">int</font> stepSize, <font class="keywordtype">int</font> numSteps, <font class="keywordtype">int</font> iterations)
00420     {
00421         <font class="comment">// Subdivides a curve within a sparsely populated buffer (gaps are already there to be interpolated into)</font>
00422         <font class="keywordtype">int</font> leftIdx, rightIdx, destIdx, halfStep, maxIdx;
00423         <font class="keywordtype">bool</font> firstSegment;
00424 
00425         maxIdx = startIdx + (numSteps * stepSize);
00426         <font class="keywordtype">int</font> step = stepSize;
00427 
00428         <font class="keywordflow">while</font>(iterations--)
00429         {
00430             halfStep = step / 2;
00431             leftIdx = startIdx;
00432             destIdx = leftIdx + halfStep;
00433             rightIdx = leftIdx + step;
00434             firstSegment = <font class="keyword">true</font>;
00435             <font class="keywordflow">while</font> (leftIdx &lt; maxIdx)
00436             {
00437                 <font class="comment">// Interpolate</font>
00438                 <a class="code" href="classOgre_1_1PatchSurface.html#Ogre_1_1PatchSurfaceb5">interpolateVertexData</a>(leftIdx, rightIdx, destIdx);
00439 
00440                 <font class="comment">// If 2nd or more segment, interpolate current left between current and last mid points</font>
00441                 <font class="keywordflow">if</font> (!firstSegment)
00442                 {
00443                     <a class="code" href="classOgre_1_1PatchSurface.html#Ogre_1_1PatchSurfaceb5">interpolateVertexData</a>(leftIdx - halfStep, leftIdx + halfStep, leftIdx);
00444                 }
00445                 <font class="comment">// Next segment</font>
00446                 leftIdx = rightIdx;
00447                 destIdx = leftIdx + halfStep;
00448                 rightIdx = leftIdx + step;
00449                 firstSegment = <font class="keyword">false</font>;
00450             }
00451 
00452             step = halfStep;
00453         }
00454     }
00455     <font class="comment">//-----------------------------------------------------------------------</font>
<a name="l00456"></a><a class="code" href="classOgre_1_1PatchSurface.html#Ogre_1_1PatchSurfaceb6">00456</a>     <font class="keywordtype">void</font> PatchSurface::makeTriangles(<font class="keywordtype">void</font>)
00457     {
00458         <font class="comment">// The mesh is built, just make a list of indexes to spit out the triangles</font>
00459         <font class="keywordtype">int</font> vInc, uInc, v, u, iterations;
00460         <font class="keywordtype">int</font> vCount, uCount;
00461 
00462         <font class="keywordflow">if</font> (<a class="code" href="classOgre_1_1PatchSurface.html#Ogre_1_1PatchSurfacen11">mVSide</a> == <a class="code" href="classOgre_1_1PatchSurface.html#Ogre_1_1PatchSurfaces7Ogre_1_1PatchSurfaces4">VS_BOTH</a>)
00463         {
00464             iterations = 2;
00465             vInc = 1;
00466             v = 0; <font class="comment">// Start with front</font>
00467         }
00468         <font class="keywordflow">else</font>
00469         {
00470             iterations = 1;
00471             <font class="keywordflow">if</font> (<a class="code" href="classOgre_1_1PatchSurface.html#Ogre_1_1PatchSurfacen11">mVSide</a> == <a class="code" href="classOgre_1_1PatchSurface.html#Ogre_1_1PatchSurfaces7Ogre_1_1PatchSurfaces2">VS_FRONT</a>)
00472             {
00473                 vInc = 1;
00474                 v = 0;
00475             }
00476             <font class="keywordflow">else</font>
00477             {
00478                 vInc = -1;
00479                 v = <a class="code" href="classOgre_1_1PatchSurface.html#Ogre_1_1PatchSurfacen10">mMeshHeight</a> - 1;
00480             }
00481         }
00482 
00483         <font class="comment">// Allocate memory for faces</font>
00484         <a class="code" href="classOgre_1_1SubMesh.html">SubMesh</a>* sm = <a class="code" href="classOgre_1_1PatchSurface.html#Ogre_1_1PatchSurfacen2">mMesh</a>-&gt;<a class="code" href="classOgre_1_1Mesh.html#Ogre_1_1Mesha6">getSubMesh</a>(0);
00485         <font class="comment">// Num faces, width*height*2 (2 tris per square)</font>
00486         sm-&gt;<a class="code" href="classOgre_1_1SubMesh.html#Ogre_1_1SubMeshm3">numFaces</a> = (<a class="code" href="classOgre_1_1PatchSurface.html#Ogre_1_1PatchSurfacen9">mMeshWidth</a>-1) * (<a class="code" href="classOgre_1_1PatchSurface.html#Ogre_1_1PatchSurfacen10">mMeshHeight</a>-1) * 2 * iterations;
00487         sm-&gt;<a class="code" href="classOgre_1_1SubMesh.html#Ogre_1_1SubMeshm4">faceVertexIndices</a> = <font class="keyword">new</font> <font class="keywordtype">unsigned</font> <font class="keywordtype">short</font>[sm-&gt;<a class="code" href="classOgre_1_1SubMesh.html#Ogre_1_1SubMeshm3">numFaces</a> * 3];
00488 
00489         <font class="keywordtype">int</font> v1, v2, v3;
00490         <font class="comment">// bool firstTri = true;</font>
00491         <font class="keywordtype">unsigned</font> <font class="keywordtype">short</font>* pIndexes = sm-&gt;<a class="code" href="classOgre_1_1SubMesh.html#Ogre_1_1SubMeshm4">faceVertexIndices</a>;
00492 
00493         <font class="keywordflow">while</font> (iterations--)
00494         {
00495             <font class="comment">// Make tris in a zigzag pattern (compatible with strips)</font>
00496             u = 0;
00497             uInc = 1; <font class="comment">// Start with moving +u</font>
00498 
00499             vCount = <a class="code" href="classOgre_1_1PatchSurface.html#Ogre_1_1PatchSurfacen10">mMeshHeight</a> - 1;
00500             <font class="keywordflow">while</font> (vCount--)
00501             {
00502                 uCount = <a class="code" href="classOgre_1_1PatchSurface.html#Ogre_1_1PatchSurfacen9">mMeshWidth</a> - 1;
00503                 <font class="keywordflow">while</font> (uCount--)
00504                 {
00505                     <font class="comment">// First Tri in cell</font>
00506                     <font class="comment">// -----------------</font>
00507                     v1 = ((v + vInc) * <a class="code" href="classOgre_1_1PatchSurface.html#Ogre_1_1PatchSurfacen9">mMeshWidth</a>) + u;
00508                     v2 = (v * <a class="code" href="classOgre_1_1PatchSurface.html#Ogre_1_1PatchSurfacen9">mMeshWidth</a>) + u;
00509                     v3 = ((v + vInc) * <a class="code" href="classOgre_1_1PatchSurface.html#Ogre_1_1PatchSurfacen9">mMeshWidth</a>) + (u + uInc);
00510                     <font class="comment">// Output indexes</font>
00511                     *pIndexes++ = v1;
00512                     *pIndexes++ = v2;
00513                     *pIndexes++ = v3;
00514                     <font class="comment">// Second Tri in cell</font>
00515                     <font class="comment">// ------------------</font>
00516                     v1 = ((v + vInc) * <a class="code" href="classOgre_1_1PatchSurface.html#Ogre_1_1PatchSurfacen9">mMeshWidth</a>) + (u + uInc);
00517                     v2 = (v * <a class="code" href="classOgre_1_1PatchSurface.html#Ogre_1_1PatchSurfacen9">mMeshWidth</a>) + u;
00518                     v3 = (v * <a class="code" href="classOgre_1_1PatchSurface.html#Ogre_1_1PatchSurfacen9">mMeshWidth</a>) + (u + uInc);
00519                     <font class="comment">// Output indexes</font>
00520                     *pIndexes++ = v1;
00521                     *pIndexes++ = v2;
00522                     *pIndexes++ = v3;
00523 
00524                     <font class="comment">// Next column</font>
00525                     u += uInc;
00526                 }
00527                 <font class="comment">// Next row</font>
00528                 v += vInc;
00529                 u = 0;
00530 
00531 
00532             }
00533 
00534             <font class="comment">// Reverse vInc for double sided</font>
00535             v = <a class="code" href="classOgre_1_1PatchSurface.html#Ogre_1_1PatchSurfacen10">mMeshHeight</a> - 1;
00536             vInc = -vInc;
00537 
00538         }
00539 
00540 
00541 
00542     }
00543     <font class="comment">//-----------------------------------------------------------------------</font>
<a name="l00544"></a><a class="code" href="classOgre_1_1PatchSurface.html#Ogre_1_1PatchSurfaceb5">00544</a>     <font class="keywordtype">void</font> PatchSurface::interpolateVertexData(<font class="keywordtype">int</font> leftIdx, <font class="keywordtype">int</font> rightIdx, <font class="keywordtype">int</font> destIdx)
00545     {
00546         <a class="code" href="structOgre_1_1__GeomVector.html">GeomVertexPosition</a> *pDestVert, *pLeftVert, *pRightVert;
00547         <a class="code" href="structOgre_1_1__GeomVector.html">GeomVertexNormal</a> *pDestNorm, *pLeftNorm, *pRightNorm;
00548         <a class="code" href="namespaceOgre.html#a281">Real</a> *pDestReal, *pLeftReal, *pRightReal;
00549 
00550         <font class="comment">// Set up pointers &amp; interpolate</font>
00551         pDestVert = (<a class="code" href="structOgre_1_1__GeomVector.html">GeomVertexPosition</a>*)((<font class="keywordtype">char</font>*)<a class="code" href="classOgre_1_1PatchSurface.html#Ogre_1_1PatchSurfacen2">mMesh</a>-&gt;<a class="code" href="classOgre_1_1Mesh.html#Ogre_1_1Meshm0">sharedGeometry</a>.<a class="code" href="structOgre_1_1GeometryData.html#Ogre_1_1GeometryDatam5">pVertices</a> + (destIdx * <a class="code" href="classOgre_1_1PatchSurface.html#Ogre_1_1PatchSurfacen15">mBufPosStep</a>));
00552         pLeftVert = (<a class="code" href="structOgre_1_1__GeomVector.html">GeomVertexPosition</a>*)((<font class="keywordtype">char</font>*)<a class="code" href="classOgre_1_1PatchSurface.html#Ogre_1_1PatchSurfacen2">mMesh</a>-&gt;<a class="code" href="classOgre_1_1Mesh.html#Ogre_1_1Meshm0">sharedGeometry</a>.<a class="code" href="structOgre_1_1GeometryData.html#Ogre_1_1GeometryDatam5">pVertices</a> + (leftIdx * <a class="code" href="classOgre_1_1PatchSurface.html#Ogre_1_1PatchSurfacen15">mBufPosStep</a>));
00553         pRightVert = (<a class="code" href="structOgre_1_1__GeomVector.html">GeomVertexPosition</a>*)((<font class="keywordtype">char</font>*)<a class="code" href="classOgre_1_1PatchSurface.html#Ogre_1_1PatchSurfacen2">mMesh</a>-&gt;<a class="code" href="classOgre_1_1Mesh.html#Ogre_1_1Meshm0">sharedGeometry</a>.<a class="code" href="structOgre_1_1GeometryData.html#Ogre_1_1GeometryDatam5">pVertices</a> + (rightIdx * <a class="code" href="classOgre_1_1PatchSurface.html#Ogre_1_1PatchSurfacen15">mBufPosStep</a>));
00554         pDestVert-&gt;<a class="code" href="structOgre_1_1__GeomVector.html#Ogre_1_1__GeomVectorm0">x</a> = (pLeftVert-&gt;<a class="code" href="structOgre_1_1__GeomVector.html#Ogre_1_1__GeomVectorm0">x</a> + pRightVert-&gt;<a class="code" href="structOgre_1_1__GeomVector.html#Ogre_1_1__GeomVectorm0">x</a>) * 0.5;
00555         pDestVert-&gt;<a class="code" href="structOgre_1_1__GeomVector.html#Ogre_1_1__GeomVectorm1">y</a> = (pLeftVert-&gt;<a class="code" href="structOgre_1_1__GeomVector.html#Ogre_1_1__GeomVectorm1">y</a> + pRightVert-&gt;<a class="code" href="structOgre_1_1__GeomVector.html#Ogre_1_1__GeomVectorm1">y</a>) * 0.5;
00556         pDestVert-&gt;<a class="code" href="structOgre_1_1__GeomVector.html#Ogre_1_1__GeomVectorm2">z</a> = (pLeftVert-&gt;<a class="code" href="structOgre_1_1__GeomVector.html#Ogre_1_1__GeomVectorm2">z</a> + pRightVert-&gt;<a class="code" href="structOgre_1_1__GeomVector.html#Ogre_1_1__GeomVectorm2">z</a>) * 0.5;
00557 
00558         <font class="keywordflow">if</font> (<a class="code" href="classOgre_1_1PatchSurface.html#Ogre_1_1PatchSurfacen2">mMesh</a>-&gt;<a class="code" href="classOgre_1_1Mesh.html#Ogre_1_1Meshm0">sharedGeometry</a>.<a class="code" href="structOgre_1_1GeometryData.html#Ogre_1_1GeometryDatam1">hasNormals</a>)
00559         {
00560             pDestNorm = (<a class="code" href="structOgre_1_1__GeomVector.html">GeomVertexNormal</a>*)((<font class="keywordtype">char</font>*)<a class="code" href="classOgre_1_1PatchSurface.html#Ogre_1_1PatchSurfacen2">mMesh</a>-&gt;<a class="code" href="classOgre_1_1Mesh.html#Ogre_1_1Meshm0">sharedGeometry</a>.<a class="code" href="structOgre_1_1GeometryData.html#Ogre_1_1GeometryDatam7">pNormals</a> + (destIdx * <a class="code" href="classOgre_1_1PatchSurface.html#Ogre_1_1PatchSurfacen16">mBufNormStep</a>));
00561             pLeftNorm = (<a class="code" href="structOgre_1_1__GeomVector.html">GeomVertexNormal</a>*)((<font class="keywordtype">char</font>*)<a class="code" href="classOgre_1_1PatchSurface.html#Ogre_1_1PatchSurfacen2">mMesh</a>-&gt;<a class="code" href="classOgre_1_1Mesh.html#Ogre_1_1Meshm0">sharedGeometry</a>.<a class="code" href="structOgre_1_1GeometryData.html#Ogre_1_1GeometryDatam7">pNormals</a> + (leftIdx * <a class="code" href="classOgre_1_1PatchSurface.html#Ogre_1_1PatchSurfacen16">mBufNormStep</a>));
00562             pRightNorm = (<a class="code" href="structOgre_1_1__GeomVector.html">GeomVertexNormal</a>*)((<font class="keywordtype">char</font>*)<a class="code" href="classOgre_1_1PatchSurface.html#Ogre_1_1PatchSurfacen2">mMesh</a>-&gt;<a class="code" href="classOgre_1_1Mesh.html#Ogre_1_1Meshm0">sharedGeometry</a>.<a class="code" href="structOgre_1_1GeometryData.html#Ogre_1_1GeometryDatam7">pNormals</a> + (rightIdx * <a class="code" href="classOgre_1_1PatchSurface.html#Ogre_1_1PatchSurfacen16">mBufNormStep</a>));
00563             pDestNorm-&gt;<a class="code" href="structOgre_1_1__GeomVector.html#Ogre_1_1__GeomVectorm0">x</a> = (pLeftNorm-&gt;<a class="code" href="structOgre_1_1__GeomVector.html#Ogre_1_1__GeomVectorm0">x</a> + pRightNorm-&gt;<a class="code" href="structOgre_1_1__GeomVector.html#Ogre_1_1__GeomVectorm0">x</a>) * 0.5;
00564             pDestNorm-&gt;<a class="code" href="structOgre_1_1__GeomVector.html#Ogre_1_1__GeomVectorm1">y</a> = (pLeftNorm-&gt;<a class="code" href="structOgre_1_1__GeomVector.html#Ogre_1_1__GeomVectorm1">y</a> + pRightNorm-&gt;<a class="code" href="structOgre_1_1__GeomVector.html#Ogre_1_1__GeomVectorm1">y</a>) * 0.5;
00565             pDestNorm-&gt;<a class="code" href="structOgre_1_1__GeomVector.html#Ogre_1_1__GeomVectorm2">z</a> = (pLeftNorm-&gt;<a class="code" href="structOgre_1_1__GeomVector.html#Ogre_1_1__GeomVectorm2">z</a> + pRightNorm-&gt;<a class="code" href="structOgre_1_1__GeomVector.html#Ogre_1_1__GeomVectorm2">z</a>) * 0.5;
00566         }
00567         <font class="comment">// Skip colours for now</font>
00568         <font class="keywordflow">for</font> (<font class="keywordtype">int</font> tex = 0; tex &lt; <a class="code" href="classOgre_1_1PatchSurface.html#Ogre_1_1PatchSurfacen1">mCtlPointData</a>.<a class="code" href="structOgre_1_1GeometryData.html#Ogre_1_1GeometryDatam2">numTexCoords</a>; ++tex)
00569         {
00570             pDestReal = (<a class="code" href="namespaceOgre.html#a281">Real</a>*)((<font class="keywordtype">char</font>*)<a class="code" href="classOgre_1_1PatchSurface.html#Ogre_1_1PatchSurfacen2">mMesh</a>-&gt;<a class="code" href="classOgre_1_1Mesh.html#Ogre_1_1Meshm0">sharedGeometry</a>.<a class="code" href="structOgre_1_1GeometryData.html#Ogre_1_1GeometryDatam6">pTexCoords</a>[tex] + (destIdx * <a class="code" href="classOgre_1_1PatchSurface.html#Ogre_1_1PatchSurfacen18">mBufTexCoordStep</a>[tex]));
00571             pLeftReal = (<a class="code" href="namespaceOgre.html#a281">Real</a>*)((<font class="keywordtype">char</font>*)<a class="code" href="classOgre_1_1PatchSurface.html#Ogre_1_1PatchSurfacen2">mMesh</a>-&gt;<a class="code" href="classOgre_1_1Mesh.html#Ogre_1_1Meshm0">sharedGeometry</a>.<a class="code" href="structOgre_1_1GeometryData.html#Ogre_1_1GeometryDatam6">pTexCoords</a>[tex] + (leftIdx * <a class="code" href="classOgre_1_1PatchSurface.html#Ogre_1_1PatchSurfacen18">mBufTexCoordStep</a>[tex]));
00572             pRightReal = (<a class="code" href="namespaceOgre.html#a281">Real</a>*)((<font class="keywordtype">char</font>*)<a class="code" href="classOgre_1_1PatchSurface.html#Ogre_1_1PatchSurfacen2">mMesh</a>-&gt;<a class="code" href="classOgre_1_1Mesh.html#Ogre_1_1Meshm0">sharedGeometry</a>.<a class="code" href="structOgre_1_1GeometryData.html#Ogre_1_1GeometryDatam6">pTexCoords</a>[tex] + (rightIdx * <a class="code" href="classOgre_1_1PatchSurface.html#Ogre_1_1PatchSurfacen18">mBufTexCoordStep</a>[tex]));
00573             <font class="keywordflow">for</font> (<font class="keywordtype">int</font> dim = 0; dim &lt; <a class="code" href="classOgre_1_1PatchSurface.html#Ogre_1_1PatchSurfacen2">mMesh</a>-&gt;<a class="code" href="classOgre_1_1Mesh.html#Ogre_1_1Meshm0">sharedGeometry</a>.<a class="code" href="structOgre_1_1GeometryData.html#Ogre_1_1GeometryDatam3">numTexCoordDimensions</a>[tex]; ++dim)
00574                 *pDestReal++ = ((*pLeftReal++) + (*pRightReal++)) * 0.5;
00575         }
00576     }
00577 
00578 }
</pre></div><p>
Copyright &copy; 2002 by The OGRE Team<br />
<script type="text/javascript">
<!--//hide script from old browsers
document.write( "Last modified "+ document.lastModified );
//end hiding contents -->
</script>
</p>
</body>
</html>
