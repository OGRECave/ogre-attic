<html>
<head>
<title>OGRE Documentation</title> <meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1"> 
<link type="text/css" rel="stylesheet" href="style.css">
</head>

<body>
<!-- Generated by Doxygen 1.2.16 -->
<center>
<a class="qindex" href="index.html">Main Page</a> &nbsp; <a class="qindex" href="namespaces.html">Namespace List</a> &nbsp; <a class="qindex" href="hierarchy.html">Class Hierarchy</a> &nbsp; <a class="qindex" href="classes.html">Alphabetical List</a> &nbsp; <a class="qindex" href="annotated.html">Compound List</a> &nbsp; <a class="qindex" href="files.html">File List</a> &nbsp; <a class="qindex" href="namespacemembers.html">Namespace Members</a> &nbsp; <a class="qindex" href="functions.html">Compound Members</a> &nbsp; <a class="qindex" href="globals.html">File Members</a> &nbsp; <a class="qindex" href="pages.html">Related Pages</a> &nbsp; </center>
<hr><h1>OgreMeshManager.cpp</h1><a href="OgreMeshManager_8cpp.html">Go to the documentation of this file.</a><div class="fragment"><pre>00001 <font class="comment">/*</font>
00002 <font class="comment">-----------------------------------------------------------------------------</font>
00003 <font class="comment">This source file is part of OGRE</font>
00004 <font class="comment">    (Object-oriented Graphics Rendering Engine)</font>
00005 <font class="comment">For the latest info, see http://www.stevestreeting.com/ogre/</font>
00006 <font class="comment"></font>
00007 <font class="comment">Copyright © 2000-2001 Steven J. Streeting</font>
00008 <font class="comment">Also see acknowledgements in Readme.html</font>
00009 <font class="comment"></font>
00010 <font class="comment">This program is free software; you can redistribute it and/or modify it under</font>
00011 <font class="comment">the terms of the GNU General Public License as published by the Free Software</font>
00012 <font class="comment">Foundation; either version 2 of the License, or (at your option) any later</font>
00013 <font class="comment">version.</font>
00014 <font class="comment"></font>
00015 <font class="comment">This program is distributed in the hope that it will be useful, but WITHOUT</font>
00016 <font class="comment">ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or FITNESS</font>
00017 <font class="comment">FOR A PARTICULAR PURPOSE. See the GNU General Public License for more details.</font>
00018 <font class="comment"></font>
00019 <font class="comment">You should have received a copy of the GNU General Public License along with</font>
00020 <font class="comment">this program; if not, write to the Free Software Foundation, Inc., 59 Temple</font>
00021 <font class="comment">Place - Suite 330, Boston, MA 02111-1307, USA, or go to</font>
00022 <font class="comment">http://www.gnu.org/copyleft/gpl.html.</font>
00023 <font class="comment">-----------------------------------------------------------------------------</font>
00024 <font class="comment">*/</font>
00025 <font class="preprocessor">#include "<a class="code" href="OgreMeshManager_8h.html">OgreMeshManager.h</a>"</font>
00026 
00027 <font class="preprocessor">#include "<a class="code" href="OgreMesh_8h.html">OgreMesh.h</a>"</font>
00028 <font class="preprocessor">#include "<a class="code" href="OgreSubMesh_8h.html">OgreSubMesh.h</a>"</font>
00029 <font class="preprocessor">#include "<a class="code" href="OgreMatrix4_8h.html">OgreMatrix4.h</a>"</font>
00030 <font class="preprocessor">#include "<a class="code" href="OgreMatrix3_8h.html">OgreMatrix3.h</a>"</font>
00031 <font class="preprocessor">#include "<a class="code" href="OgreVector3_8h.html">OgreVector3.h</a>"</font>
00032 <font class="preprocessor">#include "<a class="code" href="OgrePlane_8h.html">OgrePlane.h</a>"</font>
00033 
00034 <font class="keyword">namespace </font>Ogre
00035 {
00036     <font class="comment">//-----------------------------------------------------------------------</font>
<a name="l00037"></a><a class="code" href="classOgre_1_1Singleton.html#Ogre_1_1Singletonq0">00037</a>     <font class="keyword">template</font>&lt;&gt; <a class="code" href="classOgre_1_1MeshManager.html">MeshManager</a>* <a class="code" href="classOgre_1_1Singleton.html">Singleton&lt;MeshManager&gt;</a>::ms_Singleton = 0;
00038     <font class="comment">//-----------------------------------------------------------------------</font>
<a name="l00039"></a><a class="code" href="classOgre_1_1MeshManager.html#Ogre_1_1MeshManagera0">00039</a>     MeshManager::MeshManager()
00040     {
00041         <font class="comment">// Create prefab objects</font>
00042         <font class="comment">// PLANE</font>
00043         <a class="code" href="classOgre_1_1Mesh.html">Mesh</a>* msh = (<a class="code" href="classOgre_1_1Mesh.html">Mesh</a>*)<a class="code" href="classOgre_1_1MeshManager.html#Ogre_1_1MeshManagera2">create</a>(<font class="stringliteral">"Prefab_Plane"</font>);
00044         <a class="code" href="classOgre_1_1SubMesh.html">SubMesh</a>* sub = msh-&gt;<a class="code" href="classOgre_1_1Mesh.html#Ogre_1_1Mesha4">createSubMesh</a>();
00045         <a class="code" href="namespaceOgre.html#a281">Real</a> vertices[12] = {-100, -100, 0,
00046                               100, -100, 0,
00047                               100,  100, 0,
00048                              -100,  100, 0 };
00049         <a class="code" href="namespaceOgre.html#a281">Real</a> normals[12] = {0,0,1,
00050                             0,0,1,
00051                             0,0,1,
00052                             0,0,1,};
00053         <a class="code" href="namespaceOgre.html#a281">Real</a> texCoords[8] = {0,0,
00054                              1,0,
00055                              1,1,
00056                              0,1 };
00057         msh-&gt;<a class="code" href="classOgre_1_1Mesh.html#Ogre_1_1Meshm0">sharedGeometry</a>.<a class="code" href="structOgre_1_1GeometryData.html#Ogre_1_1GeometryDatam4">hasColours</a> = <font class="keyword">false</font>;
00058         msh-&gt;<a class="code" href="classOgre_1_1Mesh.html#Ogre_1_1Meshm0">sharedGeometry</a>.<a class="code" href="structOgre_1_1GeometryData.html#Ogre_1_1GeometryDatam1">hasNormals</a> = <font class="keyword">true</font>;
00059         msh-&gt;<a class="code" href="classOgre_1_1Mesh.html#Ogre_1_1Meshm0">sharedGeometry</a>.<a class="code" href="structOgre_1_1GeometryData.html#Ogre_1_1GeometryDatam2">numTexCoords</a> = 1;
00060         msh-&gt;<a class="code" href="classOgre_1_1Mesh.html#Ogre_1_1Meshm0">sharedGeometry</a>.<a class="code" href="structOgre_1_1GeometryData.html#Ogre_1_1GeometryDatam3">numTexCoordDimensions</a>[0] = 2;
00061         msh-&gt;<a class="code" href="classOgre_1_1Mesh.html#Ogre_1_1Meshm0">sharedGeometry</a>.<a class="code" href="structOgre_1_1GeometryData.html#Ogre_1_1GeometryDatam0">numVertices</a> = 4;
00062         msh-&gt;<a class="code" href="classOgre_1_1Mesh.html#Ogre_1_1Meshm0">sharedGeometry</a>.<a class="code" href="structOgre_1_1GeometryData.html#Ogre_1_1GeometryDatam5">pVertices</a> = <font class="keyword">new</font> <a class="code" href="namespaceOgre.html#a281">Real</a>[12];
00063         memcpy(msh-&gt;<a class="code" href="classOgre_1_1Mesh.html#Ogre_1_1Meshm0">sharedGeometry</a>.<a class="code" href="structOgre_1_1GeometryData.html#Ogre_1_1GeometryDatam5">pVertices</a>, vertices, <font class="keyword">sizeof</font>(<a class="code" href="namespaceOgre.html#a281">Real</a>)*12);
00064         msh-&gt;<a class="code" href="classOgre_1_1Mesh.html#Ogre_1_1Meshm0">sharedGeometry</a>.<a class="code" href="structOgre_1_1GeometryData.html#Ogre_1_1GeometryDatam7">pNormals</a> = <font class="keyword">new</font> <a class="code" href="namespaceOgre.html#a281">Real</a>[12];
00065         memcpy(msh-&gt;<a class="code" href="classOgre_1_1Mesh.html#Ogre_1_1Meshm0">sharedGeometry</a>.<a class="code" href="structOgre_1_1GeometryData.html#Ogre_1_1GeometryDatam7">pNormals</a>, normals, <font class="keyword">sizeof</font>(<a class="code" href="namespaceOgre.html#a281">Real</a>)*12);
00066         msh-&gt;<a class="code" href="classOgre_1_1Mesh.html#Ogre_1_1Meshm0">sharedGeometry</a>.<a class="code" href="structOgre_1_1GeometryData.html#Ogre_1_1GeometryDatam6">pTexCoords</a>[0] = <font class="keyword">new</font> <a class="code" href="namespaceOgre.html#a281">Real</a>[8];
00067         memcpy(msh-&gt;<a class="code" href="classOgre_1_1Mesh.html#Ogre_1_1Meshm0">sharedGeometry</a>.<a class="code" href="structOgre_1_1GeometryData.html#Ogre_1_1GeometryDatam6">pTexCoords</a>[0], texCoords, <font class="keyword">sizeof</font>(<a class="code" href="namespaceOgre.html#a281">Real</a>)*8);
00068 
00069         sub-&gt;<a class="code" href="classOgre_1_1SubMesh.html#Ogre_1_1SubMeshm0">useSharedVertices</a> = <font class="keyword">true</font>;
00070         sub-&gt;<a class="code" href="classOgre_1_1SubMesh.html#Ogre_1_1SubMeshm4">faceVertexIndices</a> = <font class="keyword">new</font> <font class="keywordtype">unsigned</font> <font class="keywordtype">short</font>[6];
00071         <font class="keywordtype">unsigned</font> <font class="keywordtype">short</font> faces[6] = {0,1,2,
00072                                    0,2,3 };
00073         memcpy(sub-&gt;<a class="code" href="classOgre_1_1SubMesh.html#Ogre_1_1SubMeshm4">faceVertexIndices</a>, faces, <font class="keyword">sizeof</font>(<font class="keywordtype">unsigned</font> <font class="keywordtype">short</font>)*6);
00074         sub-&gt;<a class="code" href="classOgre_1_1SubMesh.html#Ogre_1_1SubMeshm3">numFaces</a> = 2;
00075 
00076         <a class="code" href="classOgre_1_1ResourceManager.html#Ogre_1_1TextureManagern3">mResources</a>[msh-&gt;<a class="code" href="classOgre_1_1Resource.html#Ogre_1_1Zipa26">getName</a>()] = msh;
00077 
00078 
00079         <font class="comment">// Splash screen</font>
00080         msh = (<a class="code" href="classOgre_1_1Mesh.html">Mesh</a>*)<a class="code" href="classOgre_1_1MeshManager.html#Ogre_1_1MeshManagera2">create</a>(<font class="stringliteral">"Prefab_Splash_Screen"</font>);
00081         sub = msh-&gt;<a class="code" href="classOgre_1_1Mesh.html#Ogre_1_1Mesha4">createSubMesh</a>();
00082         <a class="code" href="namespaceOgre.html#a281">Real</a> vertices2[12] = {-1, -1, 0,
00083                               1, -1, 0,
00084                               1,  1, 0,
00085                              -1,  1, 0 };
00086         <a class="code" href="namespaceOgre.html#a281">Real</a> normals2[12] = {0,0,1,
00087                             0,0,1,
00088                             0,0,1,
00089                             0,0,1,};
00090         <a class="code" href="namespaceOgre.html#a281">Real</a> texCoords2[8] = {0,0,
00091                              1,0,
00092                              1,1,
00093                              0,1 };
00094         msh-&gt;<a class="code" href="classOgre_1_1Mesh.html#Ogre_1_1Meshm0">sharedGeometry</a>.<a class="code" href="structOgre_1_1GeometryData.html#Ogre_1_1GeometryDatam4">hasColours</a> = <font class="keyword">false</font>;
00095         msh-&gt;<a class="code" href="classOgre_1_1Mesh.html#Ogre_1_1Meshm0">sharedGeometry</a>.<a class="code" href="structOgre_1_1GeometryData.html#Ogre_1_1GeometryDatam1">hasNormals</a> = <font class="keyword">true</font>;
00096         msh-&gt;<a class="code" href="classOgre_1_1Mesh.html#Ogre_1_1Meshm0">sharedGeometry</a>.<a class="code" href="structOgre_1_1GeometryData.html#Ogre_1_1GeometryDatam2">numTexCoords</a> = 1;
00097         msh-&gt;<a class="code" href="classOgre_1_1Mesh.html#Ogre_1_1Meshm0">sharedGeometry</a>.<a class="code" href="structOgre_1_1GeometryData.html#Ogre_1_1GeometryDatam3">numTexCoordDimensions</a>[0] = 2;
00098         msh-&gt;<a class="code" href="classOgre_1_1Mesh.html#Ogre_1_1Meshm0">sharedGeometry</a>.<a class="code" href="structOgre_1_1GeometryData.html#Ogre_1_1GeometryDatam0">numVertices</a> = 4;
00099         msh-&gt;<a class="code" href="classOgre_1_1Mesh.html#Ogre_1_1Meshm0">sharedGeometry</a>.<a class="code" href="structOgre_1_1GeometryData.html#Ogre_1_1GeometryDatam5">pVertices</a> = <font class="keyword">new</font> <a class="code" href="namespaceOgre.html#a281">Real</a>[12];
00100         memcpy(msh-&gt;<a class="code" href="classOgre_1_1Mesh.html#Ogre_1_1Meshm0">sharedGeometry</a>.<a class="code" href="structOgre_1_1GeometryData.html#Ogre_1_1GeometryDatam5">pVertices</a>, vertices2, <font class="keyword">sizeof</font>(<a class="code" href="namespaceOgre.html#a281">Real</a>)*12);
00101         msh-&gt;<a class="code" href="classOgre_1_1Mesh.html#Ogre_1_1Meshm0">sharedGeometry</a>.<a class="code" href="structOgre_1_1GeometryData.html#Ogre_1_1GeometryDatam7">pNormals</a> = <font class="keyword">new</font> <a class="code" href="namespaceOgre.html#a281">Real</a>[12];
00102         memcpy(msh-&gt;<a class="code" href="classOgre_1_1Mesh.html#Ogre_1_1Meshm0">sharedGeometry</a>.<a class="code" href="structOgre_1_1GeometryData.html#Ogre_1_1GeometryDatam7">pNormals</a>, normals2, <font class="keyword">sizeof</font>(<a class="code" href="namespaceOgre.html#a281">Real</a>)*12);
00103         msh-&gt;<a class="code" href="classOgre_1_1Mesh.html#Ogre_1_1Meshm0">sharedGeometry</a>.<a class="code" href="structOgre_1_1GeometryData.html#Ogre_1_1GeometryDatam6">pTexCoords</a>[0] = <font class="keyword">new</font> <a class="code" href="namespaceOgre.html#a281">Real</a>[8];
00104         memcpy(msh-&gt;<a class="code" href="classOgre_1_1Mesh.html#Ogre_1_1Meshm0">sharedGeometry</a>.<a class="code" href="structOgre_1_1GeometryData.html#Ogre_1_1GeometryDatam6">pTexCoords</a>[0], texCoords2, <font class="keyword">sizeof</font>(<a class="code" href="namespaceOgre.html#a281">Real</a>)*8);
00105 
00106         sub-&gt;<a class="code" href="classOgre_1_1SubMesh.html#Ogre_1_1SubMeshm0">useSharedVertices</a> = <font class="keyword">true</font>;
00107         sub-&gt;<a class="code" href="classOgre_1_1SubMesh.html#Ogre_1_1SubMeshm4">faceVertexIndices</a> = <font class="keyword">new</font> <font class="keywordtype">unsigned</font> <font class="keywordtype">short</font>[6];
00108         <font class="keywordtype">unsigned</font> <font class="keywordtype">short</font> faces2[6] = {0,1,2,
00109                                    0,2,3 };
00110         memcpy(sub-&gt;<a class="code" href="classOgre_1_1SubMesh.html#Ogre_1_1SubMeshm4">faceVertexIndices</a>, faces2, <font class="keyword">sizeof</font>(<font class="keywordtype">unsigned</font> <font class="keywordtype">short</font>)*6);
00111         sub-&gt;<a class="code" href="classOgre_1_1SubMesh.html#Ogre_1_1SubMeshm3">numFaces</a> = 2;
00112 
00113         <a class="code" href="classOgre_1_1ResourceManager.html#Ogre_1_1TextureManagern3">mResources</a>[msh-&gt;<a class="code" href="classOgre_1_1Resource.html#Ogre_1_1Zipa26">getName</a>()] = msh;
00114 
00115 
00116 
00117     }
00118     <font class="comment">//-----------------------------------------------------------------------</font>
<a name="l00119"></a><a class="code" href="classOgre_1_1MeshManager.html#Ogre_1_1MeshManagera2">00119</a>     <a class="code" href="classOgre_1_1Resource.html">Resource</a>* MeshManager::create( <font class="keyword">const</font> <a class="code" href="classOgre_1_1String.html">String</a>&amp; name)
00120     {
00121         <font class="keywordflow">return</font> <font class="keyword">new</font> <a class="code" href="classOgre_1_1Mesh.html">Mesh</a>(name);
00122     }
00123     <font class="comment">//-----------------------------------------------------------------------</font>
<a name="l00124"></a><a class="code" href="classOgre_1_1MeshManager.html#Ogre_1_1MeshManagera1">00124</a>     <a class="code" href="classOgre_1_1Mesh.html">Mesh</a>* MeshManager::load( <font class="keyword">const</font> <a class="code" href="classOgre_1_1String.html">String</a>&amp; filename, <font class="keywordtype">int</font> priority)
00125     {
00126         <a class="code" href="classOgre_1_1Mesh.html">Mesh</a>* pMesh = (<a class="code" href="classOgre_1_1Mesh.html">Mesh</a>*)(<a class="code" href="classOgre_1_1ResourceManager.html#Ogre_1_1TextureManagera13">getByName</a>(filename));
00127         <font class="keywordflow">if</font> (!pMesh)
00128         {
00129             pMesh = (<a class="code" href="classOgre_1_1Mesh.html">Mesh</a>*)<a class="code" href="classOgre_1_1MeshManager.html#Ogre_1_1MeshManagera2">create</a>(filename);
00130             ResourceManager::load(pMesh, priority);
00131             <font class="comment">//pMesh-&gt;_registerMaterials();</font>
00132         }
00133         <font class="keywordflow">return</font> pMesh;
00134 
00135     }
00136     <font class="comment">//-----------------------------------------------------------------------</font>
<a name="l00137"></a><a class="code" href="classOgre_1_1MeshManager.html#Ogre_1_1MeshManagera3">00137</a>     <a class="code" href="classOgre_1_1Mesh.html">Mesh</a>* MeshManager::createManual( <font class="keyword">const</font> <a class="code" href="classOgre_1_1String.html">String</a>&amp; name)
00138     {
00139         <a class="code" href="classOgre_1_1Mesh.html">Mesh</a>* pMesh = (<a class="code" href="classOgre_1_1Mesh.html">Mesh</a>*)(<a class="code" href="classOgre_1_1ResourceManager.html#Ogre_1_1TextureManagera13">getByName</a>(name));
00140         <font class="keywordflow">if</font> (!pMesh)
00141         {
00142             pMesh = (<a class="code" href="classOgre_1_1Mesh.html">Mesh</a>*)<a class="code" href="classOgre_1_1MeshManager.html#Ogre_1_1MeshManagera2">create</a>(name);
00143             pMesh-&gt;<a class="code" href="classOgre_1_1Mesh.html#Ogre_1_1Mesha7">setManuallyDefined</a>(<font class="keyword">true</font>);
00144             ResourceManager::load(pMesh,0);
00145         }
00146 
00147         <font class="keywordflow">return</font> pMesh;
00148     }
00149     <font class="comment">//-----------------------------------------------------------------------</font>
<a name="l00150"></a><a class="code" href="classOgre_1_1MeshManager.html#Ogre_1_1MeshManagera4">00150</a>     <a class="code" href="classOgre_1_1Mesh.html">Mesh</a>* MeshManager::createPlane( <font class="keyword">const</font> <a class="code" href="classOgre_1_1String.html">String</a>&amp; name, <font class="keyword">const</font> <a class="code" href="classOgre_1_1Plane.html">Plane</a>&amp; plane, <a class="code" href="namespaceOgre.html#a281">Real</a> width, <a class="code" href="namespaceOgre.html#a281">Real</a> height, <font class="keywordtype">int</font> xsegments, <font class="keywordtype">int</font> ysegments,
00151         <font class="keywordtype">bool</font> normals, <font class="keywordtype">int</font> numTexCoordSets, <a class="code" href="namespaceOgre.html#a281">Real</a> xTile, <a class="code" href="namespaceOgre.html#a281">Real</a> yTile, <font class="keyword">const</font> <a class="code" href="classOgre_1_1Vector3.html">Vector3</a>&amp; upVector)
00152     {
00153         <font class="keywordtype">int</font> i;
00154         <a class="code" href="classOgre_1_1Mesh.html">Mesh</a>* pMesh = <a class="code" href="classOgre_1_1MeshManager.html#Ogre_1_1MeshManagera3">createManual</a>(name);
00155         <a class="code" href="classOgre_1_1SubMesh.html">SubMesh</a> *pSub = pMesh-&gt;<a class="code" href="classOgre_1_1Mesh.html#Ogre_1_1Mesha4">createSubMesh</a>();
00156 
00157         <font class="comment">// Set options</font>
00158         pMesh-&gt;<a class="code" href="classOgre_1_1Mesh.html#Ogre_1_1Meshm0">sharedGeometry</a>.<a class="code" href="structOgre_1_1GeometryData.html#Ogre_1_1GeometryDatam4">hasColours</a> = <font class="keyword">false</font>;
00159         pMesh-&gt;<a class="code" href="classOgre_1_1Mesh.html#Ogre_1_1Meshm0">sharedGeometry</a>.<a class="code" href="structOgre_1_1GeometryData.html#Ogre_1_1GeometryDatam1">hasNormals</a> = normals;
00160         pMesh-&gt;<a class="code" href="classOgre_1_1Mesh.html#Ogre_1_1Meshm0">sharedGeometry</a>.<a class="code" href="structOgre_1_1GeometryData.html#Ogre_1_1GeometryDatam10">normalStride</a> = 0;
00161         pMesh-&gt;<a class="code" href="classOgre_1_1Mesh.html#Ogre_1_1Meshm0">sharedGeometry</a>.<a class="code" href="structOgre_1_1GeometryData.html#Ogre_1_1GeometryDatam2">numTexCoords</a> = numTexCoordSets;
00162         <font class="keywordflow">for</font> (i = 0; i &lt; numTexCoordSets; ++i)
00163         {
00164             pMesh-&gt;<a class="code" href="classOgre_1_1Mesh.html#Ogre_1_1Meshm0">sharedGeometry</a>.<a class="code" href="structOgre_1_1GeometryData.html#Ogre_1_1GeometryDatam3">numTexCoordDimensions</a>[i] = 2;
00165             pMesh-&gt;<a class="code" href="classOgre_1_1Mesh.html#Ogre_1_1Meshm0">sharedGeometry</a>.<a class="code" href="structOgre_1_1GeometryData.html#Ogre_1_1GeometryDatam11">texCoordStride</a>[i] = 0;
00166         }
00167         pMesh-&gt;<a class="code" href="classOgre_1_1Mesh.html#Ogre_1_1Meshm0">sharedGeometry</a>.<a class="code" href="structOgre_1_1GeometryData.html#Ogre_1_1GeometryDatam0">numVertices</a> = (xsegments + 1) * (ysegments + 1);
00168         pMesh-&gt;<a class="code" href="classOgre_1_1Mesh.html#Ogre_1_1Meshm0">sharedGeometry</a>.<a class="code" href="structOgre_1_1GeometryData.html#Ogre_1_1GeometryDatam9">vertexStride</a> = 0;
00169 
00170         <font class="comment">// Allocate memory</font>
00171         pMesh-&gt;<a class="code" href="classOgre_1_1Mesh.html#Ogre_1_1Meshm0">sharedGeometry</a>.<a class="code" href="structOgre_1_1GeometryData.html#Ogre_1_1GeometryDatam5">pVertices</a> = <font class="keyword">new</font> <a class="code" href="namespaceOgre.html#a281">Real</a>[pMesh-&gt;<a class="code" href="classOgre_1_1Mesh.html#Ogre_1_1Meshm0">sharedGeometry</a>.<a class="code" href="structOgre_1_1GeometryData.html#Ogre_1_1GeometryDatam0">numVertices</a> * 3];
00172         <font class="keywordflow">if</font> (normals)
00173             pMesh-&gt;<a class="code" href="classOgre_1_1Mesh.html#Ogre_1_1Meshm0">sharedGeometry</a>.<a class="code" href="structOgre_1_1GeometryData.html#Ogre_1_1GeometryDatam7">pNormals</a> = <font class="keyword">new</font> <a class="code" href="namespaceOgre.html#a281">Real</a>[pMesh-&gt;<a class="code" href="classOgre_1_1Mesh.html#Ogre_1_1Meshm0">sharedGeometry</a>.<a class="code" href="structOgre_1_1GeometryData.html#Ogre_1_1GeometryDatam0">numVertices</a> * 3];
00174         <font class="keywordflow">for</font> (i = 0; i &lt; numTexCoordSets; ++i)
00175             pMesh-&gt;<a class="code" href="classOgre_1_1Mesh.html#Ogre_1_1Meshm0">sharedGeometry</a>.<a class="code" href="structOgre_1_1GeometryData.html#Ogre_1_1GeometryDatam6">pTexCoords</a>[i] = <font class="keyword">new</font> <a class="code" href="namespaceOgre.html#a281">Real</a>[pMesh-&gt;<a class="code" href="classOgre_1_1Mesh.html#Ogre_1_1Meshm0">sharedGeometry</a>.<a class="code" href="structOgre_1_1GeometryData.html#Ogre_1_1GeometryDatam0">numVertices</a> * 2];
00176 
00177         <font class="comment">// Work out the transform required</font>
00178         <font class="comment">// Default orientation of plane is normal along +z, distance 0</font>
00179         <a class="code" href="classOgre_1_1Matrix4.html">Matrix4</a> xlate, xform, rot;
00180         <a class="code" href="classOgre_1_1Matrix3.html">Matrix3</a> rot3;
00181         xlate = rot = Matrix4::IDENTITY;
00182         <font class="comment">// Determine axes</font>
00183         <a class="code" href="classOgre_1_1Vector3.html">Vector3</a> zAxis, yAxis, xAxis;
00184         zAxis = plane.<a class="code" href="classOgre_1_1Plane.html#Ogre_1_1Planem0">normal</a>;
00185         zAxis.<a class="code" href="classOgre_1_1Vector3.html#Ogre_1_1Vector3a24">normalise</a>();
00186         yAxis = upVector;
00187         yAxis.<a class="code" href="classOgre_1_1Vector3.html#Ogre_1_1Vector3a24">normalise</a>();
00188         xAxis = yAxis.<a class="code" href="classOgre_1_1Vector3.html#Ogre_1_1Vector3a25">crossProduct</a>(zAxis);
00189         <font class="keywordflow">if</font> (xAxis.<a class="code" href="classOgre_1_1Vector3.html#Ogre_1_1Vector3a21">length</a>() == 0)
00190         {
00191             <font class="comment">//upVector must be wrong</font>
00192             <a class="code" href="OgreException_8h.html#a0">Except</a>(Exception::ERR_INVALIDPARAMS, <font class="stringliteral">"The upVector you supplied is parallel to the plane normal, so is not valid."</font>,
00193                 <font class="stringliteral">"MeshManager::createPlane"</font>);
00194         }
00195 
00196         rot3.<a class="code" href="classOgre_1_1Matrix3.html#Ogre_1_1Matrix3a8">FromAxes</a>(xAxis, yAxis, zAxis);
00197         rot = rot3;
00198 
00199         <font class="comment">// Set up standard xform from origin</font>
00200         xlate.<a class="code" href="classOgre_1_1Matrix4.html#Ogre_1_1Matrix4a13">setTrans</a>(plane.<a class="code" href="classOgre_1_1Plane.html#Ogre_1_1Planem0">normal</a> * -plane.<a class="code" href="classOgre_1_1Plane.html#Ogre_1_1Planem1">d</a>);
00201 
00202         <font class="comment">// concatenate</font>
00203         xform = xlate * rot;
00204 
00205         <font class="comment">// Generate vertex data</font>
00206         <a class="code" href="namespaceOgre.html#a281">Real</a>* pReal;
00207         <a class="code" href="namespaceOgre.html#a281">Real</a> xSpace = width / xsegments;
00208         <a class="code" href="namespaceOgre.html#a281">Real</a> ySpace = height / ysegments;
00209         <a class="code" href="namespaceOgre.html#a281">Real</a> halfWidth = width / 2;
00210         <a class="code" href="namespaceOgre.html#a281">Real</a> halfHeight = height / 2;
00211         <a class="code" href="namespaceOgre.html#a281">Real</a> xTex = (1.0f * xTile) / xsegments;
00212         <a class="code" href="namespaceOgre.html#a281">Real</a> yTex = (1.0f * yTile) / ysegments;
00213         <a class="code" href="classOgre_1_1Vector3.html">Vector3</a> vec;
00214 
00215         <font class="keywordflow">for</font> (<font class="keywordtype">int</font> y = 0; y &lt; ysegments + 1; ++y)
00216         {
00217             <font class="keywordflow">for</font> (<font class="keywordtype">int</font> x = 0; x &lt; xsegments + 1; ++x)
00218             {
00219                 pReal = pMesh-&gt;<a class="code" href="classOgre_1_1Mesh.html#Ogre_1_1Meshm0">sharedGeometry</a>.<a class="code" href="structOgre_1_1GeometryData.html#Ogre_1_1GeometryDatam5">pVertices</a> + (((y * (xsegments+1)) + x) * 3);
00220                 <font class="comment">// Work out centered on origin</font>
00221                 vec.<a class="code" href="classOgre_1_1Vector3.html#Ogre_1_1Vector3m0">x</a> = (x * xSpace) - halfWidth;
00222                 vec.<a class="code" href="classOgre_1_1Vector3.html#Ogre_1_1Vector3m1">y</a> = (y * ySpace) - halfHeight;
00223                 vec.<a class="code" href="classOgre_1_1Vector3.html#Ogre_1_1Vector3m2">z</a> = 0.0f;
00224                 <font class="comment">// Transform by orientation and distance</font>
00225                 vec = xform * vec;
00226                 <font class="comment">// Assign to geometry</font>
00227                 pReal[0] = vec.<a class="code" href="classOgre_1_1Vector3.html#Ogre_1_1Vector3m0">x</a>;
00228                 pReal[1] = vec.<a class="code" href="classOgre_1_1Vector3.html#Ogre_1_1Vector3m1">y</a>;
00229                 pReal[2] = vec.<a class="code" href="classOgre_1_1Vector3.html#Ogre_1_1Vector3m2">z</a>;
00230 
00231                 <font class="keywordflow">if</font> (normals)
00232                 {
00233                     pReal = pMesh-&gt;<a class="code" href="classOgre_1_1Mesh.html#Ogre_1_1Meshm0">sharedGeometry</a>.<a class="code" href="structOgre_1_1GeometryData.html#Ogre_1_1GeometryDatam7">pNormals</a> + (((y * (xsegments+1)) + x) * 3);
00234                     <font class="comment">// Default normal is along unit Z</font>
00235                     vec = Vector3::UNIT_Z;
00236                     <font class="comment">// Rotate</font>
00237                     vec = rot * vec;
00238 
00239                     pReal[0] = vec.<a class="code" href="classOgre_1_1Vector3.html#Ogre_1_1Vector3m0">x</a>;
00240                     pReal[1] = vec.<a class="code" href="classOgre_1_1Vector3.html#Ogre_1_1Vector3m1">y</a>;
00241                     pReal[2] = vec.<a class="code" href="classOgre_1_1Vector3.html#Ogre_1_1Vector3m2">z</a>;
00242                 }
00243 
00244                 <font class="keywordflow">for</font> (i = 0; i &lt; numTexCoordSets; ++i)
00245                 {
00246                     pReal = pMesh-&gt;<a class="code" href="classOgre_1_1Mesh.html#Ogre_1_1Meshm0">sharedGeometry</a>.<a class="code" href="structOgre_1_1GeometryData.html#Ogre_1_1GeometryDatam6">pTexCoords</a>[i] + (((y * (xsegments+1)) + x) * 2);
00247                     pReal[0] = x * xTex;
00248                     pReal[1] = y * yTex;
00249                 }
00250 
00251             } <font class="comment">// x</font>
00252         } <font class="comment">// y</font>
00253 
00254         <font class="comment">// Generate face list</font>
00255         <a class="code" href="classOgre_1_1MeshManager.html#Ogre_1_1MeshManagerb0">tesselate2DMesh</a>(pSub, xsegments + 1, ysegments + 1, <font class="keyword">false</font>);
00256 
00257         pMesh-&gt;<a class="code" href="classOgre_1_1Mesh.html#Ogre_1_1Mesha12">_updateBounds</a>();
00258 
00259         <font class="keywordflow">return</font> pMesh;
00260 
00261 
00262 
00263     }
00264     <font class="comment">//-----------------------------------------------------------------------</font>
<a name="l00265"></a><a class="code" href="classOgre_1_1MeshManager.html#Ogre_1_1MeshManagerb0">00265</a>     <font class="keywordtype">void</font> MeshManager::tesselate2DMesh(<a class="code" href="classOgre_1_1SubMesh.html">SubMesh</a>* sm, <font class="keywordtype">int</font> meshWidth, <font class="keywordtype">int</font> meshHeight, <font class="keywordtype">bool</font> doubleSided)
00266     {
00267         <font class="comment">// The mesh is built, just make a list of indexes to spit out the triangles</font>
00268         <font class="keywordtype">int</font> vInc, uInc, v, u, iterations;
00269         <font class="keywordtype">int</font> vCount, uCount;
00270 
00271         <font class="keywordflow">if</font> (doubleSided)
00272         {
00273             iterations = 2;
00274             vInc = 1;
00275             v = 0; <font class="comment">// Start with front</font>
00276         }
00277         <font class="keywordflow">else</font>
00278         {
00279             iterations = 1;
00280             vInc = 1;
00281             v = 0;
00282         }
00283 
00284         <font class="comment">// Allocate memory for faces</font>
00285         <font class="comment">// Num faces, width*height*2 (2 tris per square)</font>
00286         sm-&gt;<a class="code" href="classOgre_1_1SubMesh.html#Ogre_1_1SubMeshm3">numFaces</a> = (meshWidth-1) * (meshHeight-1) * 2 * iterations;
00287         sm-&gt;<a class="code" href="classOgre_1_1SubMesh.html#Ogre_1_1SubMeshm4">faceVertexIndices</a> = <font class="keyword">new</font> <font class="keywordtype">unsigned</font> <font class="keywordtype">short</font>[sm-&gt;<a class="code" href="classOgre_1_1SubMesh.html#Ogre_1_1SubMeshm3">numFaces</a> * 3];
00288 
00289         <font class="keywordtype">int</font> v1, v2, v3;
00290         <font class="comment">//bool firstTri = true;</font>
00291         <font class="keywordtype">unsigned</font> <font class="keywordtype">short</font>* pIndexes = sm-&gt;<a class="code" href="classOgre_1_1SubMesh.html#Ogre_1_1SubMeshm4">faceVertexIndices</a>;
00292 
00293         <font class="keywordflow">while</font> (iterations--)
00294         {
00295             <font class="comment">// Make tris in a zigzag pattern (compatible with strips)</font>
00296             u = 0;
00297             uInc = 1; <font class="comment">// Start with moving +u</font>
00298 
00299             vCount = meshHeight - 1;
00300             <font class="keywordflow">while</font> (vCount--)
00301             {
00302                 uCount = meshWidth - 1;
00303                 <font class="keywordflow">while</font> (uCount--)
00304                 {
00305                     <font class="comment">// First Tri in cell</font>
00306                     <font class="comment">// -----------------</font>
00307                     v1 = ((v + vInc) * meshWidth) + u;
00308                     v2 = (v * meshWidth) + u;
00309                     v3 = ((v + vInc) * meshWidth) + (u + uInc);
00310                     <font class="comment">// Output indexes</font>
00311                     *pIndexes++ = v1;
00312                     *pIndexes++ = v2;
00313                     *pIndexes++ = v3;
00314                     <font class="comment">// Second Tri in cell</font>
00315                     <font class="comment">// ------------------</font>
00316                     v1 = ((v + vInc) * meshWidth) + (u + uInc);
00317                     v2 = (v * meshWidth) + u;
00318                     v3 = (v * meshWidth) + (u + uInc);
00319                     <font class="comment">// Output indexes</font>
00320                     *pIndexes++ = v1;
00321                     *pIndexes++ = v2;
00322                     *pIndexes++ = v3;
00323 
00324                     <font class="comment">// Next column</font>
00325                     u += uInc;
00326                 }
00327                 <font class="comment">// Next row</font>
00328                 v += vInc;
00329                 u = 0;
00330 
00331 
00332             }
00333 
00334             <font class="comment">// Reverse vInc for double sided</font>
00335             v = meshHeight - 1;
00336             vInc = -vInc;
00337 
00338         }
00339 
00340     }
00341 
00342     <font class="comment">//-----------------------------------------------------------------------</font>
<a name="l00343"></a><a class="code" href="classOgre_1_1MeshManager.html#Ogre_1_1MeshManagerd0">00343</a>     <a class="code" href="classOgre_1_1MeshManager.html">MeshManager</a>&amp; MeshManager::getSingleton(<font class="keywordtype">void</font>)
00344     {
00345         <font class="keywordflow">return</font> <a class="code" href="classOgre_1_1Singleton.html">Singleton&lt;MeshManager&gt;::getSingleton</a>();
00346     }
00347 
00348 
00349 
00350 }
</pre></div><p>
Copyright &copy; 2002 by The OGRE Team<br />
<script type="text/javascript">
<!--//hide script from old browsers
document.write( "Last modified "+ document.lastModified );
//end hiding contents -->
</script>
</p>
</body>
</html>
