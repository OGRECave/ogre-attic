<html>
<head>
<title>OGRE Documentation</title> <meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1"> 
<link type="text/css" rel="stylesheet" href="style.css">
</head>

<body>
<!-- Generated by Doxygen 1.2.16 -->
<center>
<a class="qindex" href="index.html">Main Page</a> &nbsp; <a class="qindex" href="namespaces.html">Namespace List</a> &nbsp; <a class="qindex" href="hierarchy.html">Class Hierarchy</a> &nbsp; <a class="qindex" href="classes.html">Alphabetical List</a> &nbsp; <a class="qindex" href="annotated.html">Compound List</a> &nbsp; <a class="qindex" href="files.html">File List</a> &nbsp; <a class="qindex" href="namespacemembers.html">Namespace Members</a> &nbsp; <a class="qindex" href="functions.html">Compound Members</a> &nbsp; <a class="qindex" href="globals.html">File Members</a> &nbsp; <a class="qindex" href="pages.html">Related Pages</a> &nbsp; </center>
<hr><h1>OgreParticleSystemManager.cpp</h1><a href="OgreParticleSystemManager_8cpp.html">Go to the documentation of this file.</a><div class="fragment"><pre>00001 <font class="comment">/*</font>
00002 <font class="comment">-----------------------------------------------------------------------------</font>
00003 <font class="comment">This source file is part of OGRE</font>
00004 <font class="comment">    (Object-oriented Graphics Rendering Engine)</font>
00005 <font class="comment">For the latest info, see http://www.stevestreeting.com/ogre/</font>
00006 <font class="comment"></font>
00007 <font class="comment">Copyright © 2000-2002 Steven J. Streeting</font>
00008 <font class="comment">Also see acknowledgements in Readme.html</font>
00009 <font class="comment"></font>
00010 <font class="comment">This program is free software; you can redistribute it and/or modify it under</font>
00011 <font class="comment">the terms of the GNU General Public License as published by the Free Software</font>
00012 <font class="comment">Foundation; either version 2 of the License, or (at your option) any later</font>
00013 <font class="comment">version.</font>
00014 <font class="comment"></font>
00015 <font class="comment">This program is distributed in the hope that it will be useful, but WITHOUT</font>
00016 <font class="comment">ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or FITNESS</font>
00017 <font class="comment">FOR A PARTICULAR PURPOSE. See the GNU General Public License for more details.</font>
00018 <font class="comment"></font>
00019 <font class="comment">You should have received a copy of the GNU General Public License along with</font>
00020 <font class="comment">this program; if not, write to the Free Software Foundation, Inc., 59 Temple</font>
00021 <font class="comment">Place - Suite 330, Boston, MA 02111-1307, USA, or go to</font>
00022 <font class="comment">http://www.gnu.org/copyleft/gpl.html.</font>
00023 <font class="comment">-----------------------------------------------------------------------------</font>
00024 <font class="comment">*/</font>
00025 
00026 <font class="preprocessor">#include "<a class="code" href="OgreParticleSystemManager_8h.html">OgreParticleSystemManager.h</a>"</font>
00027 <font class="preprocessor">#include "<a class="code" href="OgreParticleEmitterFactory_8h.html">OgreParticleEmitterFactory.h</a>"</font>
00028 <font class="preprocessor">#include "<a class="code" href="OgreParticleAffectorFactory_8h.html">OgreParticleAffectorFactory.h</a>"</font>
00029 <font class="preprocessor">#include "<a class="code" href="OgreException_8h.html">OgreException.h</a>"</font>
00030 <font class="preprocessor">#include "<a class="code" href="OgreRoot_8h.html">OgreRoot.h</a>"</font>
00031 <font class="preprocessor">#include "<a class="code" href="OgreLogManager_8h.html">OgreLogManager.h</a>"</font>
00032 <font class="preprocessor">#include "<a class="code" href="OgreString_8h.html">OgreString.h</a>"</font>
00033 
00034 
00035 <font class="keyword">namespace </font>Ogre {
<a name="l00036"></a><a class="code" href="classOgre_1_1Singleton.html#Ogre_1_1Singletonq0">00036</a>     <a class="code" href="classOgre_1_1ParticleSystemManager.html">ParticleSystemManager</a>* <a class="code" href="classOgre_1_1Singleton.html">Singleton&lt;ParticleSystemManager&gt;</a>::ms_Singleton = 0;
00037     <font class="comment">//-----------------------------------------------------------------------</font>
<a name="l00038"></a><a class="code" href="classOgre_1_1ParticleSystemManager.html#Ogre_1_1ParticleSystemManagera0">00038</a>     ParticleSystemManager::ParticleSystemManager()
00039     {
00040     }
00041     <font class="comment">//-----------------------------------------------------------------------</font>
<a name="l00042"></a><a class="code" href="classOgre_1_1ParticleSystemManager.html#Ogre_1_1ParticleSystemManagera1">00042</a>     ParticleSystemManager::~ParticleSystemManager()
00043     {
00044         <font class="comment">// Templates will be destroyed by by-value STL container</font>
00045         <a class="code" href="classOgre_1_1ParticleSystemManager.html#Ogre_1_1ParticleSystemManagern0">mSystemTemplates</a>.clear();
00046         <font class="comment">// Destroy all systems </font>
00047         ParticleSystemMap::iterator i;
00048         <font class="keywordflow">for</font> (i = <a class="code" href="classOgre_1_1ParticleSystemManager.html#Ogre_1_1ParticleSystemManagern1">mSystems</a>.begin(); i != <a class="code" href="classOgre_1_1ParticleSystemManager.html#Ogre_1_1ParticleSystemManagern1">mSystems</a>.end(); ++i)
00049         {
00050             <font class="keyword">delete</font> i-&gt;second;
00051         }
00052         <a class="code" href="classOgre_1_1ParticleSystemManager.html#Ogre_1_1ParticleSystemManagern1">mSystems</a>.clear();
00053     }
00054     <font class="comment">//-----------------------------------------------------------------------</font>
<a name="l00055"></a><a class="code" href="classOgre_1_1ParticleSystemManager.html#Ogre_1_1ParticleSystemManagera19">00055</a>     <font class="keywordtype">void</font> ParticleSystemManager::parseScript(<a class="code" href="classOgre_1_1DataChunk.html">DataChunk</a>&amp; chunk)
00056     {
00057         <a class="code" href="classOgre_1_1String.html">String</a> line;
00058         <a class="code" href="classOgre_1_1ParticleSystem.html">ParticleSystem</a>* pSys;
00059         std::vector&lt;String&gt; vecparams;
00060 
00061         pSys = 0;
00062 
00063         <font class="keywordflow">while</font>(!chunk.<a class="code" href="classOgre_1_1DataChunk.html#Ogre_1_1SDDataChunka12">isEOF</a>())
00064         {
00065             line = chunk.<a class="code" href="classOgre_1_1DataChunk.html#Ogre_1_1SDDataChunka13">getLine</a>();
00066             <font class="comment">// Ignore comments &amp; blanks</font>
00067             <font class="keywordflow">if</font> (!(line.length() == 0 || line.substr(0,2) == <font class="stringliteral">"//"</font>))
00068             {
00069                 <font class="keywordflow">if</font> (pSys == 0)
00070                 {
00071                     <font class="comment">// No current system</font>
00072                     <font class="comment">// So first valid data should be a system name</font>
00073                     pSys = <a class="code" href="classOgre_1_1ParticleSystemManager.html#Ogre_1_1ParticleSystemManagera5">createTemplate</a>(line);
00074                     <font class="comment">// Skip to and over next {</font>
00075                     <a class="code" href="classOgre_1_1ParticleSystemManager.html#Ogre_1_1ParticleSystemManagerb6">skipToNextOpenBrace</a>(chunk);
00076                 }
00077                 <font class="keywordflow">else</font>
00078                 {
00079                     <font class="comment">// Already in a system</font>
00080                     <font class="keywordflow">if</font> (line == <font class="stringliteral">"}"</font>)
00081                     {
00082                         <font class="comment">// Finished system</font>
00083                         pSys = 0;
00084                     }
00085                     <font class="keywordflow">else</font> <font class="keywordflow">if</font> (line.substr(0,7) == <font class="stringliteral">"emitter"</font>)
00086                     {
00087                         <font class="comment">// new emitter</font>
00088                         <font class="comment">// Get typename</font>
00089                         vecparams = line.<a class="code" href="classOgre_1_1String.html#Ogre_1_1Stringa6">split</a>(<font class="stringliteral">"\t "</font>);
00090                         <font class="keywordflow">if</font> (vecparams.size() &lt; 2)
00091                         {
00092                             <font class="comment">// Oops, bad emitter</font>
00093                             LogManager::getSingleton().logMessage(<font class="stringliteral">"Bad particle system emitter line: '"</font>
00094                                 + line + <font class="stringliteral">"' in "</font> + pSys-&gt;<a class="code" href="classOgre_1_1ParticleSystem.html#Ogre_1_1ParticleSystema3">getName</a>());
00095                             <a class="code" href="classOgre_1_1ParticleSystemManager.html#Ogre_1_1ParticleSystemManagerb5">skipToNextCloseBrace</a>(chunk);
00096 
00097                         }
00098                         <a class="code" href="classOgre_1_1ParticleSystemManager.html#Ogre_1_1ParticleSystemManagerb6">skipToNextOpenBrace</a>(chunk);
00099                         <a class="code" href="classOgre_1_1ParticleSystemManager.html#Ogre_1_1ParticleSystemManagerb0">parseNewEmitter</a>(vecparams[1], chunk, pSys);
00100 
00101                     }
00102                     <font class="keywordflow">else</font> <font class="keywordflow">if</font> (line.substr(0,8) == <font class="stringliteral">"affector"</font>)
00103                     {
00104                         <font class="comment">// new affector</font>
00105                         <font class="comment">// Get typename</font>
00106                         vecparams = line.<a class="code" href="classOgre_1_1String.html#Ogre_1_1Stringa6">split</a>(<font class="stringliteral">"\t "</font>);
00107                         <font class="keywordflow">if</font> (vecparams.size() &lt; 2)
00108                         {
00109                             <font class="comment">// Oops, bad emitter</font>
00110                             LogManager::getSingleton().logMessage(<font class="stringliteral">"Bad particle system affector line: '"</font>
00111                                 + line + <font class="stringliteral">"' in "</font> + pSys-&gt;<a class="code" href="classOgre_1_1ParticleSystem.html#Ogre_1_1ParticleSystema3">getName</a>());
00112                             <a class="code" href="classOgre_1_1ParticleSystemManager.html#Ogre_1_1ParticleSystemManagerb5">skipToNextCloseBrace</a>(chunk);
00113 
00114                         }
00115                         <a class="code" href="classOgre_1_1ParticleSystemManager.html#Ogre_1_1ParticleSystemManagerb6">skipToNextOpenBrace</a>(chunk);
00116                         <a class="code" href="classOgre_1_1ParticleSystemManager.html#Ogre_1_1ParticleSystemManagerb1">parseNewAffector</a>(vecparams[1],chunk, pSys);
00117                     }
00118                     <font class="keywordflow">else</font>
00119                     {
00120                         <font class="comment">// Attribute</font>
00121                         <a class="code" href="classOgre_1_1ParticleSystemManager.html#Ogre_1_1ParticleSystemManagerb2">parseAttrib</a>(line, pSys);
00122                     }
00123 
00124                 }
00125 
00126             }
00127 
00128 
00129         }
00130 
00131 
00132     }
00133     <font class="comment">//-----------------------------------------------------------------------</font>
<a name="l00134"></a><a class="code" href="classOgre_1_1ParticleSystemManager.html#Ogre_1_1ParticleSystemManagera20">00134</a>     <font class="keywordtype">void</font> ParticleSystemManager::parseAllSources(<font class="keyword">const</font> <a class="code" href="classOgre_1_1String.html">String</a>&amp; extension)
00135     {
00136         std::set&lt;String&gt; particleFiles;
00137 
00138         particleFiles = ResourceManager::_getAllCommonNamesLike(<font class="stringliteral">"./"</font>, extension);
00139 
00140         <font class="comment">// Iterate through returned files</font>
00141         std::set&lt;String&gt;::iterator i;
00142         <a class="code" href="classOgre_1_1DataChunk.html">DataChunk</a> chunk;
00143         <font class="keywordflow">for</font> (i = particleFiles.begin(); i != particleFiles.end(); ++i)
00144         {
00145             LogManager::getSingleton().logMessage(<font class="stringliteral">"Parsing particle script "</font> + *i);
00146             ResourceManager::_findCommonResourceData(*i, chunk);
00147             <a class="code" href="classOgre_1_1ParticleSystemManager.html#Ogre_1_1ParticleSystemManagera19">parseScript</a>(chunk);
00148         }
00149     }
00150     <font class="comment">//-----------------------------------------------------------------------</font>
<a name="l00151"></a><a class="code" href="classOgre_1_1ParticleSystemManager.html#Ogre_1_1ParticleSystemManagera2">00151</a>     <font class="keywordtype">void</font> ParticleSystemManager::addEmitterFactory(<a class="code" href="classOgre_1_1ParticleEmitterFactory.html">ParticleEmitterFactory</a>* factory)
00152     {
00153         <a class="code" href="classOgre_1_1String.html">String</a> name = factory-&gt;<a class="code" href="classOgre_1_1ParticleEmitterFactory.html#Ogre_1_1ParticleEmitterFactorya2">getName</a>();
00154         <a class="code" href="classOgre_1_1ParticleSystemManager.html#Ogre_1_1ParticleSystemManagern2">mEmitterFactories</a>[name] = factory;
00155         LogManager::getSingleton().logMessage(<font class="stringliteral">"Particle Emitter Type '"</font> + name + <font class="stringliteral">"' registered"</font>);
00156     }
00157     <font class="comment">//-----------------------------------------------------------------------</font>
<a name="l00158"></a><a class="code" href="classOgre_1_1ParticleSystemManager.html#Ogre_1_1ParticleSystemManagera3">00158</a>     <font class="keywordtype">void</font> ParticleSystemManager::addAffectorFactory(<a class="code" href="classOgre_1_1ParticleAffectorFactory.html">ParticleAffectorFactory</a>* factory)
00159     {
00160         <a class="code" href="classOgre_1_1String.html">String</a> name = factory-&gt;<a class="code" href="classOgre_1_1ParticleAffectorFactory.html#Ogre_1_1ParticleAffectorFactorya2">getName</a>();
00161         <a class="code" href="classOgre_1_1ParticleSystemManager.html#Ogre_1_1ParticleSystemManagern3">mAffectorFactories</a>[name] = factory;
00162         LogManager::getSingleton().logMessage(<font class="stringliteral">"Particle Affector Type '"</font> + name + <font class="stringliteral">"' registered"</font>);
00163     }
00164     <font class="comment">//-----------------------------------------------------------------------</font>
<a name="l00165"></a><a class="code" href="classOgre_1_1ParticleSystemManager.html#Ogre_1_1ParticleSystemManagera4">00165</a>     <font class="keywordtype">void</font> ParticleSystemManager::addTemplate(<font class="keyword">const</font> <a class="code" href="classOgre_1_1String.html">String</a>&amp; name, <font class="keyword">const</font> <a class="code" href="classOgre_1_1ParticleSystem.html">ParticleSystem</a>&amp; sysTemplate)
00166     {
00167         <a class="code" href="classOgre_1_1ParticleSystemManager.html#Ogre_1_1ParticleSystemManagern0">mSystemTemplates</a>[name] = sysTemplate;
00168     }
00169     <font class="comment">//-----------------------------------------------------------------------</font>
<a name="l00170"></a><a class="code" href="classOgre_1_1ParticleSystemManager.html#Ogre_1_1ParticleSystemManagera5">00170</a>     <a class="code" href="classOgre_1_1ParticleSystem.html">ParticleSystem</a>* ParticleSystemManager::createTemplate(<font class="keyword">const</font> <a class="code" href="classOgre_1_1String.html">String</a>&amp; name)
00171     {
00172         <a class="code" href="classOgre_1_1ParticleSystemManager.html#Ogre_1_1ParticleSystemManagera4">addTemplate</a>(name, <a class="code" href="classOgre_1_1ParticleSystem.html">ParticleSystem</a>(name));
00173         <font class="keywordflow">return</font> <a class="code" href="classOgre_1_1ParticleSystemManager.html#Ogre_1_1ParticleSystemManagera6">getTemplate</a>(name);
00174 
00175     }
00176     <font class="comment">//-----------------------------------------------------------------------</font>
<a name="l00177"></a><a class="code" href="classOgre_1_1ParticleSystemManager.html#Ogre_1_1ParticleSystemManagera6">00177</a>     <a class="code" href="classOgre_1_1ParticleSystem.html">ParticleSystem</a>* ParticleSystemManager::getTemplate(<font class="keyword">const</font> <a class="code" href="classOgre_1_1String.html">String</a>&amp; name)
00178     {
00179         ParticleTemplateMap::iterator i = <a class="code" href="classOgre_1_1ParticleSystemManager.html#Ogre_1_1ParticleSystemManagern0">mSystemTemplates</a>.find(name);
00180         <font class="keywordflow">if</font> (i != <a class="code" href="classOgre_1_1ParticleSystemManager.html#Ogre_1_1ParticleSystemManagern0">mSystemTemplates</a>.end())
00181         {
00182             <font class="keywordflow">return</font> &amp;(i-&gt;second);
00183         }
00184         <font class="keywordflow">else</font>
00185         {
00186             <font class="keywordflow">return</font> 0;
00187         }
00188     }
00189     <font class="comment">//-----------------------------------------------------------------------</font>
<a name="l00190"></a><a class="code" href="classOgre_1_1ParticleSystemManager.html#Ogre_1_1ParticleSystemManagera7">00190</a>     <a class="code" href="classOgre_1_1ParticleSystem.html">ParticleSystem</a>* ParticleSystemManager::createSystem(<font class="keyword">const</font> <a class="code" href="classOgre_1_1String.html">String</a>&amp; name, <font class="keywordtype">unsigned</font> <font class="keywordtype">int</font> quota)
00191     {
00192         <a class="code" href="classOgre_1_1ParticleSystem.html">ParticleSystem</a>* sys = <font class="keyword">new</font> <a class="code" href="classOgre_1_1ParticleSystem.html">ParticleSystem</a>(name);
00193         sys-&gt;<a class="code" href="classOgre_1_1ParticleSystem.html#Ogre_1_1ParticleSystema16">setParticleQuota</a>(quota);
00194         <a class="code" href="classOgre_1_1ParticleSystemManager.html#Ogre_1_1ParticleSystemManagern1">mSystems</a>[name] = sys;
00195         <font class="keywordflow">return</font> sys;
00196     }
00197     <font class="comment">//-----------------------------------------------------------------------</font>
<a name="l00198"></a><a class="code" href="classOgre_1_1ParticleSystemManager.html#Ogre_1_1ParticleSystemManagera8">00198</a>     <a class="code" href="classOgre_1_1ParticleSystem.html">ParticleSystem</a>* ParticleSystemManager::createSystem(<font class="keyword">const</font> <a class="code" href="classOgre_1_1String.html">String</a>&amp; name, <font class="keyword">const</font> <a class="code" href="classOgre_1_1String.html">String</a>&amp; templateName, <font class="keywordtype">unsigned</font> <font class="keywordtype">int</font> quota)
00199     {
00200         <font class="comment">// Look up template</font>
00201         <a class="code" href="classOgre_1_1ParticleSystem.html">ParticleSystem</a>* pTemplate = <a class="code" href="classOgre_1_1ParticleSystemManager.html#Ogre_1_1ParticleSystemManagera6">getTemplate</a>(templateName);
00202         <font class="keywordflow">if</font> (!pTemplate)
00203         {
00204             <a class="code" href="OgreException_8h.html#a0">Except</a>(Exception::ERR_INVALIDPARAMS, <font class="stringliteral">"Cannot find required template'"</font> + templateName + <font class="stringliteral">"'"</font>, <font class="stringliteral">"ParticleSystemManager::createSystem"</font>);
00205         }
00206 
00207         <a class="code" href="classOgre_1_1ParticleSystem.html">ParticleSystem</a>* sys = <a class="code" href="classOgre_1_1ParticleSystemManager.html#Ogre_1_1ParticleSystemManagera7">createSystem</a>(name, quota);
00208         <font class="comment">// Copy template settings</font>
00209         *sys = *pTemplate;
00210         <font class="keywordflow">return</font> sys;
00211         
00212     }
00213     <font class="comment">//-----------------------------------------------------------------------</font>
<a name="l00214"></a><a class="code" href="classOgre_1_1ParticleSystemManager.html#Ogre_1_1ParticleSystemManagera9">00214</a>     <font class="keywordtype">void</font> ParticleSystemManager::destroySystem(<font class="keyword">const</font> <a class="code" href="classOgre_1_1String.html">String</a>&amp; name)
00215     {
00216         ParticleSystemMap::iterator i = <a class="code" href="classOgre_1_1ParticleSystemManager.html#Ogre_1_1ParticleSystemManagern1">mSystems</a>.find(name);
00217         <font class="keywordflow">if</font> (i != <a class="code" href="classOgre_1_1ParticleSystemManager.html#Ogre_1_1ParticleSystemManagern1">mSystems</a>.end())
00218         {
00219             <font class="keyword">delete</font> i-&gt;second;
00220             <a class="code" href="classOgre_1_1ParticleSystemManager.html#Ogre_1_1ParticleSystemManagern1">mSystems</a>.erase(i);
00221         }
00222     }
00223     <font class="comment">//-----------------------------------------------------------------------</font>
<a name="l00224"></a><a class="code" href="classOgre_1_1ParticleSystemManager.html#Ogre_1_1ParticleSystemManagera10">00224</a>     <font class="keywordtype">void</font> ParticleSystemManager::destroySystem(<a class="code" href="classOgre_1_1ParticleSystem.html">ParticleSystem</a>* sys)
00225     {
00226         ParticleSystemMap::iterator i;
00227         <font class="keywordflow">for</font> (i = <a class="code" href="classOgre_1_1ParticleSystemManager.html#Ogre_1_1ParticleSystemManagern1">mSystems</a>.begin(); i != <a class="code" href="classOgre_1_1ParticleSystemManager.html#Ogre_1_1ParticleSystemManagern1">mSystems</a>.end(); ++i)
00228         {
00229             <font class="keywordflow">if</font> (i-&gt;second == sys)
00230             {
00231                 <font class="keyword">delete</font> i-&gt;second;
00232                 <a class="code" href="classOgre_1_1ParticleSystemManager.html#Ogre_1_1ParticleSystemManagern1">mSystems</a>.erase(i);
00233                 <font class="keywordflow">break</font>;
00234             }
00235         }
00236     }
00237 
00238     <font class="comment">//-----------------------------------------------------------------------</font>
<a name="l00239"></a><a class="code" href="classOgre_1_1ParticleSystemManager.html#Ogre_1_1ParticleSystemManagera11">00239</a>     <a class="code" href="classOgre_1_1ParticleSystem.html">ParticleSystem</a>* ParticleSystemManager::getSystem(<font class="keyword">const</font> <a class="code" href="classOgre_1_1String.html">String</a>&amp; name)
00240     {
00241         ParticleSystemMap::iterator i = <a class="code" href="classOgre_1_1ParticleSystemManager.html#Ogre_1_1ParticleSystemManagern1">mSystems</a>.find(name);
00242         <font class="keywordflow">if</font> (i != <a class="code" href="classOgre_1_1ParticleSystemManager.html#Ogre_1_1ParticleSystemManagern1">mSystems</a>.end())
00243         {
00244             <font class="keywordflow">return</font> i-&gt;second;
00245         }
00246         <font class="keywordflow">else</font>
00247         {
00248             <a class="code" href="OgreException_8h.html#a0">Except</a>(Exception::ERR_ITEM_NOT_FOUND, <font class="stringliteral">"Cannot find particle system '"</font> + name + <font class="stringliteral">"'"</font>,
00249                 <font class="stringliteral">"ParticleSystemManager::getSystem"</font>);
00250         }
00251     }
00252 
00253     <font class="comment">//-----------------------------------------------------------------------</font>
<a name="l00254"></a><a class="code" href="classOgre_1_1ParticleSystemManager.html#Ogre_1_1ParticleSystemManagera12">00254</a>     <a class="code" href="classOgre_1_1ParticleEmitter.html">ParticleEmitter</a>* ParticleSystemManager::_createEmitter(<font class="keyword">const</font> <a class="code" href="classOgre_1_1String.html">String</a>&amp; emitterType)
00255     {
00256         <font class="comment">// Locate emitter type</font>
00257         ParticleEmitterFactoryMap::iterator pFact = <a class="code" href="classOgre_1_1ParticleSystemManager.html#Ogre_1_1ParticleSystemManagern2">mEmitterFactories</a>.find(emitterType);
00258 
00259         <font class="keywordflow">if</font> (pFact == <a class="code" href="classOgre_1_1ParticleSystemManager.html#Ogre_1_1ParticleSystemManagern2">mEmitterFactories</a>.end())
00260         {
00261             <a class="code" href="OgreException_8h.html#a0">Except</a>(Exception::ERR_INVALIDPARAMS, <font class="stringliteral">"Cannot find requested emitter type."</font>, 
00262                 <font class="stringliteral">"ParticleSystemManager::_createEmitter"</font>);
00263         }
00264 
00265         <font class="keywordflow">return</font> pFact-&gt;second-&gt;createEmitter();
00266 
00267     }
00268     <font class="comment">//-----------------------------------------------------------------------</font>
<a name="l00269"></a><a class="code" href="classOgre_1_1ParticleSystemManager.html#Ogre_1_1ParticleSystemManagera13">00269</a>     <font class="keywordtype">void</font> ParticleSystemManager::_destroyEmitter(<a class="code" href="classOgre_1_1ParticleEmitter.html">ParticleEmitter</a>* emitter)
00270     {
00271         <font class="comment">// Destroy using the factory which created it</font>
00272         ParticleEmitterFactoryMap::iterator pFact = <a class="code" href="classOgre_1_1ParticleSystemManager.html#Ogre_1_1ParticleSystemManagern2">mEmitterFactories</a>.find(emitter-&gt;<a class="code" href="classOgre_1_1ParticleEmitter.html#Ogre_1_1RingEmittera45">getType</a>());
00273 
00274         <font class="keywordflow">if</font> (pFact == <a class="code" href="classOgre_1_1ParticleSystemManager.html#Ogre_1_1ParticleSystemManagern2">mEmitterFactories</a>.end())
00275         {
00276             <a class="code" href="OgreException_8h.html#a0">Except</a>(Exception::ERR_INVALIDPARAMS, <font class="stringliteral">"Cannot find emitter factory to destroy emitter."</font>, 
00277                 <font class="stringliteral">"ParticleSystemManager::_destroyEmitter"</font>);
00278         }
00279 
00280         pFact-&gt;second-&gt;destroyEmitter(emitter);
00281 
00282     }
00283     <font class="comment">//-----------------------------------------------------------------------</font>
<a name="l00284"></a><a class="code" href="classOgre_1_1ParticleSystemManager.html#Ogre_1_1ParticleSystemManagera14">00284</a>     <a class="code" href="classOgre_1_1ParticleAffector.html">ParticleAffector</a>* ParticleSystemManager::_createAffector(<font class="keyword">const</font> <a class="code" href="classOgre_1_1String.html">String</a>&amp; affectorType)
00285     {
00286         <font class="comment">// Locate affector type</font>
00287         ParticleAffectorFactoryMap::iterator pFact = <a class="code" href="classOgre_1_1ParticleSystemManager.html#Ogre_1_1ParticleSystemManagern3">mAffectorFactories</a>.find(affectorType);
00288 
00289         <font class="keywordflow">if</font> (pFact == <a class="code" href="classOgre_1_1ParticleSystemManager.html#Ogre_1_1ParticleSystemManagern3">mAffectorFactories</a>.end())
00290         {
00291             <a class="code" href="OgreException_8h.html#a0">Except</a>(Exception::ERR_INVALIDPARAMS, <font class="stringliteral">"Cannot find requested affector type."</font>, 
00292                 <font class="stringliteral">"ParticleSystemManager::_createAffector"</font>);
00293         }
00294 
00295         <font class="keywordflow">return</font> pFact-&gt;second-&gt;createAffector();
00296 
00297     }
00298     <font class="comment">//-----------------------------------------------------------------------</font>
<a name="l00299"></a><a class="code" href="classOgre_1_1ParticleSystemManager.html#Ogre_1_1ParticleSystemManagera15">00299</a>     <font class="keywordtype">void</font> ParticleSystemManager::_destroyAffector(<a class="code" href="classOgre_1_1ParticleAffector.html">ParticleAffector</a>* affector)
00300     {
00301         <font class="comment">// Destroy using the factory which created it</font>
00302         ParticleAffectorFactoryMap::iterator pFact = <a class="code" href="classOgre_1_1ParticleSystemManager.html#Ogre_1_1ParticleSystemManagern3">mAffectorFactories</a>.find(affector-&gt;<a class="code" href="classOgre_1_1ParticleAffector.html#Ogre_1_1ParticleAffectora2">getType</a>());
00303 
00304         <font class="keywordflow">if</font> (pFact == <a class="code" href="classOgre_1_1ParticleSystemManager.html#Ogre_1_1ParticleSystemManagern3">mAffectorFactories</a>.end())
00305         {
00306             <a class="code" href="OgreException_8h.html#a0">Except</a>(Exception::ERR_INVALIDPARAMS, <font class="stringliteral">"Cannot find affector factory to destroy affector."</font>, 
00307                 <font class="stringliteral">"ParticleSystemManager::_destroyAffector"</font>);
00308         }
00309 
00310         pFact-&gt;second-&gt;destroyAffector(affector);
00311     }
00312     <font class="comment">//-----------------------------------------------------------------------</font>
<a name="l00313"></a><a class="code" href="classOgre_1_1ParticleSystemManager.html#Ogre_1_1ParticleSystemManagera16">00313</a>     <font class="keywordtype">bool</font> ParticleSystemManager::frameStarted(<font class="keyword">const</font> <a class="code" href="structOgre_1_1FrameEvent.html">FrameEvent</a> &amp;evt)
00314     {
00315         <font class="comment">// update systems</font>
00316         <font class="comment">// TODO: only do this for visible systems</font>
00317         ParticleSystemMap::iterator i;
00318         <font class="keywordflow">for</font> (i = <a class="code" href="classOgre_1_1ParticleSystemManager.html#Ogre_1_1ParticleSystemManagern1">mSystems</a>.begin(); i != <a class="code" href="classOgre_1_1ParticleSystemManager.html#Ogre_1_1ParticleSystemManagern1">mSystems</a>.end(); ++i)
00319         {
00320             i-&gt;second-&gt;_update(evt.<a class="code" href="structOgre_1_1FrameEvent.html#Ogre_1_1FrameEventm1">timeSinceLastFrame</a>);
00321         }
00322 
00323         <font class="keywordflow">return</font> <font class="keyword">true</font>;
00324     }
00325     <font class="comment">//-----------------------------------------------------------------------</font>
<a name="l00326"></a><a class="code" href="classOgre_1_1ParticleSystemManager.html#Ogre_1_1ParticleSystemManagera17">00326</a>     <font class="keywordtype">bool</font> ParticleSystemManager::frameEnded(<font class="keyword">const</font> <a class="code" href="structOgre_1_1FrameEvent.html">FrameEvent</a> &amp;evt)
00327     {
00328         <font class="keywordflow">return</font> <font class="keyword">true</font>;
00329     }
00330     <font class="comment">//-----------------------------------------------------------------------</font>
<a name="l00331"></a><a class="code" href="classOgre_1_1ParticleSystemManager.html#Ogre_1_1ParticleSystemManagera18">00331</a>     <font class="keywordtype">void</font> ParticleSystemManager::_initialise(<font class="keywordtype">void</font>)
00332     {
00333         <font class="comment">// Register self as a frame listener</font>
00334         Root::getSingleton().addFrameListener(<font class="keyword">this</font>);
00335 
00336         <font class="comment">// Parse all scripts</font>
00337         <a class="code" href="classOgre_1_1ParticleSystemManager.html#Ogre_1_1ParticleSystemManagera20">parseAllSources</a>();
00338     }
00339     <font class="comment">//-----------------------------------------------------------------------</font>
<a name="l00340"></a><a class="code" href="classOgre_1_1ParticleSystemManager.html#Ogre_1_1ParticleSystemManagerd0">00340</a>     <a class="code" href="classOgre_1_1ParticleSystemManager.html">ParticleSystemManager</a>&amp; ParticleSystemManager::getSingleton(<font class="keywordtype">void</font>)
00341     {
00342         <font class="keywordflow">return</font> <a class="code" href="classOgre_1_1Singleton.html">Singleton&lt;ParticleSystemManager&gt;::getSingleton</a>();
00343     }
00344     <font class="comment">//-----------------------------------------------------------------------</font>
<a name="l00345"></a><a class="code" href="classOgre_1_1ParticleSystemManager.html#Ogre_1_1ParticleSystemManagerb0">00345</a>     <font class="keywordtype">void</font> ParticleSystemManager::parseNewEmitter(<font class="keyword">const</font> <a class="code" href="classOgre_1_1String.html">String</a>&amp; type, <a class="code" href="classOgre_1_1DataChunk.html">DataChunk</a>&amp; chunk, <a class="code" href="classOgre_1_1ParticleSystem.html">ParticleSystem</a>* sys)
00346     {
00347         <font class="comment">// Create new emitter</font>
00348         <a class="code" href="classOgre_1_1ParticleEmitter.html">ParticleEmitter</a>* pEmit = sys-&gt;<a class="code" href="classOgre_1_1ParticleSystem.html#Ogre_1_1ParticleSystema4">addEmitter</a>(type);
00349         <font class="comment">// Parse emitter details</font>
00350         <a class="code" href="classOgre_1_1String.html">String</a> line;
00351 
00352         <font class="keywordflow">while</font>(!chunk.<a class="code" href="classOgre_1_1DataChunk.html#Ogre_1_1SDDataChunka12">isEOF</a>())
00353         {
00354             line = chunk.<a class="code" href="classOgre_1_1DataChunk.html#Ogre_1_1SDDataChunka13">getLine</a>();
00355             <font class="comment">// Ignore comments &amp; blanks</font>
00356             <font class="keywordflow">if</font> (!(line.length() == 0 || line.substr(0,2) == <font class="stringliteral">"//"</font>))
00357             {
00358                 <font class="keywordflow">if</font> (line == <font class="stringliteral">"}"</font>)
00359                 {
00360                     <font class="comment">// Finished emitter</font>
00361                     <font class="keywordflow">break</font>;
00362                 }
00363                 <font class="keywordflow">else</font>
00364                 {
00365                     <font class="comment">// Attribute</font>
00366                     <a class="code" href="classOgre_1_1ParticleSystemManager.html#Ogre_1_1ParticleSystemManagerb3">parseEmitterAttrib</a>(line.<a class="code" href="classOgre_1_1String.html#Ogre_1_1Stringa7">toLowerCase</a>(), pEmit);
00367                 }
00368             }
00369         }
00370 
00371 
00372         
00373     }
00374     <font class="comment">//-----------------------------------------------------------------------</font>
<a name="l00375"></a><a class="code" href="classOgre_1_1ParticleSystemManager.html#Ogre_1_1ParticleSystemManagerb1">00375</a>     <font class="keywordtype">void</font> ParticleSystemManager::parseNewAffector(<font class="keyword">const</font> <a class="code" href="classOgre_1_1String.html">String</a>&amp; type, <a class="code" href="classOgre_1_1DataChunk.html">DataChunk</a>&amp; chunk, <a class="code" href="classOgre_1_1ParticleSystem.html">ParticleSystem</a>* sys)
00376     {
00377         <font class="comment">// Create new affector</font>
00378         <a class="code" href="classOgre_1_1ParticleAffector.html">ParticleAffector</a>* pAff = sys-&gt;<a class="code" href="classOgre_1_1ParticleSystem.html#Ogre_1_1ParticleSystema9">addAffector</a>(type);
00379         <font class="comment">// Parse affector details</font>
00380         <a class="code" href="classOgre_1_1String.html">String</a> line;
00381 
00382         <font class="keywordflow">while</font>(!chunk.<a class="code" href="classOgre_1_1DataChunk.html#Ogre_1_1SDDataChunka12">isEOF</a>())
00383         {
00384             line = chunk.<a class="code" href="classOgre_1_1DataChunk.html#Ogre_1_1SDDataChunka13">getLine</a>();
00385             <font class="comment">// Ignore comments &amp; blanks</font>
00386             <font class="keywordflow">if</font> (!(line.length() == 0 || line.substr(0,2) == <font class="stringliteral">"//"</font>))
00387             {
00388                 <font class="keywordflow">if</font> (line == <font class="stringliteral">"}"</font>)
00389                 {
00390                     <font class="comment">// Finished affector</font>
00391                     <font class="keywordflow">break</font>;
00392                 }
00393                 <font class="keywordflow">else</font>
00394                 {
00395                     <font class="comment">// Attribute</font>
00396                     <a class="code" href="classOgre_1_1ParticleSystemManager.html#Ogre_1_1ParticleSystemManagerb4">parseAffectorAttrib</a>(line.<a class="code" href="classOgre_1_1String.html#Ogre_1_1Stringa7">toLowerCase</a>(), pAff);
00397                 }
00398             }
00399         }
00400     }
00401     <font class="comment">//-----------------------------------------------------------------------</font>
<a name="l00402"></a><a class="code" href="classOgre_1_1ParticleSystemManager.html#Ogre_1_1ParticleSystemManagerb2">00402</a>     <font class="keywordtype">void</font> ParticleSystemManager::parseAttrib(<font class="keyword">const</font> <a class="code" href="classOgre_1_1String.html">String</a>&amp; line, <a class="code" href="classOgre_1_1ParticleSystem.html">ParticleSystem</a>* sys)
00403     {
00404         std::vector&lt;String&gt; vecparams;
00405 
00406         <font class="comment">// Split params on space</font>
00407         vecparams = line.<a class="code" href="classOgre_1_1String.html#Ogre_1_1Stringa6">split</a>(<font class="stringliteral">"\t "</font>, 1);
00408 
00409         <font class="comment">// Look up first param (command setting)</font>
00410         <font class="keywordflow">if</font> (!sys-&gt;<a class="code" href="classOgre_1_1StringInterface.html#Ogre_1_1StringInterfacea3">setParameter</a>(vecparams[0], vecparams[1]))
00411         {
00412             <font class="comment">// BAD command. BAD!</font>
00413             LogManager::getSingleton().logMessage(<font class="stringliteral">"Bad particle system attribute line: '"</font>
00414                 + line + <font class="stringliteral">"' in "</font> + sys-&gt;<a class="code" href="classOgre_1_1ParticleSystem.html#Ogre_1_1ParticleSystema3">getName</a>());
00415         }
00416     }
00417     <font class="comment">//-----------------------------------------------------------------------</font>
<a name="l00418"></a><a class="code" href="classOgre_1_1ParticleSystemManager.html#Ogre_1_1ParticleSystemManagerb3">00418</a>     <font class="keywordtype">void</font> ParticleSystemManager::parseEmitterAttrib(<font class="keyword">const</font> <a class="code" href="classOgre_1_1String.html">String</a>&amp; line, <a class="code" href="classOgre_1_1ParticleEmitter.html">ParticleEmitter</a>* emit)
00419     {
00420         std::vector&lt;String&gt; vecparams;
00421 
00422         <font class="comment">// Split params on first space</font>
00423         vecparams = line.<a class="code" href="classOgre_1_1String.html#Ogre_1_1Stringa6">split</a>(<font class="stringliteral">"\t "</font>, 1);
00424 
00425         <font class="comment">// Look up first param (command setting)</font>
00426         <font class="keywordflow">if</font> (!emit-&gt;<a class="code" href="classOgre_1_1StringInterface.html#Ogre_1_1StringInterfacea3">setParameter</a>(vecparams[0], vecparams[1]))
00427         {
00428             <font class="comment">// BAD command. BAD!</font>
00429             LogManager::getSingleton().logMessage(<font class="stringliteral">"Bad particle emitter attribute line: '"</font>
00430                 + line + <font class="stringliteral">"' for emitter "</font> + emit-&gt;<a class="code" href="classOgre_1_1ParticleEmitter.html#Ogre_1_1RingEmittera45">getType</a>());
00431         }
00432     }
00433     <font class="comment">//-----------------------------------------------------------------------</font>
<a name="l00434"></a><a class="code" href="classOgre_1_1ParticleSystemManager.html#Ogre_1_1ParticleSystemManagerb4">00434</a>     <font class="keywordtype">void</font> ParticleSystemManager::parseAffectorAttrib(<font class="keyword">const</font> <a class="code" href="classOgre_1_1String.html">String</a>&amp; line, <a class="code" href="classOgre_1_1ParticleAffector.html">ParticleAffector</a>* aff)
00435     {
00436         std::vector&lt;String&gt; vecparams;
00437 
00438         <font class="comment">// Split params on space</font>
00439         vecparams = line.<a class="code" href="classOgre_1_1String.html#Ogre_1_1Stringa6">split</a>(<font class="stringliteral">"\t "</font>, 1);
00440 
00441         <font class="comment">// Look up first param (command setting)</font>
00442         <font class="keywordflow">if</font> (!aff-&gt;<a class="code" href="classOgre_1_1StringInterface.html#Ogre_1_1StringInterfacea3">setParameter</a>(vecparams[0], vecparams[1]))
00443         {
00444             <font class="comment">// BAD command. BAD!</font>
00445             LogManager::getSingleton().logMessage(<font class="stringliteral">"Bad particle affector attribute line: '"</font>
00446                 + line + <font class="stringliteral">"' for affector "</font> + aff-&gt;<a class="code" href="classOgre_1_1ParticleAffector.html#Ogre_1_1ParticleAffectora2">getType</a>());
00447         }
00448     }
00449     <font class="comment">//-----------------------------------------------------------------------</font>
<a name="l00450"></a><a class="code" href="classOgre_1_1ParticleSystemManager.html#Ogre_1_1ParticleSystemManagerb5">00450</a>     <font class="keywordtype">void</font> ParticleSystemManager::skipToNextCloseBrace(<a class="code" href="classOgre_1_1DataChunk.html">DataChunk</a>&amp; chunk)
00451     {
00452         <a class="code" href="classOgre_1_1String.html">String</a> line = <font class="stringliteral">""</font>;
00453         <font class="keywordflow">while</font> (!chunk.<a class="code" href="classOgre_1_1DataChunk.html#Ogre_1_1SDDataChunka12">isEOF</a>() &amp;&amp; line != <font class="stringliteral">"}"</font>)
00454         {
00455             line = chunk.<a class="code" href="classOgre_1_1DataChunk.html#Ogre_1_1SDDataChunka13">getLine</a>();
00456         }
00457 
00458     }
00459     <font class="comment">//-----------------------------------------------------------------------</font>
<a name="l00460"></a><a class="code" href="classOgre_1_1ParticleSystemManager.html#Ogre_1_1ParticleSystemManagerb6">00460</a>     <font class="keywordtype">void</font> ParticleSystemManager::skipToNextOpenBrace(<a class="code" href="classOgre_1_1DataChunk.html">DataChunk</a>&amp; chunk)
00461     {
00462         <a class="code" href="classOgre_1_1String.html">String</a> line = <font class="stringliteral">""</font>;
00463         <font class="keywordflow">while</font> (!chunk.<a class="code" href="classOgre_1_1DataChunk.html#Ogre_1_1SDDataChunka12">isEOF</a>() &amp;&amp; line != <font class="stringliteral">"{"</font>)
00464         {
00465             line = chunk.<a class="code" href="classOgre_1_1DataChunk.html#Ogre_1_1SDDataChunka13">getLine</a>();
00466         }
00467 
00468     }
00469 
00470 
00471 }
</pre></div><p>
Copyright &copy; 2002 by The OGRE Team<br />
<script type="text/javascript">
<!--//hide script from old browsers
document.write( "Last modified "+ document.lastModified );
//end hiding contents -->
</script>
</p>
</body>
</html>
