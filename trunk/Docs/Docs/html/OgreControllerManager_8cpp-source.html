<html>
<head>
<title>OGRE Documentation</title> <meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1"> 
<link type="text/css" rel="stylesheet" href="style.css">
</head>

<body>
<!-- Generated by Doxygen 1.2.16 -->
<center>
<a class="qindex" href="index.html">Main Page</a> &nbsp; <a class="qindex" href="namespaces.html">Namespace List</a> &nbsp; <a class="qindex" href="hierarchy.html">Class Hierarchy</a> &nbsp; <a class="qindex" href="classes.html">Alphabetical List</a> &nbsp; <a class="qindex" href="annotated.html">Compound List</a> &nbsp; <a class="qindex" href="files.html">File List</a> &nbsp; <a class="qindex" href="namespacemembers.html">Namespace Members</a> &nbsp; <a class="qindex" href="functions.html">Compound Members</a> &nbsp; <a class="qindex" href="globals.html">File Members</a> &nbsp; <a class="qindex" href="pages.html">Related Pages</a> &nbsp; </center>
<hr><h1>OgreControllerManager.cpp</h1><a href="OgreControllerManager_8cpp.html">Go to the documentation of this file.</a><div class="fragment"><pre>00001 <font class="comment">/*</font>
00002 <font class="comment">-----------------------------------------------------------------------------</font>
00003 <font class="comment">This source file is part of OGRE</font>
00004 <font class="comment">    (Object-oriented Graphics Rendering Engine)</font>
00005 <font class="comment">For the latest info, see http://www.stevestreeting.com/ogre/</font>
00006 <font class="comment"></font>
00007 <font class="comment">Copyright © 2000-2001 Steven J. Streeting</font>
00008 <font class="comment">Also see acknowledgements in Readme.html</font>
00009 <font class="comment"></font>
00010 <font class="comment">This program is free software; you can redistribute it and/or modify it under</font>
00011 <font class="comment">the terms of the GNU General Public License as published by the Free Software</font>
00012 <font class="comment">Foundation; either version 2 of the License, or (at your option) any later</font>
00013 <font class="comment">version.</font>
00014 <font class="comment"></font>
00015 <font class="comment">This program is distributed in the hope that it will be useful, but WITHOUT</font>
00016 <font class="comment">ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or FITNESS</font>
00017 <font class="comment">FOR A PARTICULAR PURPOSE. See the GNU General Public License for more details.</font>
00018 <font class="comment"></font>
00019 <font class="comment">You should have received a copy of the GNU General Public License along with</font>
00020 <font class="comment">this program; if not, write to the Free Software Foundation, Inc., 59 Temple</font>
00021 <font class="comment">Place - Suite 330, Boston, MA 02111-1307, USA, or go to</font>
00022 <font class="comment">http://www.gnu.org/copyleft/gpl.html.</font>
00023 <font class="comment">-----------------------------------------------------------------------------</font>
00024 <font class="comment">*/</font>
00025 <font class="preprocessor">#include "<a class="code" href="OgreControllerManager_8h.html">OgreControllerManager.h</a>"</font>
00026 
00027 <font class="preprocessor">#include "<a class="code" href="OgreMaterial_8h.html">OgreMaterial.h</a>"</font>
00028 <font class="preprocessor">#include "<a class="code" href="OgreLogManager_8h.html">OgreLogManager.h</a>"</font>
00029 
00030 
00031 <font class="keyword">namespace </font>Ogre {
00032     <font class="comment">//-----------------------------------------------------------------------</font>
<a name="l00033"></a><a class="code" href="classOgre_1_1Singleton.html#Ogre_1_1Singletonq0">00033</a>     <font class="keyword">template</font>&lt;&gt; <a class="code" href="classOgre_1_1ControllerManager.html">ControllerManager</a>* <a class="code" href="classOgre_1_1Singleton.html">Singleton&lt;ControllerManager&gt;</a>::ms_Singleton = 0;
00034     <font class="comment">//-----------------------------------------------------------------------</font>
<a name="l00035"></a><a class="code" href="classOgre_1_1ControllerManager.html#Ogre_1_1ControllerManagera0">00035</a>     ControllerManager::ControllerManager()
00036     {
00037 
00038     }
00039     <font class="comment">//-----------------------------------------------------------------------</font>
<a name="l00040"></a><a class="code" href="classOgre_1_1ControllerManager.html#Ogre_1_1ControllerManagera1">00040</a>     ControllerManager::~ControllerManager()
00041     {
00042         <a class="code" href="classOgre_1_1ControllerManager.html#Ogre_1_1ControllerManagera3">clearControllers</a>();
00043     }
00044     <font class="comment">//-----------------------------------------------------------------------</font>
<a name="l00045"></a><a class="code" href="classOgre_1_1ControllerManager.html#Ogre_1_1ControllerManagera2">00045</a>     <a class="code" href="classOgre_1_1Controller.html">Controller</a>* ControllerManager::createController(<a class="code" href="classOgre_1_1ControllerValue.html">ControllerValue</a>* src, <a class="code" href="classOgre_1_1ControllerValue.html">ControllerValue</a>* dest, <a class="code" href="classOgre_1_1ControllerFunction.html">ControllerFunction</a>* func)
00046     {
00047         <a class="code" href="classOgre_1_1Controller.html">Controller</a>* c = <font class="keyword">new</font> <a class="code" href="classOgre_1_1Controller.html">Controller</a>(src, dest, func);
00048 
00049         <a class="code" href="classOgre_1_1ControllerManager.html#Ogre_1_1ControllerManagern0">mControllers</a>.insert(c);
00050         <font class="keywordflow">return</font> c;
00051     }
00052     <font class="comment">//-----------------------------------------------------------------------</font>
<a name="l00053"></a><a class="code" href="classOgre_1_1ControllerManager.html#Ogre_1_1ControllerManagera4">00053</a>     <font class="keywordtype">void</font> ControllerManager::updateAllControllers(<font class="keywordtype">void</font>)
00054     {
00055         ControllerList::iterator ci;
00056         <font class="keywordflow">for</font> (ci = <a class="code" href="classOgre_1_1ControllerManager.html#Ogre_1_1ControllerManagern0">mControllers</a>.begin(); ci != <a class="code" href="classOgre_1_1ControllerManager.html#Ogre_1_1ControllerManagern0">mControllers</a>.end(); ++ci)
00057         {
00058             (*ci)-&gt;<a class="code" href="classOgre_1_1Controller.html#Ogre_1_1Controllera8">update</a>();
00059         }
00060     }
00061     <font class="comment">//-----------------------------------------------------------------------</font>
<a name="l00062"></a><a class="code" href="classOgre_1_1ControllerManager.html#Ogre_1_1ControllerManagera3">00062</a>     <font class="keywordtype">void</font> ControllerManager::clearControllers(<font class="keywordtype">void</font>)
00063     {
00064         ControllerList::iterator ci;
00065         <font class="keywordflow">for</font> (ci = <a class="code" href="classOgre_1_1ControllerManager.html#Ogre_1_1ControllerManagern0">mControllers</a>.begin(); ci != <a class="code" href="classOgre_1_1ControllerManager.html#Ogre_1_1ControllerManagern0">mControllers</a>.end(); ++ci)
00066         {
00067             <font class="keyword">delete</font> *ci;
00068         }
00069         <a class="code" href="classOgre_1_1ControllerManager.html#Ogre_1_1ControllerManagern0">mControllers</a>.clear();
00070     }
00071     <font class="comment">//-----------------------------------------------------------------------</font>
<a name="l00072"></a><a class="code" href="classOgre_1_1ControllerManager.html#Ogre_1_1ControllerManagera5">00072</a>     <a class="code" href="classOgre_1_1ControllerValue.html">ControllerValue</a>* ControllerManager::getFrameTimeSource(<font class="keywordtype">void</font>)
00073     {
00074         <font class="keywordflow">return</font> &amp;<a class="code" href="classOgre_1_1ControllerManager.html#Ogre_1_1ControllerManagern1">mFrameTimeController</a>;
00075     }
00076     <font class="comment">//-----------------------------------------------------------------------</font>
<a name="l00077"></a><a class="code" href="classOgre_1_1ControllerManager.html#Ogre_1_1ControllerManagera6">00077</a>     <a class="code" href="classOgre_1_1Controller.html">Controller</a>* ControllerManager::createTextureAnimator(<a class="code" href="classOgre_1_1Material_1_1TextureLayer.html">Material::TextureLayer</a>* layer, <a class="code" href="namespaceOgre.html#a281">Real</a> sequenceTime)
00078     {
00079         <a class="code" href="classOgre_1_1TextureFrameControllerValue.html">TextureFrameControllerValue</a>* texVal = <font class="keyword">new</font> <a class="code" href="classOgre_1_1TextureFrameControllerValue.html">TextureFrameControllerValue</a>(layer);
00080         <a class="code" href="classOgre_1_1AnimationControllerFunction.html">AnimationControllerFunction</a>* animFunc = <font class="keyword">new</font> <a class="code" href="classOgre_1_1AnimationControllerFunction.html">AnimationControllerFunction</a>(sequenceTime);
00081 
00082         <font class="keywordflow">return</font> <a class="code" href="classOgre_1_1ControllerManager.html#Ogre_1_1ControllerManagera2">createController</a>(&amp;<a class="code" href="classOgre_1_1ControllerManager.html#Ogre_1_1ControllerManagern1">mFrameTimeController</a>, texVal, animFunc);
00083     }
00084     <font class="comment">//-----------------------------------------------------------------------</font>
<a name="l00085"></a><a class="code" href="classOgre_1_1ControllerManager.html#Ogre_1_1ControllerManagera7">00085</a>     <a class="code" href="classOgre_1_1Controller.html">Controller</a>* ControllerManager::createTextureScroller(<a class="code" href="classOgre_1_1Material_1_1TextureLayer.html">Material::TextureLayer</a>* layer, <a class="code" href="namespaceOgre.html#a281">Real</a> uSpeed, <a class="code" href="namespaceOgre.html#a281">Real</a> vSpeed)
00086     {
00087         <a class="code" href="classOgre_1_1Controller.html">Controller</a>* ret = 0;
00088         <a class="code" href="classOgre_1_1TexCoordModifierControllerValue.html">TexCoordModifierControllerValue</a> *uVal, *vVal;
00089         <a class="code" href="classOgre_1_1ScaleControllerFunction.html">ScaleControllerFunction</a> *uFunc, *vFunc;
00090 
00091         <font class="comment">// Set up 1 or 2 controllers to manage the scrolling texture</font>
00092         <font class="keywordflow">if</font> (uSpeed != 0)
00093         {
00094             <font class="keywordflow">if</font> (uSpeed == vSpeed)
00095             {
00096                 <font class="comment">// Cool, we can do both scrolls with a single controller</font>
00097                 uVal = <font class="keyword">new</font> <a class="code" href="classOgre_1_1TexCoordModifierControllerValue.html">TexCoordModifierControllerValue</a>(layer, <font class="keyword">true</font>, <font class="keyword">true</font>);
00098             }
00099             <font class="keywordflow">else</font>
00100             {
00101                 <font class="comment">// Just do u, v will take a second controller</font>
00102                 uVal = <font class="keyword">new</font> <a class="code" href="classOgre_1_1TexCoordModifierControllerValue.html">TexCoordModifierControllerValue</a>(layer, <font class="keyword">true</font>);
00103             }
00104             <font class="comment">// Create function: use -speed since we're altering texture coords so they have reverse effect</font>
00105             uFunc = <font class="keyword">new</font> <a class="code" href="classOgre_1_1ScaleControllerFunction.html">ScaleControllerFunction</a>(-uSpeed, <font class="keyword">true</font>);
00106             ret = <a class="code" href="classOgre_1_1ControllerManager.html#Ogre_1_1ControllerManagera2">createController</a>(&amp;<a class="code" href="classOgre_1_1ControllerManager.html#Ogre_1_1ControllerManagern1">mFrameTimeController</a>, uVal, uFunc);
00107 
00108         }
00109 
00110         <font class="keywordflow">if</font> (vSpeed != 0 &amp;&amp; (uSpeed == 0 || vSpeed != uSpeed))
00111         {
00112             <font class="comment">// Set up a second controller for v scroll</font>
00113             vVal = <font class="keyword">new</font> <a class="code" href="classOgre_1_1TexCoordModifierControllerValue.html">TexCoordModifierControllerValue</a>(layer, <font class="keyword">false</font>, <font class="keyword">true</font>);
00114             <font class="comment">// Create function: use -speed since we're altering texture coords so they have reverse effect</font>
00115             vFunc = <font class="keyword">new</font> <a class="code" href="classOgre_1_1ScaleControllerFunction.html">ScaleControllerFunction</a>(-vSpeed, <font class="keyword">true</font>);
00116             ret = <a class="code" href="classOgre_1_1ControllerManager.html#Ogre_1_1ControllerManagera2">createController</a>(&amp;<a class="code" href="classOgre_1_1ControllerManager.html#Ogre_1_1ControllerManagern1">mFrameTimeController</a>, vVal, vFunc);
00117         }
00118 
00119         <font class="keywordflow">return</font> ret;
00120     }
00121     <font class="comment">//-----------------------------------------------------------------------</font>
<a name="l00122"></a><a class="code" href="classOgre_1_1ControllerManager.html#Ogre_1_1ControllerManagera8">00122</a>     <a class="code" href="classOgre_1_1Controller.html">Controller</a>* ControllerManager::createTextureRotater(<a class="code" href="classOgre_1_1Material_1_1TextureLayer.html">Material::TextureLayer</a>* layer, <a class="code" href="namespaceOgre.html#a281">Real</a> speed)
00123     {
00124         <a class="code" href="classOgre_1_1TexCoordModifierControllerValue.html">TexCoordModifierControllerValue</a>* val;
00125         <a class="code" href="classOgre_1_1ScaleControllerFunction.html">ScaleControllerFunction</a> *func;
00126 
00127         <font class="comment">// Target value is texture coord rotation</font>
00128         val = <font class="keyword">new</font> <a class="code" href="classOgre_1_1TexCoordModifierControllerValue.html">TexCoordModifierControllerValue</a>(layer, <font class="keyword">false</font>, <font class="keyword">false</font>, <font class="keyword">false</font>, <font class="keyword">false</font>, <font class="keyword">true</font>);
00129         <font class="comment">// Function is simple scale (seconds * speed)</font>
00130         <font class="comment">// Use -speed since altering texture coords has the reverse visible effect</font>
00131         func = <font class="keyword">new</font> <a class="code" href="classOgre_1_1ScaleControllerFunction.html">ScaleControllerFunction</a>(-speed, <font class="keyword">true</font>);
00132 
00133         <font class="keywordflow">return</font> <a class="code" href="classOgre_1_1ControllerManager.html#Ogre_1_1ControllerManagera2">createController</a>(&amp;<a class="code" href="classOgre_1_1ControllerManager.html#Ogre_1_1ControllerManagern1">mFrameTimeController</a>, val, func);
00134 
00135     }
00136     <font class="comment">//-----------------------------------------------------------------------</font>
<a name="l00137"></a><a class="code" href="classOgre_1_1ControllerManager.html#Ogre_1_1ControllerManagera9">00137</a>     <a class="code" href="classOgre_1_1Controller.html">Controller</a>* ControllerManager::createTextureWaveTransformer(<a class="code" href="classOgre_1_1Material_1_1TextureLayer.html">Material::TextureLayer</a>* layer,
00138         Material::TextureLayer::TextureTransformType ttype, <a class="code" href="namespaceOgre.html#a432">WaveformType</a> waveType, <a class="code" href="namespaceOgre.html#a281">Real</a> base, <a class="code" href="namespaceOgre.html#a281">Real</a> frequency, <a class="code" href="namespaceOgre.html#a281">Real</a> phase, <a class="code" href="namespaceOgre.html#a281">Real</a> amplitude)
00139     {
00140         <a class="code" href="classOgre_1_1TexCoordModifierControllerValue.html">TexCoordModifierControllerValue</a>* val;
00141         <a class="code" href="classOgre_1_1WaveformControllerFunction.html">WaveformControllerFunction</a> *func;
00142 
00143         <font class="keywordflow">switch</font> (ttype)
00144         {
00145         <font class="keywordflow">case</font> Material::TextureLayer::TT_TRANSLATE_U:
00146             <font class="comment">// Target value is a u scroll</font>
00147             val = <font class="keyword">new</font> <a class="code" href="classOgre_1_1TexCoordModifierControllerValue.html">TexCoordModifierControllerValue</a>(layer, <font class="keyword">true</font>);
00148             <font class="keywordflow">break</font>;
00149         <font class="keywordflow">case</font> Material::TextureLayer::TT_TRANSLATE_V:
00150             <font class="comment">// Target value is a v scroll</font>
00151             val = <font class="keyword">new</font> <a class="code" href="classOgre_1_1TexCoordModifierControllerValue.html">TexCoordModifierControllerValue</a>(layer, <font class="keyword">false</font>, <font class="keyword">true</font>);
00152             <font class="keywordflow">break</font>;
00153         <font class="keywordflow">case</font> Material::TextureLayer::TT_SCALE_U:
00154             <font class="comment">// Target value is a u scale</font>
00155             val = <font class="keyword">new</font> <a class="code" href="classOgre_1_1TexCoordModifierControllerValue.html">TexCoordModifierControllerValue</a>(layer, <font class="keyword">false</font>, <font class="keyword">false</font>, <font class="keyword">true</font>);
00156             <font class="keywordflow">break</font>;
00157         <font class="keywordflow">case</font> Material::TextureLayer::TT_SCALE_V:
00158             <font class="comment">// Target value is a v scale</font>
00159             val = <font class="keyword">new</font> <a class="code" href="classOgre_1_1TexCoordModifierControllerValue.html">TexCoordModifierControllerValue</a>(layer, <font class="keyword">false</font>, <font class="keyword">false</font>, <font class="keyword">false</font>, <font class="keyword">true</font>);
00160             <font class="keywordflow">break</font>;
00161         <font class="keywordflow">case</font> Material::TextureLayer::TT_ROTATE:
00162             <font class="comment">// Target value is texture coord rotation</font>
00163             val = <font class="keyword">new</font> <a class="code" href="classOgre_1_1TexCoordModifierControllerValue.html">TexCoordModifierControllerValue</a>(layer, <font class="keyword">false</font>, <font class="keyword">false</font>, <font class="keyword">false</font>, <font class="keyword">false</font>, <font class="keyword">true</font>);
00164             <font class="keywordflow">break</font>;
00165         }
00166         <font class="comment">// Create new wave function for alterations</font>
00167         func = <font class="keyword">new</font> <a class="code" href="classOgre_1_1WaveformControllerFunction.html">WaveformControllerFunction</a>(waveType, base, frequency, phase, amplitude, <font class="keyword">true</font>);
00168 
00169         <font class="keywordflow">return</font> <a class="code" href="classOgre_1_1ControllerManager.html#Ogre_1_1ControllerManagera2">createController</a>(&amp;<a class="code" href="classOgre_1_1ControllerManager.html#Ogre_1_1ControllerManagern1">mFrameTimeController</a>, val, func);
00170     }
00171     <font class="comment">//-----------------------------------------------------------------------</font>
<a name="l00172"></a><a class="code" href="classOgre_1_1ControllerManager.html#Ogre_1_1ControllerManagerd0">00172</a>     <a class="code" href="classOgre_1_1ControllerManager.html">ControllerManager</a>&amp; ControllerManager::getSingleton(<font class="keywordtype">void</font>)
00173     {
00174         <font class="keywordflow">return</font> <a class="code" href="classOgre_1_1Singleton.html">Singleton&lt;ControllerManager&gt;::getSingleton</a>();
00175     }
00176     <font class="comment">//-----------------------------------------------------------------------</font>
<a name="l00177"></a><a class="code" href="classOgre_1_1ControllerManager.html#Ogre_1_1ControllerManagera10">00177</a>     <font class="keywordtype">void</font> ControllerManager::destroyController(<a class="code" href="classOgre_1_1Controller.html">Controller</a>* controller)
00178     {
00179         ControllerList::iterator i = <a class="code" href="classOgre_1_1ControllerManager.html#Ogre_1_1ControllerManagern0">mControllers</a>.find(controller);
00180         <font class="keywordflow">if</font> (i != <a class="code" href="classOgre_1_1ControllerManager.html#Ogre_1_1ControllerManagern0">mControllers</a>.end())
00181         {
00182             <a class="code" href="classOgre_1_1ControllerManager.html#Ogre_1_1ControllerManagern0">mControllers</a>.erase(i);
00183             <font class="keyword">delete</font> controller;
00184         }
00185     }
00186 
00187 }
</pre></div><p>
Copyright &copy; 2002 by The OGRE Team<br />
<script type="text/javascript">
<!--//hide script from old browsers
document.write( "Last modified "+ document.lastModified );
//end hiding contents -->
</script>
</p>
</body>
</html>
