<html>
<head>
<title>OGRE Documentation</title> <meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1"> 
<link type="text/css" rel="stylesheet" href="style.css">
</head>

<body>
<!-- Generated by Doxygen 1.2.16 -->
<center>
<a class="qindex" href="index.html">Main Page</a> &nbsp; <a class="qindex" href="namespaces.html">Namespace List</a> &nbsp; <a class="qindex" href="hierarchy.html">Class Hierarchy</a> &nbsp; <a class="qindex" href="classes.html">Alphabetical List</a> &nbsp; <a class="qindex" href="annotated.html">Compound List</a> &nbsp; <a class="qindex" href="files.html">File List</a> &nbsp; <a class="qindex" href="namespacemembers.html">Namespace Members</a> &nbsp; <a class="qindex" href="functions.html">Compound Members</a> &nbsp; <a class="qindex" href="globals.html">File Members</a> &nbsp; <a class="qindex" href="pages.html">Related Pages</a> &nbsp; </center>
<hr><h1>OgreMesh.cpp</h1><a href="OgreMesh_8cpp.html">Go to the documentation of this file.</a><div class="fragment"><pre>00001 <font class="comment">/*</font>
00002 <font class="comment">-----------------------------------------------------------------------------</font>
00003 <font class="comment">This source file is part of OGRE</font>
00004 <font class="comment">    (Object-oriented Graphics Rendering Engine)</font>
00005 <font class="comment">For the latest info, see http://www.stevestreeting.com/ogre/</font>
00006 <font class="comment"></font>
00007 <font class="comment">Copyright © 2000-2001 Steven J. Streeting</font>
00008 <font class="comment">Also see acknowledgements in Readme.html</font>
00009 <font class="comment"></font>
00010 <font class="comment">This program is free software; you can redistribute it and/or modify it under</font>
00011 <font class="comment">the terms of the GNU General Public License as published by the Free Software</font>
00012 <font class="comment">Foundation; either version 2 of the License, or (at your option) any later</font>
00013 <font class="comment">version.</font>
00014 <font class="comment"></font>
00015 <font class="comment">This program is distributed in the hope that it will be useful, but WITHOUT</font>
00016 <font class="comment">ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or FITNESS</font>
00017 <font class="comment">FOR A PARTICULAR PURPOSE. See the GNU General Public License for more details.</font>
00018 <font class="comment"></font>
00019 <font class="comment">You should have received a copy of the GNU General Public License along with</font>
00020 <font class="comment">this program; if not, write to the Free Software Foundation, Inc., 59 Temple</font>
00021 <font class="comment">Place - Suite 330, Boston, MA 02111-1307, USA, or go to</font>
00022 <font class="comment">http://www.gnu.org/copyleft/gpl.html.</font>
00023 <font class="comment">-----------------------------------------------------------------------------</font>
00024 <font class="comment">*/</font>
00025 <font class="preprocessor">#include "<a class="code" href="OgreMesh_8h.html">OgreMesh.h</a>"</font>
00026 
00027 <font class="preprocessor">#include "<a class="code" href="OgreSubMesh_8h.html">OgreSubMesh.h</a>"</font>
00028 <font class="preprocessor">#include "<a class="code" href="OgreMaterialManager_8h.html">OgreMaterialManager.h</a>"</font>
00029 <font class="preprocessor">#include "<a class="code" href="OgreLogManager_8h.html">OgreLogManager.h</a>"</font>
00030 <font class="preprocessor">#include "<a class="code" href="OgreDataChunk_8h.html">OgreDataChunk.h</a>"</font>
00031 <font class="preprocessor">#include "<a class="code" href="OgreMeshSerializer_8h.html">OgreMeshSerializer.h</a>"</font>
00032 <font class="preprocessor">#include "<a class="code" href="OgreSkeletonManager_8h.html">OgreSkeletonManager.h</a>"</font>
00033 <font class="preprocessor">#include "<a class="code" href="OgreSkeleton_8h.html">OgreSkeleton.h</a>"</font>
00034 
00035 
00036 
00037 <font class="keyword">namespace </font>Ogre {
00038 
00039     <font class="comment">//-----------------------------------------------------------------------</font>
<a name="l00040"></a><a class="code" href="classOgre_1_1Mesh.html#Ogre_1_1Mesha0">00040</a>     Mesh::Mesh(<a class="code" href="classOgre_1_1String.html">String</a> name)
00041     {
00042         <a class="code" href="classOgre_1_1Resource.html#Ogre_1_1Zipn0">mName</a> = name;
00043         <a class="code" href="classOgre_1_1Mesh.html#Ogre_1_1Meshm0">sharedGeometry</a>.<a class="code" href="structOgre_1_1GeometryData.html#Ogre_1_1GeometryDatam4">hasColours</a> = <font class="keyword">false</font>;
00044         <a class="code" href="classOgre_1_1Mesh.html#Ogre_1_1Meshm0">sharedGeometry</a>.<a class="code" href="structOgre_1_1GeometryData.html#Ogre_1_1GeometryDatam1">hasNormals</a> = <font class="keyword">false</font>;
00045         <a class="code" href="classOgre_1_1Mesh.html#Ogre_1_1Meshm0">sharedGeometry</a>.<a class="code" href="structOgre_1_1GeometryData.html#Ogre_1_1GeometryDatam9">vertexStride</a> = 0;
00046         <a class="code" href="classOgre_1_1Mesh.html#Ogre_1_1Meshm0">sharedGeometry</a>.<a class="code" href="structOgre_1_1GeometryData.html#Ogre_1_1GeometryDatam12">colourStride</a> = 0;
00047         <a class="code" href="classOgre_1_1Mesh.html#Ogre_1_1Meshm0">sharedGeometry</a>.<a class="code" href="structOgre_1_1GeometryData.html#Ogre_1_1GeometryDatam10">normalStride</a> = 0;
00048         <a class="code" href="classOgre_1_1Mesh.html#Ogre_1_1Meshm0">sharedGeometry</a>.<a class="code" href="structOgre_1_1GeometryData.html#Ogre_1_1GeometryDatam2">numTexCoords</a> = 1;
00049         <a class="code" href="classOgre_1_1Mesh.html#Ogre_1_1Meshm0">sharedGeometry</a>.<a class="code" href="structOgre_1_1GeometryData.html#Ogre_1_1GeometryDatam3">numTexCoordDimensions</a>[0] = 2;
00050         <a class="code" href="classOgre_1_1Mesh.html#Ogre_1_1Meshm0">sharedGeometry</a>.<a class="code" href="structOgre_1_1GeometryData.html#Ogre_1_1GeometryDatam0">numVertices</a> = 0;
00051         <a class="code" href="classOgre_1_1Mesh.html#Ogre_1_1Meshm0">sharedGeometry</a>.<a class="code" href="structOgre_1_1GeometryData.html#Ogre_1_1GeometryDatam8">pColours</a> = 0;
00052         <a class="code" href="classOgre_1_1Mesh.html#Ogre_1_1Meshm0">sharedGeometry</a>.<a class="code" href="structOgre_1_1GeometryData.html#Ogre_1_1GeometryDatam7">pNormals</a> = 0;
00053         <a class="code" href="classOgre_1_1Mesh.html#Ogre_1_1Meshm0">sharedGeometry</a>.<a class="code" href="structOgre_1_1GeometryData.html#Ogre_1_1GeometryDatam14">pBlendingWeights</a> = 0;
00054         <a class="code" href="classOgre_1_1Mesh.html#Ogre_1_1Meshm0">sharedGeometry</a>.<a class="code" href="structOgre_1_1GeometryData.html#Ogre_1_1GeometryDatam13">numBlendWeightsPerVertex</a> = 0;
00055 
00056         <font class="keywordflow">for</font> (<font class="keywordtype">int</font> i = 0; i &lt; <a class="code" href="OgreConfig_8h.html#a5">OGRE_MAX_TEXTURE_COORD_SETS</a>; ++i)
00057         {
00058             <a class="code" href="classOgre_1_1Mesh.html#Ogre_1_1Meshm0">sharedGeometry</a>.<a class="code" href="structOgre_1_1GeometryData.html#Ogre_1_1GeometryDatam6">pTexCoords</a>[i] = 0;
00059             <a class="code" href="classOgre_1_1Mesh.html#Ogre_1_1Meshm0">sharedGeometry</a>.<a class="code" href="structOgre_1_1GeometryData.html#Ogre_1_1GeometryDatam11">texCoordStride</a>[i] = 0;
00060         }
00061         <a class="code" href="classOgre_1_1Mesh.html#Ogre_1_1Meshm0">sharedGeometry</a>.<a class="code" href="structOgre_1_1GeometryData.html#Ogre_1_1GeometryDatam5">pVertices</a> = 0;
00062         <font class="comment">// Default to load from file</font>
00063         <a class="code" href="classOgre_1_1Mesh.html#Ogre_1_1Mesho2">mManuallyDefined</a> = <font class="keyword">false</font>;
00064         <a class="code" href="classOgre_1_1Mesh.html#Ogre_1_1Mesho3">mUpdateBounds</a> = <font class="keyword">true</font>;
00065         <a class="code" href="classOgre_1_1Mesh.html#Ogre_1_1Mesho4">mSkeleton</a> = 0;
00066         <a class="code" href="classOgre_1_1Mesh.html#Ogre_1_1Mesho6">mBoneAssignmentsOutOfDate</a> = <font class="keyword">false</font>;
00067 
00068     }
00069 
00070     <font class="comment">//-----------------------------------------------------------------------</font>
<a name="l00071"></a><a class="code" href="classOgre_1_1Mesh.html#Ogre_1_1Mesha1">00071</a>     Mesh::~Mesh()
00072     {
00073         <font class="keywordflow">if</font> (mIsLoaded)
00074         {
00075             <a class="code" href="classOgre_1_1Mesh.html#Ogre_1_1Mesha3">unload</a>();
00076         }
00077     }
00078 
00079     <font class="comment">//-----------------------------------------------------------------------</font>
<a name="l00080"></a><a class="code" href="classOgre_1_1Mesh.html#Ogre_1_1Mesha4">00080</a>     <a class="code" href="classOgre_1_1SubMesh.html">SubMesh</a>* Mesh::createSubMesh()
00081     {
00082         <a class="code" href="classOgre_1_1SubMesh.html">SubMesh</a>* sub = <font class="keyword">new</font> <a class="code" href="classOgre_1_1SubMesh.html">SubMesh</a>();
00083         sub-&gt;<a class="code" href="classOgre_1_1SubMesh.html#Ogre_1_1SubMeshm5">parent</a> = <font class="keyword">this</font>;
00084 
00085         <a class="code" href="classOgre_1_1Mesh.html#Ogre_1_1Mesho0">mSubMeshList</a>.push_back(sub);
00086 
00087         <font class="keywordflow">return</font> sub;
00088     }
00089     <font class="comment">//-----------------------------------------------------------------------</font>
<a name="l00090"></a><a class="code" href="classOgre_1_1Mesh.html#Ogre_1_1Mesha5">00090</a>     <font class="keywordtype">unsigned</font> <font class="keywordtype">short</font> Mesh::getNumSubMeshes()<font class="keyword"> const</font>
00091 <font class="keyword">    </font>{
00092         <font class="keywordflow">return</font> static_cast&lt; unsigned short &gt;( <a class="code" href="classOgre_1_1Mesh.html#Ogre_1_1Mesho0">mSubMeshList</a>.size() );
00093     }
00094 
00095     <font class="comment">//-----------------------------------------------------------------------</font>
<a name="l00096"></a><a class="code" href="classOgre_1_1Mesh.html#Ogre_1_1Mesha6">00096</a>     <a class="code" href="classOgre_1_1SubMesh.html">SubMesh</a>* Mesh::getSubMesh(<font class="keywordtype">unsigned</font> <font class="keywordtype">short</font> index)<font class="keyword"> const</font>
00097 <font class="keyword">    </font>{
00098         SubMeshList::const_iterator i = <a class="code" href="classOgre_1_1Mesh.html#Ogre_1_1Mesho0">mSubMeshList</a>.begin();
00099         <font class="keywordflow">return</font> const_cast&lt;SubMesh*&gt;(i[index]);
00100     }
00101 
00102     <font class="comment">//-----------------------------------------------------------------------</font>
<a name="l00103"></a><a class="code" href="classOgre_1_1Mesh.html#Ogre_1_1Mesha2">00103</a>     <font class="keywordtype">void</font> Mesh::load()
00104     {
00105         <font class="comment">// Load from specified 'name'</font>
00106         <font class="keywordflow">if</font> (mIsLoaded)
00107         {
00108             <a class="code" href="classOgre_1_1Mesh.html#Ogre_1_1Mesha3">unload</a>();
00109             <a class="code" href="classOgre_1_1Resource.html#Ogre_1_1Zipn1">mIsLoaded</a> = <font class="keyword">false</font>;
00110         }
00111 
00112         <font class="keywordflow">if</font> (!<a class="code" href="classOgre_1_1Mesh.html#Ogre_1_1Mesho2">mManuallyDefined</a>)
00113         {
00114             <a class="code" href="classOgre_1_1MeshSerializer.html">MeshSerializer</a> serializer;
00115             <font class="keywordtype">char</font> msg[100];
00116             sprintf(msg, <font class="stringliteral">"Mesh: Loading %s ."</font>, <a class="code" href="classOgre_1_1Resource.html#Ogre_1_1Zipn0">mName</a>.c_str());
00117             LogManager::getSingleton().logMessage(msg);
00118 
00119             <a class="code" href="classOgre_1_1DataChunk.html">DataChunk</a> chunk;
00120             MeshManager::getSingleton()._findResourceData(<a class="code" href="classOgre_1_1Resource.html#Ogre_1_1Zipn0">mName</a>, chunk);
00121 
00122             <font class="comment">// Determine file type</font>
00123             std::vector&lt;String&gt; extVec = <a class="code" href="classOgre_1_1Resource.html#Ogre_1_1Zipn0">mName</a>.<a class="code" href="classOgre_1_1String.html#Ogre_1_1Stringa6">split</a>(<font class="stringliteral">"."</font>);
00124 
00125             <a class="code" href="classOgre_1_1String.html">String</a>&amp; ext = extVec[extVec.size() - 1];
00126             ext.<a class="code" href="classOgre_1_1String.html#Ogre_1_1Stringa7">toLowerCase</a>();
00127 
00128             <font class="keywordflow">if</font> (ext == <font class="stringliteral">"oof"</font>)
00129             {
00130                 serializer.<a class="code" href="classOgre_1_1MeshSerializer.html#Ogre_1_1MeshSerializera4">importLegacyOof</a>(chunk, <font class="keyword">this</font>);
00131             }
00132             <font class="keywordflow">else</font> <font class="keywordflow">if</font> (ext == <font class="stringliteral">"mesh"</font>)
00133             {
00134                 serializer.<a class="code" href="classOgre_1_1MeshSerializer.html#Ogre_1_1MeshSerializera3">importMesh</a>(chunk, <font class="keyword">this</font>);
00135             }
00136             <font class="keywordflow">else</font>
00137             {
00138                 <font class="comment">// Unsupported format</font>
00139                 chunk.<a class="code" href="classOgre_1_1DataChunk.html#Ogre_1_1SDDataChunka4">clear</a>();
00140                 <a class="code" href="OgreException_8h.html#a0">Except</a>(999, <font class="stringliteral">"Unsupported object file format."</font>,
00141                     <font class="stringliteral">"Mesh::load"</font>);
00142             }
00143 
00144             chunk.<a class="code" href="classOgre_1_1DataChunk.html#Ogre_1_1SDDataChunka4">clear</a>();
00145         }
00146 
00147         <a class="code" href="classOgre_1_1Mesh.html#Ogre_1_1Mesha12">_updateBounds</a>();
00148 
00149     }
00150 
00151     <font class="comment">//-----------------------------------------------------------------------</font>
<a name="l00152"></a><a class="code" href="classOgre_1_1Mesh.html#Ogre_1_1Mesha3">00152</a>     <font class="keywordtype">void</font> Mesh::unload()
00153     {
00154         <font class="comment">// Teardown submeshes</font>
00155         <font class="keywordflow">for</font> (SubMeshList::iterator i = <a class="code" href="classOgre_1_1Mesh.html#Ogre_1_1Mesho0">mSubMeshList</a>.begin();
00156             i != <a class="code" href="classOgre_1_1Mesh.html#Ogre_1_1Mesho0">mSubMeshList</a>.end(); ++i)
00157         {
00158             <font class="keyword">delete</font> *i;
00159         }
00160         <font class="keywordflow">if</font> (<a class="code" href="classOgre_1_1Mesh.html#Ogre_1_1Meshm0">sharedGeometry</a>.<a class="code" href="structOgre_1_1GeometryData.html#Ogre_1_1GeometryDatam5">pVertices</a>)
00161         {
00162             <font class="keyword">delete</font>[] <a class="code" href="classOgre_1_1Mesh.html#Ogre_1_1Meshm0">sharedGeometry</a>.<a class="code" href="structOgre_1_1GeometryData.html#Ogre_1_1GeometryDatam5">pVertices</a>;
00163             <a class="code" href="classOgre_1_1Mesh.html#Ogre_1_1Meshm0">sharedGeometry</a>.<a class="code" href="structOgre_1_1GeometryData.html#Ogre_1_1GeometryDatam5">pVertices</a> = 0;
00164         }
00165         <font class="comment">// Deallocate individual components if they have their own buffers</font>
00166         <font class="comment">// NB Assuming that if some components use the same buffer, all do and vice versa</font>
00167         <font class="keywordflow">if</font> (<a class="code" href="classOgre_1_1Mesh.html#Ogre_1_1Meshm0">sharedGeometry</a>.<a class="code" href="structOgre_1_1GeometryData.html#Ogre_1_1GeometryDatam9">vertexStride</a> == 0)
00168         {
00169 
00170             <font class="comment">// Destroy shared buffers</font>
00171             <font class="keywordflow">if</font> (<a class="code" href="classOgre_1_1Mesh.html#Ogre_1_1Meshm0">sharedGeometry</a>.<a class="code" href="structOgre_1_1GeometryData.html#Ogre_1_1GeometryDatam8">pColours</a>)
00172             {
00173                 <font class="keyword">delete</font>[] <a class="code" href="classOgre_1_1Mesh.html#Ogre_1_1Meshm0">sharedGeometry</a>.<a class="code" href="structOgre_1_1GeometryData.html#Ogre_1_1GeometryDatam8">pColours</a>;
00174                 <a class="code" href="classOgre_1_1Mesh.html#Ogre_1_1Meshm0">sharedGeometry</a>.<a class="code" href="structOgre_1_1GeometryData.html#Ogre_1_1GeometryDatam8">pColours</a> = 0;
00175             }
00176             <font class="keywordflow">if</font> (<a class="code" href="classOgre_1_1Mesh.html#Ogre_1_1Meshm0">sharedGeometry</a>.<a class="code" href="structOgre_1_1GeometryData.html#Ogre_1_1GeometryDatam7">pNormals</a>)
00177             {
00178                 <font class="keyword">delete</font>[] <a class="code" href="classOgre_1_1Mesh.html#Ogre_1_1Meshm0">sharedGeometry</a>.<a class="code" href="structOgre_1_1GeometryData.html#Ogre_1_1GeometryDatam7">pNormals</a>;
00179                 <a class="code" href="classOgre_1_1Mesh.html#Ogre_1_1Meshm0">sharedGeometry</a>.<a class="code" href="structOgre_1_1GeometryData.html#Ogre_1_1GeometryDatam7">pNormals</a> = 0;
00180             }
00181             <font class="keywordflow">for</font> (<font class="keywordtype">int</font> j = 0; j &lt; <a class="code" href="OgreConfig_8h.html#a5">OGRE_MAX_TEXTURE_COORD_SETS</a>; ++j)
00182             {
00183                 <font class="keywordflow">if</font> (<a class="code" href="classOgre_1_1Mesh.html#Ogre_1_1Meshm0">sharedGeometry</a>.<a class="code" href="structOgre_1_1GeometryData.html#Ogre_1_1GeometryDatam6">pTexCoords</a>[j])
00184                 {
00185                     <font class="keyword">delete</font>[] <a class="code" href="classOgre_1_1Mesh.html#Ogre_1_1Meshm0">sharedGeometry</a>.<a class="code" href="structOgre_1_1GeometryData.html#Ogre_1_1GeometryDatam6">pTexCoords</a>[j];
00186                     <a class="code" href="classOgre_1_1Mesh.html#Ogre_1_1Meshm0">sharedGeometry</a>.<a class="code" href="structOgre_1_1GeometryData.html#Ogre_1_1GeometryDatam6">pTexCoords</a>[j] = 0;
00187                 }
00188             }
00189         }
00190 
00191     }
00192 
00193     <font class="comment">//-----------------------------------------------------------------------</font>
<a name="l00194"></a><a class="code" href="classOgre_1_1Mesh.html#Ogre_1_1Mesha10">00194</a>     <font class="keywordtype">void</font> Mesh::_dumpContents(<a class="code" href="classOgre_1_1String.html">String</a> filename)
00195     {
00196         std::ofstream <a class="code" href="namespaceOgre.html#a348">of</a>;
00197 
00198         <a class="code" href="namespaceOgre.html#a348">of</a>.open(filename);
00199 
00200         <a class="code" href="namespaceOgre.html#a348">of</a> &lt;&lt; <font class="stringliteral">"-= Debug output of model "</font> &lt;&lt; <a class="code" href="classOgre_1_1Resource.html#Ogre_1_1Zipn0">mName</a> &lt;&lt; <font class="stringliteral">" =-"</font> &lt;&lt; std::endl &lt;&lt; std::endl;
00201         <font class="keywordflow">if</font> (<a class="code" href="classOgre_1_1Mesh.html#Ogre_1_1Meshm0">sharedGeometry</a>.<a class="code" href="structOgre_1_1GeometryData.html#Ogre_1_1GeometryDatam0">numVertices</a> &gt; 0)
00202         {
00203             <a class="code" href="namespaceOgre.html#a348">of</a> &lt;&lt; <font class="stringliteral">"-= Shared geometry =- "</font> &lt;&lt; std::endl;
00204             <a class="code" href="classOgre_1_1Mesh.html#Ogre_1_1Mesha11">_dumpGeometry</a>(<a class="code" href="classOgre_1_1Mesh.html#Ogre_1_1Meshm0">sharedGeometry</a>, <a class="code" href="namespaceOgre.html#a348">of</a>);
00205         }
00206 
00207         <font class="keywordflow">for</font> (SubMeshList::iterator i = <a class="code" href="classOgre_1_1Mesh.html#Ogre_1_1Mesho0">mSubMeshList</a>.begin(); i != <a class="code" href="classOgre_1_1Mesh.html#Ogre_1_1Mesho0">mSubMeshList</a>.end(); ++i)
00208         {
00209             <a class="code" href="namespaceOgre.html#a348">of</a> &lt;&lt; <font class="stringliteral">"-= SubMesh Entry =-"</font> &lt;&lt; std::endl;
00210             <a class="code" href="namespaceOgre.html#a348">of</a> &lt;&lt; <font class="stringliteral">"Material Name = "</font> &lt;&lt; (*i)-&gt;getMaterialName() &lt;&lt; std::endl;
00211             <a class="code" href="namespaceOgre.html#a348">of</a> &lt;&lt; <font class="stringliteral">"numFaces = "</font> &lt;&lt; (*i)-&gt;numFaces &lt;&lt; std::endl;
00212             <a class="code" href="namespaceOgre.html#a348">of</a> &lt;&lt; <font class="stringliteral">"useSharedVertices = "</font> &lt;&lt; (*i)-&gt;useSharedVertices &lt;&lt; std::endl;
00213             <font class="keywordflow">if</font> (!(*i)-&gt;useSharedVertices)
00214             {
00215                 <a class="code" href="namespaceOgre.html#a348">of</a> &lt;&lt; <font class="stringliteral">"-= Dedicated Geometry =-"</font> &lt;&lt; std::endl;
00216                 <a class="code" href="classOgre_1_1Mesh.html#Ogre_1_1Mesha11">_dumpGeometry</a>((*i)-&gt;geometry, <a class="code" href="namespaceOgre.html#a348">of</a>);
00217             }
00218 
00219             <a class="code" href="namespaceOgre.html#a348">of</a> &lt;&lt; <font class="stringliteral">"-= Face List =-"</font> &lt;&lt; std::endl;
00220             <font class="keywordflow">for</font> (<font class="keywordtype">int</font> idx = 0; idx &lt; (*i)-&gt;numFaces; ++idx)
00221             {
00222                 <a class="code" href="namespaceOgre.html#a348">of</a> &lt;&lt; (*i)-&gt;faceVertexIndices[idx*3] &lt;&lt; <font class="stringliteral">", "</font> &lt;&lt;
00223                     (*i)-&gt;faceVertexIndices[(idx*3) + 1] &lt;&lt; <font class="stringliteral">", "</font> &lt;&lt;
00224                     (*i)-&gt;faceVertexIndices[(idx*3) + 2] &lt;&lt; std::endl;
00225             }
00226         }
00227 
00228         <a class="code" href="namespaceOgre.html#a348">of</a>.close();
00229 
00230 
00231     }
00232 
<a name="l00233"></a><a class="code" href="classOgre_1_1Mesh.html#Ogre_1_1Mesha11">00233</a>     <font class="keywordtype">void</font> Mesh::_dumpGeometry(<a class="code" href="structOgre_1_1GeometryData.html">GeometryData</a> &amp;g, std::ofstream&amp; <a class="code" href="namespaceOgre.html#a348">of</a>)
00234     {
00235         <font class="keywordtype">int</font> i;
00236 
00237         <a class="code" href="namespaceOgre.html#a348">of</a> &lt;&lt; <font class="stringliteral">"hasColours = "</font> &lt;&lt; g.<a class="code" href="structOgre_1_1GeometryData.html#Ogre_1_1GeometryDatam4">hasColours</a> &lt;&lt; std::endl;
00238         <a class="code" href="namespaceOgre.html#a348">of</a> &lt;&lt; <font class="stringliteral">"hasNormals = "</font> &lt;&lt; g.<a class="code" href="structOgre_1_1GeometryData.html#Ogre_1_1GeometryDatam1">hasNormals</a> &lt;&lt; std::endl;
00239         <a class="code" href="namespaceOgre.html#a348">of</a> &lt;&lt; <font class="stringliteral">"numTexCoords = "</font> &lt;&lt; g.<a class="code" href="structOgre_1_1GeometryData.html#Ogre_1_1GeometryDatam2">numTexCoords</a> &lt;&lt; std::endl;
00240         <font class="keywordflow">for</font> (i = 0; i &lt; g.<a class="code" href="structOgre_1_1GeometryData.html#Ogre_1_1GeometryDatam2">numTexCoords</a>; ++i)
00241             <a class="code" href="namespaceOgre.html#a348">of</a> &lt;&lt; <font class="stringliteral">"numTexCoordDimensions["</font> &lt;&lt; i &lt;&lt; <font class="stringliteral">"] = "</font> &lt;&lt; g.<a class="code" href="structOgre_1_1GeometryData.html#Ogre_1_1GeometryDatam3">numTexCoordDimensions</a>[i] &lt;&lt; std::endl;
00242         <a class="code" href="namespaceOgre.html#a348">of</a> &lt;&lt; <font class="stringliteral">"numVertices = "</font> &lt;&lt; g.<a class="code" href="structOgre_1_1GeometryData.html#Ogre_1_1GeometryDatam0">numVertices</a> &lt;&lt; std::endl;
00243         <font class="comment">// Write out vertices</font>
00244         <a class="code" href="namespaceOgre.html#a348">of</a> &lt;&lt; <font class="stringliteral">"Vertex Position Data:"</font> &lt;&lt; std::endl;
00245         <a class="code" href="namespaceOgre.html#a281">Real</a>* pReal = g.<a class="code" href="structOgre_1_1GeometryData.html#Ogre_1_1GeometryDatam5">pVertices</a>;
00246         <font class="keywordtype">unsigned</font> <font class="keywordtype">long</font>* pULong;
00247         <font class="keywordflow">for</font> (i = 0; i &lt; g.<a class="code" href="structOgre_1_1GeometryData.html#Ogre_1_1GeometryDatam0">numVertices</a>; ++i)
00248         {
00249             <a class="code" href="namespaceOgre.html#a348">of</a> &lt;&lt; *pReal++ &lt;&lt; <font class="stringliteral">", "</font> &lt;&lt;
00250                 *pReal++ &lt;&lt; <font class="stringliteral">", "</font> &lt;&lt;
00251                 *pReal++ &lt;&lt; std::endl;
00252             pReal = (<a class="code" href="namespaceOgre.html#a281">Real</a>*)((<font class="keywordtype">char</font>*)pReal + g.<a class="code" href="structOgre_1_1GeometryData.html#Ogre_1_1GeometryDatam9">vertexStride</a>);
00253         }
00254         <font class="keywordflow">if</font> (g.<a class="code" href="structOgre_1_1GeometryData.html#Ogre_1_1GeometryDatam4">hasColours</a>)
00255         {
00256             <font class="comment">// Write out colours</font>
00257             <a class="code" href="namespaceOgre.html#a348">of</a> &lt;&lt; <font class="stringliteral">"Vertex Colour Data:"</font> &lt;&lt; std::endl;
00258             pULong = g.<a class="code" href="structOgre_1_1GeometryData.html#Ogre_1_1GeometryDatam8">pColours</a>;
00259             <font class="keywordflow">for</font> (<font class="keywordtype">int</font> i = 0; i &lt; g.<a class="code" href="structOgre_1_1GeometryData.html#Ogre_1_1GeometryDatam0">numVertices</a>; ++i)
00260             {
00261                 <a class="code" href="namespaceOgre.html#a348">of</a> &lt;&lt; *pULong++ &lt;&lt; std::endl;
00262                 pULong = (<font class="keywordtype">unsigned</font> <font class="keywordtype">long</font>*)((<font class="keywordtype">char</font>*)pULong + g.<a class="code" href="structOgre_1_1GeometryData.html#Ogre_1_1GeometryDatam12">colourStride</a>);
00263             }
00264         }
00265         <font class="keywordflow">if</font> (g.<a class="code" href="structOgre_1_1GeometryData.html#Ogre_1_1GeometryDatam1">hasNormals</a>)
00266         {
00267             <font class="comment">// Write out Normals</font>
00268             <a class="code" href="namespaceOgre.html#a348">of</a> &lt;&lt; <font class="stringliteral">"Vertex Normal Data:"</font> &lt;&lt; std::endl;
00269             pReal = g.<a class="code" href="structOgre_1_1GeometryData.html#Ogre_1_1GeometryDatam7">pNormals</a>;
00270             <font class="keywordflow">for</font> (<font class="keywordtype">int</font> i = 0; i &lt; g.<a class="code" href="structOgre_1_1GeometryData.html#Ogre_1_1GeometryDatam0">numVertices</a>; ++i)
00271             {
00272                 <a class="code" href="namespaceOgre.html#a348">of</a> &lt;&lt; *pReal++ &lt;&lt; <font class="stringliteral">", "</font> &lt;&lt;
00273                     *pReal++ &lt;&lt; <font class="stringliteral">", "</font> &lt;&lt;
00274                     *pReal++ &lt;&lt; std::endl;
00275                 pReal = (<a class="code" href="namespaceOgre.html#a281">Real</a>*)((<font class="keywordtype">char</font>*)pReal + g.<a class="code" href="structOgre_1_1GeometryData.html#Ogre_1_1GeometryDatam10">normalStride</a>);
00276             }
00277         }
00278         <font class="comment">// Write out textures</font>
00279         <a class="code" href="namespaceOgre.html#a348">of</a> &lt;&lt; <font class="stringliteral">"Vertex Texture Coordinate Data:"</font> &lt;&lt; std::endl;
00280         <font class="keywordtype">int</font> index;
00281         index = 0;
00282         <font class="keywordflow">for</font> (<font class="keywordtype">int</font> set = 0; set &lt; g.<a class="code" href="structOgre_1_1GeometryData.html#Ogre_1_1GeometryDatam2">numTexCoords</a>; ++set)
00283         {
00284             <a class="code" href="namespaceOgre.html#a348">of</a> &lt;&lt; <font class="stringliteral">"Set "</font> &lt;&lt; set &lt;&lt; <font class="stringliteral">":"</font> &lt;&lt; std::endl;
00285             pReal = g.<a class="code" href="structOgre_1_1GeometryData.html#Ogre_1_1GeometryDatam6">pTexCoords</a>[set];
00286             <font class="keywordflow">for</font> ( i = 0; i &lt; g.<a class="code" href="structOgre_1_1GeometryData.html#Ogre_1_1GeometryDatam0">numVertices</a>; ++i)
00287             {
00288                 <font class="keywordflow">for</font> (<font class="keywordtype">int</font> d = 0; d &lt; g.<a class="code" href="structOgre_1_1GeometryData.html#Ogre_1_1GeometryDatam3">numTexCoordDimensions</a>[set]; ++ d)
00289                 {
00290                     <a class="code" href="namespaceOgre.html#a348">of</a> &lt;&lt; *pReal++ &lt;&lt; <font class="stringliteral">" "</font>;
00291                 }
00292                 <a class="code" href="namespaceOgre.html#a348">of</a> &lt;&lt; std::endl;
00293                 pReal = (<a class="code" href="namespaceOgre.html#a281">Real</a>*)((<font class="keywordtype">char</font>*)pReal + g.<a class="code" href="structOgre_1_1GeometryData.html#Ogre_1_1GeometryDatam11">texCoordStride</a>[set]);
00294             }
00295         }
00296 
00297 
00298     }
00299 
00300     <font class="comment">//-----------------------------------------------------------------------</font>
<a name="l00301"></a><a class="code" href="classOgre_1_1Mesh.html#Ogre_1_1Mesha7">00301</a>     <font class="keywordtype">void</font> Mesh::setManuallyDefined(<font class="keywordtype">bool</font> manual)
00302     {
00303         <a class="code" href="classOgre_1_1Mesh.html#Ogre_1_1Mesho2">mManuallyDefined</a> = manual;
00304     }
00305 
00306     <font class="comment">//-----------------------------------------------------------------------</font>
<a name="l00307"></a><a class="code" href="classOgre_1_1Mesh.html#Ogre_1_1Mesha8">00307</a>     <a class="code" href="classOgre_1_1Mesh.html">Mesh</a>* Mesh::clone(<a class="code" href="classOgre_1_1String.html">String</a> newName)
00308     {
00309         <font class="comment">// This is a bit like a copy constructor, but with the additional aspect of registering the clone with</font>
00310         <font class="comment">//  the MeshManager</font>
00311 
00312         <font class="comment">// New Mesh is assumed to be manually defined rather than loaded since you're cloning it for a reason</font>
00313         <a class="code" href="classOgre_1_1Mesh.html">Mesh</a>* newMesh = MeshManager::getSingleton().createManual(newName);
00314 
00315         <font class="keywordtype">bool</font> isSharedGeometry;
00316         isSharedGeometry = <font class="keyword">false</font>;
00317 
00318         <font class="comment">// Copy submeshes first</font>
00319         std::vector&lt;SubMesh*&gt;::iterator subi;
00320         <a class="code" href="classOgre_1_1SubMesh.html">SubMesh</a>* newSub;
00321         <font class="keywordflow">for</font> (subi = <a class="code" href="classOgre_1_1Mesh.html#Ogre_1_1Mesho0">mSubMeshList</a>.begin(); subi != <a class="code" href="classOgre_1_1Mesh.html#Ogre_1_1Mesho0">mSubMeshList</a>.end(); ++subi)
00322         {
00323             newSub = newMesh-&gt;<a class="code" href="classOgre_1_1Mesh.html#Ogre_1_1Mesha4">createSubMesh</a>();
00324             newSub-&gt;<a class="code" href="classOgre_1_1SubMesh.html#Ogre_1_1SubMeshn0">mMaterialName</a> = (*subi)-&gt;mMaterialName;
00325             newSub-&gt;<a class="code" href="classOgre_1_1SubMesh.html#Ogre_1_1SubMeshn1">mMatInitialised</a> = (*subi)-&gt;mMatInitialised;
00326             newSub-&gt;<a class="code" href="classOgre_1_1SubMesh.html#Ogre_1_1SubMeshm3">numFaces</a> = (*subi)-&gt;numFaces;
00327             newSub-&gt;<a class="code" href="classOgre_1_1SubMesh.html#Ogre_1_1SubMeshm5">parent</a> = newMesh;
00328             newSub-&gt;<a class="code" href="classOgre_1_1SubMesh.html#Ogre_1_1SubMeshm0">useSharedVertices</a> = (*subi)-&gt;useSharedVertices;
00329             newSub-&gt;<a class="code" href="classOgre_1_1SubMesh.html#Ogre_1_1SubMeshm1">useTriStrips</a> = (*subi)-&gt;useTriStrips;
00330 
00331             <font class="keywordflow">if</font> ((*subi)-&gt;useSharedVertices)
00332             {
00333                 <font class="comment">// Make a note to copy shared geometry later</font>
00334                 isSharedGeometry = <font class="keyword">true</font>;
00335             }
00336             <font class="keywordflow">else</font>
00337             {
00338                 <font class="comment">// Copy unique geometry</font>
00339                 <a class="code" href="classOgre_1_1Mesh.html#Ogre_1_1Meshc0">cloneGeometry</a>((*subi)-&gt;geometry, newSub-&gt;<a class="code" href="classOgre_1_1SubMesh.html#Ogre_1_1SubMeshm2">geometry</a>);
00340             }
00341 
00342             <font class="comment">// Copy indexes</font>
00343             <font class="keywordtype">int</font> numIndexes;
00344 
00345             <font class="keywordflow">if</font> ((*subi)-&gt;useTriStrips)
00346             {
00347                 numIndexes = (*subi)-&gt;numFaces + 2;
00348             }
00349             <font class="keywordflow">else</font>
00350             {
00351                 numIndexes = (*subi)-&gt;numFaces * 3;
00352             }
00353             newSub-&gt;<a class="code" href="classOgre_1_1SubMesh.html#Ogre_1_1SubMeshm4">faceVertexIndices</a> = <font class="keyword">new</font> <font class="keywordtype">unsigned</font> <font class="keywordtype">short</font>[numIndexes];
00354             memcpy(newSub-&gt;<a class="code" href="classOgre_1_1SubMesh.html#Ogre_1_1SubMeshm4">faceVertexIndices</a>, (*subi)-&gt;faceVertexIndices, <font class="keyword">sizeof</font>(<font class="keywordtype">unsigned</font> <font class="keywordtype">short</font>) * numIndexes);
00355 
00356         }
00357 
00358         <font class="comment">// Copy shared geometry, if any</font>
00359         <font class="keywordflow">if</font> (isSharedGeometry)
00360         {
00361             <a class="code" href="classOgre_1_1Mesh.html#Ogre_1_1Meshc0">cloneGeometry</a>(<a class="code" href="classOgre_1_1Mesh.html#Ogre_1_1Meshm0">sharedGeometry</a>, newMesh-&gt;<a class="code" href="classOgre_1_1Mesh.html#Ogre_1_1Meshm0">sharedGeometry</a>);
00362         }
00363 
00364         <font class="keywordflow">return</font> newMesh;
00365 
00366     }
00367     <font class="comment">//-----------------------------------------------------------------------</font>
<a name="l00368"></a><a class="code" href="classOgre_1_1Mesh.html#Ogre_1_1Meshc0">00368</a>     <font class="keywordtype">void</font> Mesh::cloneGeometry(<a class="code" href="structOgre_1_1GeometryData.html">GeometryData</a>&amp; source, <a class="code" href="structOgre_1_1GeometryData.html">GeometryData</a>&amp; dest)
00369     {
00370         <font class="keywordtype">int</font> tex;
00371 
00372         dest.<a class="code" href="structOgre_1_1GeometryData.html#Ogre_1_1GeometryDatam12">colourStride</a> = source.<a class="code" href="structOgre_1_1GeometryData.html#Ogre_1_1GeometryDatam12">colourStride</a>;
00373         dest.<a class="code" href="structOgre_1_1GeometryData.html#Ogre_1_1GeometryDatam4">hasColours</a> = source.<a class="code" href="structOgre_1_1GeometryData.html#Ogre_1_1GeometryDatam4">hasColours</a>;
00374         dest.<a class="code" href="structOgre_1_1GeometryData.html#Ogre_1_1GeometryDatam1">hasNormals</a> = source.<a class="code" href="structOgre_1_1GeometryData.html#Ogre_1_1GeometryDatam1">hasNormals</a>;
00375         dest.<a class="code" href="structOgre_1_1GeometryData.html#Ogre_1_1GeometryDatam10">normalStride</a> = source.<a class="code" href="structOgre_1_1GeometryData.html#Ogre_1_1GeometryDatam10">normalStride</a>;
00376         dest.<a class="code" href="structOgre_1_1GeometryData.html#Ogre_1_1GeometryDatam2">numTexCoords</a> = source.<a class="code" href="structOgre_1_1GeometryData.html#Ogre_1_1GeometryDatam2">numTexCoords</a>;
00377         <font class="keywordflow">for</font> (tex = 0; tex &lt; source.<a class="code" href="structOgre_1_1GeometryData.html#Ogre_1_1GeometryDatam2">numTexCoords</a>; ++tex)
00378         {
00379             dest.<a class="code" href="structOgre_1_1GeometryData.html#Ogre_1_1GeometryDatam3">numTexCoordDimensions</a>[tex] = source.<a class="code" href="structOgre_1_1GeometryData.html#Ogre_1_1GeometryDatam3">numTexCoordDimensions</a>[tex];
00380             dest.<a class="code" href="structOgre_1_1GeometryData.html#Ogre_1_1GeometryDatam11">texCoordStride</a>[tex] = source.<a class="code" href="structOgre_1_1GeometryData.html#Ogre_1_1GeometryDatam11">texCoordStride</a>[tex];
00381         }
00382         dest.<a class="code" href="structOgre_1_1GeometryData.html#Ogre_1_1GeometryDatam0">numVertices</a> = source.<a class="code" href="structOgre_1_1GeometryData.html#Ogre_1_1GeometryDatam0">numVertices</a>;
00383         dest.<a class="code" href="structOgre_1_1GeometryData.html#Ogre_1_1GeometryDatam9">vertexStride</a> = source.<a class="code" href="structOgre_1_1GeometryData.html#Ogre_1_1GeometryDatam9">vertexStride</a>;
00384 
00385         <font class="comment">// Create geometry</font>
00386         dest.<a class="code" href="structOgre_1_1GeometryData.html#Ogre_1_1GeometryDatam5">pVertices</a> = <font class="keyword">new</font> <a class="code" href="namespaceOgre.html#a281">Real</a>[source.<a class="code" href="structOgre_1_1GeometryData.html#Ogre_1_1GeometryDatam0">numVertices</a> * 3];
00387         memcpy(dest.<a class="code" href="structOgre_1_1GeometryData.html#Ogre_1_1GeometryDatam5">pVertices</a>, source.<a class="code" href="structOgre_1_1GeometryData.html#Ogre_1_1GeometryDatam5">pVertices</a>, <font class="keyword">sizeof</font>(<a class="code" href="namespaceOgre.html#a281">Real</a>) * source.<a class="code" href="structOgre_1_1GeometryData.html#Ogre_1_1GeometryDatam0">numVertices</a> * 3);
00388 
00389         <font class="keywordflow">if</font> (source.<a class="code" href="structOgre_1_1GeometryData.html#Ogre_1_1GeometryDatam4">hasColours</a>)
00390         {
00391             dest.<a class="code" href="structOgre_1_1GeometryData.html#Ogre_1_1GeometryDatam8">pColours</a> = <font class="keyword">new</font> <font class="keywordtype">unsigned</font> <font class="keywordtype">long</font>[source.<a class="code" href="structOgre_1_1GeometryData.html#Ogre_1_1GeometryDatam0">numVertices</a>];
00392             memcpy(dest.<a class="code" href="structOgre_1_1GeometryData.html#Ogre_1_1GeometryDatam8">pColours</a>, source.<a class="code" href="structOgre_1_1GeometryData.html#Ogre_1_1GeometryDatam8">pColours</a>, <font class="keyword">sizeof</font>(<font class="keywordtype">int</font>) * source.<a class="code" href="structOgre_1_1GeometryData.html#Ogre_1_1GeometryDatam0">numVertices</a>);
00393         }
00394         <font class="keywordflow">if</font> (source.<a class="code" href="structOgre_1_1GeometryData.html#Ogre_1_1GeometryDatam1">hasNormals</a>)
00395         {
00396             dest.<a class="code" href="structOgre_1_1GeometryData.html#Ogre_1_1GeometryDatam7">pNormals</a> = <font class="keyword">new</font> <a class="code" href="namespaceOgre.html#a281">Real</a>[source.<a class="code" href="structOgre_1_1GeometryData.html#Ogre_1_1GeometryDatam0">numVertices</a> * 3];
00397             memcpy(dest.<a class="code" href="structOgre_1_1GeometryData.html#Ogre_1_1GeometryDatam7">pNormals</a>, source.<a class="code" href="structOgre_1_1GeometryData.html#Ogre_1_1GeometryDatam7">pNormals</a>, <font class="keyword">sizeof</font>(<a class="code" href="namespaceOgre.html#a281">Real</a>) * source.<a class="code" href="structOgre_1_1GeometryData.html#Ogre_1_1GeometryDatam0">numVertices</a> * 3);
00398         }
00399         <font class="keywordflow">for</font> (tex = 0; tex &lt; source.<a class="code" href="structOgre_1_1GeometryData.html#Ogre_1_1GeometryDatam2">numTexCoords</a>; ++tex)
00400         {
00401             dest.<a class="code" href="structOgre_1_1GeometryData.html#Ogre_1_1GeometryDatam6">pTexCoords</a>[tex] = <font class="keyword">new</font> <a class="code" href="namespaceOgre.html#a281">Real</a>[source.<a class="code" href="structOgre_1_1GeometryData.html#Ogre_1_1GeometryDatam0">numVertices</a> * source.<a class="code" href="structOgre_1_1GeometryData.html#Ogre_1_1GeometryDatam3">numTexCoordDimensions</a>[tex]];
00402             memcpy(dest.<a class="code" href="structOgre_1_1GeometryData.html#Ogre_1_1GeometryDatam6">pTexCoords</a>[tex], source.<a class="code" href="structOgre_1_1GeometryData.html#Ogre_1_1GeometryDatam6">pTexCoords</a>[tex], <font class="keyword">sizeof</font>(<a class="code" href="namespaceOgre.html#a281">Real</a>) * source.<a class="code" href="structOgre_1_1GeometryData.html#Ogre_1_1GeometryDatam0">numVertices</a> *
00403                                                                         source.<a class="code" href="structOgre_1_1GeometryData.html#Ogre_1_1GeometryDatam3">numTexCoordDimensions</a>[tex]);
00404         }
00405     }
00406     <font class="comment">//-----------------------------------------------------------------------</font>
<a name="l00407"></a><a class="code" href="classOgre_1_1Mesh.html#Ogre_1_1Mesha12">00407</a>     <font class="keywordtype">void</font> Mesh::_updateBounds(<font class="keywordtype">void</font>)
00408     {
00409         <a class="code" href="classOgre_1_1Vector3.html">Vector3</a> min, max;
00410         <font class="keywordtype">bool</font> first = <font class="keyword">true</font>;
00411         <font class="keywordtype">bool</font> useShared = <font class="keyword">false</font>;
00412         <font class="keywordtype">int</font> vert;
00413 
00414         <font class="comment">// Loop through SubMeshes, find extents</font>
00415         SubMeshList::iterator i;
00416         <font class="keywordflow">for</font> (i = <a class="code" href="classOgre_1_1Mesh.html#Ogre_1_1Mesho0">mSubMeshList</a>.begin(); i != <a class="code" href="classOgre_1_1Mesh.html#Ogre_1_1Mesho0">mSubMeshList</a>.end(); ++i)
00417         {
00418             <font class="keywordflow">if</font> ((*i)-&gt;useSharedVertices)
00419             {
00420                 useShared = <font class="keyword">true</font>;
00421             }
00422             <font class="keywordflow">else</font>
00423             {
00424                 <font class="keywordflow">for</font> (vert = 0; vert &lt; (*i)-&gt;geometry.numVertices * 3; vert+=3)
00425                 {
00426                     <font class="keywordflow">if</font> (first || (*i)-&gt;geometry.pVertices[vert] &lt; min.<a class="code" href="classOgre_1_1Vector3.html#Ogre_1_1Vector3m0">x</a>)
00427                     {
00428                         min.<a class="code" href="classOgre_1_1Vector3.html#Ogre_1_1Vector3m0">x</a> = (*i)-&gt;geometry.pVertices[vert];
00429                     }
00430                     <font class="keywordflow">if</font> (first || (*i)-&gt;geometry.pVertices[vert+1] &lt; min.<a class="code" href="classOgre_1_1Vector3.html#Ogre_1_1Vector3m1">y</a>)
00431                     {
00432                         min.<a class="code" href="classOgre_1_1Vector3.html#Ogre_1_1Vector3m1">y</a> = (*i)-&gt;geometry.pVertices[vert+1];
00433                     }
00434                     <font class="keywordflow">if</font> (first || (*i)-&gt;geometry.pVertices[vert+2] &lt; min.<a class="code" href="classOgre_1_1Vector3.html#Ogre_1_1Vector3m2">z</a>)
00435                     {
00436                         min.<a class="code" href="classOgre_1_1Vector3.html#Ogre_1_1Vector3m2">z</a> = (*i)-&gt;geometry.pVertices[vert+2];
00437                     }
00438                     <font class="keywordflow">if</font> (first || (*i)-&gt;geometry.pVertices[vert] &gt; max.<a class="code" href="classOgre_1_1Vector3.html#Ogre_1_1Vector3m0">x</a>)
00439                     {
00440                         max.<a class="code" href="classOgre_1_1Vector3.html#Ogre_1_1Vector3m0">x</a> = (*i)-&gt;geometry.pVertices[vert];
00441                     }
00442                     <font class="keywordflow">if</font> (first || (*i)-&gt;geometry.pVertices[vert+1] &gt; max.<a class="code" href="classOgre_1_1Vector3.html#Ogre_1_1Vector3m1">y</a>)
00443                     {
00444                         max.<a class="code" href="classOgre_1_1Vector3.html#Ogre_1_1Vector3m1">y</a> = (*i)-&gt;geometry.pVertices[vert+1];
00445                     }
00446                     <font class="keywordflow">if</font> (first || (*i)-&gt;geometry.pVertices[vert+2] &gt; max.<a class="code" href="classOgre_1_1Vector3.html#Ogre_1_1Vector3m2">z</a>)
00447                     {
00448                         max.<a class="code" href="classOgre_1_1Vector3.html#Ogre_1_1Vector3m2">z</a> = (*i)-&gt;geometry.pVertices[vert+2];
00449                     }
00450                     first = <font class="keyword">false</font>;
00451                 }
00452             }
00453         }
00454 
00455         <font class="comment">// Check shared</font>
00456         <font class="keywordflow">if</font> (useShared)
00457         {
00458             <font class="keywordflow">for</font> (vert = 0; vert &lt; <a class="code" href="classOgre_1_1Mesh.html#Ogre_1_1Meshm0">sharedGeometry</a>.<a class="code" href="structOgre_1_1GeometryData.html#Ogre_1_1GeometryDatam0">numVertices</a> * 3; vert+=3)
00459             {
00460                 <font class="keywordflow">if</font> (first || <a class="code" href="classOgre_1_1Mesh.html#Ogre_1_1Meshm0">sharedGeometry</a>.<a class="code" href="structOgre_1_1GeometryData.html#Ogre_1_1GeometryDatam5">pVertices</a>[vert] &lt; min.<a class="code" href="classOgre_1_1Vector3.html#Ogre_1_1Vector3m0">x</a>)
00461                 {
00462                     min.<a class="code" href="classOgre_1_1Vector3.html#Ogre_1_1Vector3m0">x</a> = <a class="code" href="classOgre_1_1Mesh.html#Ogre_1_1Meshm0">sharedGeometry</a>.<a class="code" href="structOgre_1_1GeometryData.html#Ogre_1_1GeometryDatam5">pVertices</a>[vert];
00463                 }
00464                 <font class="keywordflow">if</font> (first || <a class="code" href="classOgre_1_1Mesh.html#Ogre_1_1Meshm0">sharedGeometry</a>.<a class="code" href="structOgre_1_1GeometryData.html#Ogre_1_1GeometryDatam5">pVertices</a>[vert+1] &lt; min.<a class="code" href="classOgre_1_1Vector3.html#Ogre_1_1Vector3m1">y</a>)
00465                 {
00466                     min.<a class="code" href="classOgre_1_1Vector3.html#Ogre_1_1Vector3m1">y</a> = <a class="code" href="classOgre_1_1Mesh.html#Ogre_1_1Meshm0">sharedGeometry</a>.<a class="code" href="structOgre_1_1GeometryData.html#Ogre_1_1GeometryDatam5">pVertices</a>[vert+1];
00467                 }
00468                 <font class="keywordflow">if</font> (first || <a class="code" href="classOgre_1_1Mesh.html#Ogre_1_1Meshm0">sharedGeometry</a>.<a class="code" href="structOgre_1_1GeometryData.html#Ogre_1_1GeometryDatam5">pVertices</a>[vert+2] &lt; min.<a class="code" href="classOgre_1_1Vector3.html#Ogre_1_1Vector3m2">z</a>)
00469                 {
00470                     min.<a class="code" href="classOgre_1_1Vector3.html#Ogre_1_1Vector3m2">z</a> = <a class="code" href="classOgre_1_1Mesh.html#Ogre_1_1Meshm0">sharedGeometry</a>.<a class="code" href="structOgre_1_1GeometryData.html#Ogre_1_1GeometryDatam5">pVertices</a>[vert+2];
00471                 }
00472                 <font class="keywordflow">if</font> (first || <a class="code" href="classOgre_1_1Mesh.html#Ogre_1_1Meshm0">sharedGeometry</a>.<a class="code" href="structOgre_1_1GeometryData.html#Ogre_1_1GeometryDatam5">pVertices</a>[vert] &gt; max.<a class="code" href="classOgre_1_1Vector3.html#Ogre_1_1Vector3m0">x</a>)
00473                 {
00474                     max.<a class="code" href="classOgre_1_1Vector3.html#Ogre_1_1Vector3m0">x</a> = <a class="code" href="classOgre_1_1Mesh.html#Ogre_1_1Meshm0">sharedGeometry</a>.<a class="code" href="structOgre_1_1GeometryData.html#Ogre_1_1GeometryDatam5">pVertices</a>[vert];
00475                 }
00476                 <font class="keywordflow">if</font> (first || <a class="code" href="classOgre_1_1Mesh.html#Ogre_1_1Meshm0">sharedGeometry</a>.<a class="code" href="structOgre_1_1GeometryData.html#Ogre_1_1GeometryDatam5">pVertices</a>[vert+1] &gt; max.<a class="code" href="classOgre_1_1Vector3.html#Ogre_1_1Vector3m1">y</a>)
00477                 {
00478                     max.<a class="code" href="classOgre_1_1Vector3.html#Ogre_1_1Vector3m1">y</a> = <a class="code" href="classOgre_1_1Mesh.html#Ogre_1_1Meshm0">sharedGeometry</a>.<a class="code" href="structOgre_1_1GeometryData.html#Ogre_1_1GeometryDatam5">pVertices</a>[vert+1];
00479                 }
00480                 <font class="keywordflow">if</font> (first || <a class="code" href="classOgre_1_1Mesh.html#Ogre_1_1Meshm0">sharedGeometry</a>.<a class="code" href="structOgre_1_1GeometryData.html#Ogre_1_1GeometryDatam5">pVertices</a>[vert+2] &gt; max.<a class="code" href="classOgre_1_1Vector3.html#Ogre_1_1Vector3m2">z</a>)
00481                 {
00482                     max.<a class="code" href="classOgre_1_1Vector3.html#Ogre_1_1Vector3m2">z</a> = <a class="code" href="classOgre_1_1Mesh.html#Ogre_1_1Meshm0">sharedGeometry</a>.<a class="code" href="structOgre_1_1GeometryData.html#Ogre_1_1GeometryDatam5">pVertices</a>[vert+2];
00483                 }
00484                 first = <font class="keyword">false</font>;
00485             }
00486         }
00487 
00488         <a class="code" href="classOgre_1_1Mesh.html#Ogre_1_1Mesho1">mAABB</a>.<a class="code" href="classOgre_1_1AxisAlignedBox.html#Ogre_1_1AxisAlignedBoxa9">setExtents</a>(min,max);
00489         <a class="code" href="classOgre_1_1Mesh.html#Ogre_1_1Mesho3">mUpdateBounds</a> = <font class="keyword">false</font>;
00490 
00491     }
00492     <font class="comment">//-----------------------------------------------------------------------</font>
<a name="l00493"></a><a class="code" href="classOgre_1_1Mesh.html#Ogre_1_1Mesha9">00493</a>     <font class="keyword">const</font> <a class="code" href="classOgre_1_1AxisAlignedBox.html">AxisAlignedBox</a>&amp; Mesh::getBounds(<font class="keywordtype">void</font>)
00494     {
00495         <font class="keywordflow">if</font> (mUpdateBounds)
00496             <a class="code" href="classOgre_1_1Mesh.html#Ogre_1_1Mesha12">_updateBounds</a>();
00497         <font class="keywordflow">return</font> <a class="code" href="classOgre_1_1Mesh.html#Ogre_1_1Mesho1">mAABB</a>;
00498     }
00499     <font class="comment">//-----------------------------------------------------------------------</font>
<a name="l00500"></a><a class="code" href="classOgre_1_1Mesh.html#Ogre_1_1Mesha13">00500</a>     <font class="keywordtype">void</font> Mesh::_setBounds(<font class="keyword">const</font> <a class="code" href="classOgre_1_1AxisAlignedBox.html">AxisAlignedBox</a>&amp; bounds)
00501     {
00502         <a class="code" href="classOgre_1_1Mesh.html#Ogre_1_1Mesho1">mAABB</a> = bounds;
00503         <a class="code" href="classOgre_1_1Mesh.html#Ogre_1_1Mesho3">mUpdateBounds</a> = <font class="keyword">false</font>;
00504     }
00505     <font class="comment">//-----------------------------------------------------------------------</font>
<a name="l00506"></a><a class="code" href="classOgre_1_1Mesh.html#Ogre_1_1Mesha14">00506</a>     <font class="keywordtype">void</font> Mesh::setSkeletonName(<font class="keyword">const</font> <a class="code" href="classOgre_1_1String.html">String</a>&amp; skelName)
00507     {
00508         <font class="keywordflow">if</font> (skelName == <font class="stringliteral">""</font>)
00509         {
00510             <font class="comment">// No skeleton</font>
00511             <a class="code" href="classOgre_1_1Mesh.html#Ogre_1_1Mesho4">mSkeleton</a> = 0;
00512         }
00513         <font class="keywordflow">else</font>
00514         {
00515             <font class="comment">// Load skeleton</font>
00516             <a class="code" href="classOgre_1_1Mesh.html#Ogre_1_1Mesho4">mSkeleton</a> = SkeletonManager::getSingleton().<a class="code" href="classOgre_1_1Skeleton.html#Ogre_1_1Skeletona2">load</a>(skelName);
00517 
00518 
00519         }
00520     }
00521     <font class="comment">//-----------------------------------------------------------------------</font>
<a name="l00522"></a><a class="code" href="classOgre_1_1Mesh.html#Ogre_1_1Mesha15">00522</a>     <font class="keywordtype">bool</font> Mesh::hasSkeleton(<font class="keywordtype">void</font>)<font class="keyword"> const</font>
00523 <font class="keyword">    </font>{
00524         <font class="keywordflow">return</font> <a class="code" href="classOgre_1_1Mesh.html#Ogre_1_1Mesho4">mSkeleton</a> != 0;
00525     }
00526     <font class="comment">//-----------------------------------------------------------------------</font>
<a name="l00527"></a><a class="code" href="classOgre_1_1Mesh.html#Ogre_1_1Mesha16">00527</a>     <a class="code" href="classOgre_1_1Skeleton.html">Skeleton</a>* Mesh::getSkeleton(<font class="keywordtype">void</font>)<font class="keyword"> const</font>
00528 <font class="keyword">    </font>{
00529         <font class="keywordflow">return</font> <a class="code" href="classOgre_1_1Mesh.html#Ogre_1_1Mesho4">mSkeleton</a>;
00530     }
00531     <font class="comment">//-----------------------------------------------------------------------</font>
<a name="l00532"></a><a class="code" href="classOgre_1_1Mesh.html#Ogre_1_1Mesha18">00532</a>     <font class="keywordtype">void</font> Mesh::addBoneAssignment(<font class="keyword">const</font> <a class="code" href="structOgre_1_1VertexBoneAssignment__s.html">VertexBoneAssignment</a>&amp; vertBoneAssign)
00533     {
00534         <a class="code" href="classOgre_1_1Mesh.html#Ogre_1_1Mesho5">mBoneAssignments</a>.insert(
00535             VertexBoneAssignmentList::value_type(vertBoneAssign.<a class="code" href="structOgre_1_1VertexBoneAssignment__s.html#Ogre_1_1VertexBoneAssignment__sm0">vertexIndex</a>, vertBoneAssign));
00536         <a class="code" href="classOgre_1_1Mesh.html#Ogre_1_1Mesho6">mBoneAssignmentsOutOfDate</a> = <font class="keyword">true</font>;
00537     }
00538     <font class="comment">//-----------------------------------------------------------------------</font>
<a name="l00539"></a><a class="code" href="classOgre_1_1Mesh.html#Ogre_1_1Mesha19">00539</a>     <font class="keywordtype">void</font> Mesh::clearBoneAssignments(<font class="keywordtype">void</font>)
00540     {
00541         <a class="code" href="classOgre_1_1Mesh.html#Ogre_1_1Mesho5">mBoneAssignments</a>.clear();
00542     }
00543     <font class="comment">//-----------------------------------------------------------------------</font>
<a name="l00544"></a><a class="code" href="classOgre_1_1Mesh.html#Ogre_1_1Mesha17">00544</a>     <font class="keywordtype">void</font> Mesh::_initAnimationState(<a class="code" href="namespaceOgre.html#a0">AnimationStateSet</a>* animSet)
00545     {
00546         <font class="comment">// Delegate to Skeleton</font>
00547         assert(<a class="code" href="classOgre_1_1Mesh.html#Ogre_1_1Mesho4">mSkeleton</a> &amp;&amp; <font class="stringliteral">"Skeleton not present"</font>);
00548         <a class="code" href="classOgre_1_1Mesh.html#Ogre_1_1Mesho4">mSkeleton</a>-&gt;<a class="code" href="classOgre_1_1Skeleton.html#Ogre_1_1Skeletona18">_initAnimationState</a>(animSet);
00549 
00550         <font class="comment">// Take the opportunity to update the compiled bone assignments</font>
00551         <font class="keywordflow">if</font> (mBoneAssignmentsOutOfDate)
00552             <a class="code" href="classOgre_1_1Mesh.html#Ogre_1_1Meshc1">compileBoneAssignments</a>();
00553     }
00554     <font class="comment">//-----------------------------------------------------------------------</font>
<a name="l00555"></a><a class="code" href="classOgre_1_1Mesh.html#Ogre_1_1Mesha20">00555</a>     <font class="keywordtype">unsigned</font> <font class="keywordtype">short</font> Mesh::_getNumBoneMatrices(<font class="keywordtype">void</font>)
00556     {
00557         <font class="comment">// Delegate to Skeleton</font>
00558         assert(<a class="code" href="classOgre_1_1Mesh.html#Ogre_1_1Mesho4">mSkeleton</a> &amp;&amp; <font class="stringliteral">"Skeleton not present"</font>);
00559 
00560         <font class="keywordflow">return</font> <a class="code" href="classOgre_1_1Mesh.html#Ogre_1_1Mesho4">mSkeleton</a>-&gt;<a class="code" href="classOgre_1_1Skeleton.html#Ogre_1_1Skeletona7">getNumBones</a>();
00561     }
00562     <font class="comment">//-----------------------------------------------------------------------</font>
<a name="l00563"></a><a class="code" href="classOgre_1_1Mesh.html#Ogre_1_1Mesha21">00563</a>     <font class="keywordtype">void</font> Mesh::_getBoneMatrices(<font class="keyword">const</font> <a class="code" href="namespaceOgre.html#a0">AnimationStateSet</a>&amp; animSet, <a class="code" href="classOgre_1_1Matrix4.html">Matrix4</a>* pMatrices)
00564     {
00565         <font class="comment">// Delegate to Skeleton</font>
00566         assert(<a class="code" href="classOgre_1_1Mesh.html#Ogre_1_1Mesho4">mSkeleton</a> &amp;&amp; <font class="stringliteral">"Skeleton not present"</font>);
00567 
00568         <a class="code" href="classOgre_1_1Mesh.html#Ogre_1_1Mesho4">mSkeleton</a>-&gt;<a class="code" href="classOgre_1_1Skeleton.html#Ogre_1_1Skeletona16">setAnimationState</a>(animSet);
00569         <a class="code" href="classOgre_1_1Mesh.html#Ogre_1_1Mesho4">mSkeleton</a>-&gt;<a class="code" href="classOgre_1_1Skeleton.html#Ogre_1_1Skeletona19">_getBoneMatrices</a>(pMatrices);
00570 
00571     }
00572     <font class="comment">//-----------------------------------------------------------------------</font>
<a name="l00573"></a><a class="code" href="classOgre_1_1Mesh.html#Ogre_1_1Meshc1">00573</a>     <font class="keywordtype">void</font> Mesh::compileBoneAssignments(<font class="keywordtype">void</font>)
00574     {
00575         <font class="comment">// Deallocate</font>
00576         <font class="keywordflow">if</font> (<a class="code" href="classOgre_1_1Mesh.html#Ogre_1_1Meshm0">sharedGeometry</a>.<a class="code" href="structOgre_1_1GeometryData.html#Ogre_1_1GeometryDatam14">pBlendingWeights</a>)
00577             <font class="keyword">delete</font> [] <a class="code" href="classOgre_1_1Mesh.html#Ogre_1_1Meshm0">sharedGeometry</a>.<a class="code" href="structOgre_1_1GeometryData.html#Ogre_1_1GeometryDatam14">pBlendingWeights</a>;
00578 
00579         <font class="comment">// Iterate through, finding the largest # bones per vertex</font>
00580         <font class="keywordtype">unsigned</font> <font class="keywordtype">short</font> maxBones = 0;
00581         <font class="keywordtype">unsigned</font> <font class="keywordtype">short</font> currBones, lastVertIdx = -1;
00582         VertexBoneAssignmentList::iterator i, iend;
00583         i = <a class="code" href="classOgre_1_1Mesh.html#Ogre_1_1Mesho5">mBoneAssignments</a>.begin();
00584         iend = <a class="code" href="classOgre_1_1Mesh.html#Ogre_1_1Mesho5">mBoneAssignments</a>.end();
00585         <font class="keywordflow">for</font> (; i != iend; ++i)
00586         {
00587             <font class="keywordflow">if</font> (lastVertIdx != i-&gt;second.vertexIndex)
00588             {
00589                 <font class="comment">// change in vertex</font>
00590                 <font class="keywordflow">if</font> (maxBones &lt; currBones)
00591                     maxBones = currBones;
00592                 currBones = 0;
00593             }
00594 
00595             currBones++;
00596 
00597             lastVertIdx = i-&gt;second.vertexIndex;
00598 
00599         }
00600 
00601         <font class="comment">// Allocate a buffer for bone weights</font>
00602         <a class="code" href="classOgre_1_1Mesh.html#Ogre_1_1Meshm0">sharedGeometry</a>.<a class="code" href="structOgre_1_1GeometryData.html#Ogre_1_1GeometryDatam13">numBlendWeightsPerVertex</a> = maxBones;
00603         <a class="code" href="classOgre_1_1Mesh.html#Ogre_1_1Meshm0">sharedGeometry</a>.<a class="code" href="structOgre_1_1GeometryData.html#Ogre_1_1GeometryDatam14">pBlendingWeights</a> = 
00604             <font class="keyword">new</font> <a class="code" href="structOgre_1_1RenderOperation_1_1VertexBlendData.html">RenderOperation::VertexBlendData</a>[<a class="code" href="classOgre_1_1Mesh.html#Ogre_1_1Meshm0">sharedGeometry</a>.<a class="code" href="structOgre_1_1GeometryData.html#Ogre_1_1GeometryDatam0">numVertices</a> * maxBones];
00605 
00606         <font class="comment">// Assign data</font>
00607         <font class="keywordtype">unsigned</font> <font class="keywordtype">short</font> v;
00608         i = <a class="code" href="classOgre_1_1Mesh.html#Ogre_1_1Mesho5">mBoneAssignments</a>.begin();
00609         <a class="code" href="structOgre_1_1RenderOperation_1_1VertexBlendData.html">RenderOperation::VertexBlendData</a> *pBlend = <a class="code" href="classOgre_1_1Mesh.html#Ogre_1_1Meshm0">sharedGeometry</a>.<a class="code" href="structOgre_1_1GeometryData.html#Ogre_1_1GeometryDatam14">pBlendingWeights</a>;
00610         <font class="comment">// Iterate by vertex</font>
00611         <font class="keywordflow">for</font> (v = 0; v &lt; <a class="code" href="classOgre_1_1Mesh.html#Ogre_1_1Meshm0">sharedGeometry</a>.<a class="code" href="structOgre_1_1GeometryData.html#Ogre_1_1GeometryDatam0">numVertices</a>; ++v)
00612         {
00613             <font class="keywordflow">for</font> (<font class="keywordtype">unsigned</font> <font class="keywordtype">short</font> bone = 0; bone &lt; maxBones; ++bone)
00614             {
00615                 <font class="comment">// Do we still have data for this vertex?</font>
00616                 <font class="keywordflow">if</font> (i-&gt;second.vertexIndex == v)
00617                 {
00618                     <font class="comment">// If so, assign</font>
00619                     pBlend-&gt;<a class="code" href="structOgre_1_1RenderOperation_1_1VertexBlendData.html#Ogre_1_1RenderOperation_1_1VertexBlendDatam0">matrixIndex</a> = i-&gt;second.boneIndex;
00620                     pBlend-&gt;<a class="code" href="structOgre_1_1RenderOperation_1_1VertexBlendData.html#Ogre_1_1RenderOperation_1_1VertexBlendDatam1">blendWeight</a> = i-&gt;second.weight;
00621                     ++i;
00622                 }
00623                 <font class="keywordflow">else</font>
00624                 {
00625                     <font class="comment">// Ran out of assignments for this vertex, use weight 0 to indicate empty</font>
00626                     pBlend-&gt;<a class="code" href="structOgre_1_1RenderOperation_1_1VertexBlendData.html#Ogre_1_1RenderOperation_1_1VertexBlendDatam1">blendWeight</a> = 0;
00627                     pBlend-&gt;<a class="code" href="structOgre_1_1RenderOperation_1_1VertexBlendData.html#Ogre_1_1RenderOperation_1_1VertexBlendDatam0">matrixIndex</a> = 0;
00628                 }
00629                 ++pBlend;
00630             }
00631         }
00632 
00633         <a class="code" href="classOgre_1_1Mesh.html#Ogre_1_1Mesho6">mBoneAssignmentsOutOfDate</a> = <font class="keyword">false</font>;
00634 
00635 
00636     }
00637 
00638 }
00639 
</pre></div><p>
Copyright &copy; 2002 by The OGRE Team<br />
<script type="text/javascript">
<!--//hide script from old browsers
document.write( "Last modified "+ document.lastModified );
//end hiding contents -->
</script>
</p>
</body>
</html>
