<html>
<head>
<title>OGRE Documentation</title> <meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1"> 
<link type="text/css" rel="stylesheet" href="style.css">
</head>

<body>
<!-- Generated by Doxygen 1.2.16 -->
<center>
<a class="qindex" href="index.html">Main Page</a> &nbsp; <a class="qindex" href="namespaces.html">Namespace List</a> &nbsp; <a class="qindex" href="hierarchy.html">Class Hierarchy</a> &nbsp; <a class="qindex" href="classes.html">Alphabetical List</a> &nbsp; <a class="qindex" href="annotated.html">Compound List</a> &nbsp; <a class="qindex" href="files.html">File List</a> &nbsp; <a class="qindex" href="namespacemembers.html">Namespace Members</a> &nbsp; <a class="qindex" href="functions.html">Compound Members</a> &nbsp; <a class="qindex" href="globals.html">File Members</a> &nbsp; <a class="qindex" href="pages.html">Related Pages</a> &nbsp; </center>
<hr><h1>OgreQuake3Shader.cpp</h1><a href="OgreQuake3Shader_8cpp.html">Go to the documentation of this file.</a><div class="fragment"><pre>00001 <font class="comment">/*</font>
00002 <font class="comment">-----------------------------------------------------------------------------</font>
00003 <font class="comment">This source file is part of OGRE</font>
00004 <font class="comment">    (Object-oriented Graphics Rendering Engine)</font>
00005 <font class="comment">For the latest info, see http://www.stevestreeting.com/ogre/</font>
00006 <font class="comment"></font>
00007 <font class="comment">Copyright © 2000-2001 Steven J. Streeting</font>
00008 <font class="comment">Also see acknowledgements in Readme.html</font>
00009 <font class="comment"></font>
00010 <font class="comment">This program is free software; you can redistribute it and/or modify it under</font>
00011 <font class="comment">the terms of the GNU General Public License as published by the Free Software</font>
00012 <font class="comment">Foundation; either version 2 of the License, or (at your option) any later</font>
00013 <font class="comment">version.</font>
00014 <font class="comment"></font>
00015 <font class="comment">This program is distributed in the hope that it will be useful, but WITHOUT</font>
00016 <font class="comment">ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or FITNESS</font>
00017 <font class="comment">FOR A PARTICULAR PURPOSE. See the GNU General Public License for more details.</font>
00018 <font class="comment"></font>
00019 <font class="comment">You should have received a copy of the GNU General Public License along with</font>
00020 <font class="comment">this program; if not, write to the Free Software Foundation, Inc., 59 Temple</font>
00021 <font class="comment">Place - Suite 330, Boston, MA 02111-1307, USA, or go to</font>
00022 <font class="comment">http://www.gnu.org/copyleft/gpl.html.</font>
00023 <font class="comment">-----------------------------------------------------------------------------</font>
00024 <font class="comment">*/</font>
00025 
00026 <font class="preprocessor">#include "<a class="code" href="OgreQuake3Shader_8h.html">OgreQuake3Shader.h</a>"</font>
00027 <font class="preprocessor">#include "<a class="code" href="OgreSceneManager_8h.html">OgreSceneManager.h</a>"</font>
00028 <font class="preprocessor">#include "<a class="code" href="OgreMaterial_8h.html">OgreMaterial.h</a>"</font>
00029 <font class="preprocessor">#include "<a class="code" href="OgreMath_8h.html">OgreMath.h</a>"</font>
00030 <font class="preprocessor">#include "<a class="code" href="OgreLogManager_8h.html">OgreLogManager.h</a>"</font>
00031 
00032 <font class="keyword">namespace </font>Ogre {
00033 
00034 
00035     <font class="comment">//-----------------------------------------------------------------------</font>
<a name="l00036"></a><a class="code" href="classOgre_1_1Quake3Shader.html#Ogre_1_1Quake3Shadera0">00036</a>     Quake3Shader::Quake3Shader(<a class="code" href="classOgre_1_1String.html">String</a> name)
00037     {
00038         <a class="code" href="classOgre_1_1Resource.html#Ogre_1_1Zipn0">mName</a> = name;
00039         <a class="code" href="classOgre_1_1Quake3Shader.html#Ogre_1_1Quake3Shaderm1">numPasses</a> = 0;
00040         <a class="code" href="classOgre_1_1Quake3Shader.html#Ogre_1_1Quake3Shaderm7">deformFunc</a> = <a class="code" href="OgreQuake3Types_8h.html#a99a87">DEFORM_FUNC_NONE</a>;
00041         <a class="code" href="classOgre_1_1Quake3Shader.html#Ogre_1_1Quake3Shaderm3">farbox</a> = <font class="keyword">false</font>;
00042         <a class="code" href="classOgre_1_1Quake3Shader.html#Ogre_1_1Quake3Shaderm5">skyDome</a> = <font class="keyword">false</font>;
00043         <a class="code" href="classOgre_1_1Quake3Shader.html#Ogre_1_1Quake3Shaderm0">flags</a> = 0;
00044         <a class="code" href="classOgre_1_1Quake3Shader.html#Ogre_1_1Quake3Shaderm10">fog</a> = <font class="keyword">false</font>;
00045         <a class="code" href="classOgre_1_1Quake3Shader.html#Ogre_1_1Quake3Shaderm9">cullMode</a> = <a class="code" href="namespaceOgre.html#a431a88">MANUAL_CULL_BACK</a>;
00046 
00047     }
00048     <font class="comment">//-----------------------------------------------------------------------</font>
<a name="l00049"></a><a class="code" href="classOgre_1_1Quake3Shader.html#Ogre_1_1Quake3Shadera1">00049</a>     Quake3Shader::~Quake3Shader()
00050     {
00051     }
00052     <font class="comment">//-----------------------------------------------------------------------</font>
<a name="l00053"></a><a class="code" href="classOgre_1_1Quake3Shader.html#Ogre_1_1Quake3Shadera2">00053</a>     <font class="keywordtype">void</font> Quake3Shader::load(<font class="keywordtype">void</font>)
00054     {
00055         <font class="comment">// Do nothing</font>
00056     }
00057     <font class="comment">//-----------------------------------------------------------------------</font>
<a name="l00058"></a><a class="code" href="classOgre_1_1Quake3Shader.html#Ogre_1_1Quake3Shadera3">00058</a>     <font class="keywordtype">void</font> Quake3Shader::unload(<font class="keywordtype">void</font>)
00059     {
00060         <font class="comment">// Do nothing</font>
00061     }
00062     <font class="comment">//-----------------------------------------------------------------------</font>
<a name="l00063"></a><a class="code" href="classOgre_1_1Quake3Shader.html#Ogre_1_1Quake3Shadera4">00063</a>     <a class="code" href="classOgre_1_1Material.html">Material</a>* Quake3Shader::createAsMaterial(<a class="code" href="classOgre_1_1SceneManager.html">SceneManager</a>* sm, <font class="keywordtype">int</font> lightmapNumber)
00064     {
00065         <font class="keywordtype">char</font> matName[72];
00066         sprintf(matName, <font class="stringliteral">"%s#%d"</font>, <a class="code" href="classOgre_1_1Resource.html#Ogre_1_1Zipn0">mName</a>.c_str(), lightmapNumber);
00067         <a class="code" href="classOgre_1_1Material.html">Material</a>* mat = sm-&gt;<a class="code" href="classOgre_1_1SceneManager.html#Ogre_1_1SceneManagera12">createMaterial</a>(matName);
00068 
00069         <font class="keywordtype">char</font> msg[256];
00070         sprintf(msg, <font class="stringliteral">"Using Q3 shader %s"</font>, <a class="code" href="classOgre_1_1Resource.html#Ogre_1_1Zipn0">mName</a>.c_str());
00071         LogManager::getSingleton().logMessage(msg, <a class="code" href="namespaceOgre.html#a435a251">LML_CRITICAL</a>);
00072         <font class="keywordflow">for</font> (<font class="keywordtype">int</font> p = 0; p &lt; <a class="code" href="classOgre_1_1Quake3Shader.html#Ogre_1_1Quake3Shaderm1">numPasses</a>; ++p)
00073         {
00074             <a class="code" href="classOgre_1_1Material_1_1TextureLayer.html">Material::TextureLayer</a>* t;
00075             <font class="comment">// Create basic texture</font>
00076             <font class="keywordflow">if</font> (<a class="code" href="classOgre_1_1Quake3Shader.html#Ogre_1_1Quake3Shaderm2">pass</a>[p].<a class="code" href="structOgre_1_1Quake3Shader_1_1Pass.html#Ogre_1_1Quake3Shader_1_1Passm1">textureName</a> == <font class="stringliteral">"$lightmap"</font>)
00077             {
00078                 <font class="keywordtype">char</font> lightmapName[16];
00079                 sprintf(lightmapName, <font class="stringliteral">"@lightmap%d"</font>, lightmapNumber);
00080                 t = mat-&gt;<a class="code" href="classOgre_1_1Material.html#Ogre_1_1Materiala19">addTextureLayer</a>(lightmapName);
00081             }
00082             <font class="comment">// Animated texture support</font>
00083             <font class="keywordflow">else</font> <font class="keywordflow">if</font> (<a class="code" href="classOgre_1_1Quake3Shader.html#Ogre_1_1Quake3Shaderm2">pass</a>[p].<a class="code" href="structOgre_1_1Quake3Shader_1_1Pass.html#Ogre_1_1Quake3Shader_1_1Passm23">animNumFrames</a> &gt; 0)
00084             {
00085                 <a class="code" href="namespaceOgre.html#a281">Real</a> sequenceTime = <a class="code" href="classOgre_1_1Quake3Shader.html#Ogre_1_1Quake3Shaderm2">pass</a>[p].<a class="code" href="structOgre_1_1Quake3Shader_1_1Pass.html#Ogre_1_1Quake3Shader_1_1Passm23">animNumFrames</a> / <a class="code" href="classOgre_1_1Quake3Shader.html#Ogre_1_1Quake3Shaderm2">pass</a>[p].<a class="code" href="structOgre_1_1Quake3Shader_1_1Pass.html#Ogre_1_1Quake3Shader_1_1Passm22">animFps</a>;
00086                 <font class="comment">/* Pre-load textures</font>
00087 <font class="comment">                   We need to know if each one was loaded OK since extensions may change for each</font>
00088 <font class="comment">                   Quake3 can still include alternate extension filenames e.g. jpg instead of tga</font>
00089 <font class="comment">                   Pain in the arse - have to check for each frame as letters&lt;n&gt;.tga for example</font>
00090 <font class="comment">                   is different per frame!</font>
00091 <font class="comment">                */</font>
00092                 <font class="keywordflow">for</font> (<font class="keywordtype">unsigned</font> <font class="keywordtype">int</font> alt = 0; alt &lt; <a class="code" href="classOgre_1_1Quake3Shader.html#Ogre_1_1Quake3Shaderm2">pass</a>[p].<a class="code" href="structOgre_1_1Quake3Shader_1_1Pass.html#Ogre_1_1Quake3Shader_1_1Passm23">animNumFrames</a>; ++alt)
00093                 {
00094                     <font class="keywordflow">try</font> {
00095                         TextureManager::getSingleton().load(<a class="code" href="classOgre_1_1Quake3Shader.html#Ogre_1_1Quake3Shaderm2">pass</a>[p].frames[alt]);
00096                     }
00097                     <font class="keywordflow">catch</font> (...)
00098                     {
00099                         <font class="comment">// Try alternate extension</font>
00100                         <a class="code" href="classOgre_1_1Quake3Shader.html#Ogre_1_1Quake3Shaderm2">pass</a>[p].<a class="code" href="structOgre_1_1Quake3Shader_1_1Pass.html#Ogre_1_1Quake3Shader_1_1Passm24">frames</a>[alt] = <a class="code" href="classOgre_1_1Quake3Shader.html#Ogre_1_1Quake3Shaderb0">getAlternateName</a>(<a class="code" href="classOgre_1_1Quake3Shader.html#Ogre_1_1Quake3Shaderm2">pass</a>[p].frames[alt]);
00101                         <font class="keywordflow">try</font> {
00102                             TextureManager::getSingleton().load(<a class="code" href="classOgre_1_1Quake3Shader.html#Ogre_1_1Quake3Shaderm2">pass</a>[p].frames[alt]);
00103                         }
00104                         <font class="keywordflow">catch</font> (...)
00105                         { <font class="comment">// stuffed - no texture</font>
00106                         }
00107                     }
00108 
00109                 }
00110 
00111                 t = mat-&gt;<a class="code" href="classOgre_1_1Material.html#Ogre_1_1Materiala19">addTextureLayer</a>(<font class="stringliteral">""</font>);
00112                 t-&gt;<a class="code" href="classOgre_1_1Material_1_1TextureLayer.html#Ogre_1_1Material_1_1TextureLayera10">setAnimatedTextureName</a>(<a class="code" href="classOgre_1_1Quake3Shader.html#Ogre_1_1Quake3Shaderm2">pass</a>[p].frames, <a class="code" href="classOgre_1_1Quake3Shader.html#Ogre_1_1Quake3Shaderm2">pass</a>[p].animNumFrames, sequenceTime);
00113                 <font class="keywordflow">if</font> (t-&gt;<a class="code" href="classOgre_1_1Material_1_1TextureLayer.html#Ogre_1_1Material_1_1TextureLayera49">isBlank</a>())
00114                 {
00115                     <a class="code" href="classOgre_1_1String.html">String</a> altNames[32];
00116                     <font class="keywordflow">for</font> (<font class="keywordtype">unsigned</font> <font class="keywordtype">int</font> alt = 0; alt &lt; <a class="code" href="classOgre_1_1Quake3Shader.html#Ogre_1_1Quake3Shaderm2">pass</a>[p].<a class="code" href="structOgre_1_1Quake3Shader_1_1Pass.html#Ogre_1_1Quake3Shader_1_1Passm23">animNumFrames</a>; ++alt)
00117                         <a class="code" href="classOgre_1_1Quake3Shader.html#Ogre_1_1Quake3Shaderm2">pass</a>[p].<a class="code" href="structOgre_1_1Quake3Shader_1_1Pass.html#Ogre_1_1Quake3Shader_1_1Passm24">frames</a>[alt] = <a class="code" href="classOgre_1_1Quake3Shader.html#Ogre_1_1Quake3Shaderb0">getAlternateName</a>(<a class="code" href="classOgre_1_1Quake3Shader.html#Ogre_1_1Quake3Shaderm2">pass</a>[p].frames[alt]);
00118                     t-&gt;<a class="code" href="classOgre_1_1Material_1_1TextureLayer.html#Ogre_1_1Material_1_1TextureLayera10">setAnimatedTextureName</a>(<a class="code" href="classOgre_1_1Quake3Shader.html#Ogre_1_1Quake3Shaderm2">pass</a>[p].frames, <a class="code" href="classOgre_1_1Quake3Shader.html#Ogre_1_1Quake3Shaderm2">pass</a>[p].animNumFrames, sequenceTime);
00119                 }
00120 
00121             }
00122             <font class="keywordflow">else</font>
00123             {
00124                 t = mat-&gt;<a class="code" href="classOgre_1_1Material.html#Ogre_1_1Materiala19">addTextureLayer</a>(<a class="code" href="classOgre_1_1Quake3Shader.html#Ogre_1_1Quake3Shaderm2">pass</a>[p].textureName);
00125                 <font class="comment">// Quake3 can still include alternate extension filenames e.g. jpg instead of tga</font>
00126                 <font class="comment">// Pain in the arse - have to check for failure</font>
00127                 <font class="keywordflow">if</font> (t-&gt;<a class="code" href="classOgre_1_1Material_1_1TextureLayer.html#Ogre_1_1Material_1_1TextureLayera49">isBlank</a>())
00128                 {
00129                     t-&gt;<a class="code" href="classOgre_1_1Material_1_1TextureLayer.html#Ogre_1_1Material_1_1TextureLayera7">setTextureName</a>(<a class="code" href="classOgre_1_1Quake3Shader.html#Ogre_1_1Quake3Shaderb0">getAlternateName</a>(<a class="code" href="classOgre_1_1Quake3Shader.html#Ogre_1_1Quake3Shaderm2">pass</a>[p].textureName));
00130                 }
00131             }
00132             <font class="comment">// Blending</font>
00133             <font class="keywordflow">if</font> (p == 0)
00134             {
00135                 <font class="comment">// scene blend</font>
00136                 mat-&gt;<a class="code" href="classOgre_1_1Material.html#Ogre_1_1Materiala24">setSceneBlending</a>(<a class="code" href="classOgre_1_1Quake3Shader.html#Ogre_1_1Quake3Shaderm2">pass</a>[p].blendSrc, <a class="code" href="classOgre_1_1Quake3Shader.html#Ogre_1_1Quake3Shaderm2">pass</a>[p].blendDest);
00137                 t-&gt;<a class="code" href="classOgre_1_1Material_1_1TextureLayer.html#Ogre_1_1Material_1_1TextureLayera32">setColourOperation</a>(<a class="code" href="namespaceOgre.html#a418a15">LBO_REPLACE</a>);
00138             }
00139             <font class="keywordflow">else</font>
00140             {
00141                 <font class="keywordflow">if</font> (<a class="code" href="classOgre_1_1Quake3Shader.html#Ogre_1_1Quake3Shaderm2">pass</a>[p].<a class="code" href="structOgre_1_1Quake3Shader_1_1Pass.html#Ogre_1_1Quake3Shader_1_1Passm6">customBlend</a>)
00142                 {
00143                     <font class="comment">// Fallback for now</font>
00144                     t-&gt;<a class="code" href="classOgre_1_1Material_1_1TextureLayer.html#Ogre_1_1Material_1_1TextureLayera32">setColourOperation</a>(<a class="code" href="namespaceOgre.html#a418a17">LBO_MODULATE</a>);
00145                 }
00146                 <font class="keywordflow">else</font>
00147                 {
00148                     <font class="comment">// simple layer blend</font>
00149                     t-&gt;<a class="code" href="classOgre_1_1Material_1_1TextureLayer.html#Ogre_1_1Material_1_1TextureLayera32">setColourOperation</a>(<a class="code" href="classOgre_1_1Quake3Shader.html#Ogre_1_1Quake3Shaderm2">pass</a>[p].blend);
00150                 }
00151             }
00152             <font class="comment">// Tex coords</font>
00153             <font class="keywordflow">if</font> (<a class="code" href="classOgre_1_1Quake3Shader.html#Ogre_1_1Quake3Shaderm2">pass</a>[p].<a class="code" href="structOgre_1_1Quake3Shader_1_1Pass.html#Ogre_1_1Quake3Shader_1_1Passm2">texGen</a> == <a class="code" href="OgreQuake3Types_8h.html#a98a84">TEXGEN_BASE</a>)
00154             {
00155                 t-&gt;<a class="code" href="classOgre_1_1Material_1_1TextureLayer.html#Ogre_1_1Material_1_1TextureLayera19">setTextureCoordSet</a>(0);
00156             }
00157             <font class="keywordflow">else</font> <font class="keywordflow">if</font> (<a class="code" href="classOgre_1_1Quake3Shader.html#Ogre_1_1Quake3Shaderm2">pass</a>[p].<a class="code" href="structOgre_1_1Quake3Shader_1_1Pass.html#Ogre_1_1Quake3Shader_1_1Passm2">texGen</a> == <a class="code" href="OgreQuake3Types_8h.html#a98a85">TEXGEN_LIGHTMAP</a>)
00158             {
00159                 t-&gt;<a class="code" href="classOgre_1_1Material_1_1TextureLayer.html#Ogre_1_1Material_1_1TextureLayera19">setTextureCoordSet</a>(1);
00160             }
00161             <font class="keywordflow">else</font> <font class="keywordflow">if</font> (<a class="code" href="classOgre_1_1Quake3Shader.html#Ogre_1_1Quake3Shaderm2">pass</a>[p].<a class="code" href="structOgre_1_1Quake3Shader_1_1Pass.html#Ogre_1_1Quake3Shader_1_1Passm2">texGen</a> == <a class="code" href="OgreQuake3Types_8h.html#a98a86">TEXGEN_ENVIRONMENT</a>)
00162             {
00163                 t-&gt;<a class="code" href="classOgre_1_1Material_1_1TextureLayer.html#Ogre_1_1Material_1_1TextureLayera40">setEnvironmentMap</a>(<font class="keyword">true</font>, <font class="keyword">true</font>);
00164             }
00165             <font class="comment">// Tex mod</font>
00166             <font class="comment">// Scale</font>
00167             t-&gt;<a class="code" href="classOgre_1_1Material_1_1TextureLayer.html#Ogre_1_1Material_1_1TextureLayera25">setTextureUScale</a>(<a class="code" href="classOgre_1_1Quake3Shader.html#Ogre_1_1Quake3Shaderm2">pass</a>[p].tcModScale[0]);
00168             t-&gt;<a class="code" href="classOgre_1_1Material_1_1TextureLayer.html#Ogre_1_1Material_1_1TextureLayera26">setTextureVScale</a>(<a class="code" href="classOgre_1_1Quake3Shader.html#Ogre_1_1Quake3Shaderm2">pass</a>[p].tcModScale[1]);
00169             <font class="comment">// Procedural mods</font>
00170             <font class="comment">// Custom - don't use mod if generating environment</font>
00171             <font class="comment">// Because I do env a different way it look horrible</font>
00172             <font class="keywordflow">if</font> (<a class="code" href="classOgre_1_1Quake3Shader.html#Ogre_1_1Quake3Shaderm2">pass</a>[p].<a class="code" href="structOgre_1_1Quake3Shader_1_1Pass.html#Ogre_1_1Quake3Shader_1_1Passm2">texGen</a> != <a class="code" href="OgreQuake3Types_8h.html#a98a86">TEXGEN_ENVIRONMENT</a>)
00173             {
00174                 <font class="keywordflow">if</font> (<a class="code" href="classOgre_1_1Quake3Shader.html#Ogre_1_1Quake3Shaderm2">pass</a>[p].<a class="code" href="structOgre_1_1Quake3Shader_1_1Pass.html#Ogre_1_1Quake3Shader_1_1Passm13">tcModRotate</a>)
00175                 {
00176                     t-&gt;<a class="code" href="classOgre_1_1Material_1_1TextureLayer.html#Ogre_1_1Material_1_1TextureLayera42">setRotateAnimation</a>(<a class="code" href="classOgre_1_1Quake3Shader.html#Ogre_1_1Quake3Shaderm2">pass</a>[p].tcModRotate);
00177                 }
00178                 <font class="keywordflow">if</font> (<a class="code" href="classOgre_1_1Quake3Shader.html#Ogre_1_1Quake3Shaderm2">pass</a>[p].<a class="code" href="structOgre_1_1Quake3Shader_1_1Pass.html#Ogre_1_1Quake3Shader_1_1Passm14">tcModScroll</a>[0] || <a class="code" href="classOgre_1_1Quake3Shader.html#Ogre_1_1Quake3Shaderm2">pass</a>[p].<a class="code" href="structOgre_1_1Quake3Shader_1_1Pass.html#Ogre_1_1Quake3Shader_1_1Passm14">tcModScroll</a>[1])
00179                 {
00180                     <font class="keywordflow">if</font> (<a class="code" href="classOgre_1_1Quake3Shader.html#Ogre_1_1Quake3Shaderm2">pass</a>[p].<a class="code" href="structOgre_1_1Quake3Shader_1_1Pass.html#Ogre_1_1Quake3Shader_1_1Passm16">tcModTurbOn</a>)
00181                     {
00182                         <font class="comment">// Turbulent scroll</font>
00183                         <font class="keywordflow">if</font> (<a class="code" href="classOgre_1_1Quake3Shader.html#Ogre_1_1Quake3Shaderm2">pass</a>[p].<a class="code" href="structOgre_1_1Quake3Shader_1_1Pass.html#Ogre_1_1Quake3Shader_1_1Passm14">tcModScroll</a>[0])
00184                         {
00185                             t-&gt;<a class="code" href="classOgre_1_1Material_1_1TextureLayer.html#Ogre_1_1Material_1_1TextureLayera43">setTransformAnimation</a>(Material::TextureLayer::TT_TRANSLATE_U, <a class="code" href="namespaceOgre.html#a432a90">WFT_SINE</a>,
00186                                 <a class="code" href="classOgre_1_1Quake3Shader.html#Ogre_1_1Quake3Shaderm2">pass</a>[p].tcModTurb[0], <a class="code" href="classOgre_1_1Quake3Shader.html#Ogre_1_1Quake3Shaderm2">pass</a>[p].tcModTurb[3], <a class="code" href="classOgre_1_1Quake3Shader.html#Ogre_1_1Quake3Shaderm2">pass</a>[p].tcModTurb[2], <a class="code" href="classOgre_1_1Quake3Shader.html#Ogre_1_1Quake3Shaderm2">pass</a>[p].tcModTurb[1]);
00187                         }
00188                         <font class="keywordflow">if</font> (<a class="code" href="classOgre_1_1Quake3Shader.html#Ogre_1_1Quake3Shaderm2">pass</a>[p].<a class="code" href="structOgre_1_1Quake3Shader_1_1Pass.html#Ogre_1_1Quake3Shader_1_1Passm14">tcModScroll</a>[1])
00189                         {
00190                             t-&gt;<a class="code" href="classOgre_1_1Material_1_1TextureLayer.html#Ogre_1_1Material_1_1TextureLayera43">setTransformAnimation</a>(Material::TextureLayer::TT_TRANSLATE_V, <a class="code" href="namespaceOgre.html#a432a90">WFT_SINE</a>,
00191                                 <a class="code" href="classOgre_1_1Quake3Shader.html#Ogre_1_1Quake3Shaderm2">pass</a>[p].tcModTurb[0], <a class="code" href="classOgre_1_1Quake3Shader.html#Ogre_1_1Quake3Shaderm2">pass</a>[p].tcModTurb[3], <a class="code" href="classOgre_1_1Quake3Shader.html#Ogre_1_1Quake3Shaderm2">pass</a>[p].tcModTurb[2], <a class="code" href="classOgre_1_1Quake3Shader.html#Ogre_1_1Quake3Shaderm2">pass</a>[p].tcModTurb[1]);
00192                         }
00193                     }
00194                     <font class="keywordflow">else</font>
00195                     {
00196                         <font class="comment">// Constant scroll</font>
00197                         t-&gt;<a class="code" href="classOgre_1_1Material_1_1TextureLayer.html#Ogre_1_1Material_1_1TextureLayera41">setScrollAnimation</a>(<a class="code" href="classOgre_1_1Quake3Shader.html#Ogre_1_1Quake3Shaderm2">pass</a>[p].tcModScroll[0], <a class="code" href="classOgre_1_1Quake3Shader.html#Ogre_1_1Quake3Shaderm2">pass</a>[p].tcModScroll[1]);
00198                     }
00199                 }
00200                 <font class="keywordflow">if</font> (<a class="code" href="classOgre_1_1Quake3Shader.html#Ogre_1_1Quake3Shaderm2">pass</a>[p].<a class="code" href="structOgre_1_1Quake3Shader_1_1Pass.html#Ogre_1_1Quake3Shader_1_1Passm18">tcModStretchWave</a> != <a class="code" href="OgreQuake3Types_8h.html#a96a75">SHADER_FUNC_NONE</a>)
00201                 {
00202                     <a class="code" href="namespaceOgre.html#a432">WaveformType</a> wft;
00203                     <font class="keywordflow">switch</font>(<a class="code" href="classOgre_1_1Quake3Shader.html#Ogre_1_1Quake3Shaderm2">pass</a>[p].<a class="code" href="structOgre_1_1Quake3Shader_1_1Pass.html#Ogre_1_1Quake3Shader_1_1Passm18">tcModStretchWave</a>)
00204                     {
00205                     <font class="keywordflow">case</font> <a class="code" href="OgreQuake3Types_8h.html#a96a76">SHADER_FUNC_SIN</a>:
00206                         wft = <a class="code" href="namespaceOgre.html#a432a90">WFT_SINE</a>;
00207                         <font class="keywordflow">break</font>;
00208                     <font class="keywordflow">case</font> <a class="code" href="OgreQuake3Types_8h.html#a96a77">SHADER_FUNC_TRIANGLE</a>:
00209                         wft = <a class="code" href="namespaceOgre.html#a432a91">WFT_TRIANGLE</a>;
00210                         <font class="keywordflow">break</font>;
00211                     <font class="keywordflow">case</font> <a class="code" href="OgreQuake3Types_8h.html#a96a78">SHADER_FUNC_SQUARE</a>:
00212                         wft = <a class="code" href="namespaceOgre.html#a432a92">WFT_SQUARE</a>;
00213                         <font class="keywordflow">break</font>;
00214                     <font class="keywordflow">case</font> <a class="code" href="OgreQuake3Types_8h.html#a96a79">SHADER_FUNC_SAWTOOTH</a>:
00215                         wft = <a class="code" href="namespaceOgre.html#a432a93">WFT_SAWTOOTH</a>;
00216                         <font class="keywordflow">break</font>;
00217                     <font class="keywordflow">case</font> <a class="code" href="OgreQuake3Types_8h.html#a96a80">SHADER_FUNC_INVERSESAWTOOTH</a>:
00218                         wft = <a class="code" href="namespaceOgre.html#a432a94">WFT_INVERSE_SAWTOOTH</a>;
00219                         <font class="keywordflow">break</font>;
00220 
00221                     }
00222                     <font class="comment">// Create wave-based stretcher</font>
00223                     t-&gt;<a class="code" href="classOgre_1_1Material_1_1TextureLayer.html#Ogre_1_1Material_1_1TextureLayera43">setTransformAnimation</a>(Material::TextureLayer::TT_SCALE_U, wft, <a class="code" href="classOgre_1_1Quake3Shader.html#Ogre_1_1Quake3Shaderm2">pass</a>[p].tcModStretchParams[3],
00224                         <a class="code" href="classOgre_1_1Quake3Shader.html#Ogre_1_1Quake3Shaderm2">pass</a>[p].tcModStretchParams[0], <a class="code" href="classOgre_1_1Quake3Shader.html#Ogre_1_1Quake3Shaderm2">pass</a>[p].tcModStretchParams[2], <a class="code" href="classOgre_1_1Quake3Shader.html#Ogre_1_1Quake3Shaderm2">pass</a>[p].tcModStretchParams[1]);
00225                     t-&gt;<a class="code" href="classOgre_1_1Material_1_1TextureLayer.html#Ogre_1_1Material_1_1TextureLayera43">setTransformAnimation</a>(Material::TextureLayer::TT_SCALE_V, wft, <a class="code" href="classOgre_1_1Quake3Shader.html#Ogre_1_1Quake3Shaderm2">pass</a>[p].tcModStretchParams[3],
00226                         <a class="code" href="classOgre_1_1Quake3Shader.html#Ogre_1_1Quake3Shaderm2">pass</a>[p].tcModStretchParams[0], <a class="code" href="classOgre_1_1Quake3Shader.html#Ogre_1_1Quake3Shaderm2">pass</a>[p].tcModStretchParams[2], <a class="code" href="classOgre_1_1Quake3Shader.html#Ogre_1_1Quake3Shaderm2">pass</a>[p].tcModStretchParams[1]);
00227                 }
00228             }
00229             <font class="comment">// Address mode</font>
00230             t-&gt;<a class="code" href="classOgre_1_1Material_1_1TextureLayer.html#Ogre_1_1Material_1_1TextureLayera30">setTextureAddressingMode</a>(<a class="code" href="classOgre_1_1Quake3Shader.html#Ogre_1_1Quake3Shaderm2">pass</a>[p].addressMode);
00231             <font class="comment">// Alpha mode</font>
00232             t-&gt;<a class="code" href="classOgre_1_1Material_1_1TextureLayer.html#Ogre_1_1Material_1_1TextureLayera44">setAlphaRejectSettings</a>(<a class="code" href="classOgre_1_1Quake3Shader.html#Ogre_1_1Quake3Shaderm2">pass</a>[p].alphaFunc, <a class="code" href="classOgre_1_1Quake3Shader.html#Ogre_1_1Quake3Shaderm2">pass</a>[p].alphaVal);
00233 
00234             assert(!t-&gt;<a class="code" href="classOgre_1_1Material_1_1TextureLayer.html#Ogre_1_1Material_1_1TextureLayera49">isBlank</a>());
00235 
00236 
00237         }
00238         <font class="comment">// Do farbox (create new material)</font>
00239 
00240         <font class="comment">// Do skydome (use this material)</font>
00241         <font class="keywordflow">if</font> (skyDome)
00242         {
00243             <font class="comment">// Quake3 is always aligned with Z upwards</font>
00244             <a class="code" href="classOgre_1_1Quaternion.html">Quaternion</a> q;
00245             q.<a class="code" href="classOgre_1_1Quaternion.html#Ogre_1_1Quaterniona4">FromAngleAxis</a>(Math::HALF_PI, Vector3::UNIT_X);
00246             <font class="comment">// Also draw last, and make close to camera (far clip plane is shorter)</font>
00247             sm-&gt;<a class="code" href="classOgre_1_1SceneManager.html#Ogre_1_1SceneManagera49">setSkyDome</a>(<font class="keyword">true</font>, matName, 20 - (<a class="code" href="classOgre_1_1Quake3Shader.html#Ogre_1_1Quake3Shaderm6">cloudHeight</a> / 256 * 18), 12, 2000, <font class="keyword">false</font>, q);
00248         }
00249 
00250 
00251         <font class="comment">// Set culling mode and lighting to defaults</font>
00252         mat-&gt;<a class="code" href="classOgre_1_1Material.html#Ogre_1_1Materiala35">setCullingMode</a>(<a class="code" href="namespaceOgre.html#a430a84">CULL_NONE</a>);
00253         mat-&gt;<a class="code" href="classOgre_1_1Material.html#Ogre_1_1Materiala37">setManualCullingMode</a>(<a class="code" href="classOgre_1_1Quake3Shader.html#Ogre_1_1Quake3Shaderm9">cullMode</a>);
00254         mat-&gt;<a class="code" href="classOgre_1_1Material.html#Ogre_1_1Materiala39">setLightingEnabled</a>(<font class="keyword">false</font>);
00255         <font class="keywordflow">return</font> mat;
00256     }
<a name="l00257"></a><a class="code" href="classOgre_1_1Quake3Shader.html#Ogre_1_1Quake3Shaderb0">00257</a>     <a class="code" href="classOgre_1_1String.html">String</a> Quake3Shader::getAlternateName(<a class="code" href="classOgre_1_1String.html">String</a> texName)
00258     {
00259         <font class="comment">// Get alternative JPG to TGA and vice versa</font>
00260         size_t pos;
00261         <a class="code" href="classOgre_1_1String.html">String</a> ext, base;
00262 
00263         pos = texName.find_last_of(<font class="stringliteral">"."</font>);
00264         ext = static_cast&lt;String&gt;(texName.substr(pos, 4)).<a class="code" href="classOgre_1_1String.html#Ogre_1_1Stringa7">toLowerCase</a>();
00265         base = texName.substr(0,pos);
00266         <font class="keywordflow">if</font> (ext == <font class="stringliteral">".jpg"</font>)
00267         {
00268             <font class="keywordflow">return</font> base + <font class="stringliteral">".tga"</font>;
00269         }
00270         <font class="keywordflow">else</font>
00271         {
00272             <font class="keywordflow">return</font> base + <font class="stringliteral">".jpg"</font>;
00273         }
00274 
00275     }
00276 }
</pre></div><p>
Copyright &copy; 2002 by The OGRE Team<br />
<script type="text/javascript">
<!--//hide script from old browsers
document.write( "Last modified "+ document.lastModified );
//end hiding contents -->
</script>
</p>
</body>
</html>
