<html>
<head>
<title>OGRE Documentation</title> <meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1"> 
<link type="text/css" rel="stylesheet" href="style.css">
</head>

<body>
<!-- Generated by Doxygen 1.2.16 -->
<center>
<a class="qindex" href="index.html">Main Page</a> &nbsp; <a class="qindex" href="namespaces.html">Namespace List</a> &nbsp; <a class="qindex" href="hierarchy.html">Class Hierarchy</a> &nbsp; <a class="qindex" href="classes.html">Alphabetical List</a> &nbsp; <a class="qindex" href="annotated.html">Compound List</a> &nbsp; <a class="qindex" href="files.html">File List</a> &nbsp; <a class="qindex" href="namespacemembers.html">Namespace Members</a> &nbsp; <a class="qindex" href="functions.html">Compound Members</a> &nbsp; <a class="qindex" href="globals.html">File Members</a> &nbsp; <a class="qindex" href="pages.html">Related Pages</a> &nbsp; </center>
<hr><h1>OgreDDDriverList.cpp</h1><a href="OgreDDDriverList_8cpp.html">Go to the documentation of this file.</a><div class="fragment"><pre>00001 <font class="comment">/*</font>
00002 <font class="comment">-----------------------------------------------------------------------------</font>
00003 <font class="comment">This source file is part of OGRE</font>
00004 <font class="comment">    (Object-oriented Graphics Rendering Engine)</font>
00005 <font class="comment">For the latest info, see http://www.stevestreeting.com/ogre/</font>
00006 <font class="comment"></font>
00007 <font class="comment">Copyright © 2000-2001 Steven J. Streeting</font>
00008 <font class="comment">Also see acknowledgements in Readme.html</font>
00009 <font class="comment"></font>
00010 <font class="comment">This program is free software; you can redistribute it and/or modify it under</font>
00011 <font class="comment">the terms of the GNU General Public License as published by the Free Software</font>
00012 <font class="comment">Foundation; either version 2 of the License, or (at your option) any later</font>
00013 <font class="comment">version.</font>
00014 <font class="comment"></font>
00015 <font class="comment">This program is distributed in the hope that it will be useful, but WITHOUT</font>
00016 <font class="comment">ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or FITNESS</font>
00017 <font class="comment">FOR A PARTICULAR PURPOSE. See the GNU General Public License for more details.</font>
00018 <font class="comment"></font>
00019 <font class="comment">You should have received a copy of the GNU General Public License along with</font>
00020 <font class="comment">this program; if not, write to the Free Software Foundation, Inc., 59 Temple</font>
00021 <font class="comment">Place - Suite 330, Boston, MA 02111-1307, USA, or go to</font>
00022 <font class="comment">http://www.gnu.org/copyleft/gpl.html.</font>
00023 <font class="comment">-----------------------------------------------------------------------------</font>
00024 <font class="comment">*/</font>
00025 <font class="preprocessor">#include "<a class="code" href="OgreD3D7RenderSystem_8h.html">OgreD3D7RenderSystem.h</a>"</font>
00026 <font class="preprocessor">#include "<a class="code" href="OgreDDDriverList_8h.html">OgreDDDriverList.h</a>"</font>
00027 <font class="preprocessor">#include "<a class="code" href="OgreDDDriver_8h.html">OgreDDDriver.h</a>"</font>
00028 <font class="preprocessor">#include "<a class="code" href="OgreLogManager_8h.html">OgreLogManager.h</a>"</font>
00029 <font class="preprocessor">#include "<a class="code" href="OgreException_8h.html">OgreException.h</a>"</font>
00030 
00031 <font class="keyword">namespace </font>Ogre {
00032 
00033     <font class="comment">// Non-member callback functions</font>
<a name="l00034"></a><a class="code" href="namespaceOgre.html#a412">00034</a>     <font class="keyword">static</font> BOOL WINAPI <a class="code" href="namespaceOgre.html#a412">DDEnumCallbackEx</a>(GUID FAR *lpGUID,
00035                     LPSTR     lpDriverDescription,
00036                     LPSTR     lpDriverName,
00037                     LPVOID    lpContext,
00038                     HMONITOR  hm)
00039     {
00040 
00041         <a class="code" href="classOgre_1_1DDDriverList.html">DDDriverList</a>* driverList;
00042 
00043         <font class="comment">// Use context pointer to add this new object to the list</font>
00044         driverList = (<a class="code" href="classOgre_1_1DDDriverList.html">DDDriverList</a>*)lpContext;
00045         driverList-&gt;<a class="code" href="classOgre_1_1DDDriverList.html#Ogre_1_1DDDriverListc0">AddDriver</a>(lpGUID, lpDriverDescription, lpDriverName);
00046 
00047 
00048         <font class="comment">// Continue enumeration (to find other cards)</font>
00049         <font class="keywordflow">return</font> TRUE;
00050     }
00051 
<a name="l00052"></a><a class="code" href="namespaceOgre.html#a413">00052</a>     <font class="keyword">static</font> BOOL WINAPI <a class="code" href="namespaceOgre.html#a413">DDEnumCallback</a>(GUID FAR *lpGUID,
00053                                LPSTR  lpDriverDescription,
00054                                LPSTR  lpDriverName,
00055                                LPVOID lpContext)
00056     {
00057         <font class="keywordflow">return</font> <a class="code" href="namespaceOgre.html#a412">DDEnumCallbackEx</a>(lpGUID,lpDriverDescription,lpDriverName,lpContext,NULL);
00058     }
00059 
<a name="l00060"></a><a class="code" href="classOgre_1_1DDDriverList.html#Ogre_1_1DDDriverLista0">00060</a>     DDDriverList::DDDriverList()
00061     {
00062         <font class="comment">// Default constructor</font>
00063         <font class="comment">// Will create a  new driver list and enumerate it</font>
00064 
00065         <font class="comment">// Enumerate the list</font>
00066         <a class="code" href="classOgre_1_1DDDriverList.html#Ogre_1_1DDDriverLista2">enumerate</a>();
00067 
00068     }
00069 
<a name="l00070"></a><a class="code" href="classOgre_1_1DDDriverList.html#Ogre_1_1DDDriverLista1">00070</a>     DDDriverList::~DDDriverList()
00071     {
00072         <font class="comment">// Release drivers</font>
00073         <a class="code" href="classOgre_1_1DDDriverList.html#Ogre_1_1DDDriverListo0">mDriverList</a>.erase( <a class="code" href="classOgre_1_1DDDriverList.html#Ogre_1_1DDDriverListo0">mDriverList</a>.begin(), <a class="code" href="classOgre_1_1DDDriverList.html#Ogre_1_1DDDriverListo0">mDriverList</a>.begin() + <a class="code" href="classOgre_1_1DDDriverList.html#Ogre_1_1DDDriverListo0">mDriverList</a>.size() - 1 );
00074     }
00075 
<a name="l00076"></a><a class="code" href="classOgre_1_1DDDriverList.html#Ogre_1_1DDDriverLista2">00076</a>     BOOL DDDriverList::enumerate()
00077     {
00078 
00079         LPDIRECTDRAWENUMERATEEX lpDDEnumEx;
00080         HINSTANCE h;
00081 
00082         LogManager::getSingleton().logMessage(<font class="stringliteral">"----- DirectDraw Detection Starts"</font>);
00083 
00084         h = LoadLibrary(<font class="stringliteral">"ddraw.dll"</font>);
00085 
00086         <font class="comment">// If ddraw.dll doesn't exist in the search path,</font>
00087         <font class="comment">// then DirectX probably isn't installed, so fail.</font>
00088         <font class="keywordflow">if</font> (!h)
00089             <font class="keywordflow">throw</font> <a class="code" href="classOgre_1_1Exception.html">Exception</a>(0, <font class="stringliteral">"Error loading ddraw.dll"</font>, <font class="stringliteral">"DDDriverList - enumerate"</font>);
00090 
00091         <font class="comment">// Note that you must know which version of the</font>
00092         <font class="comment">// function to retrieve (see the following text).</font>
00093         <font class="comment">// For this example, we use the ANSI version.</font>
00094         lpDDEnumEx = (LPDIRECTDRAWENUMERATEEX) GetProcAddress(h,<font class="stringliteral">"DirectDrawEnumerateExA"</font>);
00095          <font class="comment">// If the function is there, call it to enumerate all display</font>
00096         <font class="comment">// devices attached to the desktop, and any non-display DirectDraw</font>
00097         <font class="comment">// devices.</font>
00098         <font class="keywordflow">if</font> (lpDDEnumEx)
00099             lpDDEnumEx(<a class="code" href="classOgre_1_1DDDriverList.html#a412">DDEnumCallbackEx</a>, <font class="keyword">this</font>,
00100                 DDENUM_ATTACHEDSECONDARYDEVICES |
00101                 DDENUM_NONDISPLAYDEVICES             );
00102         <font class="keywordflow">else</font>
00103         {
00104             <font class="comment">/*</font>
00105 <font class="comment">             * We must be running on an old version of DirectDraw.</font>
00106 <font class="comment">             * Therefore MultiMon isn't supported. Fall back on</font>
00107 <font class="comment">             * DirectDrawEnumerate to enumerate standard devices on a</font>
00108 <font class="comment">             * single-monitor system.</font>
00109 <font class="comment">            */</font>
00110             DirectDrawEnumerate(<a class="code" href="classOgre_1_1DDDriverList.html#a413">DDEnumCallback</a>,<font class="keyword">this</font>);
00111 
00112         }
00113         <font class="comment">// If the library was loaded by calling LoadLibrary(),</font>
00114         <font class="comment">// then you must use FreeLibrary() to let go of it.</font>
00115 
00116         FreeLibrary(h);
00117 
00118         LogManager::getSingleton().logMessage(<font class="stringliteral">"----- DirectDraw Detection Ends"</font>);
00119 
00120         <font class="keywordflow">return</font> TRUE;
00121     }
00122 
<a name="l00123"></a><a class="code" href="classOgre_1_1DDDriverList.html#Ogre_1_1DDDriverListc0">00123</a>     <font class="keywordtype">void</font> DDDriverList::AddDriver(
00124         GUID FAR *lpGuid,
00125         LPSTR lpDriverDesc,
00126         LPSTR lpDriverName )
00127     {
00128         <a class="code" href="classOgre_1_1DDDriverList.html#Ogre_1_1DDDriverListo0">mDriverList</a>.push_back( <a class="code" href="classOgre_1_1DDDriver.html">DDDriver</a>(lpGuid, lpDriverDesc, lpDriverName) );
00129 
00130         LogManager::getSingleton().logMessage( <a class="code" href="namespaceOgre.html#a435a250">LML_NORMAL</a>, <font class="stringliteral">"Detected DirectDraw driver %s.\n"</font>, lpDriverDesc );
00131     }
00132 
<a name="l00133"></a><a class="code" href="classOgre_1_1DDDriverList.html#Ogre_1_1DDDriverLista4">00133</a>     <font class="keywordtype">unsigned</font> <font class="keywordtype">int</font> DDDriverList::count(<font class="keywordtype">void</font>) <font class="keyword">const</font> <font class="keywordflow">throw</font>()
00134     {
00135         <font class="keywordflow">return</font> static_cast&lt; unsigned int &gt;( mDriverList.size() );
00136     }
00137 
<a name="l00138"></a><a class="code" href="classOgre_1_1DDDriverList.html#Ogre_1_1DDDriverLista3">00138</a>     <a class="code" href="classOgre_1_1DDDriver.html">DDDriver</a>* DDDriverList::item(<font class="keywordtype">int</font> index) <font class="keywordflow">throw</font>( std::out_of_range )
00139     {
00140         <font class="keywordflow">return</font> &amp;mDriverList.at( index );
00141     }
00142 }
</pre></div><p>
Copyright &copy; 2002 by The OGRE Team<br />
<script type="text/javascript">
<!--//hide script from old browsers
document.write( "Last modified "+ document.lastModified );
//end hiding contents -->
</script>
</p>
</body>
</html>
