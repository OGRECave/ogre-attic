<html>
<head>
<title>OGRE Documentation</title> <meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1"> 
<link type="text/css" rel="stylesheet" href="style.css">
</head>

<body>
<!-- Generated by Doxygen 1.2.16 -->
<center>
<a class="qindex" href="index.html">Main Page</a> &nbsp; <a class="qindex" href="namespaces.html">Namespace List</a> &nbsp; <a class="qindex" href="hierarchy.html">Class Hierarchy</a> &nbsp; <a class="qindex" href="classes.html">Alphabetical List</a> &nbsp; <a class="qindex" href="annotated.html">Compound List</a> &nbsp; <a class="qindex" href="files.html">File List</a> &nbsp; <a class="qindex" href="namespacemembers.html">Namespace Members</a> &nbsp; <a class="qindex" href="functions.html">Compound Members</a> &nbsp; <a class="qindex" href="globals.html">File Members</a> &nbsp; <a class="qindex" href="pages.html">Related Pages</a> &nbsp; </center>
<hr><h1>OgreMeshSerializer.cpp</h1><a href="OgreMeshSerializer_8cpp.html">Go to the documentation of this file.</a><div class="fragment"><pre>00001 <font class="comment">/*</font>
00002 <font class="comment">-----------------------------------------------------------------------------</font>
00003 <font class="comment">This source file is part of OGRE</font>
00004 <font class="comment">    (Object-oriented Graphics Rendering Engine)</font>
00005 <font class="comment">For the latest info, see http://www.stevestreeting.com/ogre/</font>
00006 <font class="comment"></font>
00007 <font class="comment">Copyright © 2000-2002 The OGRE Team</font>
00008 <font class="comment">Also see acknowledgements in Readme.html</font>
00009 <font class="comment"></font>
00010 <font class="comment">This program is free software; you can redistribute it and/or modify it under</font>
00011 <font class="comment">the terms of the GNU General Public License as published by the Free Software</font>
00012 <font class="comment">Foundation; either version 2 of the License, or (at your option) any later</font>
00013 <font class="comment">version.</font>
00014 <font class="comment"></font>
00015 <font class="comment">This program is distributed in the hope that it will be useful, but WITHOUT</font>
00016 <font class="comment">ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or FITNESS</font>
00017 <font class="comment">FOR A PARTICULAR PURPOSE. See the GNU General Public License for more details.</font>
00018 <font class="comment"></font>
00019 <font class="comment">You should have received a copy of the GNU General Public License along with</font>
00020 <font class="comment">this program; if not, write to the Free Software Foundation, Inc., 59 Temple</font>
00021 <font class="comment">Place - Suite 330, Boston, MA 02111-1307, USA, or go to</font>
00022 <font class="comment">http://www.gnu.org/copyleft/gpl.html.</font>
00023 <font class="comment">-----------------------------------------------------------------------------</font>
00024 <font class="comment">*/</font>
00025 
00026 <font class="preprocessor">#include "<a class="code" href="OgreMeshSerializer_8h.html">OgreMeshSerializer.h</a>"</font>
00027 <font class="preprocessor">#include "<a class="code" href="OgreMeshFileFormat_8h.html">OgreMeshFileFormat.h</a>"</font>
00028 <font class="preprocessor">#include "<a class="code" href="OgreMesh_8h.html">OgreMesh.h</a>"</font>
00029 <font class="preprocessor">#include "<a class="code" href="OgreSubMesh_8h.html">OgreSubMesh.h</a>"</font>
00030 <font class="preprocessor">#include "<a class="code" href="OgreException_8h.html">OgreException.h</a>"</font>
00031 <font class="preprocessor">#include "<a class="code" href="OgreOofModelFile_8h.html">OgreOofModelFile.h</a>"</font>
00032 <font class="preprocessor">#include "<a class="code" href="OgreMaterialManager_8h.html">OgreMaterialManager.h</a>"</font>
00033 <font class="preprocessor">#include "<a class="code" href="OgreLogManager_8h.html">OgreLogManager.h</a>"</font>
00034 <font class="preprocessor">#include "<a class="code" href="OgreSkeleton_8h.html">OgreSkeleton.h</a>"</font>
00035 
00036 
00037 <font class="keyword">namespace </font>Ogre {
00038 
00040     <font class="keyword">const</font> <font class="keywordtype">unsigned</font> <font class="keywordtype">long</font> <a class="code" href="namespaceOgre.html#a341">CHUNK_OVERHEAD_SIZE</a> = <font class="keyword">sizeof</font>(<font class="keywordtype">unsigned</font> <font class="keywordtype">short</font>) + <font class="keyword">sizeof</font>(<font class="keywordtype">unsigned</font> <font class="keywordtype">long</font>);
00041     <font class="comment">//---------------------------------------------------------------------</font>
<a name="l00042"></a><a class="code" href="classOgre_1_1MeshSerializer.html#Ogre_1_1MeshSerializera0">00042</a>     MeshSerializer::MeshSerializer()
00043     {
00044         <a class="code" href="classOgre_1_1MeshSerializer.html#Ogre_1_1MeshSerializero1">mpMesh</a> = 0;
00045 
00046         <font class="comment">// Version number</font>
00047         <a class="code" href="classOgre_1_1Serializer.html#Ogre_1_1SkeletonSerializern2">mVersion</a> = <font class="stringliteral">"[MeshSerializer_v1.00]"</font>;
00048     }
00049     <font class="comment">//---------------------------------------------------------------------</font>
<a name="l00050"></a><a class="code" href="classOgre_1_1MeshSerializer.html#Ogre_1_1MeshSerializera1">00050</a>     MeshSerializer::~MeshSerializer()
00051     {
00052     }
00053     <font class="comment">//---------------------------------------------------------------------</font>
<a name="l00054"></a><a class="code" href="classOgre_1_1MeshSerializer.html#Ogre_1_1MeshSerializera2">00054</a>     <font class="keywordtype">void</font> MeshSerializer::exportMesh(<font class="keyword">const</font> <a class="code" href="classOgre_1_1Mesh.html">Mesh</a>* pMesh, <font class="keyword">const</font> <a class="code" href="classOgre_1_1String.html">String</a>&amp; filename, <font class="keywordtype">bool</font> includeMaterials)
00055     {
00056         <a class="code" href="classOgre_1_1MaterialManager.html">MaterialManager</a>&amp; matMgr = MaterialManager::getSingleton();
00057         <a class="code" href="classOgre_1_1Serializer.html#Ogre_1_1SkeletonSerializern1">mpfFile</a> = fopen(filename, <font class="stringliteral">"wb"</font>);
00058 
00059         <a class="code" href="classOgre_1_1Serializer.html#Ogre_1_1SkeletonSerializerb0">writeFileHeader</a>();
00060 
00061         <font class="comment">// Write materials if required</font>
00062         <font class="keywordflow">if</font> (includeMaterials)
00063         {
00064             <font class="keywordflow">for</font> (<font class="keywordtype">int</font> i = 0; i &lt; pMesh-&gt;<a class="code" href="classOgre_1_1Mesh.html#Ogre_1_1Mesha5">getNumSubMeshes</a>(); ++i)
00065             {
00066                 <a class="code" href="classOgre_1_1SubMesh.html">SubMesh</a>* sm = pMesh-&gt;<a class="code" href="classOgre_1_1Mesh.html#Ogre_1_1Mesha6">getSubMesh</a>(i);
00067                 <a class="code" href="classOgre_1_1Material.html">Material</a>* pMat = (<a class="code" href="classOgre_1_1Material.html">Material</a>*)matMgr.<a class="code" href="classOgre_1_1ResourceManager.html#Ogre_1_1TextureManagera13">getByName</a>(sm-&gt;<a class="code" href="classOgre_1_1SubMesh.html#Ogre_1_1SubMesha3">getMaterialName</a>());
00068                 <font class="keywordflow">if</font> (pMat)
00069                 {
00070                     <a class="code" href="classOgre_1_1MeshSerializer.html#Ogre_1_1MeshSerializerc0">writeMaterial</a>(pMat);
00071                 }
00072             }
00073         }
00074 
00075         <a class="code" href="classOgre_1_1MeshSerializer.html#Ogre_1_1MeshSerializerc2">writeMesh</a>(pMesh);
00076 
00077         fclose(<a class="code" href="classOgre_1_1Serializer.html#Ogre_1_1SkeletonSerializern1">mpfFile</a>);
00078     }
00079     <font class="comment">//---------------------------------------------------------------------</font>
<a name="l00080"></a><a class="code" href="classOgre_1_1MeshSerializer.html#Ogre_1_1MeshSerializera3">00080</a>     <font class="keywordtype">void</font> MeshSerializer::importMesh(<a class="code" href="classOgre_1_1DataChunk.html">DataChunk</a>&amp; chunk, <a class="code" href="classOgre_1_1Mesh.html">Mesh</a>* pDest)
00081     {
00082         <a class="code" href="classOgre_1_1MeshSerializer.html#Ogre_1_1MeshSerializero1">mpMesh</a> = pDest;
00083 
00084         <font class="comment">// Check header</font>
00085         <a class="code" href="classOgre_1_1Serializer.html#Ogre_1_1SkeletonSerializerb9">readFileHeader</a>(chunk);
00086 
00087         <font class="keywordtype">unsigned</font> <font class="keywordtype">short</font> chunkID;
00088         <font class="keywordflow">while</font>(!chunk.<a class="code" href="classOgre_1_1DataChunk.html#Ogre_1_1SDDataChunka12">isEOF</a>())
00089         {
00090             chunkID = <a class="code" href="classOgre_1_1Serializer.html#Ogre_1_1SkeletonSerializerb10">readChunk</a>(chunk);
00091             <font class="keywordflow">switch</font> (chunkID)
00092             {
00093             <font class="keywordflow">case</font> <a class="code" href="namespaceOgre.html#a436a255">M_MATERIAL</a>:
00094                 <a class="code" href="classOgre_1_1MeshSerializer.html#Ogre_1_1MeshSerializerc14">readMaterial</a>(chunk);
00095                 <font class="keywordflow">break</font>;
00096             <font class="keywordflow">case</font> <a class="code" href="namespaceOgre.html#a436a257">M_MESH</a>:
00097                 <a class="code" href="classOgre_1_1MeshSerializer.html#Ogre_1_1MeshSerializerc16">readMesh</a>(chunk);
00098                 <font class="keywordflow">break</font>;
00099             }
00100         }
00101     }
00102     <font class="comment">//---------------------------------------------------------------------</font>
<a name="l00103"></a><a class="code" href="classOgre_1_1MeshSerializer.html#Ogre_1_1MeshSerializera4">00103</a>     <font class="keywordtype">void</font> MeshSerializer::importLegacyOof(<a class="code" href="classOgre_1_1DataChunk.html">DataChunk</a>&amp; chunk, <a class="code" href="classOgre_1_1Mesh.html">Mesh</a>* pDest)
00104     {
00105         <font class="comment">// Load from OOF (Ogre Object File)</font>
00106         <a class="code" href="classOgre_1_1OofModelFile.html">OofModelFile</a> oofModel;
00107         <a class="code" href="classOgre_1_1MaterialManager.html">MaterialManager</a>&amp; matMgr = MaterialManager::getSingleton();
00108 
00109         oofModel.<a class="code" href="classOgre_1_1OofModelFile.html#Ogre_1_1OofModelFilea2">load</a>(chunk);
00110 
00111         <font class="comment">// Set memory deallocation off (allows us to use pointers)</font>
00112         oofModel.<a class="code" href="classOgre_1_1OofModelFile.html#Ogre_1_1OofModelFilem0">autoDeallocateMemory</a> = <font class="keyword">false</font>;
00113         <font class="comment">// Copy root-level geometry, including pointers</font>
00114         <font class="comment">// We've told the OofModel not to deallocate</font>
00115         pDest-&gt;<a class="code" href="classOgre_1_1Mesh.html#Ogre_1_1Meshm0">sharedGeometry</a> = oofModel.<a class="code" href="classOgre_1_1OofModelFile.html#Ogre_1_1OofModelFilem2">sharedGeometry</a>;
00116 
00117         <font class="comment">// Create sub-meshes from the loaded model</font>
00118         <font class="keywordflow">for</font> (<font class="keywordtype">unsigned</font> <font class="keywordtype">int</font> meshNo = 0; meshNo &lt; oofModel.<a class="code" href="classOgre_1_1OofModelFile.html#Ogre_1_1OofModelFilem3">materials</a>.size(); ++meshNo)
00119         {
00120             <a class="code" href="classOgre_1_1SubMesh.html">SubMesh</a>* sub = pDest-&gt;<a class="code" href="classOgre_1_1Mesh.html#Ogre_1_1Mesha4">createSubMesh</a>();
00121             <font class="comment">// Copy submesh geometry if present</font>
00122             sub-&gt;<a class="code" href="classOgre_1_1SubMesh.html#Ogre_1_1SubMeshm0">useSharedVertices</a> = oofModel.<a class="code" href="classOgre_1_1OofModelFile.html#Ogre_1_1OofModelFilem3">materials</a>[meshNo].useSharedVertices;
00123             <font class="keywordflow">if</font> (!sub-&gt;<a class="code" href="classOgre_1_1SubMesh.html#Ogre_1_1SubMeshm0">useSharedVertices</a>)
00124             {
00125                 sub-&gt;<a class="code" href="classOgre_1_1SubMesh.html#Ogre_1_1SubMeshm2">geometry</a> = oofModel.<a class="code" href="classOgre_1_1OofModelFile.html#Ogre_1_1OofModelFilem3">materials</a>[meshNo].materialGeometry;
00126             }
00127 
00128             <font class="comment">// Always create materials from oof</font>
00129             <font class="keywordflow">try</font> 
00130             {
00131                 matMgr.<a class="code" href="classOgre_1_1MaterialManager.html#Ogre_1_1MaterialManagera2">add</a>(oofModel.<a class="code" href="classOgre_1_1OofModelFile.html#Ogre_1_1OofModelFilem3">materials</a>[meshNo].material);
00132             }
00133             <font class="keywordflow">catch</font> (<a class="code" href="classOgre_1_1Exception.html">Exception</a>&amp; e)
00134             {
00135                 <font class="keywordflow">if</font>(e.getNumber() == Exception::ERR_DUPLICATE_ITEM)
00136                 {
00137                     <font class="comment">// Material already exists</font>
00138                     <font class="keywordtype">char</font> msg[256];
00139                     sprintf(msg, <font class="stringliteral">"Material '%s' in model '%s' has been ignored "</font>
00140                         <font class="stringliteral">"because a material with the same name has already "</font>
00141                         <font class="stringliteral">"been registered."</font>, 
00142                         oofModel.<a class="code" href="classOgre_1_1OofModelFile.html#Ogre_1_1OofModelFilem3">materials</a>[meshNo].material.getName().c_str(),
00143                         pDest-&gt;<a class="code" href="classOgre_1_1Resource.html#Ogre_1_1Zipa26">getName</a>().c_str());
00144                     LogManager::getSingleton().logMessage(msg);
00145                 }
00146                 <font class="keywordflow">else</font>
00147                 {
00148                     <font class="keywordflow">throw</font>;
00149                 }
00150             }
00151 
00152             sub-&gt;<a class="code" href="classOgre_1_1SubMesh.html#Ogre_1_1SubMesha2">setMaterialName</a>(oofModel.<a class="code" href="classOgre_1_1OofModelFile.html#Ogre_1_1OofModelFilem3">materials</a>[meshNo].material.getName());
00153 
00154             sub-&gt;<a class="code" href="classOgre_1_1SubMesh.html#Ogre_1_1SubMeshm3">numFaces</a> = oofModel.<a class="code" href="classOgre_1_1OofModelFile.html#Ogre_1_1OofModelFilem3">materials</a>[meshNo].numFaces;
00155             sub-&gt;<a class="code" href="classOgre_1_1SubMesh.html#Ogre_1_1SubMeshm4">faceVertexIndices</a> = oofModel.<a class="code" href="classOgre_1_1OofModelFile.html#Ogre_1_1OofModelFilem3">materials</a>[meshNo].pIndexes;
00156 
00157 
00158 
00159         }
00160     }
00161     <font class="comment">//---------------------------------------------------------------------</font>
<a name="l00162"></a><a class="code" href="classOgre_1_1MeshSerializer.html#Ogre_1_1MeshSerializerc0">00162</a>     <font class="keywordtype">void</font> MeshSerializer::writeMaterial(<font class="keyword">const</font> <a class="code" href="classOgre_1_1Material.html">Material</a>* m)
00163     {
00164         <font class="comment">// Header</font>
00165         <a class="code" href="classOgre_1_1Serializer.html#Ogre_1_1SkeletonSerializerb1">writeChunkHeader</a>(<a class="code" href="namespaceOgre.html#a436a255">M_MATERIAL</a>, <a class="code" href="classOgre_1_1MeshSerializer.html#Ogre_1_1MeshSerializerc7">calcMaterialSize</a>(m));
00166 
00167         <font class="comment">// Name</font>
00168         <a class="code" href="classOgre_1_1Serializer.html#Ogre_1_1SkeletonSerializerb8">writeString</a>(m-&gt;<a class="code" href="classOgre_1_1Material.html#Ogre_1_1Materiala3">getName</a>());
00169 
00170         <font class="comment">// Ambient</font>
00171         <font class="keyword">const</font> <a class="code" href="classOgre_1_1ColourValue.html">ColourValue</a>&amp; ambient = m-&gt;<a class="code" href="classOgre_1_1Material.html#Ogre_1_1Materiala14">getAmbient</a>();
00172         <a class="code" href="classOgre_1_1Serializer.html#Ogre_1_1SkeletonSerializerb7">writeData</a>(&amp;ambient.<a class="code" href="classOgre_1_1ColourValue.html#Ogre_1_1ColourValuem0">r</a>, <font class="keyword">sizeof</font>(<a class="code" href="namespaceOgre.html#a281">Real</a>), 1);
00173         <a class="code" href="classOgre_1_1Serializer.html#Ogre_1_1SkeletonSerializerb7">writeData</a>(&amp;ambient.<a class="code" href="classOgre_1_1ColourValue.html#Ogre_1_1ColourValuem1">g</a>, <font class="keyword">sizeof</font>(<a class="code" href="namespaceOgre.html#a281">Real</a>), 1);
00174         <a class="code" href="classOgre_1_1Serializer.html#Ogre_1_1SkeletonSerializerb7">writeData</a>(&amp;ambient.<a class="code" href="classOgre_1_1ColourValue.html#Ogre_1_1ColourValuem2">b</a>, <font class="keyword">sizeof</font>(<a class="code" href="namespaceOgre.html#a281">Real</a>), 1);
00175 
00176         <font class="comment">// Diffuse</font>
00177         <font class="keyword">const</font> <a class="code" href="classOgre_1_1ColourValue.html">ColourValue</a>&amp; diffuse = m-&gt;<a class="code" href="classOgre_1_1Material.html#Ogre_1_1Materiala15">getDiffuse</a>();
00178         <a class="code" href="classOgre_1_1Serializer.html#Ogre_1_1SkeletonSerializerb7">writeData</a>(&amp;diffuse.<a class="code" href="classOgre_1_1ColourValue.html#Ogre_1_1ColourValuem0">r</a>, <font class="keyword">sizeof</font>(<a class="code" href="namespaceOgre.html#a281">Real</a>), 1);
00179         <a class="code" href="classOgre_1_1Serializer.html#Ogre_1_1SkeletonSerializerb7">writeData</a>(&amp;diffuse.<a class="code" href="classOgre_1_1ColourValue.html#Ogre_1_1ColourValuem1">g</a>, <font class="keyword">sizeof</font>(<a class="code" href="namespaceOgre.html#a281">Real</a>), 1);
00180         <a class="code" href="classOgre_1_1Serializer.html#Ogre_1_1SkeletonSerializerb7">writeData</a>(&amp;diffuse.<a class="code" href="classOgre_1_1ColourValue.html#Ogre_1_1ColourValuem2">b</a>, <font class="keyword">sizeof</font>(<a class="code" href="namespaceOgre.html#a281">Real</a>), 1);
00181 
00182         <font class="comment">// Specular</font>
00183         <font class="keyword">const</font> <a class="code" href="classOgre_1_1ColourValue.html">ColourValue</a>&amp; specular = m-&gt;<a class="code" href="classOgre_1_1Material.html#Ogre_1_1Materiala16">getSpecular</a>();
00184         <a class="code" href="classOgre_1_1Serializer.html#Ogre_1_1SkeletonSerializerb7">writeData</a>(&amp;specular.<a class="code" href="classOgre_1_1ColourValue.html#Ogre_1_1ColourValuem0">r</a>, <font class="keyword">sizeof</font>(<a class="code" href="namespaceOgre.html#a281">Real</a>), 1);
00185         <a class="code" href="classOgre_1_1Serializer.html#Ogre_1_1SkeletonSerializerb7">writeData</a>(&amp;specular.<a class="code" href="classOgre_1_1ColourValue.html#Ogre_1_1ColourValuem1">g</a>, <font class="keyword">sizeof</font>(<a class="code" href="namespaceOgre.html#a281">Real</a>), 1);
00186         <a class="code" href="classOgre_1_1Serializer.html#Ogre_1_1SkeletonSerializerb7">writeData</a>(&amp;specular.<a class="code" href="classOgre_1_1ColourValue.html#Ogre_1_1ColourValuem2">b</a>, <font class="keyword">sizeof</font>(<a class="code" href="namespaceOgre.html#a281">Real</a>), 1);
00187 
00188         <font class="comment">// Shininess</font>
00189         <a class="code" href="namespaceOgre.html#a281">Real</a> val = m-&gt;<a class="code" href="classOgre_1_1Material.html#Ogre_1_1Materiala18">getShininess</a>();
00190         <a class="code" href="classOgre_1_1Serializer.html#Ogre_1_1SkeletonSerializerb7">writeData</a>(&amp;val, <font class="keyword">sizeof</font>(<a class="code" href="namespaceOgre.html#a281">Real</a>), 1);
00191 
00192         <font class="comment">// Nested texture layers</font>
00193         <font class="keywordflow">for</font> (<font class="keywordtype">int</font> i = 0; i &lt; m-&gt;<a class="code" href="classOgre_1_1Material.html#Ogre_1_1Materiala23">getNumTextureLayers</a>(); ++i)
00194         {
00195             <a class="code" href="classOgre_1_1MeshSerializer.html#Ogre_1_1MeshSerializerc1">writeTextureLayer</a>(m-&gt;<a class="code" href="classOgre_1_1Material.html#Ogre_1_1Materiala20">getTextureLayer</a>(i));
00196         }
00197 
00198     }
00199     <font class="comment">//---------------------------------------------------------------------</font>
<a name="l00200"></a><a class="code" href="classOgre_1_1MeshSerializer.html#Ogre_1_1MeshSerializerc1">00200</a>     <font class="keywordtype">void</font> MeshSerializer::writeTextureLayer(<font class="keyword">const</font> <a class="code" href="classOgre_1_1Material_1_1TextureLayer.html">Material::TextureLayer</a>* pTex)
00201     {
00202         <font class="comment">// Header</font>
00203         <a class="code" href="classOgre_1_1Serializer.html#Ogre_1_1SkeletonSerializerb1">writeChunkHeader</a>(<a class="code" href="namespaceOgre.html#a436a256">M_TEXTURE_LAYER</a>, <a class="code" href="classOgre_1_1MeshSerializer.html#Ogre_1_1MeshSerializerc8">calcTextureLayerSize</a>(pTex));
00204 
00205         <font class="comment">// Name</font>
00206         <a class="code" href="classOgre_1_1Serializer.html#Ogre_1_1SkeletonSerializerb8">writeString</a>(pTex-&gt;<a class="code" href="classOgre_1_1Material_1_1TextureLayer.html#Ogre_1_1Material_1_1TextureLayera6">getTextureName</a>());
00207 
00208     }
00209     <font class="comment">//---------------------------------------------------------------------</font>
<a name="l00210"></a><a class="code" href="classOgre_1_1MeshSerializer.html#Ogre_1_1MeshSerializerc2">00210</a>     <font class="keywordtype">void</font> MeshSerializer::writeMesh(<font class="keyword">const</font> <a class="code" href="classOgre_1_1Mesh.html">Mesh</a>* pMesh)
00211     {
00212         <font class="comment">// Header</font>
00213         <a class="code" href="classOgre_1_1Serializer.html#Ogre_1_1SkeletonSerializerb1">writeChunkHeader</a>(<a class="code" href="namespaceOgre.html#a436a257">M_MESH</a>, <a class="code" href="classOgre_1_1MeshSerializer.html#Ogre_1_1MeshSerializerc9">calcMeshSize</a>(pMesh));
00214 
00215         <font class="comment">// Write geometry</font>
00216         <a class="code" href="classOgre_1_1MeshSerializer.html#Ogre_1_1MeshSerializerc4">writeGeometry</a>(&amp;pMesh-&gt;<a class="code" href="classOgre_1_1Mesh.html#Ogre_1_1Meshm0">sharedGeometry</a>);
00217 
00218         <font class="comment">// Write Submeshes</font>
00219         <font class="keywordflow">for</font> (<font class="keywordtype">int</font> i = 0; i &lt; pMesh-&gt;<a class="code" href="classOgre_1_1Mesh.html#Ogre_1_1Mesha5">getNumSubMeshes</a>(); ++i)
00220         {
00221             <a class="code" href="classOgre_1_1MeshSerializer.html#Ogre_1_1MeshSerializerc3">writeSubMesh</a>(pMesh-&gt;<a class="code" href="classOgre_1_1Mesh.html#Ogre_1_1Mesha6">getSubMesh</a>(i));
00222         }
00223 
00224         <font class="comment">// Write skeleton info if required</font>
00225         <font class="keywordflow">if</font> (pMesh-&gt;<a class="code" href="classOgre_1_1Mesh.html#Ogre_1_1Mesha15">hasSkeleton</a>())
00226         {
00227             <font class="comment">// Write skeleton link</font>
00228             <a class="code" href="classOgre_1_1MeshSerializer.html#Ogre_1_1MeshSerializerc5">writeSkeletonLink</a>(pMesh-&gt;<a class="code" href="classOgre_1_1Mesh.html#Ogre_1_1Mesha16">getSkeleton</a>());
00229 
00230             <font class="comment">// Write bone assignments</font>
00231             Mesh::VertexBoneAssignmentList::const_iterator vi;
00232             <font class="keywordflow">for</font> (vi = pMesh-&gt;<a class="code" href="classOgre_1_1Mesh.html#Ogre_1_1Mesho5">mBoneAssignments</a>.begin(); 
00233             vi != pMesh-&gt;<a class="code" href="classOgre_1_1Mesh.html#Ogre_1_1Mesho5">mBoneAssignments</a>.end(); ++vi)
00234             {
00235                 <a class="code" href="classOgre_1_1MeshSerializer.html#Ogre_1_1MeshSerializerc6">writeBoneAssignment</a>(&amp;(vi-&gt;second));
00236             }
00237         }
00238 
00239 
00240     }
00241     <font class="comment">//---------------------------------------------------------------------</font>
<a name="l00242"></a><a class="code" href="classOgre_1_1MeshSerializer.html#Ogre_1_1MeshSerializerc3">00242</a>     <font class="keywordtype">void</font> MeshSerializer::writeSubMesh(<font class="keyword">const</font> <a class="code" href="classOgre_1_1SubMesh.html">SubMesh</a>* s)
00243     {
00244         <font class="comment">// Header</font>
00245         <a class="code" href="classOgre_1_1Serializer.html#Ogre_1_1SkeletonSerializerb1">writeChunkHeader</a>(<a class="code" href="namespaceOgre.html#a436a258">M_SUBMESH</a>, <a class="code" href="classOgre_1_1MeshSerializer.html#Ogre_1_1MeshSerializerc10">calcSubMeshSize</a>(s));
00246 
00247         <font class="comment">// char* materialName</font>
00248         <a class="code" href="classOgre_1_1Serializer.html#Ogre_1_1SkeletonSerializerb8">writeString</a>(s-&gt;<a class="code" href="classOgre_1_1SubMesh.html#Ogre_1_1SubMesha3">getMaterialName</a>());
00249 
00250         <font class="comment">// bool useSharedVertices</font>
00251         <a class="code" href="classOgre_1_1Serializer.html#Ogre_1_1SkeletonSerializerb7">writeData</a>(&amp;s-&gt;<a class="code" href="classOgre_1_1SubMesh.html#Ogre_1_1SubMeshm0">useSharedVertices</a>, <font class="keyword">sizeof</font>(<font class="keywordtype">bool</font>), 1);
00252 
00253         <font class="comment">// unsigned short numFaces</font>
00254         <a class="code" href="classOgre_1_1Serializer.html#Ogre_1_1SkeletonSerializerb7">writeData</a>(&amp;s-&gt;<a class="code" href="classOgre_1_1SubMesh.html#Ogre_1_1SubMeshm3">numFaces</a>, <font class="keyword">sizeof</font>(<font class="keywordtype">unsigned</font> <font class="keywordtype">short</font>), 1);
00255 
00256         <font class="comment">// unsigned short* faceVertexIndices ((v1, v2, v3) * numFaces)</font>
00257         <a class="code" href="classOgre_1_1Serializer.html#Ogre_1_1SkeletonSerializerb3">writeShorts</a>(s-&gt;<a class="code" href="classOgre_1_1SubMesh.html#Ogre_1_1SubMeshm4">faceVertexIndices</a>, s-&gt;<a class="code" href="classOgre_1_1SubMesh.html#Ogre_1_1SubMeshm3">numFaces</a> * 3);
00258 
00259         <font class="comment">// M_GEOMETRY chunk (Optional: present only if useSharedVertices = false)</font>
00260         <font class="keywordflow">if</font> (!s-&gt;<a class="code" href="classOgre_1_1SubMesh.html#Ogre_1_1SubMeshm0">useSharedVertices</a>)
00261         {
00262             <a class="code" href="classOgre_1_1MeshSerializer.html#Ogre_1_1MeshSerializerc4">writeGeometry</a>(&amp;s-&gt;<a class="code" href="classOgre_1_1SubMesh.html#Ogre_1_1SubMeshm2">geometry</a>);
00263         }
00264 
00265     }
00266     <font class="comment">//---------------------------------------------------------------------</font>
<a name="l00267"></a><a class="code" href="classOgre_1_1MeshSerializer.html#Ogre_1_1MeshSerializerc4">00267</a>     <font class="keywordtype">void</font> MeshSerializer::writeGeometry(<font class="keyword">const</font> <a class="code" href="structOgre_1_1GeometryData.html">GeometryData</a>* pGeom)
00268     {
00269         <font class="comment">// Header</font>
00270         <a class="code" href="classOgre_1_1Serializer.html#Ogre_1_1SkeletonSerializerb1">writeChunkHeader</a>(<a class="code" href="namespaceOgre.html#a436a259">M_GEOMETRY</a>, <a class="code" href="classOgre_1_1MeshSerializer.html#Ogre_1_1MeshSerializerc11">calcGeometrySize</a>(pGeom));
00271 
00272         <font class="comment">// unsigned short numVertices</font>
00273         <a class="code" href="classOgre_1_1Serializer.html#Ogre_1_1SkeletonSerializerb7">writeData</a>(&amp;pGeom-&gt;<a class="code" href="structOgre_1_1GeometryData.html#Ogre_1_1GeometryDatam0">numVertices</a>, <font class="keyword">sizeof</font>(<font class="keywordtype">unsigned</font> <font class="keywordtype">short</font>), 1);
00274 
00275         <font class="comment">// Real* pVertices (x, y, z order x numVertices)</font>
00276         <a class="code" href="classOgre_1_1Serializer.html#Ogre_1_1SkeletonSerializerb2">writeReals</a>(pGeom-&gt;<a class="code" href="structOgre_1_1GeometryData.html#Ogre_1_1GeometryDatam5">pVertices</a>, pGeom-&gt;<a class="code" href="structOgre_1_1GeometryData.html#Ogre_1_1GeometryDatam0">numVertices</a> * 3);
00277 
00278         <font class="keywordflow">if</font> (pGeom-&gt;<a class="code" href="structOgre_1_1GeometryData.html#Ogre_1_1GeometryDatam1">hasNormals</a>)
00279         {
00280             <a class="code" href="classOgre_1_1Serializer.html#Ogre_1_1SkeletonSerializerb1">writeChunkHeader</a>(<a class="code" href="namespaceOgre.html#a436a260">M_GEOMETRY_NORMALS</a>, <font class="keyword">sizeof</font>(<a class="code" href="namespaceOgre.html#a281">Real</a>) * pGeom-&gt;<a class="code" href="structOgre_1_1GeometryData.html#Ogre_1_1GeometryDatam0">numVertices</a> * 3);
00281 
00282             <font class="comment">// Real* pNormals (x, y, z order x numVertices)</font>
00283             <a class="code" href="classOgre_1_1Serializer.html#Ogre_1_1SkeletonSerializerb2">writeReals</a>(pGeom-&gt;<a class="code" href="structOgre_1_1GeometryData.html#Ogre_1_1GeometryDatam7">pNormals</a>, pGeom-&gt;<a class="code" href="structOgre_1_1GeometryData.html#Ogre_1_1GeometryDatam0">numVertices</a> * 3);
00284         }
00285 
00286         <font class="keywordflow">if</font> (pGeom-&gt;<a class="code" href="structOgre_1_1GeometryData.html#Ogre_1_1GeometryDatam4">hasColours</a>)
00287         {
00288             <a class="code" href="classOgre_1_1Serializer.html#Ogre_1_1SkeletonSerializerb1">writeChunkHeader</a>(<a class="code" href="namespaceOgre.html#a436a261">M_GEOMETRY_COLOURS</a>, <font class="keyword">sizeof</font>(<font class="keywordtype">unsigned</font> <font class="keywordtype">long</font>) * pGeom-&gt;<a class="code" href="structOgre_1_1GeometryData.html#Ogre_1_1GeometryDatam0">numVertices</a>);
00289             <font class="comment">// unsigned long* pColours (RGBA 8888 format x numVertices)</font>
00290             <a class="code" href="classOgre_1_1Serializer.html#Ogre_1_1SkeletonSerializerb4">writeLongs</a>((<font class="keywordtype">unsigned</font> <font class="keywordtype">long</font>*)pGeom-&gt;<a class="code" href="structOgre_1_1GeometryData.html#Ogre_1_1GeometryDatam8">pColours</a>, pGeom-&gt;<a class="code" href="structOgre_1_1GeometryData.html#Ogre_1_1GeometryDatam0">numVertices</a>);
00291         }
00292 
00293         <font class="keywordflow">for</font> (<font class="keywordtype">int</font> t = 0; t &lt; pGeom-&gt;<a class="code" href="structOgre_1_1GeometryData.html#Ogre_1_1GeometryDatam2">numTexCoords</a>; ++t)
00294         {
00295             <a class="code" href="classOgre_1_1Serializer.html#Ogre_1_1SkeletonSerializerb1">writeChunkHeader</a>(<a class="code" href="namespaceOgre.html#a436a262">M_GEOMETRY_TEXCOORDS</a>, 
00296                 <font class="keyword">sizeof</font>(<a class="code" href="namespaceOgre.html#a281">Real</a>) * pGeom-&gt;<a class="code" href="structOgre_1_1GeometryData.html#Ogre_1_1GeometryDatam0">numVertices</a> * pGeom-&gt;<a class="code" href="structOgre_1_1GeometryData.html#Ogre_1_1GeometryDatam3">numTexCoordDimensions</a>[t]);
00297 
00298             <font class="comment">// unsigned short dimensions    (1 for 1D, 2 for 2D, 3 for 3D)</font>
00299             <a class="code" href="classOgre_1_1Serializer.html#Ogre_1_1SkeletonSerializerb7">writeData</a>(&amp;pGeom-&gt;<a class="code" href="structOgre_1_1GeometryData.html#Ogre_1_1GeometryDatam3">numTexCoordDimensions</a>[t], <font class="keyword">sizeof</font>(<font class="keywordtype">unsigned</font> <font class="keywordtype">short</font>), 1);
00300             <font class="comment">// Real* pTexCoords  (u [v] [w] order, dimensions x numVertices)</font>
00301             <a class="code" href="classOgre_1_1Serializer.html#Ogre_1_1SkeletonSerializerb2">writeReals</a>(pGeom-&gt;<a class="code" href="structOgre_1_1GeometryData.html#Ogre_1_1GeometryDatam6">pTexCoords</a>[t], pGeom-&gt;<a class="code" href="structOgre_1_1GeometryData.html#Ogre_1_1GeometryDatam0">numVertices</a> * pGeom-&gt;<a class="code" href="structOgre_1_1GeometryData.html#Ogre_1_1GeometryDatam3">numTexCoordDimensions</a>[t]);
00302         }
00303 
00304 
00305     }
00306     <font class="comment">//---------------------------------------------------------------------</font>
<a name="l00307"></a><a class="code" href="classOgre_1_1MeshSerializer.html#Ogre_1_1MeshSerializerc7">00307</a>     <font class="keywordtype">unsigned</font> <font class="keywordtype">long</font> MeshSerializer::calcMaterialSize(<font class="keyword">const</font> <a class="code" href="classOgre_1_1Material.html">Material</a>* pMat)
00308     {
00309         <font class="keywordtype">unsigned</font> <font class="keywordtype">long</font> size = <a class="code" href="namespaceOgre.html#a341">CHUNK_OVERHEAD_SIZE</a>;
00310 
00311         <font class="comment">// Name, including terminator</font>
00312         size += (<font class="keywordtype">unsigned</font> <font class="keywordtype">long</font>)pMat-&gt;<a class="code" href="classOgre_1_1Material.html#Ogre_1_1Materiala3">getName</a>().length() + 1;
00313         <font class="comment">// Ambient </font>
00314         size += <font class="keyword">sizeof</font>(Real) * 3;
00315         <font class="comment">// Diffuse</font>
00316         size += <font class="keyword">sizeof</font>(Real) * 3;
00317         <font class="comment">// Specular</font>
00318         size += <font class="keyword">sizeof</font>(Real) * 3;
00319         <font class="comment">// Shininess</font>
00320         size += <font class="keyword">sizeof</font>(Real);
00321 
00322         <font class="comment">// Nested texture layers</font>
00323         <font class="keywordflow">for</font> (<font class="keywordtype">int</font> i = 0; i &lt; pMat-&gt;<a class="code" href="classOgre_1_1Material.html#Ogre_1_1Materiala23">getNumTextureLayers</a>(); ++i)
00324         {
00325             size += <a class="code" href="classOgre_1_1MeshSerializer.html#Ogre_1_1MeshSerializerc8">calcTextureLayerSize</a>(pMat-&gt;<a class="code" href="classOgre_1_1Material.html#Ogre_1_1Materiala20">getTextureLayer</a>(i));
00326         }
00327 
00328         <font class="keywordflow">return</font> size;
00329     }
00330     <font class="comment">//---------------------------------------------------------------------</font>
<a name="l00331"></a><a class="code" href="classOgre_1_1MeshSerializer.html#Ogre_1_1MeshSerializerc8">00331</a>     <font class="keywordtype">unsigned</font> <font class="keywordtype">long</font> MeshSerializer::calcTextureLayerSize(<font class="keyword">const</font> <a class="code" href="classOgre_1_1Material_1_1TextureLayer.html">Material::TextureLayer</a>* pTex)
00332     {
00333         <font class="keywordtype">unsigned</font> <font class="keywordtype">long</font> size = <a class="code" href="namespaceOgre.html#a341">CHUNK_OVERHEAD_SIZE</a>;
00334 
00335         <font class="comment">// Name, including terminator</font>
00336         size += (<font class="keywordtype">unsigned</font> <font class="keywordtype">long</font>)pTex-&gt;<a class="code" href="classOgre_1_1Material_1_1TextureLayer.html#Ogre_1_1Material_1_1TextureLayera6">getTextureName</a>().length() + 1;
00337 
00338         <font class="keywordflow">return</font> size;
00339     }
00340     <font class="comment">//---------------------------------------------------------------------</font>
<a name="l00341"></a><a class="code" href="classOgre_1_1MeshSerializer.html#Ogre_1_1MeshSerializerc9">00341</a>     <font class="keywordtype">unsigned</font> <font class="keywordtype">long</font> MeshSerializer::calcMeshSize(<font class="keyword">const</font> <a class="code" href="classOgre_1_1Mesh.html">Mesh</a>* pMesh)
00342     {
00343         <font class="keywordtype">unsigned</font> <font class="keywordtype">long</font> size = <a class="code" href="namespaceOgre.html#a341">CHUNK_OVERHEAD_SIZE</a>;
00344 
00345         <font class="comment">// Num shared vertices</font>
00346         size += <font class="keyword">sizeof</font>(<font class="keywordtype">unsigned</font> <font class="keywordtype">short</font>);
00347 
00348         <font class="comment">// Geometry</font>
00349         <font class="keywordflow">if</font> (pMesh-&gt;<a class="code" href="classOgre_1_1Mesh.html#Ogre_1_1Meshm0">sharedGeometry</a>.<a class="code" href="structOgre_1_1GeometryData.html#Ogre_1_1GeometryDatam0">numVertices</a> &gt; 0)
00350         {
00351             size += <a class="code" href="classOgre_1_1MeshSerializer.html#Ogre_1_1MeshSerializerc11">calcGeometrySize</a>(&amp;(pMesh-&gt;<a class="code" href="classOgre_1_1Mesh.html#Ogre_1_1Meshm0">sharedGeometry</a>));
00352         }
00353 
00354         <font class="comment">// Submeshes</font>
00355         <font class="keywordflow">for</font> (<font class="keywordtype">int</font> i = 0; i &lt; pMesh-&gt;<a class="code" href="classOgre_1_1Mesh.html#Ogre_1_1Mesha5">getNumSubMeshes</a>(); ++i)
00356         {
00357             size += <a class="code" href="classOgre_1_1MeshSerializer.html#Ogre_1_1MeshSerializerc10">calcSubMeshSize</a>(pMesh-&gt;<a class="code" href="classOgre_1_1Mesh.html#Ogre_1_1Mesha6">getSubMesh</a>(i));
00358         }
00359 
00360         <font class="comment">// Skeleton link</font>
00361         <font class="keywordflow">if</font> (pMesh-&gt;<a class="code" href="classOgre_1_1Mesh.html#Ogre_1_1Mesha15">hasSkeleton</a>())
00362         {
00363             size += <a class="code" href="classOgre_1_1MeshSerializer.html#Ogre_1_1MeshSerializerc12">calcSkeletonLinkSize</a>(pMesh-&gt;<a class="code" href="classOgre_1_1Mesh.html#Ogre_1_1Mesha16">getSkeleton</a>());
00364         }
00365 
00366         <font class="keywordflow">return</font> size;
00367 
00368 
00369     }
00370     <font class="comment">//---------------------------------------------------------------------</font>
<a name="l00371"></a><a class="code" href="classOgre_1_1MeshSerializer.html#Ogre_1_1MeshSerializerc10">00371</a>     <font class="keywordtype">unsigned</font> <font class="keywordtype">long</font> MeshSerializer::calcSubMeshSize(<font class="keyword">const</font> <a class="code" href="classOgre_1_1SubMesh.html">SubMesh</a>* pSub)
00372     {
00373         <font class="keywordtype">unsigned</font> <font class="keywordtype">long</font> size = <a class="code" href="namespaceOgre.html#a341">CHUNK_OVERHEAD_SIZE</a>;
00374 
00375         <font class="comment">// Material name</font>
00376         size += (<font class="keywordtype">unsigned</font> <font class="keywordtype">long</font>)pSub-&gt;<a class="code" href="classOgre_1_1SubMesh.html#Ogre_1_1SubMesha3">getMaterialName</a>().length() + 1;
00377 
00378         <font class="comment">// bool useSharedVertices</font>
00379         size += <font class="keyword">sizeof</font>(bool);
00380         <font class="comment">// unsigned short numFaces</font>
00381         size += <font class="keyword">sizeof</font>(<font class="keywordtype">unsigned</font> <font class="keywordtype">short</font>);
00382         <font class="comment">// unsigned short* faceVertexIndices ((v1, v2, v3) * numFaces)</font>
00383         size += <font class="keyword">sizeof</font>(<font class="keywordtype">unsigned</font> <font class="keywordtype">short</font>) * pSub-&gt;<a class="code" href="classOgre_1_1SubMesh.html#Ogre_1_1SubMeshm3">numFaces</a> * 3;
00384 
00385         <font class="comment">// Geometry</font>
00386         <font class="keywordflow">if</font> (!pSub-&gt;<a class="code" href="classOgre_1_1SubMesh.html#Ogre_1_1SubMeshm0">useSharedVertices</a>)
00387         {
00388             size += <a class="code" href="classOgre_1_1MeshSerializer.html#Ogre_1_1MeshSerializerc11">calcGeometrySize</a>(&amp;pSub-&gt;<a class="code" href="classOgre_1_1SubMesh.html#Ogre_1_1SubMeshm2">geometry</a>);
00389         }
00390 
00391         <font class="keywordflow">return</font> size;
00392     }
00393     <font class="comment">//---------------------------------------------------------------------</font>
<a name="l00394"></a><a class="code" href="classOgre_1_1MeshSerializer.html#Ogre_1_1MeshSerializerc11">00394</a>     <font class="keywordtype">unsigned</font> <font class="keywordtype">long</font> MeshSerializer::calcGeometrySize(<font class="keyword">const</font> <a class="code" href="structOgre_1_1GeometryData.html">GeometryData</a>* pGeom)
00395     {
00396         <font class="keywordtype">unsigned</font> <font class="keywordtype">long</font> size = <a class="code" href="namespaceOgre.html#a341">CHUNK_OVERHEAD_SIZE</a>;
00397 
00398         <font class="comment">// Num vertices</font>
00399         size += <font class="keyword">sizeof</font>(<font class="keywordtype">unsigned</font> <font class="keywordtype">short</font>);
00400         <font class="comment">// Vertex data</font>
00401         size += <font class="keyword">sizeof</font>(Real) * pGeom-&gt;<a class="code" href="structOgre_1_1GeometryData.html#Ogre_1_1GeometryDatam0">numVertices</a> * 3;
00402 
00403         <font class="keywordflow">if</font> (pGeom-&gt;<a class="code" href="structOgre_1_1GeometryData.html#Ogre_1_1GeometryDatam1">hasNormals</a>)
00404         {
00405             size += <a class="code" href="namespaceOgre.html#a341">CHUNK_OVERHEAD_SIZE</a>; <font class="comment">// subheader</font>
00406             size += <font class="keyword">sizeof</font>(Real) * pGeom-&gt;<a class="code" href="structOgre_1_1GeometryData.html#Ogre_1_1GeometryDatam0">numVertices</a> * 3; <font class="comment">//data</font>
00407         }
00408 
00409         <font class="keywordflow">for</font> (<font class="keywordtype">int</font> i = 0; i &lt; pGeom-&gt;<a class="code" href="structOgre_1_1GeometryData.html#Ogre_1_1GeometryDatam2">numTexCoords</a>; ++i)
00410         {
00411             size += <a class="code" href="namespaceOgre.html#a341">CHUNK_OVERHEAD_SIZE</a>; <font class="comment">// subheader</font>
00412             size += <font class="keyword">sizeof</font>(<font class="keywordtype">unsigned</font> <font class="keywordtype">short</font>); <font class="comment">// dimensions</font>
00413             size += <font class="keyword">sizeof</font>(Real) * pGeom-&gt;<a class="code" href="structOgre_1_1GeometryData.html#Ogre_1_1GeometryDatam0">numVertices</a> * pGeom-&gt;<a class="code" href="structOgre_1_1GeometryData.html#Ogre_1_1GeometryDatam3">numTexCoordDimensions</a>[i]; <font class="comment">//data</font>
00414         }
00415 
00416         <font class="keywordflow">if</font> (pGeom-&gt;<a class="code" href="structOgre_1_1GeometryData.html#Ogre_1_1GeometryDatam4">hasColours</a>) 
00417         {
00418             size += <a class="code" href="namespaceOgre.html#a341">CHUNK_OVERHEAD_SIZE</a>; <font class="comment">// subheader</font>
00419             size += <font class="keyword">sizeof</font>(<font class="keywordtype">unsigned</font> <font class="keywordtype">long</font>) * pGeom-&gt;<a class="code" href="structOgre_1_1GeometryData.html#Ogre_1_1GeometryDatam0">numVertices</a>; <font class="comment">//data</font>
00420         }
00421 
00422         <font class="keywordflow">return</font> size;
00423     }
00424     <font class="comment">//---------------------------------------------------------------------</font>
<a name="l00425"></a><a class="code" href="classOgre_1_1MeshSerializer.html#Ogre_1_1MeshSerializerc14">00425</a>     <font class="keywordtype">void</font> MeshSerializer::readMaterial(<a class="code" href="classOgre_1_1DataChunk.html">DataChunk</a>&amp; chunk)
00426     {
00427         <a class="code" href="classOgre_1_1ColourValue.html">ColourValue</a> col;
00428         <a class="code" href="namespaceOgre.html#a281">Real</a> rVal;
00429 
00430         <font class="comment">// char* name </font>
00431         <a class="code" href="classOgre_1_1String.html">String</a> name = <a class="code" href="classOgre_1_1Serializer.html#Ogre_1_1SkeletonSerializerb16">readString</a>(chunk);
00432 
00433         <font class="comment">// Create a new material</font>
00434         <a class="code" href="classOgre_1_1Material.html">Material</a>* pMat;
00435         <font class="keywordflow">try</font> 
00436         {
00437             pMat = (<a class="code" href="classOgre_1_1Material.html">Material</a>*)MaterialManager::getSingleton().create(name);
00438         }
00439         <font class="keywordflow">catch</font> (<a class="code" href="classOgre_1_1Exception.html">Exception</a>&amp; e)
00440         {
00441             <font class="keywordflow">if</font>(e.getNumber() == Exception::ERR_DUPLICATE_ITEM)
00442             {
00443                 <font class="comment">// Material already exists</font>
00444                 <font class="keywordtype">char</font> msg[256];
00445                 sprintf(msg, <font class="stringliteral">"Material '%s' in model '%s' has been ignored "</font>
00446                     <font class="stringliteral">"because a material with the same name has already "</font>
00447                     <font class="stringliteral">"been registered."</font>, name.c_str(),
00448                     <a class="code" href="classOgre_1_1MeshSerializer.html#Ogre_1_1MeshSerializero1">mpMesh</a>-&gt;<a class="code" href="classOgre_1_1Resource.html#Ogre_1_1Zipa26">getName</a>().c_str());
00449                 LogManager::getSingleton().logMessage(msg);
00450                 <font class="comment">// Skip the rest of this material</font>
00451                 chunk.<a class="code" href="classOgre_1_1DataChunk.html#Ogre_1_1SDDataChunka10">skip</a>(<a class="code" href="classOgre_1_1Serializer.html#Ogre_1_1SkeletonSerializern0">mCurrentChunkLen</a> - name.length() - 1 - <a class="code" href="namespaceOgre.html#a341">CHUNK_OVERHEAD_SIZE</a>);
00452                 <font class="keywordflow">return</font>;
00453 
00454             }
00455             <font class="keywordflow">else</font>
00456             {
00457                 <font class="keywordflow">throw</font>;
00458             }
00459         }
00460 
00461         <font class="comment">// AMBIENT</font>
00462         <font class="comment">// Real r, g, b</font>
00463         chunk.<a class="code" href="classOgre_1_1DataChunk.html#Ogre_1_1SDDataChunka8">read</a>(&amp;col.<a class="code" href="classOgre_1_1ColourValue.html#Ogre_1_1ColourValuem0">r</a>, <font class="keyword">sizeof</font>(<a class="code" href="namespaceOgre.html#a281">Real</a>));
00464         chunk.<a class="code" href="classOgre_1_1DataChunk.html#Ogre_1_1SDDataChunka8">read</a>(&amp;col.<a class="code" href="classOgre_1_1ColourValue.html#Ogre_1_1ColourValuem1">g</a>, <font class="keyword">sizeof</font>(<a class="code" href="namespaceOgre.html#a281">Real</a>));
00465         chunk.<a class="code" href="classOgre_1_1DataChunk.html#Ogre_1_1SDDataChunka8">read</a>(&amp;col.<a class="code" href="classOgre_1_1ColourValue.html#Ogre_1_1ColourValuem2">b</a>, <font class="keyword">sizeof</font>(<a class="code" href="namespaceOgre.html#a281">Real</a>));
00466         pMat-&gt;<a class="code" href="classOgre_1_1Material.html#Ogre_1_1Materiala5">setAmbient</a>(col);
00467 
00468         <font class="comment">// DIFFUSE</font>
00469         <font class="comment">// Real r, g, b</font>
00470         chunk.<a class="code" href="classOgre_1_1DataChunk.html#Ogre_1_1SDDataChunka8">read</a>(&amp;col.<a class="code" href="classOgre_1_1ColourValue.html#Ogre_1_1ColourValuem0">r</a>, <font class="keyword">sizeof</font>(<a class="code" href="namespaceOgre.html#a281">Real</a>));
00471         chunk.<a class="code" href="classOgre_1_1DataChunk.html#Ogre_1_1SDDataChunka8">read</a>(&amp;col.<a class="code" href="classOgre_1_1ColourValue.html#Ogre_1_1ColourValuem1">g</a>, <font class="keyword">sizeof</font>(<a class="code" href="namespaceOgre.html#a281">Real</a>));
00472         chunk.<a class="code" href="classOgre_1_1DataChunk.html#Ogre_1_1SDDataChunka8">read</a>(&amp;col.<a class="code" href="classOgre_1_1ColourValue.html#Ogre_1_1ColourValuem2">b</a>, <font class="keyword">sizeof</font>(<a class="code" href="namespaceOgre.html#a281">Real</a>));
00473         pMat-&gt;<a class="code" href="classOgre_1_1Material.html#Ogre_1_1Materiala7">setDiffuse</a>(col);
00474 
00475         <font class="comment">// SPECULAR</font>
00476         <font class="comment">// Real r, g, b</font>
00477         chunk.<a class="code" href="classOgre_1_1DataChunk.html#Ogre_1_1SDDataChunka8">read</a>(&amp;col.<a class="code" href="classOgre_1_1ColourValue.html#Ogre_1_1ColourValuem0">r</a>, <font class="keyword">sizeof</font>(<a class="code" href="namespaceOgre.html#a281">Real</a>));
00478         chunk.<a class="code" href="classOgre_1_1DataChunk.html#Ogre_1_1SDDataChunka8">read</a>(&amp;col.<a class="code" href="classOgre_1_1ColourValue.html#Ogre_1_1ColourValuem1">g</a>, <font class="keyword">sizeof</font>(<a class="code" href="namespaceOgre.html#a281">Real</a>));
00479         chunk.<a class="code" href="classOgre_1_1DataChunk.html#Ogre_1_1SDDataChunka8">read</a>(&amp;col.<a class="code" href="classOgre_1_1ColourValue.html#Ogre_1_1ColourValuem2">b</a>, <font class="keyword">sizeof</font>(<a class="code" href="namespaceOgre.html#a281">Real</a>));
00480         pMat-&gt;<a class="code" href="classOgre_1_1Material.html#Ogre_1_1Materiala9">setSpecular</a>(col);
00481 
00482         <font class="comment">// SHININESS</font>
00483         <font class="comment">// Real val;</font>
00484         chunk.<a class="code" href="classOgre_1_1DataChunk.html#Ogre_1_1SDDataChunka8">read</a>(&amp;rVal, <font class="keyword">sizeof</font>(<a class="code" href="namespaceOgre.html#a281">Real</a>));
00485         pMat-&gt;<a class="code" href="classOgre_1_1Material.html#Ogre_1_1Materiala11">setShininess</a>(rVal);
00486 
00487         <font class="comment">// Read any texture layers</font>
00488         <font class="keywordflow">if</font> (!chunk.<a class="code" href="classOgre_1_1DataChunk.html#Ogre_1_1SDDataChunka12">isEOF</a>())
00489         {
00490             <font class="keywordtype">unsigned</font> <font class="keywordtype">short</font> chunkID = <a class="code" href="classOgre_1_1Serializer.html#Ogre_1_1SkeletonSerializerb10">readChunk</a>(chunk);
00491             <font class="keywordflow">while</font>(chunkID == <a class="code" href="namespaceOgre.html#a436a256">M_TEXTURE_LAYER</a> &amp;&amp; !chunk.<a class="code" href="classOgre_1_1DataChunk.html#Ogre_1_1SDDataChunka12">isEOF</a>())
00492             {
00493                 <a class="code" href="classOgre_1_1MeshSerializer.html#Ogre_1_1MeshSerializerc15">readTextureLayer</a>(chunk, pMat);
00494                 <font class="keywordflow">if</font> (!chunk.<a class="code" href="classOgre_1_1DataChunk.html#Ogre_1_1SDDataChunka12">isEOF</a>())
00495                 {
00496                     chunkID = <a class="code" href="classOgre_1_1Serializer.html#Ogre_1_1SkeletonSerializerb10">readChunk</a>(chunk);
00497                 }
00498             }
00499             <font class="comment">// Get next chunk</font>
00500             <font class="keywordflow">if</font> (!chunk.<a class="code" href="classOgre_1_1DataChunk.html#Ogre_1_1SDDataChunka12">isEOF</a>())
00501             {
00502                 <font class="comment">// Backpedal back to start of non-texture layer chunk</font>
00503                 chunk.<a class="code" href="classOgre_1_1DataChunk.html#Ogre_1_1SDDataChunka10">skip</a>(-(<font class="keywordtype">long</font>)<a class="code" href="namespaceOgre.html#a341">CHUNK_OVERHEAD_SIZE</a>);
00504             }
00505         }
00506 
00507     }
00508     <font class="comment">//---------------------------------------------------------------------</font>
<a name="l00509"></a><a class="code" href="classOgre_1_1MeshSerializer.html#Ogre_1_1MeshSerializerc15">00509</a>     <font class="keywordtype">void</font> MeshSerializer::readTextureLayer(<a class="code" href="classOgre_1_1DataChunk.html">DataChunk</a>&amp; chunk, <a class="code" href="classOgre_1_1Material.html">Material</a>* pMat)
00510     {
00511         <font class="comment">// Just name for now</font>
00512         <a class="code" href="classOgre_1_1String.html">String</a> name = <a class="code" href="classOgre_1_1Serializer.html#Ogre_1_1SkeletonSerializerb16">readString</a>(chunk);
00513 
00514         pMat-&gt;<a class="code" href="classOgre_1_1Material.html#Ogre_1_1Materiala19">addTextureLayer</a>(name);
00515     }
00516     <font class="comment">//---------------------------------------------------------------------</font>
<a name="l00517"></a><a class="code" href="classOgre_1_1MeshSerializer.html#Ogre_1_1MeshSerializerc16">00517</a>     <font class="keywordtype">void</font> MeshSerializer::readMesh(<a class="code" href="classOgre_1_1DataChunk.html">DataChunk</a>&amp; chunk)
00518     {
00519         <font class="keywordtype">unsigned</font> <font class="keywordtype">short</font> chunkID;
00520         <font class="comment">// M_GEOMETRY chunk</font>
00521         chunkID = <a class="code" href="classOgre_1_1Serializer.html#Ogre_1_1SkeletonSerializerb10">readChunk</a>(chunk);
00522         <font class="keywordflow">if</font> (chunkID != <a class="code" href="namespaceOgre.html#a436a259">M_GEOMETRY</a>)
00523         {
00524             <a class="code" href="OgreException_8h.html#a0">Except</a>(Exception::ERR_INTERNAL_ERROR, <font class="stringliteral">"Missing geometry data in mesh file"</font>, 
00525                 <font class="stringliteral">"MeshSerializer::readMesh"</font>);
00526         }
00527         <a class="code" href="classOgre_1_1MeshSerializer.html#Ogre_1_1MeshSerializerc18">readGeometry</a>(chunk, &amp;<a class="code" href="classOgre_1_1MeshSerializer.html#Ogre_1_1MeshSerializero1">mpMesh</a>-&gt;<a class="code" href="classOgre_1_1Mesh.html#Ogre_1_1Meshm0">sharedGeometry</a>);
00528 
00529         <font class="comment">// Find all subchunks </font>
00530         <font class="keywordflow">if</font> (!chunk.<a class="code" href="classOgre_1_1DataChunk.html#Ogre_1_1SDDataChunka12">isEOF</a>())
00531         {
00532             chunkID = <a class="code" href="classOgre_1_1Serializer.html#Ogre_1_1SkeletonSerializerb10">readChunk</a>(chunk);
00533             <font class="keywordflow">while</font>(!chunk.<a class="code" href="classOgre_1_1DataChunk.html#Ogre_1_1SDDataChunka12">isEOF</a>())
00534             {
00535                 <font class="keywordflow">switch</font>(chunkID)
00536                 {
00537                 <font class="keywordflow">case</font> <a class="code" href="namespaceOgre.html#a436a258">M_SUBMESH</a>:
00538                     <a class="code" href="classOgre_1_1MeshSerializer.html#Ogre_1_1MeshSerializerc17">readSubMesh</a>(chunk);
00539                     <font class="keywordflow">break</font>;
00540                 <font class="keywordflow">case</font> <a class="code" href="namespaceOgre.html#a436a263">M_MESH_SKELETON_LINK</a>:
00541                     <a class="code" href="classOgre_1_1MeshSerializer.html#Ogre_1_1MeshSerializerc19">readSkeletonLink</a>(chunk);
00542                     <font class="keywordflow">break</font>;
00543                 <font class="keywordflow">case</font> <a class="code" href="namespaceOgre.html#a436a264">M_MESH_BONE_ASSIGNMENT</a>:
00544                     <a class="code" href="classOgre_1_1MeshSerializer.html#Ogre_1_1MeshSerializerc20">readBoneAssignment</a>(chunk);
00545                     <font class="keywordflow">break</font>;
00546                 }
00547 
00548                 <font class="keywordflow">if</font> (!chunk.<a class="code" href="classOgre_1_1DataChunk.html#Ogre_1_1SDDataChunka12">isEOF</a>())
00549                 {
00550                     chunkID = <a class="code" href="classOgre_1_1Serializer.html#Ogre_1_1SkeletonSerializerb10">readChunk</a>(chunk);
00551                 }
00552 
00553             }
00554             <font class="keywordflow">if</font> (!chunk.<a class="code" href="classOgre_1_1DataChunk.html#Ogre_1_1SDDataChunka12">isEOF</a>())
00555             {
00556                 <font class="comment">// Backpedal back to start of chunk</font>
00557                 chunk.<a class="code" href="classOgre_1_1DataChunk.html#Ogre_1_1SDDataChunka10">skip</a>(-(<font class="keywordtype">long</font>)<a class="code" href="namespaceOgre.html#a341">CHUNK_OVERHEAD_SIZE</a>);
00558             }
00559         }
00560 
00561     }
00562     <font class="comment">//---------------------------------------------------------------------</font>
<a name="l00563"></a><a class="code" href="classOgre_1_1MeshSerializer.html#Ogre_1_1MeshSerializerc17">00563</a>     <font class="keywordtype">void</font> MeshSerializer::readSubMesh(<a class="code" href="classOgre_1_1DataChunk.html">DataChunk</a>&amp; chunk)
00564     {
00565         <font class="keywordtype">unsigned</font> <font class="keywordtype">short</font> chunkID;
00566 
00567         <a class="code" href="classOgre_1_1SubMesh.html">SubMesh</a>* sm = <a class="code" href="classOgre_1_1MeshSerializer.html#Ogre_1_1MeshSerializero1">mpMesh</a>-&gt;<a class="code" href="classOgre_1_1Mesh.html#Ogre_1_1Mesha4">createSubMesh</a>();
00568         <font class="comment">// char* materialName</font>
00569         <a class="code" href="classOgre_1_1String.html">String</a> materialName = <a class="code" href="classOgre_1_1Serializer.html#Ogre_1_1SkeletonSerializerb16">readString</a>(chunk);
00570         sm-&gt;<a class="code" href="classOgre_1_1SubMesh.html#Ogre_1_1SubMesha2">setMaterialName</a>(materialName);
00571 
00572         <font class="comment">// bool useSharedVertices</font>
00573         chunk.<a class="code" href="classOgre_1_1DataChunk.html#Ogre_1_1SDDataChunka8">read</a>(&amp;sm-&gt;<a class="code" href="classOgre_1_1SubMesh.html#Ogre_1_1SubMeshm0">useSharedVertices</a>, <font class="keyword">sizeof</font>(<font class="keywordtype">bool</font>));
00574 
00575         <font class="comment">// unsigned short numFaces</font>
00576         chunk.<a class="code" href="classOgre_1_1DataChunk.html#Ogre_1_1SDDataChunka8">read</a>(&amp;sm-&gt;<a class="code" href="classOgre_1_1SubMesh.html#Ogre_1_1SubMeshm3">numFaces</a>, <font class="keyword">sizeof</font>(<font class="keywordtype">unsigned</font> <font class="keywordtype">short</font>));
00577 
00578         <font class="comment">// unsigned short* faceVertexIndices ((v1, v2, v3) * numFaces)</font>
00579         sm-&gt;<a class="code" href="classOgre_1_1SubMesh.html#Ogre_1_1SubMeshm4">faceVertexIndices</a> = <font class="keyword">new</font> <font class="keywordtype">unsigned</font> <font class="keywordtype">short</font>[sm-&gt;<a class="code" href="classOgre_1_1SubMesh.html#Ogre_1_1SubMeshm3">numFaces</a> * 3];
00580         <a class="code" href="classOgre_1_1Serializer.html#Ogre_1_1SkeletonSerializerb12">readShorts</a>(chunk, sm-&gt;<a class="code" href="classOgre_1_1SubMesh.html#Ogre_1_1SubMeshm4">faceVertexIndices</a>, sm-&gt;<a class="code" href="classOgre_1_1SubMesh.html#Ogre_1_1SubMeshm3">numFaces</a> * 3);
00581 
00582         <font class="comment">// M_GEOMETRY chunk (Optional: present only if useSharedVertices = false)</font>
00583         <font class="keywordflow">if</font> (!sm-&gt;<a class="code" href="classOgre_1_1SubMesh.html#Ogre_1_1SubMeshm0">useSharedVertices</a>)
00584         {
00585             chunkID = <a class="code" href="classOgre_1_1Serializer.html#Ogre_1_1SkeletonSerializerb10">readChunk</a>(chunk);
00586             <font class="keywordflow">if</font> (chunkID != <a class="code" href="namespaceOgre.html#a436a259">M_GEOMETRY</a>)
00587             {
00588                 <a class="code" href="OgreException_8h.html#a0">Except</a>(Exception::ERR_INTERNAL_ERROR, <font class="stringliteral">"Missing geometry data in mesh file"</font>, 
00589                     <font class="stringliteral">"MeshSerializer::readSubMesh"</font>);
00590             }
00591             <a class="code" href="classOgre_1_1MeshSerializer.html#Ogre_1_1MeshSerializerc18">readGeometry</a>(chunk, &amp;sm-&gt;<a class="code" href="classOgre_1_1SubMesh.html#Ogre_1_1SubMeshm2">geometry</a>);
00592         }
00593 
00594     }
00595     <font class="comment">//---------------------------------------------------------------------</font>
<a name="l00596"></a><a class="code" href="classOgre_1_1MeshSerializer.html#Ogre_1_1MeshSerializerc18">00596</a>     <font class="keywordtype">void</font> MeshSerializer::readGeometry(<a class="code" href="classOgre_1_1DataChunk.html">DataChunk</a>&amp; chunk, <a class="code" href="structOgre_1_1GeometryData.html">GeometryData</a>* dest)
00597     {
00598         <font class="keywordtype">unsigned</font> <font class="keywordtype">short</font> texCoordSet = 0;
00599 
00600         <font class="comment">// unsigned short numVertices</font>
00601         chunk.<a class="code" href="classOgre_1_1DataChunk.html#Ogre_1_1SDDataChunka8">read</a>(&amp;dest-&gt;<a class="code" href="structOgre_1_1GeometryData.html#Ogre_1_1GeometryDatam0">numVertices</a>, <font class="keyword">sizeof</font>(<font class="keywordtype">unsigned</font> <font class="keywordtype">short</font>));
00602 
00603         <font class="comment">// Real* pVertices (x, y, z order x numVertices)</font>
00604         dest-&gt;<a class="code" href="structOgre_1_1GeometryData.html#Ogre_1_1GeometryDatam5">pVertices</a> = <font class="keyword">new</font> <a class="code" href="namespaceOgre.html#a281">Real</a>[dest-&gt;<a class="code" href="structOgre_1_1GeometryData.html#Ogre_1_1GeometryDatam0">numVertices</a> * 3];
00605         dest-&gt;<a class="code" href="structOgre_1_1GeometryData.html#Ogre_1_1GeometryDatam9">vertexStride</a> = 0;
00606         <a class="code" href="classOgre_1_1Serializer.html#Ogre_1_1SkeletonSerializerb11">readReals</a>(chunk, dest-&gt;<a class="code" href="structOgre_1_1GeometryData.html#Ogre_1_1GeometryDatam5">pVertices</a>, dest-&gt;<a class="code" href="structOgre_1_1GeometryData.html#Ogre_1_1GeometryDatam0">numVertices</a> * 3);
00607 
00608         <font class="comment">// Find optional geometry chunks</font>
00609         <font class="keywordflow">if</font> (!chunk.<a class="code" href="classOgre_1_1DataChunk.html#Ogre_1_1SDDataChunka12">isEOF</a>())
00610         {
00611             <font class="keywordtype">unsigned</font> <font class="keywordtype">short</font> chunkID = <a class="code" href="classOgre_1_1Serializer.html#Ogre_1_1SkeletonSerializerb10">readChunk</a>(chunk);
00612             <font class="keywordflow">while</font>(!chunk.<a class="code" href="classOgre_1_1DataChunk.html#Ogre_1_1SDDataChunka12">isEOF</a>() &amp;&amp; 
00613                 (chunkID == <a class="code" href="namespaceOgre.html#a436a260">M_GEOMETRY_NORMALS</a> || 
00614                  chunkID == <a class="code" href="namespaceOgre.html#a436a261">M_GEOMETRY_COLOURS</a> ||
00615                  chunkID == <a class="code" href="namespaceOgre.html#a436a262">M_GEOMETRY_TEXCOORDS</a> ))
00616             {
00617                 <font class="keywordflow">switch</font> (chunkID)
00618                 {
00619                 <font class="keywordflow">case</font> <a class="code" href="namespaceOgre.html#a436a260">M_GEOMETRY_NORMALS</a>:
00620                     <font class="comment">// Real* pNormals (x, y, z order x numVertices)</font>
00621                     dest-&gt;<a class="code" href="structOgre_1_1GeometryData.html#Ogre_1_1GeometryDatam1">hasNormals</a> = <font class="keyword">true</font>;
00622                     dest-&gt;<a class="code" href="structOgre_1_1GeometryData.html#Ogre_1_1GeometryDatam10">normalStride</a> = 0;
00623                     dest-&gt;<a class="code" href="structOgre_1_1GeometryData.html#Ogre_1_1GeometryDatam7">pNormals</a> = <font class="keyword">new</font> <a class="code" href="namespaceOgre.html#a281">Real</a>[dest-&gt;<a class="code" href="structOgre_1_1GeometryData.html#Ogre_1_1GeometryDatam0">numVertices</a> * 3];
00624                     <a class="code" href="classOgre_1_1Serializer.html#Ogre_1_1SkeletonSerializerb11">readReals</a>(chunk, dest-&gt;<a class="code" href="structOgre_1_1GeometryData.html#Ogre_1_1GeometryDatam7">pNormals</a>, dest-&gt;<a class="code" href="structOgre_1_1GeometryData.html#Ogre_1_1GeometryDatam0">numVertices</a> * 3);
00625                     <font class="keywordflow">break</font>;
00626                 <font class="keywordflow">case</font> <a class="code" href="namespaceOgre.html#a436a261">M_GEOMETRY_COLOURS</a>:
00627                     <font class="comment">// unsigned long* pColours (RGBA 8888 format x numVertices)</font>
00628                     dest-&gt;<a class="code" href="structOgre_1_1GeometryData.html#Ogre_1_1GeometryDatam4">hasColours</a> = <font class="keyword">true</font>;
00629                     dest-&gt;<a class="code" href="structOgre_1_1GeometryData.html#Ogre_1_1GeometryDatam12">colourStride</a> = 0;
00630                     dest-&gt;<a class="code" href="structOgre_1_1GeometryData.html#Ogre_1_1GeometryDatam8">pColours</a> = <font class="keyword">new</font> <font class="keywordtype">unsigned</font> <font class="keywordtype">long</font>[dest-&gt;<a class="code" href="structOgre_1_1GeometryData.html#Ogre_1_1GeometryDatam0">numVertices</a>];
00631                     <a class="code" href="classOgre_1_1Serializer.html#Ogre_1_1SkeletonSerializerb13">readLongs</a>(chunk, dest-&gt;<a class="code" href="structOgre_1_1GeometryData.html#Ogre_1_1GeometryDatam8">pColours</a>, dest-&gt;<a class="code" href="structOgre_1_1GeometryData.html#Ogre_1_1GeometryDatam0">numVertices</a>);
00632                     <font class="keywordflow">break</font>;
00633                 <font class="keywordflow">case</font> <a class="code" href="namespaceOgre.html#a436a262">M_GEOMETRY_TEXCOORDS</a>:
00634                     <font class="comment">// unsigned short dimensions    (1 for 1D, 2 for 2D, 3 for 3D)</font>
00635                     chunk.<a class="code" href="classOgre_1_1DataChunk.html#Ogre_1_1SDDataChunka8">read</a>(&amp;dest-&gt;<a class="code" href="structOgre_1_1GeometryData.html#Ogre_1_1GeometryDatam3">numTexCoordDimensions</a>[texCoordSet], <font class="keyword">sizeof</font>(<font class="keywordtype">unsigned</font> <font class="keywordtype">short</font>));
00636                     <font class="comment">// Real* pTexCoords  (u [v] [w] order, dimensions x numVertices)</font>
00637                     dest-&gt;<a class="code" href="structOgre_1_1GeometryData.html#Ogre_1_1GeometryDatam6">pTexCoords</a>[texCoordSet] = 
00638                         <font class="keyword">new</font> <a class="code" href="namespaceOgre.html#a281">Real</a>[dest-&gt;<a class="code" href="structOgre_1_1GeometryData.html#Ogre_1_1GeometryDatam0">numVertices</a> * dest-&gt;<a class="code" href="structOgre_1_1GeometryData.html#Ogre_1_1GeometryDatam3">numTexCoordDimensions</a>[texCoordSet]];
00639                     dest-&gt;<a class="code" href="structOgre_1_1GeometryData.html#Ogre_1_1GeometryDatam11">texCoordStride</a>[texCoordSet] = 0;
00640                     <a class="code" href="classOgre_1_1Serializer.html#Ogre_1_1SkeletonSerializerb11">readReals</a>(chunk, dest-&gt;<a class="code" href="structOgre_1_1GeometryData.html#Ogre_1_1GeometryDatam6">pTexCoords</a>[texCoordSet],
00641                         dest-&gt;<a class="code" href="structOgre_1_1GeometryData.html#Ogre_1_1GeometryDatam0">numVertices</a> * dest-&gt;<a class="code" href="structOgre_1_1GeometryData.html#Ogre_1_1GeometryDatam3">numTexCoordDimensions</a>[texCoordSet]);
00642                     ++texCoordSet;
00643                     <font class="keywordflow">break</font>;
00644                 }
00645                 <font class="comment">// Get next chunk</font>
00646                 <font class="keywordflow">if</font> (!chunk.<a class="code" href="classOgre_1_1DataChunk.html#Ogre_1_1SDDataChunka12">isEOF</a>())
00647                 {
00648                     chunkID = <a class="code" href="classOgre_1_1Serializer.html#Ogre_1_1SkeletonSerializerb10">readChunk</a>(chunk);
00649                 }
00650             }
00651             <font class="keywordflow">if</font> (!chunk.<a class="code" href="classOgre_1_1DataChunk.html#Ogre_1_1SDDataChunka12">isEOF</a>())
00652             {
00653                 <font class="comment">// Backpedal back to start of non-submesh chunk</font>
00654                 chunk.<a class="code" href="classOgre_1_1DataChunk.html#Ogre_1_1SDDataChunka10">skip</a>(-(<font class="keywordtype">long</font>)<a class="code" href="namespaceOgre.html#a341">CHUNK_OVERHEAD_SIZE</a>);
00655             }
00656             <font class="comment">// Store number of texture coordinate sets found</font>
00657             dest-&gt;<a class="code" href="structOgre_1_1GeometryData.html#Ogre_1_1GeometryDatam2">numTexCoords</a> = texCoordSet;
00658         }
00659     }
00660     <font class="comment">//---------------------------------------------------------------------</font>
<a name="l00661"></a><a class="code" href="classOgre_1_1MeshSerializer.html#Ogre_1_1MeshSerializerc5">00661</a>     <font class="keywordtype">void</font> MeshSerializer::writeSkeletonLink(<font class="keyword">const</font> <a class="code" href="classOgre_1_1Skeleton.html">Skeleton</a>* pSkel)
00662     {
00663         <a class="code" href="classOgre_1_1Serializer.html#Ogre_1_1SkeletonSerializerb1">writeChunkHeader</a>(<a class="code" href="namespaceOgre.html#a436a263">M_MESH_SKELETON_LINK</a>, <a class="code" href="classOgre_1_1MeshSerializer.html#Ogre_1_1MeshSerializerc12">calcSkeletonLinkSize</a>(pSkel));
00664 
00665         <a class="code" href="classOgre_1_1Serializer.html#Ogre_1_1SkeletonSerializerb8">writeString</a>(pSkel-&gt;<a class="code" href="classOgre_1_1Resource.html#Ogre_1_1Zipa26">getName</a>());
00666 
00667     }
00668     <font class="comment">//---------------------------------------------------------------------</font>
<a name="l00669"></a><a class="code" href="classOgre_1_1MeshSerializer.html#Ogre_1_1MeshSerializerc19">00669</a>     <font class="keywordtype">void</font> MeshSerializer::readSkeletonLink(<a class="code" href="classOgre_1_1DataChunk.html">DataChunk</a> &amp;chunk)
00670     {
00671         <a class="code" href="classOgre_1_1String.html">String</a> skelName = <a class="code" href="classOgre_1_1Serializer.html#Ogre_1_1SkeletonSerializerb16">readString</a>(chunk);
00672         <a class="code" href="classOgre_1_1MeshSerializer.html#Ogre_1_1MeshSerializero1">mpMesh</a>-&gt;<a class="code" href="classOgre_1_1Mesh.html#Ogre_1_1Mesha14">setSkeletonName</a>(skelName);
00673     }
00674     <font class="comment">//---------------------------------------------------------------------</font>
<a name="l00675"></a><a class="code" href="classOgre_1_1MeshSerializer.html#Ogre_1_1MeshSerializerc12">00675</a>     <font class="keywordtype">unsigned</font> <font class="keywordtype">long</font> MeshSerializer::calcSkeletonLinkSize(<font class="keyword">const</font> <a class="code" href="classOgre_1_1Skeleton.html">Skeleton</a>* pSkel)
00676     {
00677         <font class="keywordtype">unsigned</font> <font class="keywordtype">long</font> size = <a class="code" href="namespaceOgre.html#a341">CHUNK_OVERHEAD_SIZE</a>;
00678 
00679         size += (<font class="keywordtype">unsigned</font> <font class="keywordtype">long</font>)pSkel-&gt;<a class="code" href="classOgre_1_1Resource.html#Ogre_1_1Zipa26">getName</a>().length() + 1;
00680 
00681         <font class="keywordflow">return</font> size;
00682 
00683     }
00684     <font class="comment">//---------------------------------------------------------------------</font>
<a name="l00685"></a><a class="code" href="classOgre_1_1MeshSerializer.html#Ogre_1_1MeshSerializerc6">00685</a>     <font class="keywordtype">void</font> MeshSerializer::writeBoneAssignment(<font class="keyword">const</font> <a class="code" href="structOgre_1_1VertexBoneAssignment__s.html">VertexBoneAssignment</a>* assign)
00686     {
00687         <a class="code" href="classOgre_1_1Serializer.html#Ogre_1_1SkeletonSerializerb1">writeChunkHeader</a>(<a class="code" href="namespaceOgre.html#a436a264">M_MESH_BONE_ASSIGNMENT</a>, <a class="code" href="classOgre_1_1MeshSerializer.html#Ogre_1_1MeshSerializerc13">calcBoneAssignmentSize</a>());
00688 
00689         <font class="comment">// unsigned short vertexIndex;</font>
00690         <a class="code" href="classOgre_1_1Serializer.html#Ogre_1_1SkeletonSerializerb3">writeShorts</a>(&amp;(assign-&gt;<a class="code" href="structOgre_1_1VertexBoneAssignment__s.html#Ogre_1_1VertexBoneAssignment__sm0">vertexIndex</a>), 1);
00691         <font class="comment">// unsigned short boneIndex;</font>
00692         <a class="code" href="classOgre_1_1Serializer.html#Ogre_1_1SkeletonSerializerb3">writeShorts</a>(&amp;(assign-&gt;<a class="code" href="structOgre_1_1VertexBoneAssignment__s.html#Ogre_1_1VertexBoneAssignment__sm1">boneIndex</a>), 1);
00693         <font class="comment">// Real weight;</font>
00694         <a class="code" href="classOgre_1_1Serializer.html#Ogre_1_1SkeletonSerializerb2">writeReals</a>(&amp;(assign-&gt;<a class="code" href="structOgre_1_1VertexBoneAssignment__s.html#Ogre_1_1VertexBoneAssignment__sm2">weight</a>), 1);
00695     }
00696     <font class="comment">//---------------------------------------------------------------------</font>
<a name="l00697"></a><a class="code" href="classOgre_1_1MeshSerializer.html#Ogre_1_1MeshSerializerc20">00697</a>     <font class="keywordtype">void</font> MeshSerializer::readBoneAssignment(<a class="code" href="classOgre_1_1DataChunk.html">DataChunk</a>&amp; chunk)
00698     {
00699         <a class="code" href="structOgre_1_1VertexBoneAssignment__s.html">VertexBoneAssignment</a> assign;
00700 
00701         <font class="comment">// unsigned short vertexIndex;</font>
00702         <a class="code" href="classOgre_1_1Serializer.html#Ogre_1_1SkeletonSerializerb12">readShorts</a>(chunk, &amp;(assign.<a class="code" href="structOgre_1_1VertexBoneAssignment__s.html#Ogre_1_1VertexBoneAssignment__sm0">vertexIndex</a>),1);
00703         <font class="comment">// unsigned short boneIndex;</font>
00704         <a class="code" href="classOgre_1_1Serializer.html#Ogre_1_1SkeletonSerializerb12">readShorts</a>(chunk, &amp;(assign.<a class="code" href="structOgre_1_1VertexBoneAssignment__s.html#Ogre_1_1VertexBoneAssignment__sm1">boneIndex</a>),1);
00705         <font class="comment">// Real weight;</font>
00706         <a class="code" href="classOgre_1_1Serializer.html#Ogre_1_1SkeletonSerializerb11">readReals</a>(chunk, &amp;(assign.<a class="code" href="structOgre_1_1VertexBoneAssignment__s.html#Ogre_1_1VertexBoneAssignment__sm2">weight</a>), 1);
00707 
00708         <a class="code" href="classOgre_1_1MeshSerializer.html#Ogre_1_1MeshSerializero1">mpMesh</a>-&gt;<a class="code" href="classOgre_1_1Mesh.html#Ogre_1_1Mesha18">addBoneAssignment</a>(assign);
00709 
00710     }
00711     <font class="comment">//---------------------------------------------------------------------</font>
<a name="l00712"></a><a class="code" href="classOgre_1_1MeshSerializer.html#Ogre_1_1MeshSerializerc13">00712</a>     <font class="keywordtype">unsigned</font> <font class="keywordtype">long</font> MeshSerializer::calcBoneAssignmentSize(<font class="keywordtype">void</font>)
00713     {
00714         <font class="keywordtype">unsigned</font> <font class="keywordtype">long</font> size;
00715 
00716         size = <a class="code" href="namespaceOgre.html#a341">CHUNK_OVERHEAD_SIZE</a>;
00717 
00718         <font class="comment">// Vert index</font>
00719         size += <font class="keyword">sizeof</font>(<font class="keywordtype">unsigned</font> <font class="keywordtype">short</font>);
00720         <font class="comment">// Bone index</font>
00721         size += <font class="keyword">sizeof</font>(<font class="keywordtype">unsigned</font> <font class="keywordtype">short</font>);
00722         <font class="comment">// weight</font>
00723         size += <font class="keyword">sizeof</font>(Real);
00724 
00725         <font class="keywordflow">return</font> size;
00726     }
00727 
00728 
00729 
00730 }
00731 
</pre></div><p>
Copyright &copy; 2002 by The OGRE Team<br />
<script type="text/javascript">
<!--//hide script from old browsers
document.write( "Last modified "+ document.lastModified );
//end hiding contents -->
</script>
</p>
</body>
</html>
