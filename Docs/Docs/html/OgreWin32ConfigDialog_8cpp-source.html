<html>
<head>
<title>OGRE Documentation</title> <meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1"> 
<link type="text/css" rel="stylesheet" href="style.css">
</head>

<body>
<!-- Generated by Doxygen 1.2.16 -->
<center>
<a class="qindex" href="index.html">Main Page</a> &nbsp; <a class="qindex" href="namespaces.html">Namespace List</a> &nbsp; <a class="qindex" href="hierarchy.html">Class Hierarchy</a> &nbsp; <a class="qindex" href="classes.html">Alphabetical List</a> &nbsp; <a class="qindex" href="annotated.html">Compound List</a> &nbsp; <a class="qindex" href="files.html">File List</a> &nbsp; <a class="qindex" href="namespacemembers.html">Namespace Members</a> &nbsp; <a class="qindex" href="functions.html">Compound Members</a> &nbsp; <a class="qindex" href="globals.html">File Members</a> &nbsp; <a class="qindex" href="pages.html">Related Pages</a> &nbsp; </center>
<hr><h1>OgreWin32ConfigDialog.cpp</h1><a href="OgreWin32ConfigDialog_8cpp.html">Go to the documentation of this file.</a><div class="fragment"><pre>00001 <font class="comment">/*</font>
00002 <font class="comment">-----------------------------------------------------------------------------</font>
00003 <font class="comment">This source file is part of OGRE</font>
00004 <font class="comment">    (Object-oriented Graphics Rendering Engine)</font>
00005 <font class="comment">For the latest info, see http://www.stevestreeting.com/ogre/</font>
00006 <font class="comment"></font>
00007 <font class="comment">Copyright © 2000-2001 Steven J. Streeting</font>
00008 <font class="comment">Also see acknowledgements in Readme.html</font>
00009 <font class="comment"></font>
00010 <font class="comment">This program is free software; you can redistribute it and/or modify it under</font>
00011 <font class="comment">the terms of the GNU General Public License as published by the Free Software</font>
00012 <font class="comment">Foundation; either version 2 of the License, or (at your option) any later</font>
00013 <font class="comment">version.</font>
00014 <font class="comment"></font>
00015 <font class="comment">This program is distributed in the hope that it will be useful, but WITHOUT</font>
00016 <font class="comment">ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or FITNESS</font>
00017 <font class="comment">FOR A PARTICULAR PURPOSE. See the GNU General Public License for more details.</font>
00018 <font class="comment"></font>
00019 <font class="comment">You should have received a copy of the GNU General Public License along with</font>
00020 <font class="comment">this program; if not, write to the Free Software Foundation, Inc., 59 Temple</font>
00021 <font class="comment">Place - Suite 330, Boston, MA 02111-1307, USA, or go to</font>
00022 <font class="comment">http://www.gnu.org/copyleft/gpl.html.</font>
00023 <font class="comment">-----------------------------------------------------------------------------</font>
00024 <font class="comment">*/</font>
00025 <font class="preprocessor">#include "<a class="code" href="OgreRoot_8h.html">OgreRoot.h</a>"</font>
00026 <font class="preprocessor">#include "<a class="code" href="OgreWin32ConfigDialog_8h.html">OgreWin32ConfigDialog.h</a>"</font>
00027 <font class="preprocessor">#include "<a class="code" href="OgreRenderSystem_8h.html">OgreRenderSystem.h</a>"</font>
00028 <font class="preprocessor">#include "resource.h"</font>
00029 <font class="preprocessor">#include "<a class="code" href="OgreException_8h.html">OgreException.h</a>"</font>
00030 
00031 <font class="keyword">namespace </font>Ogre
00032 {
<a name="l00033"></a><a class="code" href="classOgre_1_1Win32ConfigDialog.html#Ogre_1_1Win32ConfigDialoga0">00033</a>     Win32ConfigDialog::Win32ConfigDialog(HINSTANCE hInst)
00034     {
00035         <a class="code" href="classOgre_1_1Win32ConfigDialog.html#Ogre_1_1Win32ConfigDialogn0">mHInstance</a> = hInst;
00036         <a class="code" href="classOgre_1_1ConfigDialog.html#Ogre_1_1Win32ConfigDialogn1">mSelectedRenderSystem</a> = 0;
00037     }
00038 
00039     Win32ConfigDialog* <a class="code" href="namespaceOgre.html#a346">dlg</a>;  <font class="comment">// This is a pointer to instance, since this is a static member</font>
00040 
<a name="l00041"></a><a class="code" href="classOgre_1_1Win32ConfigDialog.html#Ogre_1_1Win32ConfigDialoge0">00041</a>     BOOL Win32ConfigDialog::DlgProc(HWND hDlg, UINT iMsg, WPARAM wParam, LPARAM lParam)
00042     {
00043         HWND hwndDlgItem;
00044         <font class="keyword">static</font> <a class="code" href="namespaceOgre.html#a302">RenderSystemList</a>* lstRend;
00045         RenderSystemList::iterator pRend;
00046         <font class="keyword">static</font> <a class="code" href="namespaceOgre.html#a97">ConfigOptionMap</a> opts;
00047         <a class="code" href="classOgre_1_1String.html">String</a> err;
00048 
00049         <font class="keywordtype">int</font> i, sel, savedSel;
00050         <font class="keyword">static</font> <font class="keywordtype">bool</font> fullScreen = <font class="keyword">true</font>;
00051 
00052 
00053         <font class="keywordflow">switch</font> (iMsg)
00054         {
00055 
00056         <font class="keywordflow">case</font> WM_INITDIALOG:
00057             <font class="comment">// Load saved settings</font>
00058             Root::getSingleton().restoreConfig();
00059             <a class="code" href="namespaceOgre.html#a346">dlg</a>-&gt;<a class="code" href="classOgre_1_1ConfigDialog.html#Ogre_1_1Win32ConfigDialogn1">mSelectedRenderSystem</a> = Root::getSingleton().getRenderSystem();
00060             <font class="comment">// Get all render systems</font>
00061             lstRend = Root::getSingleton().getAvailableRenderers();
00062             pRend = lstRend-&gt;begin();            
00063             i = 0;
00064             <font class="keywordflow">while</font> (pRend != lstRend-&gt;end())
00065             {
00066                 hwndDlgItem = GetDlgItem(hDlg, IDC_CBO_RENDERSYSTEM);
00067 
00068                 SendMessage(hwndDlgItem, CB_ADDSTRING, 0,
00069                     (LPARAM)(<font class="keywordtype">char</font>*)(*pRend)-&gt;getName().c_str());
00070 
00071                 <font class="keywordflow">if</font> (*pRend == <a class="code" href="namespaceOgre.html#a346">dlg</a>-&gt;<a class="code" href="classOgre_1_1ConfigDialog.html#Ogre_1_1Win32ConfigDialogn1">mSelectedRenderSystem</a>)
00072                 {
00073                     <font class="comment">// Select</font>
00074                     SendMessage(hwndDlgItem, CB_SETCURSEL, (WPARAM)i, 0);
00075                     <font class="comment">// Refresh Options</font>
00076                     <font class="comment">// Get options from render system</font>
00077                     opts = (*pRend)-&gt;getConfigOptions();
00078                     <font class="comment">// Reset list box</font>
00079                     hwndDlgItem = GetDlgItem(hDlg, IDC_LST_OPTIONS);
00080                     <font class="comment">//SendMessage(hwndDlgItem, LB_RESETCONTENT, 0, 0);</font>
00081                     <font class="comment">// Iterate through options</font>
00082                     ConfigOptionMap::iterator pOpt = opts.begin();
00083                     <a class="code" href="classOgre_1_1String.html">String</a> strLine;
00084                     <font class="keywordflow">while</font>( pOpt!= opts.end() )
00085                     {
00086                         strLine = pOpt-&gt;second.name + <font class="stringliteral">": "</font> + pOpt-&gt;second.currentValue;
00087                         SendMessage(hwndDlgItem, LB_ADDSTRING, 0, (LPARAM)strLine.c_str());
00088                         ++pOpt;
00089                     }
00090                 }
00091 
00092                 ++pRend;
00093                 ++i;
00094             }
00095 
00096             <font class="comment">// Center myself</font>
00097             <font class="keywordtype">int</font> x, y, screenWidth, screenHeight;
00098             RECT rcDlg;
00099             GetWindowRect(hDlg, &amp;rcDlg);
00100             screenWidth = GetSystemMetrics(SM_CXFULLSCREEN);
00101             screenHeight = GetSystemMetrics(SM_CYFULLSCREEN);
00102 
00103             x = (screenWidth / 2) - ((rcDlg.right - rcDlg.left) / 2);
00104             y = (screenHeight / 2) - ((rcDlg.bottom - rcDlg.top) / 2);
00105 
00106             MoveWindow(hDlg, x, y, (rcDlg.right - rcDlg.left),
00107                 (rcDlg.bottom - rcDlg.top), TRUE);
00108 
00109             <font class="keywordflow">return</font> TRUE;
00110 
00111         <font class="keywordflow">case</font> WM_COMMAND:
00112             <font class="keywordflow">switch</font> (LOWORD(wParam))
00113             {
00114             <font class="keywordflow">case</font> IDC_CBO_RENDERSYSTEM:
00115                 hwndDlgItem = GetDlgItem(hDlg, IDC_CBO_RENDERSYSTEM);
00116                 sel = SendMessage( hwndDlgItem, CB_GETCOUNT, 0, 0 );
00117 
00118                 <font class="keywordflow">if</font> (HIWORD(wParam) == CBN_SELCHANGE )
00119                 {
00120                     <font class="comment">// RenderSystem selected</font>
00121                     <font class="comment">// Get selected index</font>
00122                     hwndDlgItem = GetDlgItem(hDlg, IDC_CBO_RENDERSYSTEM);
00123                     sel = SendMessage(hwndDlgItem, CB_GETCURSEL,0,0);
00124                     <font class="keywordflow">if</font> (sel != -1)
00125                     {
00126                         <font class="comment">// Get RenderSystem selected</font>
00127                         pRend = lstRend-&gt;begin();
00128                         <a class="code" href="namespaceOgre.html#a346">dlg</a>-&gt;<a class="code" href="classOgre_1_1ConfigDialog.html#Ogre_1_1Win32ConfigDialogn1">mSelectedRenderSystem</a> = pRend[sel];
00129                         <font class="comment">// refresh options</font>
00130                         <font class="comment">// Get options from render system</font>
00131                         opts = pRend[sel]-&gt;<a class="code" href="classOgre_1_1RenderSystem.html#Ogre_1_1RenderSystema3">getConfigOptions</a>();
00132                         <font class="comment">// Reset list box</font>
00133                         hwndDlgItem = GetDlgItem(hDlg, IDC_LST_OPTIONS);
00134                         SendMessage(hwndDlgItem, LB_RESETCONTENT, 0, 0);
00135                         <font class="comment">// Iterate through options</font>
00136                         ConfigOptionMap::iterator pOpt = opts.begin();
00137                         <a class="code" href="classOgre_1_1String.html">String</a> strLine;
00138                         <font class="keywordflow">while</font> (pOpt!=opts.end())
00139                         {
00140                             strLine = pOpt-&gt;second.name + <font class="stringliteral">": "</font> + pOpt-&gt;second.currentValue;
00141                             SendMessage(hwndDlgItem, LB_ADDSTRING, 0, (LPARAM)strLine.c_str());
00142                             ++pOpt;
00143                         }
00144                     }                    
00145                 }
00146 
00147                 <font class="keywordflow">return</font> TRUE;
00148 
00149             <font class="keywordflow">case</font> IDC_LST_OPTIONS:
00150                 <font class="keywordflow">if</font> (HIWORD(wParam) == LBN_SELCHANGE)
00151                 {
00152                     <font class="comment">// Selection in list box of options changed</font>
00153                     <font class="comment">// Update combo and label in edit section</font>
00154                     hwndDlgItem = GetDlgItem(hDlg, IDC_LST_OPTIONS);
00155                     sel = SendMessage(hwndDlgItem, LB_GETCURSEL, 0, 0);
00156                     <font class="keywordflow">if</font> (sel != -1)
00157                     {
00158                         ConfigOptionMap::iterator pOpt = opts.begin();
00159                         <font class="keywordflow">for</font> (i = 0; i &lt; sel; i++)
00160                             ++pOpt;
00161                         <font class="comment">// Set label text</font>
00162                         hwndDlgItem = GetDlgItem(hDlg, IDC_LBL_OPTION);
00163                         SetWindowText(hwndDlgItem, pOpt-&gt;second.name.c_str());
00164                         <font class="comment">// Set combo options</font>
00165                         hwndDlgItem = GetDlgItem(hDlg, IDC_CBO_OPTION);
00166                         SendMessage(hwndDlgItem, CB_RESETCONTENT, 0, 0);
00167                         StringVector::iterator pPoss = pOpt-&gt;second.possibleValues.begin();
00168                         i = 0;
00169                         <font class="keywordflow">while</font> (pPoss!=pOpt-&gt;second.possibleValues.end())
00170                         {
00171                             SendMessage(hwndDlgItem, CB_ADDSTRING, 0, (LPARAM)pPoss[0].c_str());
00172                             <font class="keywordflow">if</font> (pPoss[0] == pOpt-&gt;second.currentValue)
00173                                 <font class="comment">// Select current value</font>
00174                                 SendMessage(hwndDlgItem, CB_SETCURSEL, (WPARAM)i, 0);
00175                             ++pPoss;
00176                             ++i;
00177                         }
00178                         <font class="comment">// Enable/disable combo depending on (not)immutable</font>
00179                         EnableWindow(hwndDlgItem, !(pOpt-&gt;second.immutable));
00180                     }
00181                 }
00182 
00183                 <font class="keywordflow">return</font> TRUE;
00184 
00185             <font class="keywordflow">case</font> IDC_CBO_OPTION:
00186                 <font class="keywordflow">if</font> (HIWORD(wParam) == CBN_SELCHANGE)
00187                 {
00188                     <font class="comment">// Updated an option</font>
00189                     <font class="comment">// Get option</font>
00190                     hwndDlgItem = GetDlgItem(hDlg, IDC_LST_OPTIONS);
00191                     sel = SendMessage(hwndDlgItem, LB_GETCURSEL, 0, 0);
00192                     savedSel = sel;
00193                     ConfigOptionMap::iterator pOpt = opts.begin();
00194                     <font class="keywordflow">for</font> (i = 0; i &lt; sel; i++)
00195                         ++pOpt;
00196                     <font class="comment">// Get selected value</font>
00197                     hwndDlgItem = GetDlgItem(hDlg, IDC_CBO_OPTION);
00198                     sel = SendMessage(hwndDlgItem, CB_GETCURSEL, 0, 0);
00199 
00200                     <font class="keywordflow">if</font> (sel != -1)
00201                     {
00202                         StringVector::iterator pPoss = pOpt-&gt;second.possibleValues.begin();
00203 
00204                         <font class="comment">// Set option</font>
00205                         <a class="code" href="namespaceOgre.html#a346">dlg</a>-&gt;<a class="code" href="classOgre_1_1ConfigDialog.html#Ogre_1_1Win32ConfigDialogn1">mSelectedRenderSystem</a>-&gt;<a class="code" href="classOgre_1_1RenderSystem.html#Ogre_1_1RenderSystema4">setConfigOption</a>(
00206                             pOpt-&gt;second.name, pPoss[sel]);
00207                         <font class="comment">// Re-retrieve options</font>
00208                         opts = <a class="code" href="namespaceOgre.html#a346">dlg</a>-&gt;<a class="code" href="classOgre_1_1ConfigDialog.html#Ogre_1_1Win32ConfigDialogn1">mSelectedRenderSystem</a>-&gt;<a class="code" href="classOgre_1_1RenderSystem.html#Ogre_1_1RenderSystema3">getConfigOptions</a>();
00209 
00210                         <font class="comment">// Reset options list box</font>
00211                         hwndDlgItem = GetDlgItem(hDlg, IDC_LST_OPTIONS);
00212                         SendMessage(hwndDlgItem, LB_RESETCONTENT, 0, 0);
00213                         <font class="comment">// Iterate through options</font>
00214                         pOpt = opts.begin();
00215                         <a class="code" href="classOgre_1_1String.html">String</a> strLine;
00216                         <font class="keywordflow">while</font> (pOpt!=opts.end())
00217                         {
00218                             strLine = pOpt-&gt;second.name + <font class="stringliteral">": "</font> + pOpt-&gt;second.currentValue;
00219                             SendMessage(hwndDlgItem, LB_ADDSTRING, 0, (LPARAM)strLine.c_str());
00220                             ++pOpt;
00221                         }
00222                         <font class="comment">// Select previously selected item</font>
00223                         SendMessage(hwndDlgItem, LB_SETCURSEL, savedSel, 0);
00224                     }
00225 
00226                 }
00227                 <font class="keywordflow">return</font> TRUE;
00228 
00229             <font class="keywordflow">case</font> IDOK:
00230                 <font class="comment">// Set render system</font>
00231                 <font class="keywordflow">if</font> (!<a class="code" href="namespaceOgre.html#a346">dlg</a>-&gt;<a class="code" href="classOgre_1_1ConfigDialog.html#Ogre_1_1Win32ConfigDialogn1">mSelectedRenderSystem</a>)
00232                 {
00233                     MessageBox(NULL, <font class="stringliteral">"Please choose a rendering system."</font>, <font class="stringliteral">"OGRE"</font>, MB_OK | MB_ICONEXCLAMATION);
00234                     <font class="keywordflow">return</font> TRUE;
00235                 }
00236                 err = <a class="code" href="namespaceOgre.html#a346">dlg</a>-&gt;<a class="code" href="classOgre_1_1ConfigDialog.html#Ogre_1_1Win32ConfigDialogn1">mSelectedRenderSystem</a>-&gt;<a class="code" href="classOgre_1_1RenderSystem.html#Ogre_1_1RenderSystema5">validateConfigOptions</a>();
00237                 <font class="keywordflow">if</font> (err.length() &gt; 0)
00238                 {
00239                     MessageBox(NULL, err.c_str(), <font class="stringliteral">"OGRE"</font>, MB_OK | MB_ICONEXCLAMATION);
00240                     <font class="keywordflow">return</font> TRUE;
00241                 }
00242 
00243                 Root::getSingleton().setRenderSystem(<a class="code" href="namespaceOgre.html#a346">dlg</a>-&gt;<a class="code" href="classOgre_1_1ConfigDialog.html#Ogre_1_1Win32ConfigDialogn1">mSelectedRenderSystem</a>);
00244                 Root::getSingleton().saveConfig();
00245 
00246                 EndDialog(hDlg, TRUE);
00247                 <font class="keywordflow">return</font> TRUE;
00248 
00249             <font class="keywordflow">case</font> IDCANCEL:
00250                 EndDialog(hDlg, FALSE);
00251                 <font class="keywordflow">return</font> TRUE;
00252             }
00253         }
00254 
00255         <font class="keywordflow">return</font> FALSE;
00256     }
00257 
00258 
<a name="l00259"></a><a class="code" href="classOgre_1_1Win32ConfigDialog.html#Ogre_1_1Win32ConfigDialoga1">00259</a>     <font class="keywordtype">bool</font> Win32ConfigDialog::display(<font class="keywordtype">void</font>)
00260     {
00261         <font class="comment">// Display dialog</font>
00262         <font class="comment">// Don't return to caller until dialog dismissed</font>
00263         <font class="keywordtype">int</font> i;
00264         <a class="code" href="namespaceOgre.html#a346">dlg</a> = <font class="keyword">this</font>;
00265         i = DialogBox(<a class="code" href="classOgre_1_1Win32ConfigDialog.html#Ogre_1_1Win32ConfigDialogn0">mHInstance</a>, MAKEINTRESOURCE(IDD_DLG_CONFIG), NULL, <a class="code" href="classOgre_1_1Win32ConfigDialog.html#Ogre_1_1Win32ConfigDialoge0">DlgProc</a>);
00266 
00267         <font class="keywordflow">if</font> (i == -1)
00268         {
00269             <font class="keywordtype">int</font> winError = GetLastError();
00270             <font class="keywordtype">char</font>* errDesc;
00271             <font class="keywordtype">int</font> i;
00272 
00273             errDesc = <font class="keyword">new</font> <font class="keywordtype">char</font>[255];
00274             <font class="comment">// Try windows errors first</font>
00275             i = FormatMessage(
00276                 FORMAT_MESSAGE_FROM_SYSTEM |
00277                 FORMAT_MESSAGE_IGNORE_INSERTS,
00278                 NULL,
00279                 winError,
00280                 MAKELANGID(LANG_NEUTRAL, SUBLANG_DEFAULT), <font class="comment">// Default language</font>
00281                 (LPTSTR) errDesc,
00282                 255,
00283                 NULL
00284             );
00285 
00286             <font class="keywordflow">throw</font> <a class="code" href="classOgre_1_1Exception.html">Exception</a>(winError,errDesc, <font class="stringliteral">"Win32ConfigDialog::display"</font>);
00287         }
00288         <font class="keywordflow">if</font> (i)
00289             <font class="keywordflow">return</font> <font class="keyword">true</font>;
00290         <font class="keywordflow">else</font>
00291             <font class="keywordflow">return</font> <font class="keyword">false</font>;
00292 
00293     }
00294 }
</pre></div><p>
Copyright &copy; 2002 by The OGRE Team<br />
<script type="text/javascript">
<!--//hide script from old browsers
document.write( "Last modified "+ document.lastModified );
//end hiding contents -->
</script>
</p>
</body>
</html>
