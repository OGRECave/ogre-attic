<html>
<head>
<title>OGRE Documentation</title> <meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1"> 
<link type="text/css" rel="stylesheet" href="style.css">
</head>

<body>
<!-- Generated by Doxygen 1.2.16 -->
<center>
<a class="qindex" href="index.html">Main Page</a> &nbsp; <a class="qindex" href="namespaces.html">Namespace List</a> &nbsp; <a class="qindex" href="hierarchy.html">Class Hierarchy</a> &nbsp; <a class="qindex" href="classes.html">Alphabetical List</a> &nbsp; <a class="qindex" href="annotated.html">Compound List</a> &nbsp; <a class="qindex" href="files.html">File List</a> &nbsp; <a class="qindex" href="namespacemembers.html">Namespace Members</a> &nbsp; <a class="qindex" href="functions.html">Compound Members</a> &nbsp; <a class="qindex" href="globals.html">File Members</a> &nbsp; <a class="qindex" href="pages.html">Related Pages</a> &nbsp; </center>
<hr><h1>OgreParticleSystem.cpp</h1><a href="OgreParticleSystem_8cpp.html">Go to the documentation of this file.</a><div class="fragment"><pre>00001 <font class="comment">/*</font>
00002 <font class="comment">-----------------------------------------------------------------------------</font>
00003 <font class="comment">This source file is part of OGRE</font>
00004 <font class="comment">    (Object-oriented Graphics Rendering Engine)</font>
00005 <font class="comment">For the latest info, see http://www.stevestreeting.com/ogre/</font>
00006 <font class="comment"></font>
00007 <font class="comment">Copyright © 2000-2002 Steven J. Streeting</font>
00008 <font class="comment">Also see acknowledgements in Readme.html</font>
00009 <font class="comment"></font>
00010 <font class="comment">This program is free software; you can redistribute it and/or modify it under</font>
00011 <font class="comment">the terms of the GNU General Public License as published by the Free Software</font>
00012 <font class="comment">Foundation; either version 2 of the License, or (at your option) any later</font>
00013 <font class="comment">version.</font>
00014 <font class="comment"></font>
00015 <font class="comment">This program is distributed in the hope that it will be useful, but WITHOUT</font>
00016 <font class="comment">ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or FITNESS</font>
00017 <font class="comment">FOR A PARTICULAR PURPOSE. See the GNU General Public License for more details.</font>
00018 <font class="comment"></font>
00019 <font class="comment">You should have received a copy of the GNU General Public License along with</font>
00020 <font class="comment">this program; if not, write to the Free Software Foundation, Inc., 59 Temple</font>
00021 <font class="comment">Place - Suite 330, Boston, MA 02111-1307, USA, or go to</font>
00022 <font class="comment">http://www.gnu.org/copyleft/gpl.html.</font>
00023 <font class="comment">-----------------------------------------------------------------------------</font>
00024 <font class="comment">*/</font>
00025 
00026 <font class="preprocessor">#include "<a class="code" href="OgreParticleSystem_8h.html">OgreParticleSystem.h</a>"</font>
00027 <font class="preprocessor">#include "<a class="code" href="OgreParticleSystemManager_8h.html">OgreParticleSystemManager.h</a>"</font>
00028 <font class="preprocessor">#include "<a class="code" href="OgreRenderQueue_8h.html">OgreRenderQueue.h</a>"</font>
00029 <font class="preprocessor">#include "<a class="code" href="OgreBillboardSet_8h.html">OgreBillboardSet.h</a>"</font>
00030 <font class="preprocessor">#include "<a class="code" href="OgreParticleEmitter_8h.html">OgreParticleEmitter.h</a>"</font>
00031 <font class="preprocessor">#include "<a class="code" href="OgreParticleAffector_8h.html">OgreParticleAffector.h</a>"</font>
00032 <font class="preprocessor">#include "<a class="code" href="OgreParticle_8h.html">OgreParticle.h</a>"</font>
00033 <font class="preprocessor">#include "<a class="code" href="OgreSceneNode_8h.html">OgreSceneNode.h</a>"</font>
00034 <font class="preprocessor">#include "<a class="code" href="OgreCamera_8h.html">OgreCamera.h</a>"</font>
00035 <font class="preprocessor">#include "<a class="code" href="OgreStringConverter_8h.html">OgreStringConverter.h</a>"</font>
00036 <font class="preprocessor">#include "<a class="code" href="OgreLogManager_8h.html">OgreLogManager.h</a>"</font>
00037 
00038 
00039 
00040 
00041 <font class="keyword">namespace </font>Ogre {
00042     <font class="comment">// Init statics</font>
<a name="l00043"></a><a class="code" href="classOgre_1_1ParticleSystem.html#Ogre_1_1ParticleSystemq0">00043</a>     <a class="code" href="classOgre_1_1ParticleSystem_1_1CmdCull.html">ParticleSystem::CmdCull</a> ParticleSystem::msCullCmd;
<a name="l00044"></a><a class="code" href="classOgre_1_1ParticleSystem.html#Ogre_1_1ParticleSystemq1">00044</a>     <a class="code" href="classOgre_1_1ParticleSystem_1_1CmdHeight.html">ParticleSystem::CmdHeight</a> ParticleSystem::msHeightCmd;
<a name="l00045"></a><a class="code" href="classOgre_1_1ParticleSystem.html#Ogre_1_1ParticleSystemq2">00045</a>     <a class="code" href="classOgre_1_1ParticleSystem_1_1CmdMaterial.html">ParticleSystem::CmdMaterial</a> ParticleSystem::msMaterialCmd;
<a name="l00046"></a><a class="code" href="classOgre_1_1ParticleSystem.html#Ogre_1_1ParticleSystemq3">00046</a>     <a class="code" href="classOgre_1_1ParticleSystem_1_1CmdQuota.html">ParticleSystem::CmdQuota</a> ParticleSystem::msQuotaCmd;
<a name="l00047"></a><a class="code" href="classOgre_1_1ParticleSystem.html#Ogre_1_1ParticleSystemq4">00047</a>     <a class="code" href="classOgre_1_1ParticleSystem_1_1CmdWidth.html">ParticleSystem::CmdWidth</a> ParticleSystem::msWidthCmd;
<a name="l00048"></a><a class="code" href="classOgre_1_1ParticleSystem.html#Ogre_1_1ParticleSystemq5">00048</a>     <a class="code" href="classOgre_1_1ParticleSystem_1_1CmdBillboardType.html">ParticleSystem::CmdBillboardType</a> ParticleSystem::msBillboardTypeCmd;
<a name="l00049"></a><a class="code" href="classOgre_1_1ParticleSystem.html#Ogre_1_1ParticleSystemq6">00049</a>     <a class="code" href="classOgre_1_1ParticleSystem_1_1CmdCommonDirection.html">ParticleSystem::CmdCommonDirection</a> ParticleSystem::msCommonDirectionCmd;
00050 
00051     <font class="comment">//-----------------------------------------------------------------------</font>
<a name="l00052"></a><a class="code" href="classOgre_1_1ParticleSystem.html#Ogre_1_1ParticleSystema0">00052</a>     ParticleSystem::ParticleSystem()
00053     {
00054         <a class="code" href="classOgre_1_1ParticleSystem.html#Ogre_1_1ParticleSystemb7">initParameters</a>();
00055     }
00056     <font class="comment">//-----------------------------------------------------------------------</font>
<a name="l00057"></a><a class="code" href="classOgre_1_1ParticleSystem.html#Ogre_1_1ParticleSystema1">00057</a>     ParticleSystem::ParticleSystem(<font class="keyword">const</font> <a class="code" href="classOgre_1_1String.html">String</a>&amp; name)
00058     {
00059         <font class="comment">// DO NOT use superclass constructor</font>
00060         <font class="comment">// This will call setPoolSize in the BillboardSet context and create Billboard objects</font>
00061         <font class="comment">//  instead of Particle objects</font>
00062         <font class="comment">// Unavoidable due to C++ funky virtualisation rules &amp; constructors</font>
00063         <a class="code" href="classOgre_1_1BillboardSet.html#Ogre_1_1ParticleSystemn14">mpPositions</a> = 0;
00064         <a class="code" href="classOgre_1_1BillboardSet.html#Ogre_1_1ParticleSystemn15">mpColours</a> = 0;
00065         <a class="code" href="classOgre_1_1BillboardSet.html#Ogre_1_1ParticleSystemn17">mpIndexes</a> = 0;
00066         <a class="code" href="classOgre_1_1BillboardSet.html#Ogre_1_1ParticleSystemn16">mpTexCoords</a> = 0;
00067         <a class="code" href="classOgre_1_1BillboardSet.html#Ogre_1_1ParticleSystemn10">mAutoExtendPool</a> = <font class="keyword">true</font>;
00068         <a class="code" href="classOgre_1_1BillboardSet.html#Ogre_1_1ParticleSystemn9">mAllDefaultSize</a> = <font class="keyword">true</font>;
00069         <a class="code" href="classOgre_1_1BillboardSet.html#Ogre_1_1ParticleSystemn4">mOriginType</a> = <a class="code" href="namespaceOgre.html#a415a5">BBO_CENTER</a>;
00070         <a class="code" href="classOgre_1_1ParticleSystem.html#Ogre_1_1ParticleSystemn0">mName</a> = name;
00071         <a class="code" href="classOgre_1_1BillboardSet.html#Ogre_1_1ParticleSystemn18">mCullIndividual</a> = <font class="keyword">true</font>;
00072         <a class="code" href="classOgre_1_1BillboardSet.html#Ogre_1_1ParticleSystema36">setDefaultDimensions</a>( 100, 100 );
00073         <a class="code" href="classOgre_1_1BillboardSet.html#Ogre_1_1ParticleSystema41">setMaterialName</a>( <font class="stringliteral">"BaseWhite"</font> );
00074         <font class="comment">// Default to 10 particles, expect app to specify (will only be increased, not decreased)</font>
00075         <a class="code" href="classOgre_1_1BillboardSet.html#Ogre_1_1ParticleSystema28">setPoolSize</a>( 10 );
00076 
00077         <a class="code" href="classOgre_1_1ParticleSystem.html#Ogre_1_1ParticleSystemb7">initParameters</a>();
00078 
00079     }
00080     <font class="comment">//-----------------------------------------------------------------------</font>
<a name="l00081"></a><a class="code" href="classOgre_1_1ParticleSystem.html#Ogre_1_1ParticleSystema2">00081</a>     ParticleSystem::~ParticleSystem()
00082     {
00083         <font class="comment">// Arrange for the deletion of emitters &amp; affectors</font>
00084         <a class="code" href="classOgre_1_1ParticleSystem.html#Ogre_1_1ParticleSystema8">removeAllEmitters</a>();
00085         <a class="code" href="classOgre_1_1ParticleSystem.html#Ogre_1_1ParticleSystema13">removeAllAffectors</a>();
00086     }
00087     <font class="comment">//-----------------------------------------------------------------------</font>
<a name="l00088"></a><a class="code" href="classOgre_1_1ParticleSystem.html#Ogre_1_1ParticleSystema3">00088</a>     <a class="code" href="classOgre_1_1String.html">String</a> ParticleSystem::getName(<font class="keywordtype">void</font>)
00089     {
00090         <font class="keywordflow">return</font> <a class="code" href="classOgre_1_1ParticleSystem.html#Ogre_1_1ParticleSystemn0">mName</a>;
00091     }
00092     <font class="comment">//-----------------------------------------------------------------------</font>
<a name="l00093"></a><a class="code" href="classOgre_1_1ParticleSystem.html#Ogre_1_1ParticleSystema4">00093</a>     <a class="code" href="classOgre_1_1ParticleEmitter.html">ParticleEmitter</a>* ParticleSystem::addEmitter(<font class="keyword">const</font> <a class="code" href="classOgre_1_1String.html">String</a>&amp; emitterType)
00094     {
00095         <a class="code" href="classOgre_1_1ParticleEmitter.html">ParticleEmitter</a>* em = ParticleSystemManager::getSingleton()._createEmitter(emitterType);
00096         <a class="code" href="classOgre_1_1ParticleSystem.html#Ogre_1_1ParticleSystemn1">mEmitters</a>.push_back(em);
00097         <font class="keywordflow">return</font> em;
00098     }
00099     <font class="comment">//-----------------------------------------------------------------------</font>
<a name="l00100"></a><a class="code" href="classOgre_1_1ParticleSystem.html#Ogre_1_1ParticleSystema5">00100</a>     <a class="code" href="classOgre_1_1ParticleEmitter.html">ParticleEmitter</a>* ParticleSystem::getEmitter(<font class="keywordtype">unsigned</font> <font class="keywordtype">short</font> index)<font class="keyword"> const</font>
00101 <font class="keyword">    </font>{
00102         assert(index &lt; <a class="code" href="classOgre_1_1ParticleSystem.html#Ogre_1_1ParticleSystemn1">mEmitters</a>.size() &amp;&amp; <font class="stringliteral">"Emitter index out of bounds!"</font>);
00103         <font class="keywordflow">return</font> <a class="code" href="classOgre_1_1ParticleSystem.html#Ogre_1_1ParticleSystemn1">mEmitters</a>[index];
00104     }
00105     <font class="comment">//-----------------------------------------------------------------------</font>
<a name="l00106"></a><a class="code" href="classOgre_1_1ParticleSystem.html#Ogre_1_1ParticleSystema6">00106</a>     <font class="keywordtype">unsigned</font> <font class="keywordtype">short</font> ParticleSystem::getNumEmitters(<font class="keywordtype">void</font>)<font class="keyword"> const</font>
00107 <font class="keyword">    </font>{
00108         <font class="keywordflow">return</font> static_cast&lt; unsigned short &gt;( <a class="code" href="classOgre_1_1ParticleSystem.html#Ogre_1_1ParticleSystemn1">mEmitters</a>.size() );
00109     }
00110     <font class="comment">//-----------------------------------------------------------------------</font>
<a name="l00111"></a><a class="code" href="classOgre_1_1ParticleSystem.html#Ogre_1_1ParticleSystema7">00111</a>     <font class="keywordtype">void</font> ParticleSystem::removeEmitter(<font class="keywordtype">unsigned</font> <font class="keywordtype">short</font> index)
00112     {
00113         assert(index &lt; <a class="code" href="classOgre_1_1ParticleSystem.html#Ogre_1_1ParticleSystemn1">mEmitters</a>.size() &amp;&amp; <font class="stringliteral">"Emitter index out of bounds!"</font>);
00114         ParticleEmitterList::iterator ei = <a class="code" href="classOgre_1_1ParticleSystem.html#Ogre_1_1ParticleSystemn1">mEmitters</a>.begin() + index;
00115         ParticleSystemManager::getSingleton()._destroyEmitter(*ei);
00116         <a class="code" href="classOgre_1_1ParticleSystem.html#Ogre_1_1ParticleSystemn1">mEmitters</a>.erase(ei);
00117     }
00118     <font class="comment">//-----------------------------------------------------------------------</font>
<a name="l00119"></a><a class="code" href="classOgre_1_1ParticleSystem.html#Ogre_1_1ParticleSystema8">00119</a>     <font class="keywordtype">void</font> ParticleSystem::removeAllEmitters(<font class="keywordtype">void</font>)
00120     {
00121         <font class="comment">// DON'T delete directly, we don't know what heap these have been created on</font>
00122         ParticleEmitterList::iterator ei;
00123         <font class="keywordflow">for</font> (ei = <a class="code" href="classOgre_1_1ParticleSystem.html#Ogre_1_1ParticleSystemn1">mEmitters</a>.begin(); ei != <a class="code" href="classOgre_1_1ParticleSystem.html#Ogre_1_1ParticleSystemn1">mEmitters</a>.end(); ++ei)
00124         {
00125             ParticleSystemManager::getSingleton()._destroyEmitter(*ei);
00126         }
00127         <a class="code" href="classOgre_1_1ParticleSystem.html#Ogre_1_1ParticleSystemn1">mEmitters</a>.clear();
00128     }
00129     <font class="comment">//-----------------------------------------------------------------------</font>
<a name="l00130"></a><a class="code" href="classOgre_1_1ParticleSystem.html#Ogre_1_1ParticleSystema9">00130</a>     <a class="code" href="classOgre_1_1ParticleAffector.html">ParticleAffector</a>* ParticleSystem::addAffector(<font class="keyword">const</font> <a class="code" href="classOgre_1_1String.html">String</a>&amp; affectorType)
00131     {
00132         <a class="code" href="classOgre_1_1ParticleAffector.html">ParticleAffector</a>* af = ParticleSystemManager::getSingleton()._createAffector(affectorType);
00133         <a class="code" href="classOgre_1_1ParticleSystem.html#Ogre_1_1ParticleSystemn2">mAffectors</a>.push_back(af);
00134         <font class="keywordflow">return</font> af;
00135     }
00136     <font class="comment">//-----------------------------------------------------------------------</font>
<a name="l00137"></a><a class="code" href="classOgre_1_1ParticleSystem.html#Ogre_1_1ParticleSystema10">00137</a>     <a class="code" href="classOgre_1_1ParticleAffector.html">ParticleAffector</a>* ParticleSystem::getAffector(<font class="keywordtype">unsigned</font> <font class="keywordtype">short</font> index)<font class="keyword"> const</font>
00138 <font class="keyword">    </font>{
00139         assert(index &lt; <a class="code" href="classOgre_1_1ParticleSystem.html#Ogre_1_1ParticleSystemn2">mAffectors</a>.size() &amp;&amp; <font class="stringliteral">"Affector index out of bounds!"</font>);
00140         <font class="keywordflow">return</font> <a class="code" href="classOgre_1_1ParticleSystem.html#Ogre_1_1ParticleSystemn2">mAffectors</a>[index];
00141     }
00142     <font class="comment">//-----------------------------------------------------------------------</font>
<a name="l00143"></a><a class="code" href="classOgre_1_1ParticleSystem.html#Ogre_1_1ParticleSystema11">00143</a>     <font class="keywordtype">unsigned</font> <font class="keywordtype">short</font> ParticleSystem::getNumAffectors(<font class="keywordtype">void</font>)<font class="keyword"> const</font>
00144 <font class="keyword">    </font>{
00145         <font class="keywordflow">return</font> static_cast&lt; unsigned short &gt;( <a class="code" href="classOgre_1_1ParticleSystem.html#Ogre_1_1ParticleSystemn2">mAffectors</a>.size() );
00146     }
00147     <font class="comment">//-----------------------------------------------------------------------</font>
<a name="l00148"></a><a class="code" href="classOgre_1_1ParticleSystem.html#Ogre_1_1ParticleSystema12">00148</a>     <font class="keywordtype">void</font> ParticleSystem::removeAffector(<font class="keywordtype">unsigned</font> <font class="keywordtype">short</font> index)
00149     {
00150         assert(index &lt; <a class="code" href="classOgre_1_1ParticleSystem.html#Ogre_1_1ParticleSystemn2">mAffectors</a>.size() &amp;&amp; <font class="stringliteral">"Affector index out of bounds!"</font>);
00151         ParticleAffectorList::iterator ai = <a class="code" href="classOgre_1_1ParticleSystem.html#Ogre_1_1ParticleSystemn2">mAffectors</a>.begin() + index;
00152         ParticleSystemManager::getSingleton()._destroyAffector(*ai);
00153         <a class="code" href="classOgre_1_1ParticleSystem.html#Ogre_1_1ParticleSystemn2">mAffectors</a>.erase(ai);
00154     }
00155     <font class="comment">//-----------------------------------------------------------------------</font>
<a name="l00156"></a><a class="code" href="classOgre_1_1ParticleSystem.html#Ogre_1_1ParticleSystema13">00156</a>     <font class="keywordtype">void</font> ParticleSystem::removeAllAffectors(<font class="keywordtype">void</font>)
00157     {
00158         <font class="comment">// DON'T delete directly, we don't know what heap these have been created on</font>
00159         ParticleAffectorList::iterator ai;
00160         <font class="keywordflow">for</font> (ai = <a class="code" href="classOgre_1_1ParticleSystem.html#Ogre_1_1ParticleSystemn2">mAffectors</a>.begin(); ai != <a class="code" href="classOgre_1_1ParticleSystem.html#Ogre_1_1ParticleSystemn2">mAffectors</a>.end(); ++ai)
00161         {
00162             ParticleSystemManager::getSingleton()._destroyAffector(*ai);
00163         }
00164         <a class="code" href="classOgre_1_1ParticleSystem.html#Ogre_1_1ParticleSystemn2">mAffectors</a>.clear();
00165     }
00166     <font class="comment">//-----------------------------------------------------------------------</font>
<a name="l00167"></a><a class="code" href="classOgre_1_1ParticleSystem.html#Ogre_1_1ParticleSystema17">00167</a>     <a class="code" href="classOgre_1_1ParticleSystem.html">ParticleSystem</a>&amp; ParticleSystem::operator=(<font class="keyword">const</font> <a class="code" href="classOgre_1_1ParticleSystem.html">ParticleSystem</a>&amp; rhs)
00168     {
00169         <font class="comment">// Blank this system's emitters &amp; affectors</font>
00170         <a class="code" href="classOgre_1_1ParticleSystem.html#Ogre_1_1ParticleSystema8">removeAllEmitters</a>();
00171         <a class="code" href="classOgre_1_1ParticleSystem.html#Ogre_1_1ParticleSystema13">removeAllAffectors</a>();
00172 
00173         <font class="comment">// Copy emitters</font>
00174         <font class="keywordtype">unsigned</font> <font class="keywordtype">int</font> i;
00175         <font class="keywordflow">for</font>(i = 0; i &lt; rhs.<a class="code" href="classOgre_1_1ParticleSystem.html#Ogre_1_1ParticleSystema6">getNumEmitters</a>(); ++i)
00176         {
00177             <a class="code" href="classOgre_1_1ParticleEmitter.html">ParticleEmitter</a>* rhsEm = rhs.<a class="code" href="classOgre_1_1ParticleSystem.html#Ogre_1_1ParticleSystema5">getEmitter</a>(i);
00178             <a class="code" href="classOgre_1_1ParticleEmitter.html">ParticleEmitter</a>* newEm = <a class="code" href="classOgre_1_1ParticleSystem.html#Ogre_1_1ParticleSystema4">addEmitter</a>(rhsEm-&gt;<a class="code" href="classOgre_1_1ParticleEmitter.html#Ogre_1_1RingEmittera45">getType</a>());
00179             rhsEm-&gt;<a class="code" href="classOgre_1_1StringInterface.html#Ogre_1_1StringInterfacea5">copyParametersTo</a>(newEm);
00180         }
00181         <font class="comment">// Copy affectors</font>
00182         <font class="keywordflow">for</font>(i = 0; i &lt; rhs.<a class="code" href="classOgre_1_1ParticleSystem.html#Ogre_1_1ParticleSystema11">getNumAffectors</a>(); ++i)
00183         {
00184             <a class="code" href="classOgre_1_1ParticleAffector.html">ParticleAffector</a>* rhsAf = rhs.<a class="code" href="classOgre_1_1ParticleSystem.html#Ogre_1_1ParticleSystema10">getAffector</a>(i);
00185             <a class="code" href="classOgre_1_1ParticleAffector.html">ParticleAffector</a>* newAf = <a class="code" href="classOgre_1_1ParticleSystem.html#Ogre_1_1ParticleSystema9">addAffector</a>(rhsAf-&gt;<a class="code" href="classOgre_1_1ParticleAffector.html#Ogre_1_1ParticleAffectora2">getType</a>());
00186             rhsAf-&gt;<a class="code" href="classOgre_1_1StringInterface.html#Ogre_1_1StringInterfacea5">copyParametersTo</a>(newAf);
00187         }
00188         <a class="code" href="classOgre_1_1BillboardSet.html#Ogre_1_1ParticleSystema28">setPoolSize</a>(rhs.<a class="code" href="classOgre_1_1BillboardSet.html#Ogre_1_1ParticleSystema29">getPoolSize</a>());
00189         <a class="code" href="classOgre_1_1BillboardSet.html#Ogre_1_1ParticleSystema41">setMaterialName</a>(rhs.<a class="code" href="classOgre_1_1BillboardSet.html#Ogre_1_1ParticleSystemn7">mMaterialName</a>);
00190         <a class="code" href="classOgre_1_1BillboardSet.html#Ogre_1_1ParticleSystemn4">mOriginType</a> = rhs.<a class="code" href="classOgre_1_1BillboardSet.html#Ogre_1_1ParticleSystemn4">mOriginType</a>;
00191         <a class="code" href="classOgre_1_1BillboardSet.html#Ogre_1_1ParticleSystemn6">mDefaultHeight</a> = rhs.<a class="code" href="classOgre_1_1BillboardSet.html#Ogre_1_1ParticleSystemn6">mDefaultHeight</a>;
00192         <a class="code" href="classOgre_1_1BillboardSet.html#Ogre_1_1ParticleSystemn5">mDefaultWidth</a> = rhs.<a class="code" href="classOgre_1_1BillboardSet.html#Ogre_1_1ParticleSystemn5">mDefaultWidth</a>;
00193         <a class="code" href="classOgre_1_1BillboardSet.html#Ogre_1_1ParticleSystemn18">mCullIndividual</a> = rhs.<a class="code" href="classOgre_1_1BillboardSet.html#Ogre_1_1ParticleSystemn18">mCullIndividual</a>;
00194         <a class="code" href="classOgre_1_1BillboardSet.html#Ogre_1_1ParticleSystemn19">mBillboardType</a> = rhs.<a class="code" href="classOgre_1_1BillboardSet.html#Ogre_1_1ParticleSystemn19">mBillboardType</a>;
00195         <a class="code" href="classOgre_1_1BillboardSet.html#Ogre_1_1ParticleSystemn20">mCommonDirection</a> = rhs.<a class="code" href="classOgre_1_1BillboardSet.html#Ogre_1_1ParticleSystemn20">mCommonDirection</a>;
00196 
00197 
00198         <font class="keywordflow">return</font> *<font class="keyword">this</font>;
00199 
00200     }
00201     <font class="comment">//-----------------------------------------------------------------------</font>
<a name="l00202"></a><a class="code" href="classOgre_1_1ParticleSystem.html#Ogre_1_1ParticleSystema15">00202</a>     <font class="keywordtype">unsigned</font> <font class="keywordtype">int</font> ParticleSystem::getParticleQuota(<font class="keywordtype">void</font>)<font class="keyword"> const</font>
00203 <font class="keyword">    </font>{
00204         <font class="comment">// This is basically a renamed property</font>
00205         <font class="keywordflow">return</font> <a class="code" href="classOgre_1_1BillboardSet.html#Ogre_1_1ParticleSystema29">getPoolSize</a>();
00206     }
00207     <font class="comment">//-----------------------------------------------------------------------</font>
<a name="l00208"></a><a class="code" href="classOgre_1_1ParticleSystem.html#Ogre_1_1ParticleSystema16">00208</a>     <font class="keywordtype">void</font> ParticleSystem::setParticleQuota(<font class="keywordtype">unsigned</font> <font class="keywordtype">int</font> quota)
00209     {
00210         <font class="comment">// This is basically a renamed property</font>
00211         <a class="code" href="classOgre_1_1BillboardSet.html#Ogre_1_1ParticleSystema28">setPoolSize</a>(quota);
00212     }
00213     <font class="comment">//-----------------------------------------------------------------------</font>
<a name="l00214"></a><a class="code" href="classOgre_1_1ParticleSystem.html#Ogre_1_1ParticleSystema18">00214</a>     <font class="keywordtype">void</font> ParticleSystem::_update(<a class="code" href="namespaceOgre.html#a281">Real</a> timeElapsed)
00215     {
00216         <a class="code" href="classOgre_1_1ParticleSystem.html#Ogre_1_1ParticleSystemb0">_expire</a>(timeElapsed);
00217         <a class="code" href="classOgre_1_1ParticleSystem.html#Ogre_1_1ParticleSystemb1">_triggerEmitters</a>(timeElapsed);
00218         <a class="code" href="classOgre_1_1ParticleSystem.html#Ogre_1_1ParticleSystemb2">_applyMotion</a>(timeElapsed);
00219         <a class="code" href="classOgre_1_1ParticleSystem.html#Ogre_1_1ParticleSystemb3">_triggerAffectors</a>(timeElapsed);
00220     }
00221     <font class="comment">//-----------------------------------------------------------------------</font>
<a name="l00222"></a><a class="code" href="classOgre_1_1ParticleSystem.html#Ogre_1_1ParticleSystemb0">00222</a>     <font class="keywordtype">void</font> ParticleSystem::_expire(<a class="code" href="namespaceOgre.html#a281">Real</a> timeElapsed)
00223     {
00224         ActiveBillboardList::iterator i, itEnd;
00225         <a class="code" href="classOgre_1_1Particle.html">Particle</a>* pParticle;
00226 
00227         itEnd = <a class="code" href="classOgre_1_1BillboardSet.html#Ogre_1_1ParticleSystemn11">mActiveBillboards</a>.end();
00228 
00229         <font class="keywordflow">for</font> (i = <a class="code" href="classOgre_1_1BillboardSet.html#Ogre_1_1ParticleSystemn11">mActiveBillboards</a>.begin(); i != itEnd; ++i)
00230         {
00231             pParticle = static_cast&lt;Particle*&gt;(*i);
00232             <font class="keywordflow">if</font> (pParticle-&gt;<a class="code" href="classOgre_1_1Particle.html#Ogre_1_1Particlem0">mTimeToLive</a> &lt; timeElapsed)
00233             {
00234                 <font class="comment">// Destroy this one</font>
00235                 <a class="code" href="classOgre_1_1BillboardSet.html#Ogre_1_1ParticleSystemn12">mFreeBillboards</a>.push_back( *i );
00236                 i = <a class="code" href="classOgre_1_1BillboardSet.html#Ogre_1_1ParticleSystemn11">mActiveBillboards</a>.erase( i );
00237             }
00238             <font class="keywordflow">else</font>
00239             {
00240                 <font class="comment">// Decrement TTL</font>
00241                 pParticle-&gt;<a class="code" href="classOgre_1_1Particle.html#Ogre_1_1Particlem0">mTimeToLive</a> -= timeElapsed;
00242             }
00243 
00244         }
00245     }
00246     <font class="comment">//-----------------------------------------------------------------------</font>
<a name="l00247"></a><a class="code" href="classOgre_1_1ParticleSystem.html#Ogre_1_1ParticleSystemb1">00247</a>     <font class="keywordtype">void</font> ParticleSystem::_triggerEmitters(<a class="code" href="namespaceOgre.html#a281">Real</a> timeElapsed)
00248     {
00249         <font class="comment">// Add up requests for emission</font>
00250         <font class="keyword">static</font> std::vector&lt;unsigned&gt; requested;
00251         <font class="keywordflow">if</font>( requested.size() != <a class="code" href="classOgre_1_1ParticleSystem.html#Ogre_1_1ParticleSystemn1">mEmitters</a>.size() )
00252             requested.resize( <a class="code" href="classOgre_1_1ParticleSystem.html#Ogre_1_1ParticleSystemn1">mEmitters</a>.size() );
00253 
00254         size_t totalRequested, emitterCount, i, emissionAllowed;
00255         ParticleEmitterList::iterator it, iEmitEnd;
00256         
00257         iEmitEnd = <a class="code" href="classOgre_1_1ParticleSystem.html#Ogre_1_1ParticleSystemn1">mEmitters</a>.end();
00258         emitterCount = <a class="code" href="classOgre_1_1ParticleSystem.html#Ogre_1_1ParticleSystemn1">mEmitters</a>.size();
00259         emissionAllowed = <a class="code" href="classOgre_1_1ParticleSystem.html#Ogre_1_1ParticleSystema15">getParticleQuota</a>() - <a class="code" href="classOgre_1_1BillboardSet.html#Ogre_1_1ParticleSystemn11">mActiveBillboards</a>.size();
00260         totalRequested = 0;
00261 
00262         <font class="comment">// Count up total requested emissions</font>
00263         <font class="keywordflow">for</font> (it = <a class="code" href="classOgre_1_1ParticleSystem.html#Ogre_1_1ParticleSystemn1">mEmitters</a>.begin(), i = 0; it != iEmitEnd; ++it, ++i)
00264         {
00265             requested[i] = (*it)-&gt;_getEmissionCount(timeElapsed);
00266             totalRequested += requested[i];
00267         }
00268 
00269 
00270         <font class="comment">// Check if the quota will be exceeded, if so reduce demand</font>
00271         <font class="keywordflow">if</font> (totalRequested &gt; emissionAllowed)
00272         {
00273             <font class="comment">// Apportion down requested values to allotted values</font>
00274             <a class="code" href="namespaceOgre.html#a281">Real</a> ratio =  (Real)emissionAllowed / (Real)totalRequested;
00275             <font class="keywordflow">for</font> (i = 0; i &lt; emitterCount; ++i)
00276             {
00277                 requested[i] *= (<font class="keywordtype">unsigned</font> <font class="keywordtype">int</font>)ratio;
00278             }
00279         }
00280 
00281         <font class="comment">// Emit</font>
00282         <font class="keywordflow">for</font> (it = <a class="code" href="classOgre_1_1ParticleSystem.html#Ogre_1_1ParticleSystemn1">mEmitters</a>.begin(), i = 0; it != iEmitEnd; ++it, ++i)
00283         {
00284             <font class="keywordflow">for</font> (<font class="keywordtype">unsigned</font> <font class="keywordtype">int</font> j = 0; j &lt; requested[i]; ++j)
00285             {
00286                 <font class="comment">// Create a new particle &amp; init using emitter</font>
00287                 <a class="code" href="classOgre_1_1Particle.html">Particle</a>* p = <a class="code" href="classOgre_1_1ParticleSystem.html#Ogre_1_1ParticleSystemb5">addParticle</a>();
00288                 (*it)-&gt;_initParticle(p);
00289                 <font class="comment">// Translate position &amp; direction into world space</font>
00290                 <font class="comment">// Maybe make emitter do this?</font>
00291                 p-&gt;<a class="code" href="classOgre_1_1Billboard.html#Ogre_1_1Particlem1">mPosition</a> =  (<a class="code" href="classOgre_1_1MovableObject.html#Ogre_1_1SimpleRenderablen14">mParentNode</a>-&gt;<a class="code" href="classOgre_1_1Node.html#Ogre_1_1SceneNodea47">_getDerivedOrientation</a>() * p-&gt;<a class="code" href="classOgre_1_1Billboard.html#Ogre_1_1Particlem1">mPosition</a>) + <a class="code" href="classOgre_1_1MovableObject.html#Ogre_1_1SimpleRenderablen14">mParentNode</a>-&gt;<a class="code" href="classOgre_1_1Node.html#Ogre_1_1SceneNodea48">_getDerivedPosition</a>();
00292                 p-&gt;<a class="code" href="classOgre_1_1Billboard.html#Ogre_1_1Particlem2">mDirection</a> = <a class="code" href="classOgre_1_1MovableObject.html#Ogre_1_1SimpleRenderablen14">mParentNode</a>-&gt;<a class="code" href="classOgre_1_1Node.html#Ogre_1_1SceneNodea47">_getDerivedOrientation</a>() * p-&gt;<a class="code" href="classOgre_1_1Billboard.html#Ogre_1_1Particlem2">mDirection</a>;
00293 
00294             }
00295         }
00296 
00297 
00298     }
00299     <font class="comment">//-----------------------------------------------------------------------</font>
<a name="l00300"></a><a class="code" href="classOgre_1_1ParticleSystem.html#Ogre_1_1ParticleSystemb2">00300</a>     <font class="keywordtype">void</font> ParticleSystem::_applyMotion(<a class="code" href="namespaceOgre.html#a281">Real</a> timeElapsed)
00301     {
00302         ActiveBillboardList::iterator i, itEnd;
00303         <a class="code" href="classOgre_1_1Particle.html">Particle</a>* pParticle;
00304 
00305         itEnd = <a class="code" href="classOgre_1_1BillboardSet.html#Ogre_1_1ParticleSystemn11">mActiveBillboards</a>.end();
00306         <font class="keywordflow">for</font> (i = <a class="code" href="classOgre_1_1BillboardSet.html#Ogre_1_1ParticleSystemn11">mActiveBillboards</a>.begin(); i != itEnd; ++i)
00307         {
00308             pParticle = static_cast&lt;Particle*&gt;(*i);
00309             pParticle-&gt;<a class="code" href="classOgre_1_1Billboard.html#Ogre_1_1Particlem1">mPosition</a> += (pParticle-&gt;<a class="code" href="classOgre_1_1Billboard.html#Ogre_1_1Particlem2">mDirection</a> * timeElapsed);
00310         }
00311 
00312     }
00313     <font class="comment">//-----------------------------------------------------------------------</font>
<a name="l00314"></a><a class="code" href="classOgre_1_1ParticleSystem.html#Ogre_1_1ParticleSystemb3">00314</a>     <font class="keywordtype">void</font> ParticleSystem::_triggerAffectors(<a class="code" href="namespaceOgre.html#a281">Real</a> timeElapsed)
00315     {
00316         ParticleAffectorList::iterator i, itEnd;
00317         
00318         itEnd = <a class="code" href="classOgre_1_1ParticleSystem.html#Ogre_1_1ParticleSystemn2">mAffectors</a>.end();
00319         <font class="keywordflow">for</font> (i = <a class="code" href="classOgre_1_1ParticleSystem.html#Ogre_1_1ParticleSystemn2">mAffectors</a>.begin(); i != itEnd; ++i)
00320         {
00321             (*i)-&gt;_affectParticles(<font class="keyword">this</font>, timeElapsed);
00322         }
00323 
00324     }
00325     <font class="comment">//-----------------------------------------------------------------------</font>
<a name="l00326"></a><a class="code" href="classOgre_1_1ParticleSystem.html#Ogre_1_1ParticleSystemb4">00326</a>     <font class="keywordtype">void</font> ParticleSystem::increasePool(<font class="keywordtype">unsigned</font> <font class="keywordtype">int</font> size)
00327     {
00328         size_t oldSize = <a class="code" href="classOgre_1_1BillboardSet.html#Ogre_1_1ParticleSystemn13">mBillboardPool</a>.size();
00329 
00330         <font class="comment">// Increase size</font>
00331         <a class="code" href="classOgre_1_1BillboardSet.html#Ogre_1_1ParticleSystemn13">mBillboardPool</a>.reserve(size);
00332         <a class="code" href="classOgre_1_1BillboardSet.html#Ogre_1_1ParticleSystemn13">mBillboardPool</a>.resize(size);
00333 
00334         <font class="comment">// Create new particles</font>
00335         <font class="keywordflow">for</font>( size_t i = oldSize; i &lt; size; i++ )
00336             <a class="code" href="classOgre_1_1BillboardSet.html#Ogre_1_1ParticleSystemn13">mBillboardPool</a>[i] = <font class="keyword">new</font> <a class="code" href="classOgre_1_1Particle.html">Particle</a>();
00337 
00338     }
00339     <font class="comment">//-----------------------------------------------------------------------</font>
<a name="l00340"></a><a class="code" href="classOgre_1_1ParticleSystem.html#Ogre_1_1ParticleSystema19">00340</a>     <a class="code" href="classOgre_1_1ParticleIterator.html">ParticleIterator</a> ParticleSystem::_getIterator(<font class="keywordtype">void</font>)
00341     {
00342         <font class="keywordflow">return</font> <a class="code" href="classOgre_1_1ParticleIterator.html">ParticleIterator</a>(<a class="code" href="classOgre_1_1BillboardSet.html#Ogre_1_1ParticleSystemn11">mActiveBillboards</a>.begin(), <a class="code" href="classOgre_1_1BillboardSet.html#Ogre_1_1ParticleSystemn11">mActiveBillboards</a>.end());
00343     }
00344     <font class="comment">//-----------------------------------------------------------------------</font>
<a name="l00345"></a><a class="code" href="classOgre_1_1ParticleSystem.html#Ogre_1_1ParticleSystemb5">00345</a>     <a class="code" href="classOgre_1_1Particle.html">Particle</a>* ParticleSystem::addParticle(<font class="keywordtype">void</font>)
00346     {
00347         <font class="comment">// Fast creation (don't use superclass since emitter will init)</font>
00348         <a class="code" href="classOgre_1_1Billboard.html">Billboard</a>* newBill = <a class="code" href="classOgre_1_1BillboardSet.html#Ogre_1_1ParticleSystemn12">mFreeBillboards</a>.front();
00349         <a class="code" href="classOgre_1_1BillboardSet.html#Ogre_1_1ParticleSystemn12">mFreeBillboards</a>.pop_front();
00350         <a class="code" href="classOgre_1_1BillboardSet.html#Ogre_1_1ParticleSystemn11">mActiveBillboards</a>.push_back(newBill);
00351 
00352         newBill-&gt;<a class="code" href="classOgre_1_1Billboard.html#Ogre_1_1Particlea8">_notifyOwner</a>(<font class="keyword">this</font>);
00353 
00354         <font class="comment">// Because we're creating objects here we know this is a Particle</font>
00355         <font class="keywordflow">return</font> static_cast&lt;Particle*&gt;(newBill);
00356 
00357     }
00358     <font class="comment">//-----------------------------------------------------------------------</font>
<a name="l00359"></a><a class="code" href="classOgre_1_1ParticleSystem.html#Ogre_1_1ParticleSystemb6">00359</a>     <font class="keywordtype">void</font> ParticleSystem::genBillboardAxes(<a class="code" href="classOgre_1_1Camera.html">Camera</a>&amp; cam, <a class="code" href="classOgre_1_1Vector3.html">Vector3</a>* pX, <a class="code" href="classOgre_1_1Vector3.html">Vector3</a> *pY, <font class="keyword">const</font> <a class="code" href="classOgre_1_1Billboard.html">Billboard</a>* pBill)    
00360     {
00361         <font class="comment">// Orientation different from BillboardSet</font>
00362         <font class="comment">// Billboards are in world space (to decouple them from emitters in node space)</font>
00363         <a class="code" href="classOgre_1_1Quaternion.html">Quaternion</a> camQ;
00364 
00365         <font class="keywordflow">switch</font> (mBillboardType)
00366         {
00367         <font class="keywordflow">case</font> <a class="code" href="namespaceOgre.html#a416a10">BBT_POINT</a>:
00368             <font class="comment">// Get camera world axes for X and Y (depth is irrelevant)</font>
00369             <font class="comment">// No inverse transform</font>
00370             camQ = cam.<a class="code" href="classOgre_1_1Camera.html#Ogre_1_1Cameraa43">getDerivedOrientation</a>();
00371             *pX = camQ * Vector3::UNIT_X;
00372             *pY = camQ * Vector3::UNIT_Y;
00373            
00374             <font class="keywordflow">break</font>;
00375         <font class="keywordflow">case</font> <a class="code" href="namespaceOgre.html#a416a11">BBT_ORIENTED_COMMON</a>:
00376              <font class="comment">// Y-axis is common direction</font>
00377             <font class="comment">// X-axis is cross with camera direction </font>
00378             *pY = <a class="code" href="classOgre_1_1BillboardSet.html#Ogre_1_1ParticleSystemn20">mCommonDirection</a>;
00379             *pX = camQ * cam.<a class="code" href="classOgre_1_1Camera.html#Ogre_1_1Cameraa45">getDerivedDirection</a>().<a class="code" href="classOgre_1_1Vector3.html#Ogre_1_1Vector3a25">crossProduct</a>(*pY);
00380            
00381             <font class="keywordflow">break</font>;
00382         <font class="keywordflow">case</font> <a class="code" href="namespaceOgre.html#a416a12">BBT_ORIENTED_SELF</a>:
00383             <font class="comment">// Y-axis is direction</font>
00384             <font class="comment">// X-axis is cross with camera direction </font>
00385 
00386             <font class="comment">// Scale direction first</font>
00387             *pY = (pBill-&gt;<a class="code" href="classOgre_1_1Billboard.html#Ogre_1_1Particlem2">mDirection</a> * 0.01);
00388             *pX = camQ * cam.<a class="code" href="classOgre_1_1Camera.html#Ogre_1_1Cameraa45">getDerivedDirection</a>().<a class="code" href="classOgre_1_1Vector3.html#Ogre_1_1Vector3a25">crossProduct</a>(*pY);
00389 
00390             <font class="keywordflow">break</font>;
00391         }
00392 
00393     }
00394     <font class="comment">//-----------------------------------------------------------------------</font>
<a name="l00395"></a><a class="code" href="classOgre_1_1ParticleSystem.html#Ogre_1_1ParticleSystema20">00395</a>     <font class="keywordtype">void</font> ParticleSystem::getWorldTransforms(<a class="code" href="classOgre_1_1Matrix4.html">Matrix4</a>* xform)
00396     {
00397         <font class="comment">// Particles are already in world space</font>
00398         *xform = Matrix4::IDENTITY;
00399 
00400     }
00401     <font class="comment">//-----------------------------------------------------------------------</font>
<a name="l00402"></a><a class="code" href="classOgre_1_1ParticleSystem.html#Ogre_1_1ParticleSystemb7">00402</a>     <font class="keywordtype">void</font> ParticleSystem::initParameters(<font class="keywordtype">void</font>)
00403     {
00404         <font class="keywordflow">if</font> (<a class="code" href="classOgre_1_1StringInterface.html#Ogre_1_1StringInterfaceb0">createParamDictionary</a>(<font class="stringliteral">"ParticleSystem"</font>))
00405         {
00406             <a class="code" href="classOgre_1_1ParamDictionary.html">ParamDictionary</a>* dict = <a class="code" href="classOgre_1_1StringInterface.html#Ogre_1_1StringInterfacea1">getParamDictionary</a>();
00407 
00408             dict-&gt;<a class="code" href="classOgre_1_1ParamDictionary.html#Ogre_1_1ParamDictionarya1">addParameter</a>(<a class="code" href="classOgre_1_1ParameterDef.html">ParameterDef</a>(<font class="stringliteral">"quota"</font>, 
00409                 <font class="stringliteral">"The maximum number of particle allowed at once in this system."</font>,
00410                 <a class="code" href="namespaceOgre.html#a443a327">PT_UNSIGNED_INT</a>),
00411                 &amp;<a class="code" href="classOgre_1_1ParticleSystem.html#Ogre_1_1ParticleSystemq3">msQuotaCmd</a>);
00412 
00413             dict-&gt;<a class="code" href="classOgre_1_1ParamDictionary.html#Ogre_1_1ParamDictionarya1">addParameter</a>(<a class="code" href="classOgre_1_1ParameterDef.html">ParameterDef</a>(<font class="stringliteral">"material"</font>, 
00414                 <font class="stringliteral">"The name of the material to be used to render all particles in this system."</font>,
00415                 <a class="code" href="namespaceOgre.html#a443a332">PT_STRING</a>),
00416                 &amp;<a class="code" href="classOgre_1_1ParticleSystem.html#Ogre_1_1ParticleSystemq2">msMaterialCmd</a>);
00417 
00418             dict-&gt;<a class="code" href="classOgre_1_1ParamDictionary.html#Ogre_1_1ParamDictionarya1">addParameter</a>(<a class="code" href="classOgre_1_1ParameterDef.html">ParameterDef</a>(<font class="stringliteral">"particle_width"</font>, 
00419                 <font class="stringliteral">"The width of particles in world units."</font>,
00420                 <a class="code" href="namespaceOgre.html#a443a325">PT_REAL</a>),
00421                 &amp;<a class="code" href="classOgre_1_1ParticleSystem.html#Ogre_1_1ParticleSystemq4">msWidthCmd</a>);
00422 
00423             dict-&gt;<a class="code" href="classOgre_1_1ParamDictionary.html#Ogre_1_1ParamDictionarya1">addParameter</a>(<a class="code" href="classOgre_1_1ParameterDef.html">ParameterDef</a>(<font class="stringliteral">"particle_height"</font>, 
00424                 <font class="stringliteral">"The height of particles in world units."</font>,
00425                 <a class="code" href="namespaceOgre.html#a443a325">PT_REAL</a>),
00426                 &amp;<a class="code" href="classOgre_1_1ParticleSystem.html#Ogre_1_1ParticleSystemq1">msHeightCmd</a>);
00427 
00428             dict-&gt;<a class="code" href="classOgre_1_1ParamDictionary.html#Ogre_1_1ParamDictionarya1">addParameter</a>(<a class="code" href="classOgre_1_1ParameterDef.html">ParameterDef</a>(<font class="stringliteral">"cull_each"</font>, 
00429                 <font class="stringliteral">"If true, each particle is culled in it's own right. If false, the entire system is culled as a whole."</font>,
00430                 <a class="code" href="namespaceOgre.html#a443a324">PT_BOOL</a>),
00431                 &amp;<a class="code" href="classOgre_1_1ParticleSystem.html#Ogre_1_1ParticleSystemq0">msCullCmd</a>);
00432 
00433             dict-&gt;<a class="code" href="classOgre_1_1ParamDictionary.html#Ogre_1_1ParamDictionarya1">addParameter</a>(<a class="code" href="classOgre_1_1ParameterDef.html">ParameterDef</a>(<font class="stringliteral">"billboard_type"</font>, 
00434                 <font class="stringliteral">"The type of billboard to use. 'point' means a simulated spherical particle, "</font> 
00435                 <font class="stringliteral">"'oriented_common' means all particles in the set are oriented around common_direction, "</font>
00436                 <font class="stringliteral">"and 'oriented_self' means particles are oriented around their own direction."</font>,
00437                 <a class="code" href="namespaceOgre.html#a443a327">PT_UNSIGNED_INT</a>),
00438                 &amp;<a class="code" href="classOgre_1_1ParticleSystem.html#Ogre_1_1ParticleSystemq5">msBillboardTypeCmd</a>);
00439 
00440             dict-&gt;<a class="code" href="classOgre_1_1ParamDictionary.html#Ogre_1_1ParamDictionarya1">addParameter</a>(<a class="code" href="classOgre_1_1ParameterDef.html">ParameterDef</a>(<font class="stringliteral">"common_direction"</font>, 
00441                 <font class="stringliteral">"Only useful when billboard_type is oriented_common. This parameter sets the common "</font>
00442                 <font class="stringliteral">"orientation for all particles in the set (e.g. raindrops may all be oriented downwards)."</font>,
00443                 <a class="code" href="namespaceOgre.html#a443a333">PT_VECTOR3</a>),
00444                 &amp;<a class="code" href="classOgre_1_1ParticleSystem.html#Ogre_1_1ParticleSystemq6">msCommonDirectionCmd</a>);
00445 
00446         }
00447     }
00448     <font class="comment">//-----------------------------------------------------------------------</font>
<a name="l00449"></a><a class="code" href="classOgre_1_1ParticleSystem.html#Ogre_1_1ParticleSystema21">00449</a>     <font class="keywordtype">void</font> ParticleSystem::_notifyCurrentCamera(<a class="code" href="classOgre_1_1Camera.html">Camera</a> *cam)
00450     {
00451         <font class="comment">// Call superclass</font>
00452         BillboardSet::_notifyCurrentCamera(cam);
00453         <font class="comment">// Have to override because bounds are supposed to be in local node space</font>
00454         <font class="comment">// but we've already put particles in world space to decouple them from the</font>
00455         <font class="comment">// node transform, so reverse transform back</font>
00456 
00457         <a class="code" href="classOgre_1_1Vector3.html">Vector3</a> min( Math::POS_INFINITY, Math::POS_INFINITY, Math::POS_INFINITY );
00458         <a class="code" href="classOgre_1_1Vector3.html">Vector3</a> max( Math::NEG_INFINITY, Math::NEG_INFINITY, Math::NEG_INFINITY );
00459         <a class="code" href="classOgre_1_1Vector3.html">Vector3</a> temp;
00460         <font class="keyword">const</font> <a class="code" href="classOgre_1_1Vector3.html">Vector3</a> *corner = <a class="code" href="classOgre_1_1BillboardSet.html#Ogre_1_1ParticleSystemn3">mAABB</a>.<a class="code" href="classOgre_1_1AxisAlignedBox.html#Ogre_1_1AxisAlignedBoxa11">getAllCorners</a>();
00461         <a class="code" href="classOgre_1_1Quaternion.html">Quaternion</a> invQ = <a class="code" href="classOgre_1_1MovableObject.html#Ogre_1_1SimpleRenderablen14">mParentNode</a>-&gt;<a class="code" href="classOgre_1_1Node.html#Ogre_1_1SceneNodea47">_getDerivedOrientation</a>().<a class="code" href="classOgre_1_1Quaternion.html#Ogre_1_1Quaterniona19">Inverse</a>();
00462         <a class="code" href="classOgre_1_1Vector3.html">Vector3</a> t = <a class="code" href="classOgre_1_1MovableObject.html#Ogre_1_1SimpleRenderablen14">mParentNode</a>-&gt;<a class="code" href="classOgre_1_1Node.html#Ogre_1_1SceneNodea48">_getDerivedPosition</a>();
00463 
00464         <font class="keywordflow">for</font> (<font class="keywordtype">int</font> i = 0; i &lt; 8; ++i)
00465         {
00466             <font class="comment">// Reverse transform corner</font>
00467             temp = invQ * (corner[i] - t);
00468             min.<a class="code" href="classOgre_1_1Vector3.html#Ogre_1_1Vector3a29">makeFloor</a>(temp);
00469             max.<a class="code" href="classOgre_1_1Vector3.html#Ogre_1_1Vector3a30">makeCeil</a>(temp);
00470         }
00471         <a class="code" href="classOgre_1_1BillboardSet.html#Ogre_1_1ParticleSystemn3">mAABB</a>.<a class="code" href="classOgre_1_1AxisAlignedBox.html#Ogre_1_1AxisAlignedBoxa9">setExtents</a>(min, max);
00472     }
00473     <font class="comment">//-----------------------------------------------------------------------</font>
00474 
<a name="l00475"></a><a class="code" href="classOgre_1_1ParticleSystem.html#Ogre_1_1ParticleSystema22">00475</a>     <font class="keywordtype">void</font> ParticleSystem::fastForward(<a class="code" href="namespaceOgre.html#a281">Real</a> time, <a class="code" href="namespaceOgre.html#a281">Real</a> interval)
00476     {
00477         <font class="comment">// First make sure all transforms are up to date</font>
00478 
00479         <font class="keywordflow">for</font> (<a class="code" href="namespaceOgre.html#a281">Real</a> ftime = 0; ftime &lt; time; ftime += interval)
00480         {
00481             <a class="code" href="classOgre_1_1ParticleSystem.html#Ogre_1_1ParticleSystema18">_update</a>(interval);
00482         }
00483     }
00484 
00485     <font class="comment">//-----------------------------------------------------------------------</font>
<a name="l00486"></a><a class="code" href="classOgre_1_1ParticleSystem_1_1CmdCull.html#Ogre_1_1ParticleSystem_1_1CmdCulla0">00486</a>     <a class="code" href="classOgre_1_1String.html">String</a> ParticleSystem::CmdCull::doGet(<font class="keywordtype">void</font>* target)
00487     {
00488         <font class="keywordflow">return</font> StringConverter::toString(
00489             static_cast&lt;ParticleSystem*&gt;(target)-&gt;<a class="code" href="classOgre_1_1BillboardSet.html#Ogre_1_1ParticleSystema48">getCullIndividually</a>() );
00490     }
<a name="l00491"></a><a class="code" href="classOgre_1_1ParticleSystem_1_1CmdCull.html#Ogre_1_1ParticleSystem_1_1CmdCulla1">00491</a>     <font class="keywordtype">void</font> ParticleSystem::CmdCull::doSet(<font class="keywordtype">void</font>* target, <font class="keyword">const</font> <a class="code" href="classOgre_1_1String.html">String</a>&amp; val)
00492     {
00493         static_cast&lt;ParticleSystem*&gt;(target)-&gt;setCullIndividually(
00494             StringConverter::parseBool(val));
00495     }
00496     <font class="comment">//-----------------------------------------------------------------------</font>
<a name="l00497"></a><a class="code" href="classOgre_1_1ParticleSystem_1_1CmdHeight.html#Ogre_1_1ParticleSystem_1_1CmdHeighta0">00497</a>     <a class="code" href="classOgre_1_1String.html">String</a> ParticleSystem::CmdHeight::doGet(<font class="keywordtype">void</font>* target)
00498     {
00499         <font class="keywordflow">return</font> StringConverter::toString(
00500             static_cast&lt;ParticleSystem*&gt;(target)-&gt;<a class="code" href="classOgre_1_1BillboardSet.html#Ogre_1_1ParticleSystema40">getDefaultHeight</a>() );
00501     }
<a name="l00502"></a><a class="code" href="classOgre_1_1ParticleSystem_1_1CmdHeight.html#Ogre_1_1ParticleSystem_1_1CmdHeighta1">00502</a>     <font class="keywordtype">void</font> ParticleSystem::CmdHeight::doSet(<font class="keywordtype">void</font>* target, <font class="keyword">const</font> <a class="code" href="classOgre_1_1String.html">String</a>&amp; val)
00503     {
00504         static_cast&lt;ParticleSystem*&gt;(target)-&gt;setDefaultHeight(
00505             StringConverter::parseReal(val));
00506     }
00507     <font class="comment">//-----------------------------------------------------------------------</font>
<a name="l00508"></a><a class="code" href="classOgre_1_1ParticleSystem_1_1CmdWidth.html#Ogre_1_1ParticleSystem_1_1CmdWidtha0">00508</a>     <a class="code" href="classOgre_1_1String.html">String</a> ParticleSystem::CmdWidth::doGet(<font class="keywordtype">void</font>* target)
00509     {
00510         <font class="keywordflow">return</font> StringConverter::toString(
00511             static_cast&lt;ParticleSystem*&gt;(target)-&gt;<a class="code" href="classOgre_1_1BillboardSet.html#Ogre_1_1ParticleSystema38">getDefaultWidth</a>() );
00512     }
<a name="l00513"></a><a class="code" href="classOgre_1_1ParticleSystem_1_1CmdWidth.html#Ogre_1_1ParticleSystem_1_1CmdWidtha1">00513</a>     <font class="keywordtype">void</font> ParticleSystem::CmdWidth::doSet(<font class="keywordtype">void</font>* target, <font class="keyword">const</font> <a class="code" href="classOgre_1_1String.html">String</a>&amp; val)
00514     {
00515         static_cast&lt;ParticleSystem*&gt;(target)-&gt;setDefaultWidth(
00516             StringConverter::parseReal(val));
00517     }
00518     <font class="comment">//-----------------------------------------------------------------------</font>
<a name="l00519"></a><a class="code" href="classOgre_1_1ParticleSystem_1_1CmdMaterial.html#Ogre_1_1ParticleSystem_1_1CmdMateriala0">00519</a>     <a class="code" href="classOgre_1_1String.html">String</a> ParticleSystem::CmdMaterial::doGet(<font class="keywordtype">void</font>* target)
00520     {
00521         <font class="keywordflow">return</font> static_cast&lt;ParticleSystem*&gt;(target)-&gt;getMaterialName();
00522     }
<a name="l00523"></a><a class="code" href="classOgre_1_1ParticleSystem_1_1CmdMaterial.html#Ogre_1_1ParticleSystem_1_1CmdMateriala1">00523</a>     <font class="keywordtype">void</font> ParticleSystem::CmdMaterial::doSet(<font class="keywordtype">void</font>* target, <font class="keyword">const</font> <a class="code" href="classOgre_1_1String.html">String</a>&amp; val)
00524     {
00525         static_cast&lt;ParticleSystem*&gt;(target)-&gt;setMaterialName(val);
00526     }
00527     <font class="comment">//-----------------------------------------------------------------------</font>
<a name="l00528"></a><a class="code" href="classOgre_1_1ParticleSystem_1_1CmdQuota.html#Ogre_1_1ParticleSystem_1_1CmdQuotaa0">00528</a>     <a class="code" href="classOgre_1_1String.html">String</a> ParticleSystem::CmdQuota::doGet(<font class="keywordtype">void</font>* target)
00529     {
00530         <font class="keywordflow">return</font> StringConverter::toString(
00531             static_cast&lt;ParticleSystem*&gt;(target)-&gt;<a class="code" href="classOgre_1_1ParticleSystem.html#Ogre_1_1ParticleSystema15">getParticleQuota</a>() );
00532     }
<a name="l00533"></a><a class="code" href="classOgre_1_1ParticleSystem_1_1CmdQuota.html#Ogre_1_1ParticleSystem_1_1CmdQuotaa1">00533</a>     <font class="keywordtype">void</font> ParticleSystem::CmdQuota::doSet(<font class="keywordtype">void</font>* target, <font class="keyword">const</font> <a class="code" href="classOgre_1_1String.html">String</a>&amp; val)
00534     {
00535         static_cast&lt;ParticleSystem*&gt;(target)-&gt;setParticleQuota(
00536             StringConverter::parseUnsignedInt(val));
00537     }
00538     <font class="comment">//-----------------------------------------------------------------------</font>
<a name="l00539"></a><a class="code" href="classOgre_1_1ParticleSystem_1_1CmdBillboardType.html#Ogre_1_1ParticleSystem_1_1CmdBillboardTypea0">00539</a>     <a class="code" href="classOgre_1_1String.html">String</a> ParticleSystem::CmdBillboardType::doGet(<font class="keywordtype">void</font>* target)
00540     {
00541         <a class="code" href="namespaceOgre.html#a416">BillboardType</a> t = static_cast&lt;ParticleSystem*&gt;(target)-&gt;getBillboardType();
00542         <font class="keywordflow">switch</font>(t)
00543         {
00544         <font class="keywordflow">case</font> <a class="code" href="namespaceOgre.html#a416a10">BBT_POINT</a>:
00545             <font class="keywordflow">return</font> <font class="stringliteral">"point"</font>;
00546             <font class="keywordflow">break</font>;
00547         <font class="keywordflow">case</font> <a class="code" href="namespaceOgre.html#a416a11">BBT_ORIENTED_COMMON</a>:
00548             <font class="keywordflow">return</font> <font class="stringliteral">"oriented_common"</font>;
00549             <font class="keywordflow">break</font>;
00550         <font class="keywordflow">case</font> <a class="code" href="namespaceOgre.html#a416a12">BBT_ORIENTED_SELF</a>:
00551             <font class="keywordflow">return</font> <font class="stringliteral">"oriented_self"</font>;
00552             <font class="keywordflow">break</font>;
00553         }
00554         <font class="comment">// Compiler nicety</font>
00555         <font class="keywordflow">return</font> <font class="stringliteral">""</font>;
00556     }
<a name="l00557"></a><a class="code" href="classOgre_1_1ParticleSystem_1_1CmdBillboardType.html#Ogre_1_1ParticleSystem_1_1CmdBillboardTypea1">00557</a>     <font class="keywordtype">void</font> ParticleSystem::CmdBillboardType::doSet(<font class="keywordtype">void</font>* target, <font class="keyword">const</font> <a class="code" href="classOgre_1_1String.html">String</a>&amp; val)
00558     {
00559         <a class="code" href="namespaceOgre.html#a416">BillboardType</a> t;
00560         <font class="keywordflow">if</font> (val == <font class="stringliteral">"point"</font>)
00561         {
00562             t = <a class="code" href="namespaceOgre.html#a416a10">BBT_POINT</a>;
00563         }
00564         <font class="keywordflow">else</font> <font class="keywordflow">if</font> (val == <font class="stringliteral">"oriented_common"</font>)
00565         {
00566             t = <a class="code" href="namespaceOgre.html#a416a11">BBT_ORIENTED_COMMON</a>;
00567         }
00568         <font class="keywordflow">else</font> <font class="keywordflow">if</font> (val == <font class="stringliteral">"oriented_self"</font>)
00569         {
00570             t = <a class="code" href="namespaceOgre.html#a416a12">BBT_ORIENTED_SELF</a>;
00571         }
00572         static_cast&lt;ParticleSystem*&gt;(target)-&gt;setBillboardType(t);
00573     }
00574     <font class="comment">//-----------------------------------------------------------------------</font>
<a name="l00575"></a><a class="code" href="classOgre_1_1ParticleSystem_1_1CmdCommonDirection.html#Ogre_1_1ParticleSystem_1_1CmdCommonDirectiona0">00575</a>     <a class="code" href="classOgre_1_1String.html">String</a> ParticleSystem::CmdCommonDirection::doGet(<font class="keywordtype">void</font>* target)
00576     {
00577         <font class="keywordflow">return</font> StringConverter::toString(
00578             static_cast&lt;ParticleSystem*&gt;(target)-&gt;<a class="code" href="classOgre_1_1BillboardSet.html#Ogre_1_1ParticleSystema53">getCommonDirection</a>() );
00579     }
<a name="l00580"></a><a class="code" href="classOgre_1_1ParticleSystem_1_1CmdCommonDirection.html#Ogre_1_1ParticleSystem_1_1CmdCommonDirectiona1">00580</a>     <font class="keywordtype">void</font> ParticleSystem::CmdCommonDirection::doSet(<font class="keywordtype">void</font>* target, <font class="keyword">const</font> <a class="code" href="classOgre_1_1String.html">String</a>&amp; val)
00581     {
00582         static_cast&lt;ParticleSystem*&gt;(target)-&gt;setCommonDirection(
00583             StringConverter::parseVector3(val));
00584     }
00585 
00586 }
</pre></div><p>
Copyright &copy; 2002 by The OGRE Team<br />
<script type="text/javascript">
<!--//hide script from old browsers
document.write( "Last modified "+ document.lastModified );
//end hiding contents -->
</script>
</p>
</body>
</html>
