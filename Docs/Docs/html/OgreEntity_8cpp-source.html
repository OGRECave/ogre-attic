<html>
<head>
<title>OGRE Documentation</title> <meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1"> 
<link type="text/css" rel="stylesheet" href="style.css">
</head>

<body>
<!-- Generated by Doxygen 1.2.16 -->
<center>
<a class="qindex" href="index.html">Main Page</a> &nbsp; <a class="qindex" href="namespaces.html">Namespace List</a> &nbsp; <a class="qindex" href="hierarchy.html">Class Hierarchy</a> &nbsp; <a class="qindex" href="classes.html">Alphabetical List</a> &nbsp; <a class="qindex" href="annotated.html">Compound List</a> &nbsp; <a class="qindex" href="files.html">File List</a> &nbsp; <a class="qindex" href="namespacemembers.html">Namespace Members</a> &nbsp; <a class="qindex" href="functions.html">Compound Members</a> &nbsp; <a class="qindex" href="globals.html">File Members</a> &nbsp; <a class="qindex" href="pages.html">Related Pages</a> &nbsp; </center>
<hr><h1>OgreEntity.cpp</h1><a href="OgreEntity_8cpp.html">Go to the documentation of this file.</a><div class="fragment"><pre>00001 <font class="comment">/*</font>
00002 <font class="comment">-----------------------------------------------------------------------------</font>
00003 <font class="comment">This source file is part of OGRE</font>
00004 <font class="comment">    (Object-oriented Graphics Rendering Engine)</font>
00005 <font class="comment">For the latest info, see http://www.stevestreeting.com/ogre/</font>
00006 <font class="comment"></font>
00007 <font class="comment">Copyright © 2000-2001 Steven J. Streeting</font>
00008 <font class="comment">Also see acknowledgements in Readme.html</font>
00009 <font class="comment"></font>
00010 <font class="comment">This program is free software; you can redistribute it and/or modify it under</font>
00011 <font class="comment">the terms of the GNU General Public License as published by the Free Software</font>
00012 <font class="comment">Foundation; either version 2 of the License, or (at your option) any later</font>
00013 <font class="comment">version.</font>
00014 <font class="comment"></font>
00015 <font class="comment">This program is distributed in the hope that it will be useful, but WITHOUT</font>
00016 <font class="comment">ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or FITNESS</font>
00017 <font class="comment">FOR A PARTICULAR PURPOSE. See the GNU General Public License for more details.</font>
00018 <font class="comment"></font>
00019 <font class="comment">You should have received a copy of the GNU General Public License along with</font>
00020 <font class="comment">this program; if not, write to the Free Software Foundation, Inc., 59 Temple</font>
00021 <font class="comment">Place - Suite 330, Boston, MA 02111-1307, USA, or go to</font>
00022 <font class="comment">http://www.gnu.org/copyleft/gpl.html.</font>
00023 <font class="comment">-----------------------------------------------------------------------------</font>
00024 <font class="comment">*/</font>
00025 <font class="preprocessor">#include "<a class="code" href="OgreEntity_8h.html">OgreEntity.h</a>"</font>
00026 
00027 <font class="preprocessor">#include "<a class="code" href="OgreMesh_8h.html">OgreMesh.h</a>"</font>
00028 <font class="preprocessor">#include "<a class="code" href="OgreSubMesh_8h.html">OgreSubMesh.h</a>"</font>
00029 <font class="preprocessor">#include "<a class="code" href="OgreSubEntity_8h.html">OgreSubEntity.h</a>"</font>
00030 <font class="preprocessor">#include "<a class="code" href="OgreException_8h.html">OgreException.h</a>"</font>
00031 <font class="preprocessor">#include "<a class="code" href="OgreSceneManager_8h.html">OgreSceneManager.h</a>"</font>
00032 
00033 <font class="keyword">namespace </font>Ogre {
<a name="l00034"></a><a class="code" href="classOgre_1_1Entity.html#Ogre_1_1Entityr0">00034</a>     <a class="code" href="classOgre_1_1String.html">String</a> Entity::msMovableType = <font class="stringliteral">"Entity"</font>;
00035     <font class="comment">//-----------------------------------------------------------------------</font>
<a name="l00036"></a><a class="code" href="classOgre_1_1Entity.html#Ogre_1_1Entityc0">00036</a>     Entity::Entity ()
00037     {
00038     }
00039     <font class="comment">//-----------------------------------------------------------------------</font>
<a name="l00040"></a><a class="code" href="classOgre_1_1Entity.html#Ogre_1_1Entityc1">00040</a>     Entity::Entity( <font class="keyword">const</font> <a class="code" href="classOgre_1_1String.html">String</a>&amp; name, <a class="code" href="classOgre_1_1Mesh.html">Mesh</a>* mesh, <a class="code" href="classOgre_1_1SceneManager.html">SceneManager</a>* creator) :
00041         mName(name),
00042         mMesh(mesh),
00043         mCreatorSceneManager(creator)
00044     {
00045         <font class="comment">// Create SubEntities</font>
00046         <font class="keywordtype">int</font> i, numSubMeshes;
00047         <a class="code" href="classOgre_1_1SubMesh.html">SubMesh</a>* subMesh;
00048         <a class="code" href="classOgre_1_1SubEntity.html">SubEntity</a>* subEnt;
00049 
00050         numSubMeshes = mesh-&gt;<a class="code" href="classOgre_1_1Mesh.html#Ogre_1_1Mesha5">getNumSubMeshes</a>();
00051         <font class="keywordflow">for</font> (i = 0; i &lt; numSubMeshes; ++i)
00052         {
00053             subMesh = mesh-&gt;<a class="code" href="classOgre_1_1Mesh.html#Ogre_1_1Mesha6">getSubMesh</a>(i);
00054             subEnt = <font class="keyword">new</font> <a class="code" href="classOgre_1_1Entity.html#Ogre_1_1Entityl1">SubEntity</a>();
00055             subEnt-&gt;<a class="code" href="classOgre_1_1SubEntity.html#Ogre_1_1SubEntityo0">mParentEntity</a> = <font class="keyword">this</font>;
00056             subEnt-&gt;<a class="code" href="classOgre_1_1SubEntity.html#Ogre_1_1SubEntityo3">mSubMesh</a> = subMesh;
00057             <font class="keywordflow">if</font> (subMesh-&gt;<a class="code" href="classOgre_1_1SubMesh.html#Ogre_1_1SubMesha4">isMatInitialised</a>())
00058                 subEnt-&gt;<a class="code" href="classOgre_1_1SubEntity.html#Ogre_1_1SubEntitya1">setMaterialName</a>(subMesh-&gt;<a class="code" href="classOgre_1_1SubMesh.html#Ogre_1_1SubMesha3">getMaterialName</a>());
00059             <a class="code" href="classOgre_1_1Entity.html#Ogre_1_1Entityo2">mSubEntityList</a>.push_back(subEnt);
00060         }
00061 
00062         <font class="comment">// Initialise the AnimationState, if Mesh has animation</font>
00063         <font class="keywordflow">if</font> (mesh-&gt;<a class="code" href="classOgre_1_1Mesh.html#Ogre_1_1Mesha15">hasSkeleton</a>())
00064         {
00065             mesh-&gt;<a class="code" href="classOgre_1_1Mesh.html#Ogre_1_1Mesha17">_initAnimationState</a>(&amp;<a class="code" href="classOgre_1_1Entity.html#Ogre_1_1Entityo4">mAnimationState</a>);
00066             <a class="code" href="classOgre_1_1Entity.html#Ogre_1_1Entityo6">mNumBoneMatrices</a> = mesh-&gt;<a class="code" href="classOgre_1_1Mesh.html#Ogre_1_1Mesha20">_getNumBoneMatrices</a>();
00067             <a class="code" href="classOgre_1_1Entity.html#Ogre_1_1Entityo5">mBoneMatrices</a> = <font class="keyword">new</font> <a class="code" href="classOgre_1_1Matrix4.html">Matrix4</a>[<a class="code" href="classOgre_1_1Entity.html#Ogre_1_1Entityo6">mNumBoneMatrices</a>];
00068         }
00069         <font class="keywordflow">else</font>
00070         {
00071             <a class="code" href="classOgre_1_1Entity.html#Ogre_1_1Entityo5">mBoneMatrices</a> = 0;
00072             <a class="code" href="classOgre_1_1Entity.html#Ogre_1_1Entityo6">mNumBoneMatrices</a> = 0;
00073         }
00074 
00075 
00076 
00077     }
00078     <font class="comment">//-----------------------------------------------------------------------</font>
<a name="l00079"></a><a class="code" href="classOgre_1_1Entity.html#Ogre_1_1Entitya0">00079</a>     Entity::~Entity()
00080     {
00081         <font class="comment">// Delete submeshes</font>
00082         <font class="keywordflow">for</font> (SubEntityList::iterator i = <a class="code" href="classOgre_1_1Entity.html#Ogre_1_1Entityo2">mSubEntityList</a>.begin();
00083             i != <a class="code" href="classOgre_1_1Entity.html#Ogre_1_1Entityo2">mSubEntityList</a>.end(); ++i)
00084         {
00085             <font class="keyword">delete</font> *i;
00086         }
00087         <font class="keywordflow">if</font> (mBoneMatrices)
00088             <font class="keyword">delete</font> [] <a class="code" href="classOgre_1_1Entity.html#Ogre_1_1Entityo5">mBoneMatrices</a>;
00089 
00090     }
00091     <font class="comment">//-----------------------------------------------------------------------</font>
<a name="l00092"></a><a class="code" href="classOgre_1_1Entity.html#Ogre_1_1Entitya2">00092</a>     <a class="code" href="classOgre_1_1Mesh.html">Mesh</a>* Entity::getMesh(<font class="keywordtype">void</font>)
00093     {
00094         <font class="keywordflow">return</font> <a class="code" href="classOgre_1_1Entity.html#Ogre_1_1Entityo1">mMesh</a>;
00095     }
00096     <font class="comment">//-----------------------------------------------------------------------</font>
<a name="l00097"></a><a class="code" href="classOgre_1_1Entity.html#Ogre_1_1Entitya1">00097</a>     <font class="keyword">const</font> <a class="code" href="classOgre_1_1String.html">String</a>&amp; Entity::getName(<font class="keywordtype">void</font>)<font class="keyword"> const</font>
00098 <font class="keyword">    </font>{
00099         <font class="keywordflow">return</font> <a class="code" href="classOgre_1_1Entity.html#Ogre_1_1Entityo0">mName</a>;
00100     }
00101     <font class="comment">//-----------------------------------------------------------------------</font>
<a name="l00102"></a><a class="code" href="classOgre_1_1Entity.html#Ogre_1_1Entitya3">00102</a>     <a class="code" href="classOgre_1_1SubEntity.html">SubEntity</a>* Entity::getSubEntity(<font class="keywordtype">unsigned</font> <font class="keywordtype">int</font> index)
00103     {
00104         <font class="keywordflow">if</font> (index &gt;= <a class="code" href="classOgre_1_1Entity.html#Ogre_1_1Entityo2">mSubEntityList</a>.size())
00105             <a class="code" href="OgreException_8h.html#a0">Except</a>(Exception::ERR_INVALIDPARAMS,
00106                 <font class="stringliteral">"Index out of bounds."</font>,
00107                 <font class="stringliteral">"Entity::getSubEntity"</font>);
00108         <font class="keywordflow">return</font> <a class="code" href="classOgre_1_1Entity.html#Ogre_1_1Entityo2">mSubEntityList</a>[index];
00109     }
00110     <font class="comment">//-----------------------------------------------------------------------</font>
<a name="l00111"></a><a class="code" href="classOgre_1_1Entity.html#Ogre_1_1Entitya4">00111</a>     <font class="keywordtype">unsigned</font> <font class="keywordtype">int</font> Entity::getNumSubEntities(<font class="keywordtype">void</font>)
00112     {
00113         <font class="keywordflow">return</font> static_cast&lt; unsigned int &gt;( <a class="code" href="classOgre_1_1Entity.html#Ogre_1_1Entityo2">mSubEntityList</a>.size() );
00114     }
00115     <font class="comment">//-----------------------------------------------------------------------</font>
<a name="l00116"></a><a class="code" href="classOgre_1_1Entity.html#Ogre_1_1Entitya5">00116</a>     <a class="code" href="classOgre_1_1Entity.html">Entity</a>* Entity::clone( <font class="keyword">const</font> <a class="code" href="classOgre_1_1String.html">String</a>&amp; newName)
00117     {
00118         <a class="code" href="classOgre_1_1Entity.html">Entity</a>* newEnt;
00119         newEnt = <a class="code" href="classOgre_1_1Entity.html#Ogre_1_1Entityo3">mCreatorSceneManager</a>-&gt;<a class="code" href="classOgre_1_1SceneManager.html#Ogre_1_1SceneManagera21">createEntity</a>( newName, <a class="code" href="classOgre_1_1Entity.html#Ogre_1_1Entitya2">getMesh</a>()-&gt;<a class="code" href="classOgre_1_1Entity.html#Ogre_1_1Entitya1">getName</a>() );
00120         <font class="comment">// Copy material settings</font>
00121         SubEntityList::iterator i;
00122         <font class="keywordtype">int</font> n = 0;
00123         <font class="keywordflow">for</font> (i = <a class="code" href="classOgre_1_1Entity.html#Ogre_1_1Entityo2">mSubEntityList</a>.begin(); i != <a class="code" href="classOgre_1_1Entity.html#Ogre_1_1Entityo2">mSubEntityList</a>.end(); ++i, ++n)
00124         {
00125             newEnt-&gt;<a class="code" href="classOgre_1_1Entity.html#Ogre_1_1Entitya3">getSubEntity</a>(n)-&gt;<a class="code" href="classOgre_1_1SubEntity.html#Ogre_1_1SubEntitya1">setMaterialName</a>((*i)-&gt;getMaterialName());
00126         }
00127         newEnt-&gt;<a class="code" href="classOgre_1_1Entity.html#Ogre_1_1Entityo4">mAnimationState</a> = <a class="code" href="classOgre_1_1Entity.html#Ogre_1_1Entityo4">mAnimationState</a>;
00128         <font class="keywordflow">return</font> newEnt;
00129     }
00130     <font class="comment">//-----------------------------------------------------------------------</font>
<a name="l00131"></a><a class="code" href="classOgre_1_1Entity.html#Ogre_1_1Entitya6">00131</a>     <font class="keywordtype">void</font> Entity::setMaterialName(<font class="keyword">const</font> <a class="code" href="classOgre_1_1String.html">String</a>&amp; name)
00132     {
00133         <font class="comment">// Set for all subentities</font>
00134         SubEntityList::iterator i;
00135         <font class="keywordflow">for</font> (i = <a class="code" href="classOgre_1_1Entity.html#Ogre_1_1Entityo2">mSubEntityList</a>.begin(); i != <a class="code" href="classOgre_1_1Entity.html#Ogre_1_1Entityo2">mSubEntityList</a>.end(); ++i)
00136         {
00137             (*i)-&gt;<a class="code" href="classOgre_1_1Entity.html#Ogre_1_1Entitya6">setMaterialName</a>(name);
00138         }
00139 
00140     }
00141     <font class="comment">//-----------------------------------------------------------------------</font>
<a name="l00142"></a><a class="code" href="classOgre_1_1Entity.html#Ogre_1_1Entitya7">00142</a>     <font class="keywordtype">void</font> Entity::_notifyCurrentCamera(<a class="code" href="classOgre_1_1Camera.html">Camera</a>* cam)
00143     {
00144         <font class="comment">// do nothing</font>
00145     }
00146     <font class="comment">//-----------------------------------------------------------------------</font>
<a name="l00147"></a><a class="code" href="classOgre_1_1Entity.html#Ogre_1_1Entitya8">00147</a>     <font class="keyword">const</font> <a class="code" href="classOgre_1_1AxisAlignedBox.html">AxisAlignedBox</a>&amp; Entity::getBoundingBox(<font class="keywordtype">void</font>)<font class="keyword"> const</font>
00148 <font class="keyword">    </font>{
00149         <font class="comment">// Get from Mesh</font>
00150         <font class="keywordflow">return</font> <a class="code" href="classOgre_1_1Entity.html#Ogre_1_1Entityo1">mMesh</a>-&gt;<a class="code" href="classOgre_1_1Mesh.html#Ogre_1_1Mesha9">getBounds</a>();
00151     }
00152     <font class="comment">//-----------------------------------------------------------------------</font>
<a name="l00153"></a><a class="code" href="classOgre_1_1Entity.html#Ogre_1_1Entitya9">00153</a>     <font class="keywordtype">void</font> Entity::_updateRenderQueue(<a class="code" href="classOgre_1_1RenderQueue.html">RenderQueue</a>* queue)
00154     {
00155         <font class="comment">// Add each SubEntity to the queue</font>
00156         SubEntityList::iterator i, iend;
00157         iend = <a class="code" href="classOgre_1_1Entity.html#Ogre_1_1Entityo2">mSubEntityList</a>.end();
00158         <font class="keywordflow">for</font> (i = <a class="code" href="classOgre_1_1Entity.html#Ogre_1_1Entityo2">mSubEntityList</a>.begin(); i != iend; ++i)
00159         {
00160             queue-&gt;<a class="code" href="classOgre_1_1RenderQueue.html#Ogre_1_1RenderQueuea1">addRenderable</a>(*i);
00161         }
00162 
00163         <font class="comment">// Since we know we're going to be rendered, take this opportunity to </font>
00164         <font class="comment">// cache bone matrices &amp; apply world matrix to them</font>
00165         <font class="keywordflow">if</font> (<a class="code" href="classOgre_1_1Entity.html#Ogre_1_1Entityo1">mMesh</a>-&gt;<a class="code" href="classOgre_1_1Mesh.html#Ogre_1_1Mesha15">hasSkeleton</a>())
00166         {
00167             <a class="code" href="classOgre_1_1Entity.html#Ogre_1_1Entityc2">cacheBoneMatrices</a>();
00168         }
00169 
00170     }
00171     <font class="comment">//-----------------------------------------------------------------------</font>
<a name="l00172"></a><a class="code" href="classOgre_1_1Entity.html#Ogre_1_1Entitya12">00172</a>     <a class="code" href="classOgre_1_1AnimationState.html">AnimationState</a>* Entity::getAnimationState(<font class="keyword">const</font> <a class="code" href="classOgre_1_1String.html">String</a>&amp; name)
00173     {
00174         AnimationStateSet::iterator i = <a class="code" href="classOgre_1_1Entity.html#Ogre_1_1Entityo4">mAnimationState</a>.find(name);
00175 
00176         <font class="keywordflow">if</font> (i == <a class="code" href="classOgre_1_1Entity.html#Ogre_1_1Entityo4">mAnimationState</a>.end())
00177         {
00178             <a class="code" href="OgreException_8h.html#a0">Except</a>(Exception::ERR_ITEM_NOT_FOUND, <font class="stringliteral">"No animation entry found named "</font> + name, 
00179             <font class="stringliteral">"Entity::getAnimationState"</font>);
00180         }
00181 
00182         <font class="keywordflow">return</font> &amp;(i-&gt;second);
00183     }
00184     <font class="comment">//-----------------------------------------------------------------------</font>
<a name="l00185"></a><a class="code" href="classOgre_1_1Entity.html#Ogre_1_1Entitya13">00185</a>     <a class="code" href="namespaceOgre.html#a0">AnimationStateSet</a>* Entity::getAllAnimationStates(<font class="keywordtype">void</font>)
00186     {
00187         <font class="keywordflow">return</font> &amp;<a class="code" href="classOgre_1_1Entity.html#Ogre_1_1Entityo4">mAnimationState</a>;
00188     }
00189     <font class="comment">//-----------------------------------------------------------------------</font>
<a name="l00190"></a><a class="code" href="classOgre_1_1Entity.html#Ogre_1_1Entitya10">00190</a>     <a class="code" href="classOgre_1_1String.html">String</a> Entity::getName(<font class="keywordtype">void</font>)
00191     {
00192         <font class="keywordflow">return</font> <a class="code" href="classOgre_1_1Entity.html#Ogre_1_1Entityo0">mName</a>;
00193     }
00194     <font class="comment">//-----------------------------------------------------------------------</font>
<a name="l00195"></a><a class="code" href="classOgre_1_1Entity.html#Ogre_1_1Entitya11">00195</a>     <a class="code" href="classOgre_1_1String.html">String</a> Entity::getMovableType(<font class="keywordtype">void</font>)
00196     {
00197         <font class="keywordflow">return</font> <a class="code" href="classOgre_1_1Entity.html#Ogre_1_1Entityr0">msMovableType</a>;
00198     }
00199     <font class="comment">//-----------------------------------------------------------------------</font>
<a name="l00200"></a><a class="code" href="classOgre_1_1Entity.html#Ogre_1_1Entityc2">00200</a>     <font class="keywordtype">void</font> Entity::cacheBoneMatrices(<font class="keywordtype">void</font>)
00201     {
00202         <a class="code" href="classOgre_1_1Entity.html#Ogre_1_1Entityo1">mMesh</a>-&gt;<a class="code" href="classOgre_1_1Mesh.html#Ogre_1_1Mesha21">_getBoneMatrices</a>(<a class="code" href="classOgre_1_1Entity.html#Ogre_1_1Entityo4">mAnimationState</a>, <a class="code" href="classOgre_1_1Entity.html#Ogre_1_1Entityo5">mBoneMatrices</a>);
00203         <font class="comment">// Apply our current world transform to these too, since these are used as</font>
00204         <font class="comment">// replacement world matrices</font>
00205         <font class="keywordtype">int</font> i;
00206         <a class="code" href="classOgre_1_1Matrix4.html">Matrix4</a> worldXform = <a class="code" href="classOgre_1_1MovableObject.html#Ogre_1_1SimpleRenderablen14">mParentNode</a>-&gt;<a class="code" href="classOgre_1_1Node.html#Ogre_1_1SceneNodea50">_getFullTransform</a>();
00207 
00208         <font class="keywordflow">for</font> (i = 0; i &lt; <a class="code" href="classOgre_1_1Entity.html#Ogre_1_1Entityo1">mMesh</a>-&gt;<a class="code" href="classOgre_1_1Mesh.html#Ogre_1_1Mesha20">_getNumBoneMatrices</a>(); ++i)
00209         {
00210             <a class="code" href="classOgre_1_1Entity.html#Ogre_1_1Entityo5">mBoneMatrices</a>[i] = worldXform * <a class="code" href="classOgre_1_1Entity.html#Ogre_1_1Entityo5">mBoneMatrices</a>[i];
00211         }
00212 
00213     }
00214 
00215 
00216 }
</pre></div><p>
Copyright &copy; 2002 by The OGRE Team<br />
<script type="text/javascript">
<!--//hide script from old browsers
document.write( "Last modified "+ document.lastModified );
//end hiding contents -->
</script>
</p>
</body>
</html>
