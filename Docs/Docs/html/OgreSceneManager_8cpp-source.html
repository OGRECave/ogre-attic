<html>
<head>
<title>OGRE Documentation</title> <meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1"> 
<link type="text/css" rel="stylesheet" href="style.css">
</head>

<body>
<!-- Generated by Doxygen 1.2.16 -->
<center>
<a class="qindex" href="index.html">Main Page</a> &nbsp; <a class="qindex" href="namespaces.html">Namespace List</a> &nbsp; <a class="qindex" href="hierarchy.html">Class Hierarchy</a> &nbsp; <a class="qindex" href="classes.html">Alphabetical List</a> &nbsp; <a class="qindex" href="annotated.html">Compound List</a> &nbsp; <a class="qindex" href="files.html">File List</a> &nbsp; <a class="qindex" href="namespacemembers.html">Namespace Members</a> &nbsp; <a class="qindex" href="functions.html">Compound Members</a> &nbsp; <a class="qindex" href="globals.html">File Members</a> &nbsp; <a class="qindex" href="pages.html">Related Pages</a> &nbsp; </center>
<hr><h1>OgreSceneManager.cpp</h1><a href="OgreSceneManager_8cpp.html">Go to the documentation of this file.</a><div class="fragment"><pre>00001 <font class="comment">/*</font>
00002 <font class="comment">-----------------------------------------------------------------------------</font>
00003 <font class="comment">This source file is part of OGRE</font>
00004 <font class="comment">    (Object-oriented Graphics Rendering Engine)</font>
00005 <font class="comment">For the latest info, see http://www.stevestreeting.com/ogre/</font>
00006 <font class="comment"></font>
00007 <font class="comment">Copyright © 2000-2001 Steven J. Streeting</font>
00008 <font class="comment">Also see acknowledgements in Readme.html</font>
00009 <font class="comment"></font>
00010 <font class="comment">This program is free software; you can redistribute it and/or modify it under</font>
00011 <font class="comment">the terms of the GNU General Public License as published by the Free Software</font>
00012 <font class="comment">Foundation; either version 2 of the License, or (at your option) any later</font>
00013 <font class="comment">version.</font>
00014 <font class="comment"></font>
00015 <font class="comment">This program is distributed in the hope that it will be useful, but WITHOUT</font>
00016 <font class="comment">ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or FITNESS</font>
00017 <font class="comment">FOR A PARTICULAR PURPOSE. See the GNU General Public License for more details.</font>
00018 <font class="comment"></font>
00019 <font class="comment">You should have received a copy of the GNU General Public License along with</font>
00020 <font class="comment">this program; if not, write to the Free Software Foundation, Inc., 59 Temple</font>
00021 <font class="comment">Place - Suite 330, Boston, MA 02111-1307, USA, or go to</font>
00022 <font class="comment">http://www.gnu.org/copyleft/gpl.html.</font>
00023 <font class="comment">-----------------------------------------------------------------------------</font>
00024 <font class="comment">*/</font>
00025 
00026 <font class="preprocessor">#include "<a class="code" href="OgreSceneManager_8h.html">OgreSceneManager.h</a>"</font>
00027 
00028 <font class="preprocessor">#include "<a class="code" href="OgreCamera_8h.html">OgreCamera.h</a>"</font>
00029 <font class="preprocessor">#include "<a class="code" href="OgreRenderSystem_8h.html">OgreRenderSystem.h</a>"</font>
00030 <font class="preprocessor">#include "<a class="code" href="OgreMeshManager_8h.html">OgreMeshManager.h</a>"</font>
00031 <font class="preprocessor">#include "<a class="code" href="OgreMesh_8h.html">OgreMesh.h</a>"</font>
00032 <font class="preprocessor">#include "<a class="code" href="OgreSubMesh_8h.html">OgreSubMesh.h</a>"</font>
00033 <font class="preprocessor">#include "<a class="code" href="OgreEntity_8h.html">OgreEntity.h</a>"</font>
00034 <font class="preprocessor">#include "<a class="code" href="OgreSubEntity_8h.html">OgreSubEntity.h</a>"</font>
00035 <font class="preprocessor">#include "<a class="code" href="OgreLight_8h.html">OgreLight.h</a>"</font>
00036 <font class="preprocessor">#include "<a class="code" href="OgreMath_8h.html">OgreMath.h</a>"</font>
00037 <font class="preprocessor">#include "<a class="code" href="OgreControllerManager_8h.html">OgreControllerManager.h</a>"</font>
00038 <font class="preprocessor">#include "<a class="code" href="OgreMaterialManager_8h.html">OgreMaterialManager.h</a>"</font>
00039 
00040 <font class="comment">// This class implements the most basic scene manager</font>
00041 
00042 <font class="preprocessor">#include &lt;cstdio&gt;</font>
00043 
00044 <font class="keyword">namespace </font>Ogre {
00045 
<a name="l00046"></a><a class="code" href="classOgre_1_1SceneManager.html#Ogre_1_1SceneManagera0">00046</a>     SceneManager::SceneManager()
00047     {
00048         <font class="comment">// Root scene node</font>
00049         <a class="code" href="classOgre_1_1SceneManager.html#Ogre_1_1SceneManagern9">mSceneRoot</a> = <font class="keyword">new</font> <a class="code" href="classOgre_1_1SceneNode.html">SceneNode</a>(<font class="keyword">this</font>);
00050 
00051 
00052         <font class="comment">// No sky by default</font>
00053         <a class="code" href="classOgre_1_1SceneManager.html#Ogre_1_1SceneManagern10">mSkyPlaneEnabled</a> = <font class="keyword">false</font>;
00054         <a class="code" href="classOgre_1_1SceneManager.html#Ogre_1_1SceneManagern14">mSkyBoxEnabled</a> = <font class="keyword">false</font>;
00055         <a class="code" href="classOgre_1_1SceneManager.html#Ogre_1_1SceneManagern19">mSkyDomeEnabled</a> = <font class="keyword">false</font>;
00056 
00057         <font class="comment">// No fog</font>
00058         <a class="code" href="classOgre_1_1SceneManager.html#Ogre_1_1SceneManagern24">mFogMode</a> = <a class="code" href="namespaceOgre.html#a429a80">FOG_NONE</a>;
00059     }
00060 
<a name="l00061"></a><a class="code" href="classOgre_1_1SceneManager.html#Ogre_1_1SceneManagera1">00061</a>     SceneManager::~SceneManager()
00062     {
00063         <a class="code" href="classOgre_1_1SceneManager.html#Ogre_1_1SceneManagera27">clearScene</a>();
00064         <font class="keyword">delete</font> <a class="code" href="classOgre_1_1SceneManager.html#Ogre_1_1SceneManagern9">mSceneRoot</a>;
00065     }
00066 
00067     <font class="comment">//-----------------------------------------------------------------------</font>
<a name="l00068"></a><a class="code" href="classOgre_1_1SceneManager.html#Ogre_1_1SceneManagera2">00068</a>     <a class="code" href="classOgre_1_1Camera.html">Camera</a>* SceneManager::createCamera(<font class="keyword">const</font> <a class="code" href="classOgre_1_1String.html">String</a>&amp; name)
00069     {
00070         <a class="code" href="classOgre_1_1Camera.html">Camera</a> *c = <font class="keyword">new</font> <a class="code" href="classOgre_1_1Camera.html">Camera</a>(name, <font class="keyword">this</font>);
00071         <a class="code" href="classOgre_1_1SceneManager.html#Ogre_1_1SceneManagern3">mCameras</a>.insert(CameraList::value_type(name, c));
00072 
00073 
00074         <font class="keywordflow">return</font> c;
00075     }
00076 
00077     <font class="comment">//-----------------------------------------------------------------------</font>
<a name="l00078"></a><a class="code" href="classOgre_1_1SceneManager.html#Ogre_1_1SceneManagera3">00078</a>     <a class="code" href="classOgre_1_1Camera.html">Camera</a>* SceneManager::getCamera(<font class="keyword">const</font> <a class="code" href="classOgre_1_1String.html">String</a>&amp; name)
00079     {
00080         CameraList::iterator i = <a class="code" href="classOgre_1_1SceneManager.html#Ogre_1_1SceneManagern3">mCameras</a>.find(name);
00081         <font class="keywordflow">if</font> (i == <a class="code" href="classOgre_1_1SceneManager.html#Ogre_1_1SceneManagern3">mCameras</a>.end())
00082         {
00083             <font class="keywordflow">return</font> 0;
00084         }
00085         <font class="keywordflow">else</font>
00086         {
00087             <font class="keywordflow">return</font> i-&gt;second;
00088         }
00089     }
00090 
00091     <font class="comment">//-----------------------------------------------------------------------</font>
<a name="l00092"></a><a class="code" href="classOgre_1_1SceneManager.html#Ogre_1_1SceneManagera4">00092</a>     <font class="keywordtype">void</font> SceneManager::removeCamera(<a class="code" href="classOgre_1_1Camera.html">Camera</a> *cam)
00093     {
00094         <font class="comment">// Find in list</font>
00095         CameraList::iterator i = <a class="code" href="classOgre_1_1SceneManager.html#Ogre_1_1SceneManagern3">mCameras</a>.begin();
00096         <font class="keywordflow">for</font> (; i != <a class="code" href="classOgre_1_1SceneManager.html#Ogre_1_1SceneManagern3">mCameras</a>.end(); ++i)
00097         {
00098             <font class="keywordflow">if</font> (i-&gt;second == cam)
00099             {
00100                 <a class="code" href="classOgre_1_1SceneManager.html#Ogre_1_1SceneManagern3">mCameras</a>.erase(i);
00101                 <font class="keyword">delete</font> cam;
00102                 <font class="keywordflow">break</font>;
00103             }
00104         }
00105 
00106     }
00107 
00108     <font class="comment">//-----------------------------------------------------------------------</font>
<a name="l00109"></a><a class="code" href="classOgre_1_1SceneManager.html#Ogre_1_1SceneManagera5">00109</a>     <font class="keywordtype">void</font> SceneManager::removeCamera(<font class="keyword">const</font> <a class="code" href="classOgre_1_1String.html">String</a>&amp; name)
00110     {
00111         <font class="comment">// Find in list</font>
00112         CameraList::iterator i = <a class="code" href="classOgre_1_1SceneManager.html#Ogre_1_1SceneManagern3">mCameras</a>.find(name);
00113         <font class="keywordflow">if</font> (i != <a class="code" href="classOgre_1_1SceneManager.html#Ogre_1_1SceneManagern3">mCameras</a>.end())
00114         {
00115             <font class="keyword">delete</font> i-&gt;second;
00116             <a class="code" href="classOgre_1_1SceneManager.html#Ogre_1_1SceneManagern3">mCameras</a>.erase(i);
00117         }
00118 
00119     }
00120 
00121     <font class="comment">//-----------------------------------------------------------------------</font>
<a name="l00122"></a><a class="code" href="classOgre_1_1SceneManager.html#Ogre_1_1SceneManagera6">00122</a>     <font class="keywordtype">void</font> SceneManager::removeAllCameras(<font class="keywordtype">void</font>)
00123     {
00124 
00125         CameraList::iterator i = <a class="code" href="classOgre_1_1SceneManager.html#Ogre_1_1SceneManagern3">mCameras</a>.begin();
00126         <font class="keywordflow">for</font> (; i != <a class="code" href="classOgre_1_1SceneManager.html#Ogre_1_1SceneManagern3">mCameras</a>.end(); ++i)
00127         {
00128             <font class="keyword">delete</font> i-&gt;second;
00129         }
00130         <a class="code" href="classOgre_1_1SceneManager.html#Ogre_1_1SceneManagern3">mCameras</a>.clear();
00131     }
00132 
00133     <font class="comment">//-----------------------------------------------------------------------</font>
<a name="l00134"></a><a class="code" href="classOgre_1_1SceneManager.html#Ogre_1_1SceneManagera7">00134</a>     <a class="code" href="classOgre_1_1Light.html">Light</a>* SceneManager::createLight(<font class="keyword">const</font> <a class="code" href="classOgre_1_1String.html">String</a>&amp; name)
00135     {
00136         <a class="code" href="classOgre_1_1Light.html">Light</a> *l = <font class="keyword">new</font> <a class="code" href="classOgre_1_1Light.html">Light</a>(name);
00137         <a class="code" href="classOgre_1_1SceneManager.html#Ogre_1_1SceneManagern4">mLights</a>.insert(LightList::value_type(name, l));
00138         <font class="comment">// Add light to render system</font>
00139         <a class="code" href="classOgre_1_1SceneManager.html#Ogre_1_1SceneManagern2">mDestRenderSystem</a>-&gt;<a class="code" href="classOgre_1_1RenderSystem.html#Ogre_1_1RenderSystema23">_addLight</a>(l);
00140         <font class="keywordflow">return</font> l;
00141     }
00142 
00143     <font class="comment">//-----------------------------------------------------------------------</font>
<a name="l00144"></a><a class="code" href="classOgre_1_1SceneManager.html#Ogre_1_1SceneManagera8">00144</a>     <a class="code" href="classOgre_1_1Light.html">Light</a>* SceneManager::getLight(<font class="keyword">const</font> <a class="code" href="classOgre_1_1String.html">String</a>&amp; name)
00145     {
00146         LightList::iterator i = <a class="code" href="classOgre_1_1SceneManager.html#Ogre_1_1SceneManagern4">mLights</a>.find(name);
00147         <font class="keywordflow">if</font> (i == <a class="code" href="classOgre_1_1SceneManager.html#Ogre_1_1SceneManagern4">mLights</a>.end())
00148         {
00149             <font class="keywordflow">return</font> 0;
00150         }
00151         <font class="keywordflow">else</font>
00152         {
00153             <font class="keywordflow">return</font> i-&gt;second;
00154         }
00155     }
00156 
00157     <font class="comment">//-----------------------------------------------------------------------</font>
<a name="l00158"></a><a class="code" href="classOgre_1_1SceneManager.html#Ogre_1_1SceneManagera10">00158</a>     <font class="keywordtype">void</font> SceneManager::removeLight(<a class="code" href="classOgre_1_1Light.html">Light</a> *l)
00159     {
00160         <font class="comment">// Find in list</font>
00161         LightList::iterator i = <a class="code" href="classOgre_1_1SceneManager.html#Ogre_1_1SceneManagern4">mLights</a>.begin();
00162         <font class="keywordflow">for</font> (; i != <a class="code" href="classOgre_1_1SceneManager.html#Ogre_1_1SceneManagern4">mLights</a>.end(); ++i)
00163         {
00164             <font class="keywordflow">if</font> (i-&gt;second == l)
00165             {
00166                 <a class="code" href="classOgre_1_1SceneManager.html#Ogre_1_1SceneManagern4">mLights</a>.erase(i);
00167                 <a class="code" href="classOgre_1_1SceneManager.html#Ogre_1_1SceneManagern2">mDestRenderSystem</a>-&gt;<a class="code" href="classOgre_1_1RenderSystem.html#Ogre_1_1RenderSystema24">_removeLight</a>(l);
00168                 <font class="keyword">delete</font> l;
00169                 <font class="keywordflow">break</font>;
00170             }
00171         }
00172 
00173     }
00174 
00175     <font class="comment">//-----------------------------------------------------------------------</font>
<a name="l00176"></a><a class="code" href="classOgre_1_1SceneManager.html#Ogre_1_1SceneManagera9">00176</a>     <font class="keywordtype">void</font> SceneManager::removeLight(<font class="keyword">const</font> <a class="code" href="classOgre_1_1String.html">String</a>&amp; name)
00177     {
00178         <font class="comment">// Find in list</font>
00179         LightList::iterator i = <a class="code" href="classOgre_1_1SceneManager.html#Ogre_1_1SceneManagern4">mLights</a>.find(name);
00180         <font class="keywordflow">if</font> (i != <a class="code" href="classOgre_1_1SceneManager.html#Ogre_1_1SceneManagern4">mLights</a>.end())
00181         {
00182             <font class="keyword">delete</font> i-&gt;second;
00183             <a class="code" href="classOgre_1_1SceneManager.html#Ogre_1_1SceneManagern2">mDestRenderSystem</a>-&gt;<a class="code" href="classOgre_1_1RenderSystem.html#Ogre_1_1RenderSystema24">_removeLight</a>(i-&gt;second);
00184             <a class="code" href="classOgre_1_1SceneManager.html#Ogre_1_1SceneManagern4">mLights</a>.erase(i);
00185         }
00186 
00187     }
00188 
00189     <font class="comment">//-----------------------------------------------------------------------</font>
<a name="l00190"></a><a class="code" href="classOgre_1_1SceneManager.html#Ogre_1_1SceneManagera11">00190</a>     <font class="keywordtype">void</font> SceneManager::removeAllLights(<font class="keywordtype">void</font>)
00191     {
00192 
00193         LightList::iterator i = <a class="code" href="classOgre_1_1SceneManager.html#Ogre_1_1SceneManagern4">mLights</a>.begin();
00194         <font class="keywordflow">for</font> (; i != <a class="code" href="classOgre_1_1SceneManager.html#Ogre_1_1SceneManagern4">mLights</a>.end(); ++i)
00195         {
00196             <font class="keyword">delete</font> i-&gt;second;
00197         }
00198         <a class="code" href="classOgre_1_1SceneManager.html#Ogre_1_1SceneManagern2">mDestRenderSystem</a>-&gt;<a class="code" href="classOgre_1_1RenderSystem.html#Ogre_1_1RenderSystema26">_removeAllLights</a>();
00199         <a class="code" href="classOgre_1_1SceneManager.html#Ogre_1_1SceneManagern4">mLights</a>.clear();
00200     }
00201     <font class="comment">//-----------------------------------------------------------------------</font>
<a name="l00202"></a><a class="code" href="classOgre_1_1SceneManager.html#Ogre_1_1SceneManagera22">00202</a>     <a class="code" href="classOgre_1_1Entity.html">Entity</a>* SceneManager::createEntity(<font class="keyword">const</font> <a class="code" href="classOgre_1_1String.html">String</a>&amp; entityName, PrefabType ptype)
00203     {
00204         <font class="keywordflow">switch</font> (ptype)
00205         {
00206         <font class="keywordflow">case</font> <a class="code" href="classOgre_1_1SceneManager.html#Ogre_1_1SceneManagers1Ogre_1_1SceneManagers0">PT_PLANE</a>:
00207             <font class="keywordflow">return</font> <a class="code" href="classOgre_1_1SceneManager.html#Ogre_1_1SceneManagera21">createEntity</a>(entityName, <font class="stringliteral">"Prefab_Plane"</font>);
00208 
00209             <font class="keywordflow">break</font>;
00210         }
00211 
00212         <font class="keywordflow">return</font> 0;
00213     }
00214 
00215     <font class="comment">//-----------------------------------------------------------------------</font>
<a name="l00216"></a><a class="code" href="classOgre_1_1SceneManager.html#Ogre_1_1SceneManagera21">00216</a>     <a class="code" href="classOgre_1_1Entity.html">Entity</a>* SceneManager::createEntity(
00217         <font class="keyword">const</font> <a class="code" href="classOgre_1_1String.html">String</a>&amp; entityName,
00218         <font class="keyword">const</font> <a class="code" href="classOgre_1_1String.html">String</a>&amp; meshName )
00219     {
00220         <font class="comment">// Check name not used</font>
00221         EntityList::iterator it = <a class="code" href="classOgre_1_1SceneManager.html#Ogre_1_1SceneManagern5">mEntities</a>.find( entityName );
00222         <font class="keywordflow">if</font>( it != <a class="code" href="classOgre_1_1SceneManager.html#Ogre_1_1SceneManagern5">mEntities</a>.end() )
00223         {
00224             <a class="code" href="OgreException_8h.html#a0">Except</a>(
00225                 Exception::ERR_DUPLICATE_ITEM,
00226                 <font class="stringliteral">"An entity with the name "</font> + entityName + <font class="stringliteral">"already exists"</font>,
00227                 <font class="stringliteral">"SceneManager::createEntity"</font> );
00228         }
00229 
00230         <font class="comment">// Get mesh (load if required)</font>
00231         <a class="code" href="classOgre_1_1Mesh.html">Mesh</a>* pMesh = MeshManager::getSingleton().load( meshName );
00232 
00233         <font class="comment">// Create entity</font>
00234         <a class="code" href="classOgre_1_1Entity.html">Entity</a>* e = <font class="keyword">new</font> <a class="code" href="classOgre_1_1Entity.html">Entity</a>( entityName, pMesh, <font class="keyword">this</font> );
00235 
00236         <font class="comment">// Add to internal list</font>
00237         <a class="code" href="classOgre_1_1SceneManager.html#Ogre_1_1SceneManagern5">mEntities</a>[entityName] = e; <font class="comment">//.insert(EntityList::value_type(entityName, e));</font>
00238 
00239         <font class="keywordflow">return</font> e;
00240     }
00241 
00242     <font class="comment">//-----------------------------------------------------------------------</font>
<a name="l00243"></a><a class="code" href="classOgre_1_1SceneManager.html#Ogre_1_1SceneManagera23">00243</a>     <a class="code" href="classOgre_1_1Entity.html">Entity</a>* SceneManager::getEntity(<font class="keyword">const</font> <a class="code" href="classOgre_1_1String.html">String</a>&amp; name)
00244     {
00245         EntityList::iterator i = <a class="code" href="classOgre_1_1SceneManager.html#Ogre_1_1SceneManagern5">mEntities</a>.find(name);
00246         <font class="keywordflow">if</font> (i == <a class="code" href="classOgre_1_1SceneManager.html#Ogre_1_1SceneManagern5">mEntities</a>.end())
00247         {
00248             <font class="keywordflow">return</font> 0;
00249         }
00250         <font class="keywordflow">else</font>
00251         {
00252             <font class="keywordflow">return</font> i-&gt;second;
00253         }
00254     }
00255 
00256     <font class="comment">//-----------------------------------------------------------------------</font>
<a name="l00257"></a><a class="code" href="classOgre_1_1SceneManager.html#Ogre_1_1SceneManagera24">00257</a>     <font class="keywordtype">void</font> SceneManager::removeEntity(<a class="code" href="classOgre_1_1Entity.html">Entity</a> *cam)
00258     {
00259         <font class="comment">// Find in list</font>
00260         EntityList::iterator i = <a class="code" href="classOgre_1_1SceneManager.html#Ogre_1_1SceneManagern5">mEntities</a>.begin();
00261         <font class="keywordflow">for</font> (; i != <a class="code" href="classOgre_1_1SceneManager.html#Ogre_1_1SceneManagern5">mEntities</a>.end(); ++i)
00262         {
00263             <font class="keywordflow">if</font> (i-&gt;second == cam)
00264             {
00265                 <a class="code" href="classOgre_1_1SceneManager.html#Ogre_1_1SceneManagern5">mEntities</a>.erase(i);
00266                 <font class="keyword">delete</font> cam;
00267                 <font class="keywordflow">break</font>;
00268             }
00269         }
00270 
00271     }
00272 
00273     <font class="comment">//-----------------------------------------------------------------------</font>
<a name="l00274"></a><a class="code" href="classOgre_1_1SceneManager.html#Ogre_1_1SceneManagera25">00274</a>     <font class="keywordtype">void</font> SceneManager::removeEntity(<font class="keyword">const</font> <a class="code" href="classOgre_1_1String.html">String</a>&amp; name)
00275     {
00276         <font class="comment">// Find in list</font>
00277         EntityList::iterator i = <a class="code" href="classOgre_1_1SceneManager.html#Ogre_1_1SceneManagern5">mEntities</a>.find(name);
00278         <font class="keywordflow">if</font> (i != <a class="code" href="classOgre_1_1SceneManager.html#Ogre_1_1SceneManagern5">mEntities</a>.end())
00279         {
00280             <font class="keyword">delete</font> i-&gt;second;
00281             <a class="code" href="classOgre_1_1SceneManager.html#Ogre_1_1SceneManagern5">mEntities</a>.erase(i);
00282         }
00283 
00284     }
00285 
00286     <font class="comment">//-----------------------------------------------------------------------</font>
<a name="l00287"></a><a class="code" href="classOgre_1_1SceneManager.html#Ogre_1_1SceneManagera26">00287</a>     <font class="keywordtype">void</font> SceneManager::removeAllEntities(<font class="keywordtype">void</font>)
00288     {
00289 
00290         EntityList::iterator i = <a class="code" href="classOgre_1_1SceneManager.html#Ogre_1_1SceneManagern5">mEntities</a>.begin();
00291         <font class="keywordflow">for</font> (; i != <a class="code" href="classOgre_1_1SceneManager.html#Ogre_1_1SceneManagern5">mEntities</a>.end(); ++i)
00292         {
00293             <font class="keyword">delete</font> i-&gt;second;
00294         }
00295         <a class="code" href="classOgre_1_1SceneManager.html#Ogre_1_1SceneManagern5">mEntities</a>.clear();
00296     }
00297     <font class="comment">//-----------------------------------------------------------------------</font>
<a name="l00298"></a><a class="code" href="classOgre_1_1SceneManager.html#Ogre_1_1SceneManagera27">00298</a>     <font class="keywordtype">void</font> SceneManager::clearScene(<font class="keywordtype">void</font>)
00299     {
00300         <font class="comment">// Delete all SceneNodes, except root that is</font>
00301         <font class="keywordflow">for</font> (SceneNodeList::iterator i = <a class="code" href="classOgre_1_1SceneManager.html#Ogre_1_1SceneManagern7">mSceneNodes</a>.begin();
00302             i != <a class="code" href="classOgre_1_1SceneManager.html#Ogre_1_1SceneManagern7">mSceneNodes</a>.end(); ++i)
00303         {
00304             <font class="keyword">delete</font> i-&gt;second;
00305         }
00306         <a class="code" href="classOgre_1_1SceneManager.html#Ogre_1_1SceneManagern7">mSceneNodes</a>.clear();
00307 
00308         <font class="comment">// Clear root node of all children</font>
00309         <a class="code" href="classOgre_1_1SceneManager.html#Ogre_1_1SceneManagern9">mSceneRoot</a>-&gt;<a class="code" href="classOgre_1_1Node.html#Ogre_1_1SceneNodea46">removeAllChildren</a>();
00310         <a class="code" href="classOgre_1_1SceneManager.html#Ogre_1_1SceneManagern9">mSceneRoot</a>-&gt;<a class="code" href="classOgre_1_1SceneNode.html#Ogre_1_1SceneNodea12">detachAllObjects</a>();
00311 
00312         <font class="comment">// Delete all entities</font>
00313         <font class="keywordflow">for</font> (EntityList::iterator ei = <a class="code" href="classOgre_1_1SceneManager.html#Ogre_1_1SceneManagern5">mEntities</a>.begin();
00314             ei != <a class="code" href="classOgre_1_1SceneManager.html#Ogre_1_1SceneManagern5">mEntities</a>.end(); ++ei)
00315         {
00316             <font class="keyword">delete</font> ei-&gt;second;
00317         }
00318         <a class="code" href="classOgre_1_1SceneManager.html#Ogre_1_1SceneManagern5">mEntities</a>.clear();
00319 
00320         <font class="comment">// Delete all Cameras</font>
00321         <font class="keywordflow">for</font> (CameraList::iterator ci = <a class="code" href="classOgre_1_1SceneManager.html#Ogre_1_1SceneManagern3">mCameras</a>.begin();
00322             ci != <a class="code" href="classOgre_1_1SceneManager.html#Ogre_1_1SceneManagern3">mCameras</a>.end(); ++ci)
00323         {
00324             <font class="keyword">delete</font> ci-&gt;second;
00325         }
00326         <a class="code" href="classOgre_1_1SceneManager.html#Ogre_1_1SceneManagern3">mCameras</a>.clear();
00327 
00328         <font class="comment">// Delete all BillboardSets</font>
00329         <font class="keywordflow">for</font> (BillboardSetList::iterator bi = <a class="code" href="classOgre_1_1SceneManager.html#Ogre_1_1SceneManagern6">mBillboardSets</a>.begin();
00330             bi != <a class="code" href="classOgre_1_1SceneManager.html#Ogre_1_1SceneManagern6">mBillboardSets</a>.end(); ++bi)
00331         {
00332             <font class="keyword">delete</font> bi-&gt;second;
00333         }
00334         <a class="code" href="classOgre_1_1SceneManager.html#Ogre_1_1SceneManagern6">mBillboardSets</a>.clear();
00335         <font class="comment">// Clear lights</font>
00336         <font class="comment">//removeAllLights();</font>
00337 
00338 
00339 
00340     }
00341 
00342     <font class="comment">//-----------------------------------------------------------------------</font>
<a name="l00343"></a><a class="code" href="classOgre_1_1SceneManager.html#Ogre_1_1SceneManagera12">00343</a>     <a class="code" href="classOgre_1_1Material.html">Material</a>* SceneManager::createMaterial(<font class="keyword">const</font> <a class="code" href="classOgre_1_1String.html">String</a>&amp; name)
00344     {
00345         <font class="comment">// Create using MaterialManager</font>
00346         <a class="code" href="classOgre_1_1Material.html">Material</a>* m = (<a class="code" href="classOgre_1_1Material.html">Material</a>*)MaterialManager::getSingleton().create(name);
00347 
00348 
00349         <font class="keywordflow">return</font> m;
00350     }
00351     <font class="comment">//-----------------------------------------------------------------------</font>
<a name="l00352"></a><a class="code" href="classOgre_1_1SceneManager.html#Ogre_1_1SceneManagera13">00352</a>     <a class="code" href="classOgre_1_1Material.html">Material</a>* SceneManager::getDefaultMaterialSettings(<font class="keywordtype">void</font>)
00353     {
00354         <font class="keywordflow">return</font> Material::mDefaultSettings;
00355     }
00356     <font class="comment">//-----------------------------------------------------------------------</font>
<a name="l00357"></a><a class="code" href="classOgre_1_1SceneManager.html#Ogre_1_1SceneManagera14">00357</a>     <font class="keywordtype">void</font> SceneManager::addMaterial(<font class="keyword">const</font> <a class="code" href="classOgre_1_1Material.html">Material</a>&amp; mat)
00358     {
00359         <font class="comment">// Add using MaterialManager</font>
00360         <font class="comment">/* Material* newMat = */</font> MaterialManager::getSingleton().add(mat);
00361     }
00362 
00363     <font class="comment">//-----------------------------------------------------------------------</font>
<a name="l00364"></a><a class="code" href="classOgre_1_1SceneManager.html#Ogre_1_1SceneManagera15">00364</a>     <a class="code" href="classOgre_1_1Material.html">Material</a>* SceneManager::getMaterial(<font class="keyword">const</font> <a class="code" href="classOgre_1_1String.html">String</a>&amp; name)
00365     {
00366         <font class="keywordflow">return</font> (<a class="code" href="classOgre_1_1Material.html">Material</a>*)MaterialManager::getSingleton().getByName(name);
00367     }
00368 
00369     <font class="comment">//-----------------------------------------------------------------------</font>
<a name="l00370"></a><a class="code" href="classOgre_1_1SceneManager.html#Ogre_1_1SceneManagera16">00370</a>     <a class="code" href="classOgre_1_1Material.html">Material</a>* SceneManager::getMaterial(<font class="keywordtype">int</font> handle)
00371     {
00372         <font class="keywordflow">return</font> MaterialManager::getSingleton().getByHandle(handle);
00373     }
00374     <font class="comment">//-----------------------------------------------------------------------</font>
<a name="l00375"></a><a class="code" href="classOgre_1_1SceneManager.html#Ogre_1_1SceneManagera17">00375</a>     <a class="code" href="classOgre_1_1SceneNode.html">SceneNode</a>* SceneManager::createSceneNode(<font class="keywordtype">void</font>)
00376     {
00377         <a class="code" href="classOgre_1_1SceneNode.html">SceneNode</a>* sn = <font class="keyword">new</font> <a class="code" href="classOgre_1_1SceneNode.html">SceneNode</a>(<font class="keyword">this</font>);
00378         <a class="code" href="classOgre_1_1SceneManager.html#Ogre_1_1SceneManagern7">mSceneNodes</a>[sn-&gt;<a class="code" href="classOgre_1_1Node.html#Ogre_1_1SceneNodea18">getName</a>()] = sn;
00379         <font class="keywordflow">return</font> sn;
00380     }
00381     <font class="comment">//-----------------------------------------------------------------------</font>
<a name="l00382"></a><a class="code" href="classOgre_1_1SceneManager.html#Ogre_1_1SceneManagera18">00382</a>     <a class="code" href="classOgre_1_1SceneNode.html">SceneNode</a>* SceneManager::createSceneNode(<font class="keyword">const</font> <a class="code" href="classOgre_1_1String.html">String</a>&amp; name)
00383     {
00384         <a class="code" href="classOgre_1_1SceneNode.html">SceneNode</a>* sn = <font class="keyword">new</font> <a class="code" href="classOgre_1_1SceneNode.html">SceneNode</a>(<font class="keyword">this</font>, name);
00385         <a class="code" href="classOgre_1_1SceneManager.html#Ogre_1_1SceneManagern7">mSceneNodes</a>[sn-&gt;<a class="code" href="classOgre_1_1Node.html#Ogre_1_1SceneNodea18">getName</a>()] = sn;
00386         <font class="keywordflow">return</font> sn;
00387     }
00388     <font class="comment">//-----------------------------------------------------------------------</font>
<a name="l00389"></a><a class="code" href="classOgre_1_1SceneManager.html#Ogre_1_1SceneManagera19">00389</a>     <a class="code" href="classOgre_1_1SceneNode.html">SceneNode</a>* SceneManager::getRootSceneNode(<font class="keywordtype">void</font>)<font class="keyword"> const</font>
00390 <font class="keyword">    </font>{
00391         <font class="keywordflow">return</font> <a class="code" href="classOgre_1_1SceneManager.html#Ogre_1_1SceneManagern9">mSceneRoot</a>;
00392     }
00393     <font class="comment">//-----------------------------------------------------------------------</font>
<a name="l00394"></a><a class="code" href="classOgre_1_1SceneManager.html#Ogre_1_1SceneManagera20">00394</a>     <a class="code" href="classOgre_1_1SceneNode.html">SceneNode</a>* SceneManager::getSceneNode(<font class="keyword">const</font> <a class="code" href="classOgre_1_1String.html">String</a>&amp; name)<font class="keyword"> const</font>
00395 <font class="keyword">    </font>{
00396         SceneNodeList::const_iterator i = <a class="code" href="classOgre_1_1SceneManager.html#Ogre_1_1SceneManagern7">mSceneNodes</a>.find(name);
00397 
00398         <font class="keywordflow">if</font> (i == <a class="code" href="classOgre_1_1SceneManager.html#Ogre_1_1SceneManagern7">mSceneNodes</a>.end())
00399         {
00400             <a class="code" href="OgreException_8h.html#a0">Except</a>(Exception::ERR_ITEM_NOT_FOUND, <font class="stringliteral">"SceneNode '"</font> + name + <font class="stringliteral">"' not found."</font>,
00401                 <font class="stringliteral">"SceneManager::getSceneNode"</font>);
00402         }
00403 
00404         <font class="keywordflow">return</font> i-&gt;second;
00405         
00406     }
00407     <font class="comment">//-----------------------------------------------------------------------</font>
<a name="l00408"></a><a class="code" href="classOgre_1_1SceneManager.html#Ogre_1_1SceneManagerb0">00408</a>     <font class="keywordtype">int</font> SceneManager::setMaterial(<a class="code" href="classOgre_1_1Material.html">Material</a>* mat, <font class="keywordtype">int</font> numLayersLeft)
00409     {
00410         <font class="keyword">static</font> <font class="keywordtype">bool</font> <a class="code" href="namespaceOgre.html#a347">firstTime</a> = <font class="keyword">true</font>;
00411         <font class="keyword">static</font> <font class="keywordtype">bool</font> lastUsedFallback = <font class="keyword">false</font>;
00412         <font class="keyword">static</font> <font class="keywordtype">int</font> lastNumTexUnitsUsed = 0;
00413         <font class="keyword">static</font> <a class="code" href="classOgre_1_1Material.html">Material</a> lastMat; <font class="comment">// Last material settings, to minimise render state changes</font>
00414 
00415         <font class="comment">// Recent changes: eliminated the need to copy all material settings to set with RenderSystem</font>
00416         <font class="comment">// Now only issues required render state changes to the render system for maximum performance</font>
00417 
00418         <font class="comment">// Set surface properties</font>
00419         <font class="keywordflow">if</font> (<a class="code" href="namespaceOgre.html#a347">firstTime</a> || mat-&gt;<a class="code" href="classOgre_1_1Material.html#Ogre_1_1Materiala54">_compareSurfaceParams</a>(lastMat) == <font class="keyword">false</font>)
00420         {
00421            <a class="code" href="classOgre_1_1ColourValue.html">ColourValue</a> a, b, c, d;
00422            a = mat-&gt;<a class="code" href="classOgre_1_1Material.html#Ogre_1_1Materiala14">getAmbient</a>();
00423            b = mat-&gt;<a class="code" href="classOgre_1_1Material.html#Ogre_1_1Materiala15">getDiffuse</a>();
00424            c = mat-&gt;<a class="code" href="classOgre_1_1Material.html#Ogre_1_1Materiala16">getSpecular</a>();
00425            d = mat-&gt;<a class="code" href="classOgre_1_1Material.html#Ogre_1_1Materiala17">getSelfIllumination</a>();
00426             <a class="code" href="classOgre_1_1SceneManager.html#Ogre_1_1SceneManagern2">mDestRenderSystem</a>-&gt;<a class="code" href="classOgre_1_1RenderSystem.html#Ogre_1_1RenderSystema35">_setSurfaceParams</a>( a, b, c, d, mat-&gt;<a class="code" href="classOgre_1_1Material.html#Ogre_1_1Materiala18">getShininess</a>() );
00427         }
00428 
00429         <font class="comment">// Set global blending, play it safe if last one was fallback</font>
00430         <font class="keywordflow">if</font> (<a class="code" href="namespaceOgre.html#a347">firstTime</a> || lastUsedFallback ||
00431         (lastMat.<a class="code" href="classOgre_1_1Material.html#Ogre_1_1Materiala26">getSourceBlendFactor</a>() != mat-&gt;<a class="code" href="classOgre_1_1Material.html#Ogre_1_1Materiala26">getSourceBlendFactor</a>() ||
00432          lastMat.<a class="code" href="classOgre_1_1Material.html#Ogre_1_1Materiala27">getDestBlendFactor</a>() != mat-&gt;<a class="code" href="classOgre_1_1Material.html#Ogre_1_1Materiala27">getDestBlendFactor</a>()))
00433         {
00434             <a class="code" href="classOgre_1_1SceneManager.html#Ogre_1_1SceneManagern2">mDestRenderSystem</a>-&gt;<a class="code" href="classOgre_1_1RenderSystem.html#Ogre_1_1RenderSystema43">_setSceneBlending</a>(mat-&gt;<a class="code" href="classOgre_1_1Material.html#Ogre_1_1Materiala26">getSourceBlendFactor</a>(), mat-&gt;<a class="code" href="classOgre_1_1Material.html#Ogre_1_1Materiala27">getDestBlendFactor</a>());
00435         }
00436 
00437         <font class="comment">// Fog</font>
00438         <font class="comment">// New fog params can either be from scene or from material</font>
00439         <a class="code" href="namespaceOgre.html#a429">FogMode</a> newFogMode;
00440         <a class="code" href="classOgre_1_1ColourValue.html">ColourValue</a> newFogColour;
00441         <a class="code" href="namespaceOgre.html#a281">Real</a> newFogStart, newFogEnd, newFogDensity;
00442         <font class="keyword">static</font> <a class="code" href="namespaceOgre.html#a429">FogMode</a> oldFogMode;
00443         <font class="keyword">static</font> <a class="code" href="classOgre_1_1ColourValue.html">ColourValue</a> oldFogColour;
00444         <font class="keyword">static</font> <a class="code" href="namespaceOgre.html#a281">Real</a> oldFogStart, oldFogEnd, oldFogDensity;
00445         <font class="keywordflow">if</font> (mat-&gt;<a class="code" href="classOgre_1_1Material.html#Ogre_1_1Materiala46">getFogOverride</a>())
00446         {
00447             <font class="comment">// New fog params from material</font>
00448             newFogMode = mat-&gt;<a class="code" href="classOgre_1_1Material.html#Ogre_1_1Materiala47">getFogMode</a>();
00449             newFogColour = mat-&gt;<a class="code" href="classOgre_1_1Material.html#Ogre_1_1Materiala48">getFogColour</a>();
00450             newFogStart = mat-&gt;<a class="code" href="classOgre_1_1Material.html#Ogre_1_1Materiala49">getFogStart</a>();
00451             newFogEnd = mat-&gt;<a class="code" href="classOgre_1_1Material.html#Ogre_1_1Materiala50">getFogEnd</a>();
00452             newFogDensity = mat-&gt;<a class="code" href="classOgre_1_1Material.html#Ogre_1_1Materiala51">getFogDensity</a>();
00453         }
00454         <font class="keywordflow">else</font>
00455         {
00456             <font class="comment">// New fog params from scene</font>
00457             newFogMode = <a class="code" href="classOgre_1_1SceneManager.html#Ogre_1_1SceneManagern24">mFogMode</a>;
00458             newFogColour = <a class="code" href="classOgre_1_1SceneManager.html#Ogre_1_1SceneManagern25">mFogColour</a>;
00459             newFogStart = <a class="code" href="classOgre_1_1SceneManager.html#Ogre_1_1SceneManagern26">mFogStart</a>;
00460             newFogEnd = <a class="code" href="classOgre_1_1SceneManager.html#Ogre_1_1SceneManagern27">mFogEnd</a>;
00461             newFogDensity = <a class="code" href="classOgre_1_1SceneManager.html#Ogre_1_1SceneManagern28">mFogDensity</a>;
00462         }
00463         <font class="keywordflow">if</font> (<a class="code" href="namespaceOgre.html#a347">firstTime</a> || newFogMode != oldFogMode || newFogColour != oldFogColour ||
00464             newFogStart != oldFogStart || newFogEnd != oldFogEnd ||
00465             newFogDensity != oldFogDensity)
00466         {
00467             <a class="code" href="classOgre_1_1SceneManager.html#Ogre_1_1SceneManagern2">mDestRenderSystem</a>-&gt;<a class="code" href="classOgre_1_1RenderSystem.html#Ogre_1_1RenderSystema56">_setFog</a>(newFogMode, newFogColour, newFogDensity, newFogStart, newFogEnd);
00468             oldFogMode = newFogMode;
00469             oldFogColour = newFogColour;
00470             oldFogStart = newFogStart;
00471             oldFogEnd = newFogEnd;
00472             oldFogDensity = newFogDensity;
00473         }
00474 
00475 
00476 
00477         <font class="comment">// Texture layers</font>
00478         <font class="keywordtype">int</font> texLayer = mat-&gt;<a class="code" href="classOgre_1_1Material.html#Ogre_1_1Materiala23">getNumTextureLayers</a>() - numLayersLeft;
00479         <font class="keywordtype">int</font> thisUnitsRequested = numLayersLeft;
00480         <font class="keywordtype">int</font> texUnits = <a class="code" href="classOgre_1_1SceneManager.html#Ogre_1_1SceneManagern2">mDestRenderSystem</a>-&gt;<a class="code" href="classOgre_1_1RenderSystem.html#Ogre_1_1RenderSystema37">_getNumTextureUnits</a>();
00481 
00482 <font class="preprocessor">#if OGRE_TEST_MULTIPASS == 1</font>
00483 <font class="preprocessor"></font>        texUnits = 1;
00484 <font class="preprocessor">#endif</font>
00485 <font class="preprocessor"></font>
00486         <font class="comment">// Iterate over texture units, set them up to the higher of the last texturing units used and the current to be used</font>
00487         <font class="comment">//   but no higher than the number of units</font>
00488         lastUsedFallback = <font class="keyword">false</font>;
00489        <font class="keywordtype">int</font> unit;
00490         <font class="keywordflow">for</font> (unit = 0;
00491             (unit &lt; lastNumTexUnitsUsed || unit &lt; thisUnitsRequested) &amp;&amp; unit &lt; texUnits;
00492             ++unit, ++texLayer)
00493         {
00494             <font class="keywordflow">if</font> (unit &gt;= thisUnitsRequested)
00495             {
00496                 <font class="comment">// We've run out of texture layers before we ran out of units to set</font>
00497                 <font class="comment">// Turn off the texturing for this unit</font>
00498                 <a class="code" href="classOgre_1_1SceneManager.html#Ogre_1_1SceneManagern2">mDestRenderSystem</a>-&gt;<a class="code" href="classOgre_1_1RenderSystem.html#Ogre_1_1SDLRenderSystema55">_disableTextureUnit</a>(unit);
00499             }
00500             <font class="keywordflow">else</font>
00501             {
00502                 <a class="code" href="classOgre_1_1Material_1_1TextureLayer.html">Material::TextureLayer</a>* pTex = mat-&gt;<a class="code" href="classOgre_1_1Material.html#Ogre_1_1Materiala20">getTextureLayer</a>(texLayer);
00503                 <font class="comment">// We still have texture layers to put in this unit</font>
00504                 <font class="keywordflow">if</font> (unit == 0 &amp;&amp; thisUnitsRequested &gt; 0 &amp;&amp; thisUnitsRequested &lt; mat-&gt;<a class="code" href="classOgre_1_1Material.html#Ogre_1_1Materiala23">getNumTextureLayers</a>())
00505                 {
00506                     <font class="comment">// We're on the second (or more) leg of a multipass render</font>
00507                     <font class="comment">//  because remaining layers is not the total number</font>
00508 
00509                     <font class="comment">// So we need to use the multipass fallback and override first texture layer blend</font>
00510                     lastUsedFallback = <font class="keyword">true</font>;
00511 
00512                     <font class="comment">// Copy texture layer info and set custom blending</font>
00513                     <a class="code" href="classOgre_1_1Material_1_1TextureLayer.html">Material::TextureLayer</a> newTex = *pTex;
00514 
00515                     <font class="comment">// Set multitexture blend to NO blend (avoids any modulation with material colour)</font>
00516                     newTex.<a class="code" href="classOgre_1_1Material_1_1TextureLayer.html#Ogre_1_1Material_1_1TextureLayera32">setColourOperation</a>(<a class="code" href="namespaceOgre.html#a418a15">LBO_REPLACE</a>);
00517                     <font class="comment">// Set scene blending to colour blending equivalent (fallback)</font>
00518                     <a class="code" href="classOgre_1_1SceneManager.html#Ogre_1_1SceneManagern2">mDestRenderSystem</a>-&gt;<a class="code" href="classOgre_1_1RenderSystem.html#Ogre_1_1RenderSystema43">_setSceneBlending</a>(pTex-&gt;<a class="code" href="classOgre_1_1Material_1_1TextureLayer.html#Ogre_1_1Material_1_1TextureLayera36">getColourBlendFallbackSrc</a>(), pTex-&gt;<a class="code" href="classOgre_1_1Material_1_1TextureLayer.html#Ogre_1_1Material_1_1TextureLayera37">getColourBlendFallbackDest</a>());
00519 
00520                     <font class="comment">// Set texture unit settings</font>
00521                     <font class="comment">// NB rendersystem will know to only change relevant settings</font>
00522                     <a class="code" href="classOgre_1_1SceneManager.html#Ogre_1_1SceneManagern2">mDestRenderSystem</a>-&gt;<a class="code" href="classOgre_1_1RenderSystem.html#Ogre_1_1SDLRenderSystema54">_setTextureUnitSettings</a>(unit, newTex);
00523                 }
00524                 <font class="keywordflow">else</font>
00525                 {
00526                     <font class="keywordflow">if</font> (lastUsedFallback)
00527                     {
00528                         <font class="comment">// Ensure that fallback alpha on bottom layer does not mask out alpha on this layer</font>
00529                         pTex-&gt;<a class="code" href="classOgre_1_1Material_1_1TextureLayer.html#Ogre_1_1Material_1_1TextureLayera38">setAlphaOperation</a>(<a class="code" href="namespaceOgre.html#a419a24">LBX_ADD</a>);
00530                     }
00531 
00532                     <font class="comment">// Standard issue</font>
00533                     <a class="code" href="classOgre_1_1SceneManager.html#Ogre_1_1SceneManagern2">mDestRenderSystem</a>-&gt;<a class="code" href="classOgre_1_1RenderSystem.html#Ogre_1_1SDLRenderSystema54">_setTextureUnitSettings</a>(unit, *pTex);
00534                 }
00535 
00536                 numLayersLeft--;
00537             }
00538         }
00539 
00540         <font class="comment">// Set up non-texture related material settings</font>
00541         <font class="comment">// Depth buffer settings</font>
00542         <font class="keywordflow">if</font> (<a class="code" href="namespaceOgre.html#a347">firstTime</a> || lastMat.<a class="code" href="classOgre_1_1Material.html#Ogre_1_1Materiala34">getDepthFunction</a>() != mat-&gt;<a class="code" href="classOgre_1_1Material.html#Ogre_1_1Materiala34">getDepthFunction</a>())
00543         {
00544             <a class="code" href="classOgre_1_1SceneManager.html#Ogre_1_1SceneManagern2">mDestRenderSystem</a>-&gt;<a class="code" href="classOgre_1_1RenderSystem.html#Ogre_1_1RenderSystema55">_setDepthBufferFunction</a>(mat-&gt;<a class="code" href="classOgre_1_1Material.html#Ogre_1_1Materiala34">getDepthFunction</a>());
00545         }
00546         <font class="keywordflow">if</font> (<a class="code" href="namespaceOgre.html#a347">firstTime</a> || lastMat.<a class="code" href="classOgre_1_1Material.html#Ogre_1_1Materiala30">getDepthCheckEnabled</a>() != mat-&gt;<a class="code" href="classOgre_1_1Material.html#Ogre_1_1Materiala30">getDepthCheckEnabled</a>())
00547         {
00548             <a class="code" href="classOgre_1_1SceneManager.html#Ogre_1_1SceneManagern2">mDestRenderSystem</a>-&gt;<a class="code" href="classOgre_1_1RenderSystem.html#Ogre_1_1RenderSystema53">_setDepthBufferCheckEnabled</a>(mat-&gt;<a class="code" href="classOgre_1_1Material.html#Ogre_1_1Materiala30">getDepthCheckEnabled</a>());
00549         }
00550         <font class="keywordflow">if</font> (<a class="code" href="namespaceOgre.html#a347">firstTime</a> || lastMat.<a class="code" href="classOgre_1_1Material.html#Ogre_1_1Materiala32">getDepthWriteEnabled</a>() != mat-&gt;<a class="code" href="classOgre_1_1Material.html#Ogre_1_1Materiala32">getDepthWriteEnabled</a>())
00551         {
00552             <a class="code" href="classOgre_1_1SceneManager.html#Ogre_1_1SceneManagern2">mDestRenderSystem</a>-&gt;<a class="code" href="classOgre_1_1RenderSystem.html#Ogre_1_1RenderSystema54">_setDepthBufferWriteEnabled</a>(mat-&gt;<a class="code" href="classOgre_1_1Material.html#Ogre_1_1Materiala32">getDepthWriteEnabled</a>());
00553         }
00554         <font class="comment">// Culling mode</font>
00555         <font class="keywordflow">if</font> (<a class="code" href="namespaceOgre.html#a347">firstTime</a> || lastMat.<a class="code" href="classOgre_1_1Material.html#Ogre_1_1Materiala36">getCullingMode</a>() != mat-&gt;<a class="code" href="classOgre_1_1Material.html#Ogre_1_1Materiala36">getCullingMode</a>())
00556         {
00557             <a class="code" href="classOgre_1_1SceneManager.html#Ogre_1_1SceneManagern2">mDestRenderSystem</a>-&gt;<a class="code" href="classOgre_1_1RenderSystem.html#Ogre_1_1RenderSystema50">_setCullingMode</a>(mat-&gt;<a class="code" href="classOgre_1_1Material.html#Ogre_1_1Materiala36">getCullingMode</a>());
00558 
00559         }
00560         <font class="comment">// Dynamic lighting enabled</font>
00561         <font class="keywordflow">if</font> (<a class="code" href="namespaceOgre.html#a347">firstTime</a> || lastMat.<a class="code" href="classOgre_1_1Material.html#Ogre_1_1Materiala40">getLightingEnabled</a>() != mat-&gt;<a class="code" href="classOgre_1_1Material.html#Ogre_1_1Materiala40">getLightingEnabled</a>())
00562         {
00563             <a class="code" href="classOgre_1_1SceneManager.html#Ogre_1_1SceneManagern2">mDestRenderSystem</a>-&gt;<a class="code" href="classOgre_1_1RenderSystem.html#Ogre_1_1RenderSystema15">setLightingEnabled</a>(mat-&gt;<a class="code" href="classOgre_1_1Material.html#Ogre_1_1Materiala40">getLightingEnabled</a>());
00564         }
00565         <font class="comment">// Shading</font>
00566         <font class="keywordflow">if</font> (<a class="code" href="namespaceOgre.html#a347">firstTime</a> || lastMat.<a class="code" href="classOgre_1_1Material.html#Ogre_1_1Materiala42">getShadingMode</a>() != mat-&gt;<a class="code" href="classOgre_1_1Material.html#Ogre_1_1Materiala42">getShadingMode</a>())
00567         {
00568             <a class="code" href="classOgre_1_1SceneManager.html#Ogre_1_1SceneManagern2">mDestRenderSystem</a>-&gt;<a class="code" href="classOgre_1_1RenderSystem.html#Ogre_1_1RenderSystema13">setShadingType</a>(mat-&gt;<a class="code" href="classOgre_1_1Material.html#Ogre_1_1Materiala42">getShadingMode</a>());
00569         }
00570         <font class="comment">// Texture filtering</font>
00571         <font class="keywordflow">if</font> (<a class="code" href="namespaceOgre.html#a347">firstTime</a> || lastMat.<a class="code" href="classOgre_1_1Material.html#Ogre_1_1Materiala44">getTextureFiltering</a>() != mat-&gt;<a class="code" href="classOgre_1_1Material.html#Ogre_1_1Materiala44">getTextureFiltering</a>())
00572         {
00573             <a class="code" href="classOgre_1_1SceneManager.html#Ogre_1_1SceneManagern2">mDestRenderSystem</a>-&gt;<a class="code" href="classOgre_1_1RenderSystem.html#Ogre_1_1RenderSystema14">setTextureFiltering</a>(mat-&gt;<a class="code" href="classOgre_1_1Material.html#Ogre_1_1Materiala44">getTextureFiltering</a>());
00574         }
00575 
00576 
00577         <a class="code" href="namespaceOgre.html#a347">firstTime</a> = <font class="keyword">false</font>;
00578         <font class="comment">// Copy material settings from last render</font>
00579         lastMat = *mat;
00580         lastNumTexUnitsUsed = unit;
00581         <font class="keywordflow">return</font> numLayersLeft;
00582 
00583     }
00584     <font class="comment">//-----------------------------------------------------------------------</font>
<a name="l00585"></a><a class="code" href="classOgre_1_1SceneManager.html#Ogre_1_1SceneManagera40">00585</a>     <font class="keywordtype">void</font> SceneManager::_renderScene(<a class="code" href="classOgre_1_1Camera.html">Camera</a>* camera, <a class="code" href="classOgre_1_1Viewport.html">Viewport</a>* vp)
00586     {
00587         <a class="code" href="classOgre_1_1SceneManager.html#Ogre_1_1SceneManagern8">mCameraInProgress</a> = camera;
00588 
00589         <a class="code" href="classOgre_1_1SceneManager.html#Ogre_1_1SceneManagera37">_updateSceneGraph</a>(camera);
00590         <a class="code" href="classOgre_1_1SceneManager.html#Ogre_1_1SceneManagera45">_updateDynamicLights</a>();
00591         <a class="code" href="classOgre_1_1SceneManager.html#Ogre_1_1SceneManagera38">_findVisibleObjects</a>(camera);
00592 
00593 
00594         <font class="comment">// Set viewport, view and projection matrices</font>
00595         <a class="code" href="classOgre_1_1SceneManager.html#Ogre_1_1SceneManagern2">mDestRenderSystem</a>-&gt;<a class="code" href="classOgre_1_1RenderSystem.html#Ogre_1_1RenderSystema48">_setViewport</a>(vp);
00596         <a class="code" href="classOgre_1_1SceneManager.html#Ogre_1_1SceneManagern2">mDestRenderSystem</a>-&gt;<a class="code" href="classOgre_1_1RenderSystem.html#Ogre_1_1RenderSystema31">_setViewMatrix</a>(camera-&gt;<a class="code" href="classOgre_1_1Camera.html#Ogre_1_1Cameraa33">getViewMatrix</a>());
00597         <a class="code" href="classOgre_1_1SceneManager.html#Ogre_1_1SceneManagern2">mDestRenderSystem</a>-&gt;<a class="code" href="classOgre_1_1RenderSystem.html#Ogre_1_1RenderSystema32">_setProjectionMatrix</a>(camera-&gt;<a class="code" href="classOgre_1_1Camera.html#Ogre_1_1Cameraa32">getProjectionMatrix</a>());
00598 
00599         <a class="code" href="classOgre_1_1SceneManager.html#Ogre_1_1SceneManagern2">mDestRenderSystem</a>-&gt;<a class="code" href="classOgre_1_1RenderSystem.html#Ogre_1_1SDLRenderSystema58">_beginGeometryCount</a>();
00600         <font class="comment">// Begin the frame</font>
00601         <a class="code" href="classOgre_1_1SceneManager.html#Ogre_1_1SceneManagern2">mDestRenderSystem</a>-&gt;<a class="code" href="classOgre_1_1RenderSystem.html#Ogre_1_1RenderSystema45">_beginFrame</a>();
00602 
00603         <font class="comment">// Update controllers (after begineFrame since some are frameTime dependent)</font>
00604         ControllerManager::getSingleton().updateAllControllers();
00605 
00606         <font class="comment">// Render the sky (first)</font>
00607         <font class="keywordflow">if</font> (<a class="code" href="classOgre_1_1SceneManager.html#Ogre_1_1SceneManagern10">mSkyPlaneEnabled</a> &amp;&amp; <a class="code" href="classOgre_1_1SceneManager.html#Ogre_1_1SceneManagern11">mSkyPlaneDrawFirst</a>)
00608             <a class="code" href="classOgre_1_1SceneManager.html#Ogre_1_1SceneManagera41">_renderSkyPlane</a>(camera);
00609         <font class="keywordflow">if</font> (<a class="code" href="classOgre_1_1SceneManager.html#Ogre_1_1SceneManagern14">mSkyBoxEnabled</a> &amp;&amp; <a class="code" href="classOgre_1_1SceneManager.html#Ogre_1_1SceneManagern15">mSkyBoxDrawFirst</a>)
00610             <a class="code" href="classOgre_1_1SceneManager.html#Ogre_1_1SceneManagera42">_renderSkyBox</a>(camera);
00611         <font class="keywordflow">if</font> (<a class="code" href="classOgre_1_1SceneManager.html#Ogre_1_1SceneManagern19">mSkyDomeEnabled</a> &amp;&amp; <a class="code" href="classOgre_1_1SceneManager.html#Ogre_1_1SceneManagern20">mSkyDomeDrawFirst</a>)
00612             <a class="code" href="classOgre_1_1SceneManager.html#Ogre_1_1SceneManagera43">_renderSkyDome</a>(camera);
00613 
00614         <font class="comment">// Render scene content (only entities in this SceneManager, no world geometry)</font>
00615         <font class="comment">//_renderEntities();</font>
00616         <a class="code" href="classOgre_1_1SceneManager.html#Ogre_1_1SceneManagera39">_renderVisibleObjects</a>();
00617 
00618         <font class="comment">// Render the sky (last)</font>
00619         <font class="keywordflow">if</font> (<a class="code" href="classOgre_1_1SceneManager.html#Ogre_1_1SceneManagern10">mSkyPlaneEnabled</a> &amp;&amp; !<a class="code" href="classOgre_1_1SceneManager.html#Ogre_1_1SceneManagern11">mSkyPlaneDrawFirst</a>)
00620             <a class="code" href="classOgre_1_1SceneManager.html#Ogre_1_1SceneManagera41">_renderSkyPlane</a>(camera);
00621         <font class="keywordflow">if</font> (<a class="code" href="classOgre_1_1SceneManager.html#Ogre_1_1SceneManagern14">mSkyBoxEnabled</a> &amp;&amp; !<a class="code" href="classOgre_1_1SceneManager.html#Ogre_1_1SceneManagern15">mSkyBoxDrawFirst</a>)
00622             <a class="code" href="classOgre_1_1SceneManager.html#Ogre_1_1SceneManagera42">_renderSkyBox</a>(camera);
00623         <font class="keywordflow">if</font> (<a class="code" href="classOgre_1_1SceneManager.html#Ogre_1_1SceneManagern19">mSkyDomeEnabled</a> &amp;&amp; !<a class="code" href="classOgre_1_1SceneManager.html#Ogre_1_1SceneManagern20">mSkyDomeDrawFirst</a>)
00624             <a class="code" href="classOgre_1_1SceneManager.html#Ogre_1_1SceneManagera43">_renderSkyDome</a>(camera);
00625 
00626         <font class="comment">// End frame</font>
00627         <a class="code" href="classOgre_1_1SceneManager.html#Ogre_1_1SceneManagern2">mDestRenderSystem</a>-&gt;<a class="code" href="classOgre_1_1RenderSystem.html#Ogre_1_1RenderSystema47">_endFrame</a>();
00628 
00629         <font class="comment">// Notify camera or vis faces</font>
00630         camera-&gt;<a class="code" href="classOgre_1_1Camera.html#Ogre_1_1Cameraa41">_notifyRenderedFaces</a>(<a class="code" href="classOgre_1_1SceneManager.html#Ogre_1_1SceneManagern2">mDestRenderSystem</a>-&gt;<a class="code" href="classOgre_1_1RenderSystem.html#Ogre_1_1SDLRenderSystema59">_getFaceCount</a>());
00631 
00632 
00633 
00634     }
00635 
00636 
00637     <font class="comment">//-----------------------------------------------------------------------</font>
<a name="l00638"></a><a class="code" href="classOgre_1_1SceneManager.html#Ogre_1_1SceneManagera46">00638</a>     <font class="keywordtype">void</font> SceneManager::_setDestinationRenderSystem(<a class="code" href="classOgre_1_1RenderSystem.html">RenderSystem</a>* sys)
00639     {
00640         <a class="code" href="classOgre_1_1SceneManager.html#Ogre_1_1SceneManagern2">mDestRenderSystem</a> = sys;
00641     }
00642 
00643 
00644     <font class="comment">//-----------------------------------------------------------------------</font>
<a name="l00645"></a><a class="code" href="classOgre_1_1SceneManager.html#Ogre_1_1SceneManagera30">00645</a>     <font class="keywordtype">void</font> SceneManager::setWorldGeometry(<font class="keyword">const</font> <a class="code" href="classOgre_1_1String.html">String</a>&amp; filename)
00646     {
00647         <font class="comment">// This default implementation cannot handle world geometry</font>
00648         <a class="code" href="OgreException_8h.html#a0">Except</a>(Exception::ERR_INVALIDPARAMS,
00649             <font class="stringliteral">"World geometry is not supported by the generic SceneManager."</font>,
00650             <font class="stringliteral">"SceneManager::setWorldGeometry"</font>);
00651     }
00652 
00653     <font class="comment">//-----------------------------------------------------------------------</font>
<a name="l00654"></a><a class="code" href="structOgre_1_1SceneManager_1_1materialLess.html#Ogre_1_1SceneManager_1_1materialLessa0">00654</a>     <font class="keywordtype">bool</font> SceneManager::materialLess::operator() (<font class="keyword">const</font> <a class="code" href="classOgre_1_1Material.html">Material</a>* x, <font class="keyword">const</font> <a class="code" href="classOgre_1_1Material.html">Material</a>* y)<font class="keyword"> const</font>
00655 <font class="keyword">    </font>{
00656         <font class="comment">// If x transparent and y not, x &gt; y (since x has to overlap y)</font>
00657         <font class="keywordflow">if</font> (x-&gt;<a class="code" href="classOgre_1_1Material.html#Ogre_1_1Materiala28">isTransparent</a>() &amp;&amp; !y-&gt;<a class="code" href="classOgre_1_1Material.html#Ogre_1_1Materiala28">isTransparent</a>())
00658         {
00659             <font class="keywordflow">return</font> <font class="keyword">false</font>;
00660         }
00661         <font class="comment">// If y is transparent and x not, x &lt; y</font>
00662         <font class="keywordflow">else</font> <font class="keywordflow">if</font> (!x-&gt;<a class="code" href="classOgre_1_1Material.html#Ogre_1_1Materiala28">isTransparent</a>() &amp;&amp; y-&gt;<a class="code" href="classOgre_1_1Material.html#Ogre_1_1Materiala28">isTransparent</a>())
00663         {
00664             <font class="keywordflow">return</font> <font class="keyword">true</font>;
00665         }
00666         <font class="keywordflow">else</font>
00667         {
00668             <font class="comment">// Otherwise don't care (both transparent or both solid)</font>
00669             <font class="comment">// Just arbitrarily use pointer</font>
00670             <font class="keywordflow">return</font> x &lt; y;
00671         }
00672 
00673     }
00674 
00675     <font class="comment">//-----------------------------------------------------------------------</font>
<a name="l00676"></a><a class="code" href="classOgre_1_1SceneManager.html#Ogre_1_1SceneManagera47">00676</a>     <font class="keywordtype">void</font> SceneManager::setSkyPlane(
00677         <font class="keywordtype">bool</font> enable,
00678         <font class="keyword">const</font> <a class="code" href="classOgre_1_1Plane.html">Plane</a>&amp; plane,
00679         <font class="keyword">const</font> <a class="code" href="classOgre_1_1String.html">String</a>&amp; materialName,
00680         <a class="code" href="namespaceOgre.html#a281">Real</a> gscale,
00681         <a class="code" href="namespaceOgre.html#a281">Real</a> tiling,
00682         <font class="keywordtype">bool</font> drawFirst )
00683     {
00684         <a class="code" href="classOgre_1_1SceneManager.html#Ogre_1_1SceneManagern10">mSkyPlaneEnabled</a> = enable;
00685         <font class="keywordflow">if</font> (enable)
00686         {
00687             <a class="code" href="classOgre_1_1SceneManager.html#Ogre_1_1SceneManagern12">mSkyPlane</a> = plane;
00688             <a class="code" href="classOgre_1_1Material.html">Material</a>* m = <a class="code" href="classOgre_1_1SceneManager.html#Ogre_1_1SceneManagera15">getMaterial</a>(materialName);
00689             <font class="keywordflow">if</font> (!m)
00690             {
00691                 <font class="keywordtype">char</font> errMsg[128];
00692                 sprintf(errMsg, <font class="stringliteral">"Sky plane material '%s' not found."</font>, materialName.c_str());
00693                 <a class="code" href="OgreException_8h.html#a0">Except</a>(Exception::ERR_INVALIDPARAMS, errMsg, <font class="stringliteral">"SceneManager::setSkyPlane"</font>);
00694             }
00695             <font class="comment">// Make sure the material doesn't update the depth buffer</font>
00696             m-&gt;<a class="code" href="classOgre_1_1Material.html#Ogre_1_1Materiala31">setDepthWriteEnabled</a>(<font class="keyword">false</font>);
00697             <font class="comment">// Ensure loaded</font>
00698             m-&gt;<a class="code" href="classOgre_1_1Material.html#Ogre_1_1Materiala52">load</a>();
00699 
00700             <a class="code" href="classOgre_1_1SceneManager.html#Ogre_1_1SceneManagern13">mSkyPlaneMatHdl</a> = m-&gt;<a class="code" href="classOgre_1_1Material.html#Ogre_1_1Materiala4">getHandle</a>();
00701             <a class="code" href="classOgre_1_1SceneManager.html#Ogre_1_1SceneManagern11">mSkyPlaneDrawFirst</a> = drawFirst;
00702 
00703             <font class="comment">// Set up the plane</font>
00704             <a class="code" href="classOgre_1_1Mesh.html">Mesh</a>* planeMesh = (<a class="code" href="classOgre_1_1Mesh.html">Mesh</a>*)MeshManager::getSingleton().getByName(<font class="stringliteral">"SkyPlane"</font>);
00705             <font class="keywordflow">if</font> (planeMesh)
00706             {
00707                 <font class="comment">// Destroy the old one</font>
00708                 MeshManager::getSingleton().unload(planeMesh);
00709                 <font class="keyword">delete</font> planeMesh;
00710             }
00711 
00712             <font class="comment">// Create up vector</font>
00713             <a class="code" href="classOgre_1_1Vector3.html">Vector3</a> up = plane.<a class="code" href="classOgre_1_1Plane.html#Ogre_1_1Planem0">normal</a>.<a class="code" href="classOgre_1_1Vector3.html#Ogre_1_1Vector3a25">crossProduct</a>(Vector3::UNIT_X);
00714             <font class="keywordflow">if</font> (up == Vector3::ZERO)
00715                 up = plane.<a class="code" href="classOgre_1_1Plane.html#Ogre_1_1Planem0">normal</a>.<a class="code" href="classOgre_1_1Vector3.html#Ogre_1_1Vector3a25">crossProduct</a>(-Vector3::UNIT_Z);
00716 
00717             <font class="comment">// Create skybox based on new parameters</font>
00718             planeMesh = MeshManager::getSingleton().createPlane(<font class="stringliteral">"SkyPlane"</font>, plane, gscale * 100, gscale * 100,
00719                 1,1, <font class="keyword">false</font>, 1, tiling, tiling, up);
00720 
00721             <font class="comment">//planeMesh-&gt;_dumpContents("skyplane.txt");</font>
00722 
00723 
00724         }
00725     }
00726     <font class="comment">//-----------------------------------------------------------------------</font>
<a name="l00727"></a><a class="code" href="classOgre_1_1SceneManager.html#Ogre_1_1SceneManagera48">00727</a>     <font class="keywordtype">void</font> SceneManager::setSkyBox(
00728         <font class="keywordtype">bool</font> enable,
00729         <font class="keyword">const</font> <a class="code" href="classOgre_1_1String.html">String</a>&amp; materialName,
00730         <a class="code" href="namespaceOgre.html#a281">Real</a> distance,
00731         <font class="keywordtype">bool</font> drawFirst,
00732         <font class="keyword">const</font> <a class="code" href="classOgre_1_1Quaternion.html">Quaternion</a>&amp; orientation )
00733     {
00734         <a class="code" href="classOgre_1_1SceneManager.html#Ogre_1_1SceneManagern14">mSkyBoxEnabled</a> = enable;
00735         <font class="keywordflow">if</font> (enable)
00736         {
00737             <a class="code" href="classOgre_1_1SceneManager.html#Ogre_1_1SceneManagern17">mSkyBoxDist</a> = distance;
00738             <a class="code" href="classOgre_1_1Material.html">Material</a>* m = <a class="code" href="classOgre_1_1SceneManager.html#Ogre_1_1SceneManagera15">getMaterial</a>(materialName);
00739             <font class="keywordflow">if</font> (!m)
00740             {
00741                 <font class="keywordtype">char</font> errMsg[128];
00742                 sprintf(errMsg, <font class="stringliteral">"Sky box material '%s' not found."</font>, materialName.c_str());
00743                 <a class="code" href="OgreException_8h.html#a0">Except</a>(Exception::ERR_INVALIDPARAMS, errMsg, <font class="stringliteral">"SceneManager::setSkyBox"</font>);
00744             }
00745             <font class="comment">// Make sure the material doesn't update the depth buffer</font>
00746             m-&gt;<a class="code" href="classOgre_1_1Material.html#Ogre_1_1Materiala31">setDepthWriteEnabled</a>(<font class="keyword">false</font>);
00747             <font class="comment">// Also clamp texture, don't wrap (otherwise edges can get filtered)</font>
00748             m-&gt;<a class="code" href="classOgre_1_1Material.html#Ogre_1_1Materiala20">getTextureLayer</a>(0)-&gt;setTextureAddressingMode(Material::TextureLayer::TAM_CLAMP);
00749 
00750             <font class="comment">// Ensure loaded</font>
00751             m-&gt;<a class="code" href="classOgre_1_1Material.html#Ogre_1_1Materiala52">load</a>();
00752 
00753             <a class="code" href="classOgre_1_1SceneManager.html#Ogre_1_1SceneManagern16">mSkyBoxMatHdl</a> = m-&gt;<a class="code" href="classOgre_1_1Material.html#Ogre_1_1Materiala4">getHandle</a>();
00754             <a class="code" href="classOgre_1_1SceneManager.html#Ogre_1_1SceneManagern15">mSkyBoxDrawFirst</a> = drawFirst;
00755 
00756             <font class="comment">// Set up the box (6 planes)</font>
00757             <font class="keywordflow">for</font> (<font class="keywordtype">int</font> i = 0; i &lt; 6; ++i)
00758             {
00759                 <a class="code" href="classOgre_1_1SceneManager.html#Ogre_1_1SceneManagerb1">createSkyboxPlane</a>((<a class="code" href="classOgre_1_1SceneManager.html#Ogre_1_1SceneManagert11">BoxPlane</a>)i, distance, orientation);
00760             }
00761 
00762         }
00763 
00764     }
00765     <font class="comment">//-----------------------------------------------------------------------</font>
<a name="l00766"></a><a class="code" href="classOgre_1_1SceneManager.html#Ogre_1_1SceneManagera49">00766</a>     <font class="keywordtype">void</font> SceneManager::setSkyDome(
00767         <font class="keywordtype">bool</font> enable,
00768         <font class="keyword">const</font> <a class="code" href="classOgre_1_1String.html">String</a>&amp; materialName,
00769         <a class="code" href="namespaceOgre.html#a281">Real</a> curvature,
00770         <a class="code" href="namespaceOgre.html#a281">Real</a> tiling,
00771         <a class="code" href="namespaceOgre.html#a281">Real</a> distance,
00772         <font class="keywordtype">bool</font> drawFirst,
00773         <font class="keyword">const</font> <a class="code" href="classOgre_1_1Quaternion.html">Quaternion</a>&amp; orientation )
00774     {
00775         <a class="code" href="classOgre_1_1SceneManager.html#Ogre_1_1SceneManagern19">mSkyDomeEnabled</a> = enable;
00776         <font class="keywordflow">if</font> (enable)
00777         {
00778             <a class="code" href="classOgre_1_1SceneManager.html#Ogre_1_1SceneManagern22">mSkyDomeDist</a> = distance;
00779             <a class="code" href="classOgre_1_1Material.html">Material</a>* m = <a class="code" href="classOgre_1_1SceneManager.html#Ogre_1_1SceneManagera15">getMaterial</a>(materialName);
00780             <font class="keywordflow">if</font> (!m)
00781             {
00782                 <font class="keywordtype">char</font> errMsg[128];
00783                 sprintf(errMsg, <font class="stringliteral">"Sky box material '%s' not found."</font>, materialName.c_str());
00784                 <a class="code" href="OgreException_8h.html#a0">Except</a>(Exception::ERR_INVALIDPARAMS, errMsg, <font class="stringliteral">"SceneManager::setSkyDome"</font>);
00785             }
00786             <font class="comment">// Make sure the material doesn't update the depth buffer</font>
00787             m-&gt;<a class="code" href="classOgre_1_1Material.html#Ogre_1_1Materiala31">setDepthWriteEnabled</a>(<font class="keyword">false</font>);
00788             <font class="comment">// Ensure loaded</font>
00789             m-&gt;<a class="code" href="classOgre_1_1Material.html#Ogre_1_1Materiala52">load</a>();
00790 
00791             <a class="code" href="classOgre_1_1SceneManager.html#Ogre_1_1SceneManagern21">mSkyDomeMatHdl</a> = m-&gt;<a class="code" href="classOgre_1_1Material.html#Ogre_1_1Materiala4">getHandle</a>();
00792             <a class="code" href="classOgre_1_1SceneManager.html#Ogre_1_1SceneManagern20">mSkyDomeDrawFirst</a> = drawFirst;
00793 
00794             <font class="comment">// Set up the dome (5 planes)</font>
00795             <font class="keywordflow">for</font> (<font class="keywordtype">int</font> i = 0; i &lt; 5; ++i)
00796             {
00797                 <a class="code" href="classOgre_1_1SceneManager.html#Ogre_1_1SceneManagerb2">createSkydomePlane</a>((<a class="code" href="classOgre_1_1SceneManager.html#Ogre_1_1SceneManagert11">BoxPlane</a>)i, curvature, tiling, distance, orientation);
00798             }
00799 
00800         }
00801     }
00802     <font class="comment">//-----------------------------------------------------------------------</font>
<a name="l00803"></a><a class="code" href="classOgre_1_1SceneManager.html#Ogre_1_1SceneManagerb1">00803</a>     <font class="keywordtype">void</font> SceneManager::createSkyboxPlane(
00804         BoxPlane bp,
00805         <a class="code" href="namespaceOgre.html#a281">Real</a> distance,
00806         <font class="keyword">const</font> <a class="code" href="classOgre_1_1Quaternion.html">Quaternion</a>&amp; orientation )
00807     {
00808         <a class="code" href="classOgre_1_1Plane.html">Plane</a> plane;
00809         <a class="code" href="classOgre_1_1String.html">String</a> meshName;
00810         <a class="code" href="classOgre_1_1Vector3.html">Vector3</a> up;
00811 
00812         meshName = <font class="stringliteral">"SkyBoxPlane_"</font>;
00813         <font class="comment">// Set up plane equation</font>
00814         plane.<a class="code" href="classOgre_1_1Plane.html#Ogre_1_1Planem1">d</a> = -distance;
00815         <font class="keywordflow">switch</font>(bp)
00816         {
00817         <font class="keywordflow">case</font> <a class="code" href="classOgre_1_1SceneManager.html#Ogre_1_1SceneManagert11Ogre_1_1SceneManagert5">BP_FRONT</a>:
00818             plane.<a class="code" href="classOgre_1_1Plane.html#Ogre_1_1Planem0">normal</a> = Vector3::UNIT_Z;
00819             up = Vector3::UNIT_Y;
00820             meshName += <font class="stringliteral">"Front"</font>;
00821             <font class="keywordflow">break</font>;
00822         <font class="keywordflow">case</font> <a class="code" href="classOgre_1_1SceneManager.html#Ogre_1_1SceneManagert11Ogre_1_1SceneManagert7">BP_BACK</a>:
00823             plane.<a class="code" href="classOgre_1_1Plane.html#Ogre_1_1Planem0">normal</a> = -Vector3::UNIT_Z;
00824             up = Vector3::UNIT_Y;
00825             meshName += <font class="stringliteral">"Back"</font>;
00826             <font class="keywordflow">break</font>;
00827         <font class="keywordflow">case</font> <a class="code" href="classOgre_1_1SceneManager.html#Ogre_1_1SceneManagert11Ogre_1_1SceneManagert6">BP_LEFT</a>:
00828             plane.<a class="code" href="classOgre_1_1Plane.html#Ogre_1_1Planem0">normal</a> = Vector3::UNIT_X;
00829             up = Vector3::UNIT_Y;
00830             meshName += <font class="stringliteral">"Left"</font>;
00831             <font class="keywordflow">break</font>;
00832         <font class="keywordflow">case</font> <a class="code" href="classOgre_1_1SceneManager.html#Ogre_1_1SceneManagert11Ogre_1_1SceneManagert8">BP_RIGHT</a>:
00833             plane.<a class="code" href="classOgre_1_1Plane.html#Ogre_1_1Planem0">normal</a> = -Vector3::UNIT_X;
00834             up = Vector3::UNIT_Y;
00835             meshName += <font class="stringliteral">"Right"</font>;
00836             <font class="keywordflow">break</font>;
00837         <font class="keywordflow">case</font> <a class="code" href="classOgre_1_1SceneManager.html#Ogre_1_1SceneManagert11Ogre_1_1SceneManagert9">BP_UP</a>:
00838             plane.<a class="code" href="classOgre_1_1Plane.html#Ogre_1_1Planem0">normal</a> = -Vector3::UNIT_Y;
00839             up = Vector3::UNIT_Z;
00840             meshName += <font class="stringliteral">"Up"</font>;
00841             <font class="keywordflow">break</font>;
00842         <font class="keywordflow">case</font> <a class="code" href="classOgre_1_1SceneManager.html#Ogre_1_1SceneManagert11Ogre_1_1SceneManagert10">BP_DOWN</a>:
00843             plane.<a class="code" href="classOgre_1_1Plane.html#Ogre_1_1Planem0">normal</a> = Vector3::UNIT_Y;
00844             up = -Vector3::UNIT_Z;
00845             meshName += <font class="stringliteral">"Down"</font>;
00846             <font class="keywordflow">break</font>;
00847         }
00848         <font class="comment">// Modify by orientation</font>
00849         plane.<a class="code" href="classOgre_1_1Plane.html#Ogre_1_1Planem0">normal</a> = orientation * plane.<a class="code" href="classOgre_1_1Plane.html#Ogre_1_1Planem0">normal</a>;
00850         up = orientation * up;
00851 
00852 
00853         <font class="comment">// Check to see if existing plane</font>
00854         <a class="code" href="classOgre_1_1MeshManager.html">MeshManager</a>&amp; mm = MeshManager::getSingleton();
00855         <a class="code" href="classOgre_1_1Mesh.html">Mesh</a>* planeMesh = (<a class="code" href="classOgre_1_1Mesh.html">Mesh</a>*)mm.<a class="code" href="classOgre_1_1ResourceManager.html#Ogre_1_1TextureManagera13">getByName</a>(meshName);
00856         <font class="keywordflow">if</font>(planeMesh)
00857         {
00858             <font class="comment">// destroy existing</font>
00859             mm.<a class="code" href="classOgre_1_1ResourceManager.html#Ogre_1_1TextureManagera11">unload</a>(planeMesh);
00860             <font class="keyword">delete</font> planeMesh;
00861         }
00862         <font class="comment">// Create new</font>
00863         <a class="code" href="namespaceOgre.html#a281">Real</a> planeSize = distance * 2;
00864         <font class="keyword">const</font> <font class="keywordtype">int</font> BOX_SEGMENTS = 1;
00865         planeMesh = mm.<a class="code" href="classOgre_1_1MeshManager.html#Ogre_1_1MeshManagera4">createPlane</a>(meshName, plane, planeSize, planeSize, BOX_SEGMENTS, BOX_SEGMENTS, <font class="keyword">false</font>, 1, 1, 1, up);
00866 
00867         <font class="comment">//planeMesh-&gt;_dumpContents(meshName);</font>
00868 
00869     }
00870     <font class="comment">//-----------------------------------------------------------------------</font>
<a name="l00871"></a><a class="code" href="classOgre_1_1SceneManager.html#Ogre_1_1SceneManagerb2">00871</a>     <font class="keywordtype">void</font> SceneManager::createSkydomePlane(
00872         BoxPlane bp,
00873         <a class="code" href="namespaceOgre.html#a281">Real</a> curvature,
00874         <a class="code" href="namespaceOgre.html#a281">Real</a> tiling,
00875         <a class="code" href="namespaceOgre.html#a281">Real</a> distance,
00876         <font class="keyword">const</font> <a class="code" href="classOgre_1_1Quaternion.html">Quaternion</a>&amp; orientation )
00877     {
00878         <a class="code" href="classOgre_1_1Plane.html">Plane</a> plane;
00879         <a class="code" href="classOgre_1_1String.html">String</a> meshName;
00880         <a class="code" href="classOgre_1_1Vector3.html">Vector3</a> up;
00881 
00882         meshName = <font class="stringliteral">"SkyDomePlane_"</font>;
00883         <font class="comment">// Set up plane equation</font>
00884         plane.<a class="code" href="classOgre_1_1Plane.html#Ogre_1_1Planem1">d</a> = -distance;
00885         <font class="keywordflow">switch</font>(bp)
00886         {
00887         <font class="keywordflow">case</font> <a class="code" href="classOgre_1_1SceneManager.html#Ogre_1_1SceneManagert11Ogre_1_1SceneManagert5">BP_FRONT</a>:
00888             plane.<a class="code" href="classOgre_1_1Plane.html#Ogre_1_1Planem0">normal</a> = Vector3::UNIT_Z;
00889             up = Vector3::UNIT_Y;
00890             meshName += <font class="stringliteral">"Front"</font>;
00891             <font class="keywordflow">break</font>;
00892         <font class="keywordflow">case</font> <a class="code" href="classOgre_1_1SceneManager.html#Ogre_1_1SceneManagert11Ogre_1_1SceneManagert7">BP_BACK</a>:
00893             plane.<a class="code" href="classOgre_1_1Plane.html#Ogre_1_1Planem0">normal</a> = -Vector3::UNIT_Z;
00894             up = Vector3::UNIT_Y;
00895             meshName += <font class="stringliteral">"Back"</font>;
00896             <font class="keywordflow">break</font>;
00897         <font class="keywordflow">case</font> <a class="code" href="classOgre_1_1SceneManager.html#Ogre_1_1SceneManagert11Ogre_1_1SceneManagert6">BP_LEFT</a>:
00898             plane.<a class="code" href="classOgre_1_1Plane.html#Ogre_1_1Planem0">normal</a> = Vector3::UNIT_X;
00899             up = Vector3::UNIT_Y;
00900             meshName += <font class="stringliteral">"Left"</font>;
00901             <font class="keywordflow">break</font>;
00902         <font class="keywordflow">case</font> <a class="code" href="classOgre_1_1SceneManager.html#Ogre_1_1SceneManagert11Ogre_1_1SceneManagert8">BP_RIGHT</a>:
00903             plane.<a class="code" href="classOgre_1_1Plane.html#Ogre_1_1Planem0">normal</a> = -Vector3::UNIT_X;
00904             up = Vector3::UNIT_Y;
00905             meshName += <font class="stringliteral">"Right"</font>;
00906             <font class="keywordflow">break</font>;
00907         <font class="keywordflow">case</font> <a class="code" href="classOgre_1_1SceneManager.html#Ogre_1_1SceneManagert11Ogre_1_1SceneManagert9">BP_UP</a>:
00908             plane.<a class="code" href="classOgre_1_1Plane.html#Ogre_1_1Planem0">normal</a> = -Vector3::UNIT_Y;
00909             up = Vector3::UNIT_Z;
00910             meshName += <font class="stringliteral">"Up"</font>;
00911             <font class="keywordflow">break</font>;
00912         <font class="keywordflow">case</font> <a class="code" href="classOgre_1_1SceneManager.html#Ogre_1_1SceneManagert11Ogre_1_1SceneManagert10">BP_DOWN</a>:
00913             <font class="comment">// no down</font>
00914             <font class="keywordflow">return</font>;
00915         }
00916         <font class="comment">// Modify by orientation</font>
00917         plane.<a class="code" href="classOgre_1_1Plane.html#Ogre_1_1Planem0">normal</a> = orientation * plane.<a class="code" href="classOgre_1_1Plane.html#Ogre_1_1Planem0">normal</a>;
00918         up = orientation * up;
00919 
00920         <font class="comment">// Check to see if existing plane</font>
00921         <a class="code" href="classOgre_1_1MeshManager.html">MeshManager</a>&amp; mm = MeshManager::getSingleton();
00922         <a class="code" href="classOgre_1_1Mesh.html">Mesh</a>* planeMesh = (<a class="code" href="classOgre_1_1Mesh.html">Mesh</a>*)mm.<a class="code" href="classOgre_1_1ResourceManager.html#Ogre_1_1TextureManagera13">getByName</a>(meshName);
00923         <font class="keywordflow">if</font>(planeMesh)
00924         {
00925             <font class="comment">// destroy existing</font>
00926             mm.<a class="code" href="classOgre_1_1ResourceManager.html#Ogre_1_1TextureManagera11">unload</a>(planeMesh);
00927             <font class="keyword">delete</font> planeMesh;
00928         }
00929         <font class="comment">// Create new</font>
00930         <a class="code" href="namespaceOgre.html#a281">Real</a> planeSize = distance * 2;
00931         <font class="keyword">const</font> <font class="keywordtype">int</font> BOX_SEGMENTS = 16;
00932         planeMesh = mm.<a class="code" href="classOgre_1_1MeshManager.html#Ogre_1_1MeshManagera4">createPlane</a>(meshName, plane, planeSize, planeSize, BOX_SEGMENTS, BOX_SEGMENTS, <font class="keyword">false</font>, 1, 1, 1, up);
00933 
00934         <font class="comment">//planeMesh-&gt;_dumpContents(meshName);</font>
00935 
00936         <font class="comment">// Now we've created a basic plane, modify the texture coordinates to appear curved</font>
00937         <font class="comment">// Imagine a large sphere with the camera located near the top</font>
00938         <font class="comment">// The lower the curvature, the larger the sphere</font>
00939         <font class="comment">// Use the angle from viewer to the points on the plane</font>
00940         <font class="comment">// Credit to Aftershock for the general approach</font>
00941         <a class="code" href="namespaceOgre.html#a281">Real</a>* pTex;
00942         <a class="code" href="classOgre_1_1Vector3.html">Vector3</a> vertPos;  <font class="comment">// position relative to camera</font>
00943         <a class="code" href="namespaceOgre.html#a281">Real</a> sphDist;      <font class="comment">// Distance from camera to sphere along box vertex vector</font>
00944         <font class="comment">// Vector3 camToSph; // camera position to sphere</font>
00945         <a class="code" href="namespaceOgre.html#a281">Real</a> sphereRadius;<font class="comment">// Sphere radius</font>
00946         <a class="code" href="namespaceOgre.html#a281">Real</a> camPos;      <font class="comment">// Camera position relative to sphere center</font>
00947 
00948         <font class="comment">// Derive sphere radius</font>
00949         <font class="comment">// Actual values irrelevant, it's the relation between sphere radius and camera position that's important</font>
00950         <font class="keyword">const</font> <a class="code" href="namespaceOgre.html#a281">Real</a> SPHERE_RAD = 100.0;
00951         <font class="keyword">const</font> <a class="code" href="namespaceOgre.html#a281">Real</a> CAM_DIST = 5.0;
00952 
00953         sphereRadius = SPHERE_RAD - curvature;
00954         camPos = sphereRadius - CAM_DIST;
00955 
00956         <font class="keywordflow">for</font> (<font class="keywordtype">int</font> y = 0; y &lt; BOX_SEGMENTS + 1; ++y)
00957         {
00958             <font class="keywordflow">for</font> (<font class="keywordtype">int</font> x = 0; x &lt; BOX_SEGMENTS + 1; ++x)
00959             {
00960                 pTex = planeMesh-&gt;<a class="code" href="classOgre_1_1Mesh.html#Ogre_1_1Meshm0">sharedGeometry</a>.<a class="code" href="structOgre_1_1GeometryData.html#Ogre_1_1GeometryDatam6">pTexCoords</a>[0] + (((y * (BOX_SEGMENTS+1)) + x) * 2);
00961 
00962                 <font class="comment">// Get position of box vertex in view space</font>
00963                 vertPos = <a class="code" href="classOgre_1_1Vector3.html">Vector3</a>(planeMesh-&gt;<a class="code" href="classOgre_1_1Mesh.html#Ogre_1_1Meshm0">sharedGeometry</a>.<a class="code" href="structOgre_1_1GeometryData.html#Ogre_1_1GeometryDatam5">pVertices</a> + (((y * (BOX_SEGMENTS+1)) + x) * 3));
00964                 <font class="comment">// Adjust by -orientation to return to +y up</font>
00965                 vertPos = orientation.<a class="code" href="classOgre_1_1Quaternion.html#Ogre_1_1Quaterniona19">Inverse</a>() * vertPos;
00966                 <font class="comment">// Normalise</font>
00967                 vertPos.<a class="code" href="classOgre_1_1Vector3.html#Ogre_1_1Vector3a24">normalise</a>();
00968                 <font class="comment">// Find distance to sphere</font>
00969                 sphDist = Math::getSingleton().Sqrt(camPos*camPos * (vertPos.<a class="code" href="classOgre_1_1Vector3.html#Ogre_1_1Vector3m1">y</a>*vertPos.<a class="code" href="classOgre_1_1Vector3.html#Ogre_1_1Vector3m1">y</a>-1.0) + sphereRadius*sphereRadius) - camPos*vertPos.<a class="code" href="classOgre_1_1Vector3.html#Ogre_1_1Vector3m1">y</a>;
00970 
00971                 vertPos.<a class="code" href="classOgre_1_1Vector3.html#Ogre_1_1Vector3m0">x</a> *= sphDist;
00972                 vertPos.<a class="code" href="classOgre_1_1Vector3.html#Ogre_1_1Vector3m2">z</a> *= sphDist;
00973 
00974                 <font class="comment">// Use x and y on sphere as texture coordinates, tiled</font>
00975                 pTex[0] = vertPos.<a class="code" href="classOgre_1_1Vector3.html#Ogre_1_1Vector3m0">x</a> * (0.01 * tiling);
00976                 pTex[1] = vertPos.<a class="code" href="classOgre_1_1Vector3.html#Ogre_1_1Vector3m2">z</a> * (0.01 * tiling);
00977 
00978             }
00979         }
00980 
00981     }
00982     <font class="comment">//-----------------------------------------------------------------------</font>
<a name="l00983"></a><a class="code" href="classOgre_1_1SceneManager.html#Ogre_1_1SceneManagera41">00983</a>     <font class="keywordtype">void</font> SceneManager::_renderSkyPlane(<a class="code" href="classOgre_1_1Camera.html">Camera</a>* cam)
00984     {
00985         <font class="keywordtype">int</font> matLayers;
00986         <a class="code" href="classOgre_1_1Material.html">Material</a> *m;
00987         <a class="code" href="classOgre_1_1Mesh.html">Mesh</a>* planeMesh;
00988         <a class="code" href="classOgre_1_1SubMesh.html">SubMesh</a>* sm;
00989 
00990         planeMesh = (<a class="code" href="classOgre_1_1Mesh.html">Mesh</a>*)MeshManager::getSingleton().getByName(<font class="stringliteral">"SkyPlane"</font>);
00991         sm = planeMesh-&gt;<a class="code" href="classOgre_1_1Mesh.html#Ogre_1_1Mesha6">getSubMesh</a>(0);
00992 
00993         <font class="comment">// Translate the plane by the camera position (constant distance)</font>
00994         <font class="comment">// The plane position relative to the camera has already been set up</font>
00995         <a class="code" href="classOgre_1_1Matrix4.html">Matrix4</a> mat = Matrix4::IDENTITY;
00996         mat.<a class="code" href="classOgre_1_1Matrix4.html#Ogre_1_1Matrix4a13">setTrans</a>(cam-&gt;<a class="code" href="classOgre_1_1Camera.html#Ogre_1_1Cameraa10">getPosition</a>());
00997         <a class="code" href="classOgre_1_1SceneManager.html#Ogre_1_1SceneManagern2">mDestRenderSystem</a>-&gt;<a class="code" href="classOgre_1_1RenderSystem.html#Ogre_1_1RenderSystema29">_setWorldMatrix</a>(mat);
00998 
00999         m = <a class="code" href="classOgre_1_1SceneManager.html#Ogre_1_1SceneManagera15">getMaterial</a>(<a class="code" href="classOgre_1_1SceneManager.html#Ogre_1_1SceneManagern13">mSkyPlaneMatHdl</a>);
01000         <font class="comment">// Set the material for the camera</font>
01001         matLayers = m-&gt;<a class="code" href="classOgre_1_1Material.html#Ogre_1_1Materiala23">getNumTextureLayers</a>();
01002         <font class="keywordflow">do</font>
01003         {
01004             matLayers = <a class="code" href="classOgre_1_1SceneManager.html#Ogre_1_1SceneManagerb0">setMaterial</a>(m, matLayers);
01005             <a class="code" href="classOgre_1_1SceneManager.html#Ogre_1_1SceneManagera44">_renderSubMesh</a>(sm);
01006 
01007         } <font class="keywordflow">while</font> (matLayers &gt; 0);
01008 
01009     }
01010 
01011     <font class="comment">//-----------------------------------------------------------------------</font>
<a name="l01012"></a><a class="code" href="classOgre_1_1SceneManager.html#Ogre_1_1SceneManagera42">01012</a>     <font class="keywordtype">void</font> SceneManager::_renderSkyBox(<a class="code" href="classOgre_1_1Camera.html">Camera</a>* cam)
01013     {
01014         <font class="keywordtype">int</font> matLayers;
01015         <a class="code" href="classOgre_1_1Material.html">Material</a> *m;
01016         <a class="code" href="classOgre_1_1Mesh.html">Mesh</a>* planeMesh;
01017         <a class="code" href="classOgre_1_1SubMesh.html">SubMesh</a>* sm;
01018         <a class="code" href="classOgre_1_1String.html">String</a> baseName, meshName;
01019 
01020         baseName = <font class="stringliteral">"SkyBoxPlane_"</font>;
01021 
01022         <font class="comment">// Translate the box by the camera position (constant distance)</font>
01023         <font class="comment">// The plane position relative to the camera has already been set up</font>
01024         <a class="code" href="classOgre_1_1Matrix4.html">Matrix4</a> mat = Matrix4::IDENTITY;
01025         mat.<a class="code" href="classOgre_1_1Matrix4.html#Ogre_1_1Matrix4a13">setTrans</a>(cam-&gt;<a class="code" href="classOgre_1_1Camera.html#Ogre_1_1Cameraa10">getPosition</a>());
01026         <a class="code" href="classOgre_1_1SceneManager.html#Ogre_1_1SceneManagern2">mDestRenderSystem</a>-&gt;<a class="code" href="classOgre_1_1RenderSystem.html#Ogre_1_1RenderSystema29">_setWorldMatrix</a>(mat);
01027 
01028         m = <a class="code" href="classOgre_1_1SceneManager.html#Ogre_1_1SceneManagera15">getMaterial</a>(<a class="code" href="classOgre_1_1SceneManager.html#Ogre_1_1SceneManagern16">mSkyBoxMatHdl</a>);
01029         <font class="keywordflow">for</font> (<font class="keywordtype">int</font> plane = 0; plane &lt; 6; ++plane)
01030         {
01031             <font class="keywordflow">switch</font>(plane)
01032             {
01033             <font class="keywordflow">case</font> <a class="code" href="classOgre_1_1SceneManager.html#Ogre_1_1SceneManagert11Ogre_1_1SceneManagert5">BP_FRONT</a>:
01034                 <font class="comment">//??? Why is back/front BACKWARDS from 3D Studio???</font>
01035                 <font class="comment">// I thought LEFT was relative to looking FRONT, but appears not when you look at the output</font>
01036                 <font class="comment">// Quake3 images also have this</font>
01037                 m-&gt;<a class="code" href="classOgre_1_1Material.html#Ogre_1_1Materiala20">getTextureLayer</a>(0)-&gt;setCurrentFrame(Material::TextureLayer::CUBE_BACK);
01038                 meshName = baseName + <font class="stringliteral">"Front"</font>;
01039                 <font class="keywordflow">break</font>;
01040             <font class="keywordflow">case</font> <a class="code" href="classOgre_1_1SceneManager.html#Ogre_1_1SceneManagert11Ogre_1_1SceneManagert7">BP_BACK</a>:
01041                 <font class="comment">//??? Why is back/front BACKWARDS from 3D Studio???</font>
01042                 m-&gt;<a class="code" href="classOgre_1_1Material.html#Ogre_1_1Materiala20">getTextureLayer</a>(0)-&gt;setCurrentFrame(Material::TextureLayer::CUBE_FRONT);
01043                 meshName = baseName + <font class="stringliteral">"Back"</font>;
01044                 <font class="keywordflow">break</font>;
01045             <font class="keywordflow">case</font> <a class="code" href="classOgre_1_1SceneManager.html#Ogre_1_1SceneManagert11Ogre_1_1SceneManagert6">BP_LEFT</a>:
01046                 m-&gt;<a class="code" href="classOgre_1_1Material.html#Ogre_1_1Materiala20">getTextureLayer</a>(0)-&gt;setCurrentFrame(Material::TextureLayer::CUBE_LEFT);
01047                 meshName = baseName + <font class="stringliteral">"Left"</font>;
01048                 <font class="keywordflow">break</font>;
01049             <font class="keywordflow">case</font> <a class="code" href="classOgre_1_1SceneManager.html#Ogre_1_1SceneManagert11Ogre_1_1SceneManagert8">BP_RIGHT</a>:
01050                 m-&gt;<a class="code" href="classOgre_1_1Material.html#Ogre_1_1Materiala20">getTextureLayer</a>(0)-&gt;setCurrentFrame(Material::TextureLayer::CUBE_RIGHT);
01051                 meshName = baseName + <font class="stringliteral">"Right"</font>;
01052                 <font class="keywordflow">break</font>;
01053             <font class="keywordflow">case</font> <a class="code" href="classOgre_1_1SceneManager.html#Ogre_1_1SceneManagert11Ogre_1_1SceneManagert9">BP_UP</a>:
01054                 m-&gt;<a class="code" href="classOgre_1_1Material.html#Ogre_1_1Materiala20">getTextureLayer</a>(0)-&gt;setCurrentFrame(Material::TextureLayer::CUBE_UP);
01055                 meshName = baseName + <font class="stringliteral">"Up"</font>;
01056                 <font class="keywordflow">break</font>;
01057             <font class="keywordflow">case</font> <a class="code" href="classOgre_1_1SceneManager.html#Ogre_1_1SceneManagert11Ogre_1_1SceneManagert10">BP_DOWN</a>:
01058                 m-&gt;<a class="code" href="classOgre_1_1Material.html#Ogre_1_1Materiala20">getTextureLayer</a>(0)-&gt;setCurrentFrame(Material::TextureLayer::CUBE_DOWN);
01059                 meshName = baseName + <font class="stringliteral">"Down"</font>;
01060                 <font class="keywordflow">break</font>;
01061             }
01062 
01063             planeMesh = (<a class="code" href="classOgre_1_1Mesh.html">Mesh</a>*)MeshManager::getSingleton().getByName(meshName);
01064             sm = planeMesh-&gt;<a class="code" href="classOgre_1_1Mesh.html#Ogre_1_1Mesha6">getSubMesh</a>(0);
01065 
01066 
01067             <font class="comment">// Set the material for the camera</font>
01068             matLayers = m-&gt;<a class="code" href="classOgre_1_1Material.html#Ogre_1_1Materiala23">getNumTextureLayers</a>();
01069             <font class="keywordflow">do</font>
01070             {
01071                 matLayers = <a class="code" href="classOgre_1_1SceneManager.html#Ogre_1_1SceneManagerb0">setMaterial</a>(m, matLayers);
01072                 <a class="code" href="classOgre_1_1SceneManager.html#Ogre_1_1SceneManagera44">_renderSubMesh</a>(sm);
01073 
01074             } <font class="keywordflow">while</font> (matLayers &gt; 0);
01075         }
01076 
01077 
01078     }
01079     <font class="comment">//-----------------------------------------------------------------------</font>
<a name="l01080"></a><a class="code" href="classOgre_1_1SceneManager.html#Ogre_1_1SceneManagera43">01080</a>     <font class="keywordtype">void</font> SceneManager::_renderSkyDome(<a class="code" href="classOgre_1_1Camera.html">Camera</a>* cam)
01081     {
01082         <font class="keywordtype">int</font> matLayers;
01083         <a class="code" href="classOgre_1_1Material.html">Material</a> *m;
01084         <a class="code" href="classOgre_1_1Mesh.html">Mesh</a>* planeMesh;
01085         <a class="code" href="classOgre_1_1SubMesh.html">SubMesh</a>* sm;
01086         <a class="code" href="classOgre_1_1String.html">String</a> baseName, meshName;
01087 
01088         <font class="comment">// Translate the box by the camera position (constant distance)</font>
01089         <font class="comment">// The plane position relative to the camera has already been set up</font>
01090         <a class="code" href="classOgre_1_1Matrix4.html">Matrix4</a> mat = Matrix4::IDENTITY;
01091         mat.<a class="code" href="classOgre_1_1Matrix4.html#Ogre_1_1Matrix4a13">setTrans</a>(cam-&gt;<a class="code" href="classOgre_1_1Camera.html#Ogre_1_1Cameraa10">getPosition</a>());
01092         <a class="code" href="classOgre_1_1SceneManager.html#Ogre_1_1SceneManagern2">mDestRenderSystem</a>-&gt;<a class="code" href="classOgre_1_1RenderSystem.html#Ogre_1_1RenderSystema29">_setWorldMatrix</a>(mat);
01093 
01094         baseName = <font class="stringliteral">"SkyDomePlane_"</font>;
01095 
01096         m = <a class="code" href="classOgre_1_1SceneManager.html#Ogre_1_1SceneManagera15">getMaterial</a>(<a class="code" href="classOgre_1_1SceneManager.html#Ogre_1_1SceneManagern21">mSkyDomeMatHdl</a>);
01097         <font class="comment">// Set the material</font>
01098         matLayers = m-&gt;<a class="code" href="classOgre_1_1Material.html#Ogre_1_1Materiala23">getNumTextureLayers</a>();
01099         <font class="keywordflow">do</font>
01100         {
01101             matLayers = <a class="code" href="classOgre_1_1SceneManager.html#Ogre_1_1SceneManagerb0">setMaterial</a>(m, matLayers);
01102 
01103             <font class="keywordflow">for</font> (<font class="keywordtype">int</font> plane = 0; plane &lt; 5; ++plane)
01104             {
01105                 <font class="keywordflow">switch</font>(plane)
01106                 {
01107                 <font class="keywordflow">case</font> <a class="code" href="classOgre_1_1SceneManager.html#Ogre_1_1SceneManagert11Ogre_1_1SceneManagert5">BP_FRONT</a>:
01108                     meshName = baseName + <font class="stringliteral">"Front"</font>;
01109                     <font class="keywordflow">break</font>;
01110                 <font class="keywordflow">case</font> <a class="code" href="classOgre_1_1SceneManager.html#Ogre_1_1SceneManagert11Ogre_1_1SceneManagert7">BP_BACK</a>:
01111                     meshName = baseName + <font class="stringliteral">"Back"</font>;
01112                     <font class="keywordflow">break</font>;
01113                 <font class="keywordflow">case</font> <a class="code" href="classOgre_1_1SceneManager.html#Ogre_1_1SceneManagert11Ogre_1_1SceneManagert6">BP_LEFT</a>:
01114                     meshName = baseName + <font class="stringliteral">"Left"</font>;
01115                     <font class="keywordflow">break</font>;
01116                 <font class="keywordflow">case</font> <a class="code" href="classOgre_1_1SceneManager.html#Ogre_1_1SceneManagert11Ogre_1_1SceneManagert8">BP_RIGHT</a>:
01117                     meshName = baseName + <font class="stringliteral">"Right"</font>;
01118                     <font class="keywordflow">break</font>;
01119                 <font class="keywordflow">case</font> <a class="code" href="classOgre_1_1SceneManager.html#Ogre_1_1SceneManagert11Ogre_1_1SceneManagert9">BP_UP</a>:
01120                     meshName = baseName + <font class="stringliteral">"Up"</font>;
01121                     <font class="keywordflow">break</font>;
01122                 }
01123 
01124                 planeMesh = (<a class="code" href="classOgre_1_1Mesh.html">Mesh</a>*)MeshManager::getSingleton().getByName(meshName);
01125                 sm = planeMesh-&gt;<a class="code" href="classOgre_1_1Mesh.html#Ogre_1_1Mesha6">getSubMesh</a>(0);
01126 
01127                 <a class="code" href="classOgre_1_1SceneManager.html#Ogre_1_1SceneManagera44">_renderSubMesh</a>(sm);
01128             }
01129 
01130         } <font class="keywordflow">while</font> (matLayers &gt; 0);
01131     }
01132     <font class="comment">//-----------------------------------------------------------------------</font>
<a name="l01133"></a><a class="code" href="classOgre_1_1SceneManager.html#Ogre_1_1SceneManagera44">01133</a>     <font class="keywordtype">void</font> SceneManager::_renderSubMesh(<a class="code" href="classOgre_1_1SubMesh.html">SubMesh</a>* sm)
01134     {
01135 
01136         <font class="keyword">static</font> <a class="code" href="classOgre_1_1RenderOperation.html">RenderOperation</a> ro; <font class="comment">// to avoid creating / destroying every time but must be careful to set all fields</font>
01137         <font class="comment">/*</font>
01138 <font class="comment"></font>
01139 <font class="comment">        // SubMeshes always use indexes</font>
01140 <font class="comment">        ro.useIndexes = true;</font>
01141 <font class="comment">        GeometryData* geom;</font>
01142 <font class="comment"></font>
01143 <font class="comment">        if (sm-&gt;useTriStrips)</font>
01144 <font class="comment">            ro.operationType = RenderOperation::OT_TRIANGLE_STRIP;</font>
01145 <font class="comment">        else</font>
01146 <font class="comment">            ro.operationType = RenderOperation::OT_TRIANGLE_LIST;</font>
01147 <font class="comment"></font>
01148 <font class="comment">        if (sm-&gt;useSharedVertices)</font>
01149 <font class="comment">        {</font>
01150 <font class="comment">            geom = &amp;(sm-&gt;parent-&gt;sharedGeometry);</font>
01151 <font class="comment">        }</font>
01152 <font class="comment">        else</font>
01153 <font class="comment">        {</font>
01154 <font class="comment">            geom = &amp;(sm-&gt;geometry);</font>
01155 <font class="comment">        }</font>
01156 <font class="comment"></font>
01157 <font class="comment">        if (geom-&gt;numTexCoords &gt; 0)</font>
01158 <font class="comment">        {</font>
01159 <font class="comment">            ro.vertexOptions = RenderOperation::VO_TEXTURE_COORDS;</font>
01160 <font class="comment">            ro.numTextureCoordSets = geom-&gt;numTexCoords;</font>
01161 <font class="comment">            for (int tex = 0; tex &lt; ro.numTextureCoordSets; ++tex)</font>
01162 <font class="comment">            {</font>
01163 <font class="comment">                ro.numTextureDimensions[tex] = geom-&gt;numTexCoordDimensions[tex];</font>
01164 <font class="comment">                ro.pTexCoords[tex] = geom-&gt;pTexCoords[tex];</font>
01165 <font class="comment">                ro.texCoordStride[tex] = geom-&gt;texCoordStride[tex];</font>
01166 <font class="comment">            }</font>
01167 <font class="comment"></font>
01168 <font class="comment">        }</font>
01169 <font class="comment"></font>
01170 <font class="comment">        if (geom-&gt;hasNormals)</font>
01171 <font class="comment">        {</font>
01172 <font class="comment">            ro.vertexOptions |= RenderOperation::VO_NORMALS;</font>
01173 <font class="comment">            ro.pNormals = geom-&gt;pNormals;</font>
01174 <font class="comment">        }</font>
01175 <font class="comment"></font>
01176 <font class="comment">        if (geom-&gt;hasColours)</font>
01177 <font class="comment">        {</font>
01178 <font class="comment">            ro.vertexOptions = RenderOperation::VO_DIFFUSE_COLOURS;</font>
01179 <font class="comment">            ro.pDiffuseColour = geom-&gt;pColours;</font>
01180 <font class="comment">        }</font>
01181 <font class="comment"></font>
01182 <font class="comment">        ro.numVertices = geom-&gt;numVertices;</font>
01183 <font class="comment">        ro.pVertices = geom-&gt;pVertices;</font>
01184 <font class="comment">        ro.diffuseStride = geom-&gt;colourStride;</font>
01185 <font class="comment">        ro.normalStride= geom-&gt;normalStride;</font>
01186 <font class="comment">        ro.vertexStride = geom-&gt;vertexStride;</font>
01187 <font class="comment"></font>
01188 <font class="comment">        if (sm-&gt;useTriStrips)</font>
01189 <font class="comment">            ro.numIndexes = sm-&gt;numFaces + 2;</font>
01190 <font class="comment">        else</font>
01191 <font class="comment">            ro.numIndexes = sm-&gt;numFaces * 3;</font>
01192 <font class="comment"></font>
01193 <font class="comment">        ro.pIndexes = sm-&gt;faceVertexIndices;</font>
01194 <font class="comment"></font>
01195 <font class="comment">        */</font>
01196 
01197         sm-&gt;<a class="code" href="classOgre_1_1SubMesh.html#Ogre_1_1SubMesha5">_getRenderOperation</a>(ro);
01198         <a class="code" href="classOgre_1_1SceneManager.html#Ogre_1_1SceneManagern2">mDestRenderSystem</a>-&gt;<a class="code" href="classOgre_1_1RenderSystem.html#Ogre_1_1RenderSystema46">_render</a>(ro);
01199 
01200 
01201     }
01202 
01203 
01204     <font class="comment">//-----------------------------------------------------------------------</font>
<a name="l01205"></a><a class="code" href="classOgre_1_1SceneManager.html#Ogre_1_1SceneManagera37">01205</a>     <font class="keywordtype">void</font> SceneManager::_updateSceneGraph(<a class="code" href="classOgre_1_1Camera.html">Camera</a>* cam)
01206     {
01207         <font class="comment">// Cascade down the graph updating transforms &amp; world bounds</font>
01208         <font class="comment">// In this implementation, just update from the root</font>
01209         <font class="comment">// Smarter SceneManager subclasses may choose to update only</font>
01210         <font class="comment">//   certain scene graph branches</font>
01211         <a class="code" href="classOgre_1_1SceneManager.html#Ogre_1_1SceneManagern9">mSceneRoot</a>-&gt;<a class="code" href="classOgre_1_1SceneNode.html#Ogre_1_1SceneNodea15">_update</a>(cam, <font class="keyword">true</font>);
01212 
01213 
01214     }
01215     <font class="comment">//-----------------------------------------------------------------------</font>
<a name="l01216"></a><a class="code" href="classOgre_1_1SceneManager.html#Ogre_1_1SceneManagera38">01216</a>     <font class="keywordtype">void</font> SceneManager::_findVisibleObjects(<a class="code" href="classOgre_1_1Camera.html">Camera</a>* cam)
01217     {
01218         <font class="comment">// Tell nodes to find, cascade down all nodes</font>
01219         <a class="code" href="classOgre_1_1SceneManager.html#Ogre_1_1SceneManagern0">mRenderQueue</a>.<a class="code" href="classOgre_1_1RenderQueue.html#Ogre_1_1RenderQueuea0">clear</a>();
01220         <a class="code" href="classOgre_1_1SceneManager.html#Ogre_1_1SceneManagern9">mSceneRoot</a>-&gt;<a class="code" href="classOgre_1_1SceneNode.html#Ogre_1_1SceneNodea16">_findVisibleObjects</a>(cam, &amp;<a class="code" href="classOgre_1_1SceneManager.html#Ogre_1_1SceneManagern0">mRenderQueue</a>, <font class="keyword">true</font>);
01221 
01222     }
01223     <font class="comment">//-----------------------------------------------------------------------</font>
<a name="l01224"></a><a class="code" href="classOgre_1_1SceneManager.html#Ogre_1_1SceneManagera39">01224</a>     <font class="keywordtype">void</font> SceneManager::_renderVisibleObjects(<font class="keywordtype">void</font>)
01225     {
01226         <font class="comment">// Just render each entity in turn, grouped by material</font>
01227         RenderQueue::RenderQueueMap::iterator imat, imatend;
01228         imatend = <a class="code" href="classOgre_1_1SceneManager.html#Ogre_1_1SceneManagern0">mRenderQueue</a>.<a class="code" href="classOgre_1_1RenderQueue.html#Ogre_1_1RenderQueuen0">mQueue</a>.end();
01229         <font class="keyword">static</font> <a class="code" href="classOgre_1_1Matrix4.html">Matrix4</a> xform[256];
01230         <a class="code" href="classOgre_1_1RenderOperation.html">RenderOperation</a> ro;
01231 
01232         <font class="keywordflow">for</font> (imat = <a class="code" href="classOgre_1_1SceneManager.html#Ogre_1_1SceneManagern0">mRenderQueue</a>.<a class="code" href="classOgre_1_1RenderQueue.html#Ogre_1_1RenderQueuen0">mQueue</a>.begin(); imat != imatend; ++imat)
01233         {
01234             <font class="comment">// Set Material</font>
01235             <a class="code" href="classOgre_1_1Material.html">Material</a>* thisMaterial = imat-&gt;first;
01236             <font class="keywordtype">int</font> matLayersLeft = thisMaterial-&gt;<a class="code" href="classOgre_1_1Material.html#Ogre_1_1Materiala23">getNumTextureLayers</a>();
01237 
01238             <font class="comment">// NB do at least one rendering pass even if no layers! (Untextured materials)</font>
01239             <font class="keywordflow">do</font>
01240             {
01241                 <font class="comment">// Set material - will return non-zero if multipass required so loop will continue, 0 otherwise</font>
01242                 matLayersLeft = <a class="code" href="classOgre_1_1SceneManager.html#Ogre_1_1SceneManagerb0">setMaterial</a>(thisMaterial, matLayersLeft);
01243 
01244 
01245                 <font class="comment">// Iterate through renderables and render</font>
01246                 <font class="comment">// Note this may happen multiple times for multipass render</font>
01247                 std::vector&lt;Renderable*&gt;::iterator irend, irendend;
01248                 irendend = imat-&gt;second.end();
01249 
01250                 <font class="keywordflow">for</font> (irend = imat-&gt;second.begin(); irend != irendend; ++irend)
01251                 {
01252                     <font class="comment">// Set world transformation</font>
01253                     (*irend)-&gt;getWorldTransforms(xform);
01254                     <font class="keywordtype">unsigned</font> <font class="keywordtype">short</font> numMatrices = (*irend)-&gt;getNumWorldTransforms();
01255                     <font class="keywordflow">if</font> (numMatrices &gt; 1)
01256                     {
01257                         <a class="code" href="classOgre_1_1SceneManager.html#Ogre_1_1SceneManagern2">mDestRenderSystem</a>-&gt;<a class="code" href="classOgre_1_1RenderSystem.html#Ogre_1_1SDLRenderSystema53">_setWorldMatrices</a>(xform, numMatrices);
01258                     }
01259                     <font class="keywordflow">else</font>
01260                     {
01261                         <a class="code" href="classOgre_1_1SceneManager.html#Ogre_1_1SceneManagern2">mDestRenderSystem</a>-&gt;<a class="code" href="classOgre_1_1RenderSystem.html#Ogre_1_1RenderSystema29">_setWorldMatrix</a>(*xform);
01262                     }
01263 
01264                     <font class="comment">// Set up rendering operation</font>
01265                     (*irend)-&gt;getRenderOperation(ro);
01266 
01267                     <font class="keywordflow">if</font>( ro.<a class="code" href="classOgre_1_1RenderOperation.html#Ogre_1_1RenderOperationm1">numVertices</a> )
01268                         <a class="code" href="classOgre_1_1SceneManager.html#Ogre_1_1SceneManagern2">mDestRenderSystem</a>-&gt;<a class="code" href="classOgre_1_1RenderSystem.html#Ogre_1_1RenderSystema46">_render</a>(ro);
01269 
01270                 }
01271             } <font class="keywordflow">while</font> (matLayersLeft &gt; 0);
01272 
01273 
01274         } <font class="comment">// for each material</font>
01275 
01276     }
01277     <font class="comment">//-----------------------------------------------------------------------</font>
<a name="l01278"></a><a class="code" href="classOgre_1_1SceneManager.html#Ogre_1_1SceneManagera45">01278</a>     <font class="keywordtype">void</font> SceneManager::_updateDynamicLights(<font class="keywordtype">void</font>)
01279     {
01280         <font class="comment">// Update all lights</font>
01281         LightList::iterator i;
01282         <a class="code" href="classOgre_1_1Light.html">Light</a>* lt;
01283         <font class="keywordflow">for</font> (i = <a class="code" href="classOgre_1_1SceneManager.html#Ogre_1_1SceneManagern4">mLights</a>.begin(); i != <a class="code" href="classOgre_1_1SceneManager.html#Ogre_1_1SceneManagern4">mLights</a>.end(); ++i)
01284         {
01285             lt = i-&gt;second;
01286             <font class="keywordflow">if</font> (lt-&gt;<a class="code" href="classOgre_1_1Light.html#Ogre_1_1Lighta27">isModified</a>())
01287                 <a class="code" href="classOgre_1_1SceneManager.html#Ogre_1_1SceneManagern2">mDestRenderSystem</a>-&gt;<a class="code" href="classOgre_1_1RenderSystem.html#Ogre_1_1RenderSystema25">_modifyLight</a>(lt);
01288 
01289         }
01290     }
01291     <font class="comment">//-----------------------------------------------------------------------</font>
<a name="l01292"></a><a class="code" href="classOgre_1_1SceneManager.html#Ogre_1_1SceneManagera28">01292</a>     <font class="keywordtype">void</font> SceneManager::setAmbientLight(<a class="code" href="classOgre_1_1ColourValue.html">ColourValue</a> colour)
01293     {
01294         <a class="code" href="classOgre_1_1SceneManager.html#Ogre_1_1SceneManagern1">mAmbientLight</a> = colour;
01295         <a class="code" href="classOgre_1_1SceneManager.html#Ogre_1_1SceneManagern2">mDestRenderSystem</a>-&gt;<a class="code" href="classOgre_1_1RenderSystem.html#Ogre_1_1RenderSystema12">setAmbientLight</a>(colour.<a class="code" href="classOgre_1_1ColourValue.html#Ogre_1_1ColourValuem0">r</a>, colour.<a class="code" href="classOgre_1_1ColourValue.html#Ogre_1_1ColourValuem1">g</a>, colour.<a class="code" href="classOgre_1_1ColourValue.html#Ogre_1_1ColourValuem2">b</a>);
01296     }
01297     <font class="comment">//-----------------------------------------------------------------------</font>
<a name="l01298"></a><a class="code" href="classOgre_1_1SceneManager.html#Ogre_1_1SceneManagera29">01298</a>     <a class="code" href="classOgre_1_1ColourValue.html">ColourValue</a> SceneManager::getAmbientLight(<font class="keywordtype">void</font>)
01299     {
01300         <font class="keywordflow">return</font> <a class="code" href="classOgre_1_1SceneManager.html#Ogre_1_1SceneManagern1">mAmbientLight</a>;
01301     }
01302     <font class="comment">//-----------------------------------------------------------------------</font>
<a name="l01303"></a><a class="code" href="classOgre_1_1SceneManager.html#Ogre_1_1SceneManagera31">01303</a>     <a class="code" href="structOgre_1_1ViewPoint.html">ViewPoint</a> SceneManager::getSuggestedViewpoint(<font class="keywordtype">bool</font> random)
01304     {
01305         <font class="comment">// By default return the origin</font>
01306         <a class="code" href="structOgre_1_1ViewPoint.html">ViewPoint</a> vp;
01307         vp.<a class="code" href="structOgre_1_1ViewPoint.html#Ogre_1_1ViewPointm0">position</a> = Vector3::ZERO;
01308         vp.<a class="code" href="structOgre_1_1ViewPoint.html#Ogre_1_1ViewPointm1">orientation</a> = Quaternion::IDENTITY;
01309         <font class="keywordflow">return</font> vp;
01310     }
01311     <font class="comment">//-----------------------------------------------------------------------</font>
<a name="l01312"></a><a class="code" href="classOgre_1_1SceneManager.html#Ogre_1_1SceneManagera56">01312</a>     <font class="keywordtype">void</font> SceneManager::displaySplashScreen( <a class="code" href="classOgre_1_1Viewport.html">Viewport</a>* vp, <font class="keyword">const</font> <a class="code" href="classOgre_1_1String.html">String</a>&amp; name )
01313     {
01314         <a class="code" href="classOgre_1_1SceneManager.html#Ogre_1_1SceneManagern2">mDestRenderSystem</a>-&gt;<a class="code" href="classOgre_1_1RenderSystem.html#Ogre_1_1RenderSystema48">_setViewport</a>(vp);
01315         <font class="comment">// Reset all matrices</font>
01316         <a class="code" href="classOgre_1_1SceneManager.html#Ogre_1_1SceneManagern2">mDestRenderSystem</a>-&gt;<a class="code" href="classOgre_1_1RenderSystem.html#Ogre_1_1RenderSystema29">_setWorldMatrix</a>(Matrix4::IDENTITY);
01317         <a class="code" href="classOgre_1_1SceneManager.html#Ogre_1_1SceneManagern2">mDestRenderSystem</a>-&gt;<a class="code" href="classOgre_1_1RenderSystem.html#Ogre_1_1RenderSystema31">_setViewMatrix</a>(Matrix4::IDENTITY);
01318         <a class="code" href="classOgre_1_1SceneManager.html#Ogre_1_1SceneManagern2">mDestRenderSystem</a>-&gt;<a class="code" href="classOgre_1_1RenderSystem.html#Ogre_1_1RenderSystema32">_setProjectionMatrix</a>(Matrix4::IDENTITY);
01319 
01320         <font class="comment">// Make sure texture is loaded</font>
01321         <a class="code" href="classOgre_1_1Material.html">Material</a> mat;
01322         mat.<a class="code" href="classOgre_1_1Material.html#Ogre_1_1Materiala19">addTextureLayer</a>(name);
01323         mat.<a class="code" href="classOgre_1_1Material.html#Ogre_1_1Materiala39">setLightingEnabled</a>(<font class="keyword">false</font>);
01324         mat.<a class="code" href="classOgre_1_1Material.html#Ogre_1_1Materiala35">setCullingMode</a>(<a class="code" href="namespaceOgre.html#a430a84">CULL_NONE</a>);
01325 
01326         <a class="code" href="classOgre_1_1Mesh.html">Mesh</a>* msh = (<a class="code" href="classOgre_1_1Mesh.html">Mesh</a>*)MeshManager::getSingleton().getByName(<font class="stringliteral">"Prefab_Splash_Screen"</font>);
01327 
01328 
01329         <font class="comment">// Begin the frame</font>
01330         <a class="code" href="classOgre_1_1SceneManager.html#Ogre_1_1SceneManagern2">mDestRenderSystem</a>-&gt;<a class="code" href="classOgre_1_1RenderSystem.html#Ogre_1_1RenderSystema45">_beginFrame</a>();
01331 
01332         <a class="code" href="classOgre_1_1SceneManager.html#Ogre_1_1SceneManagerb0">setMaterial</a>(&amp;mat,1);
01333         <a class="code" href="classOgre_1_1SceneManager.html#Ogre_1_1SceneManagera44">_renderSubMesh</a>(msh-&gt;<a class="code" href="classOgre_1_1Mesh.html#Ogre_1_1Mesha6">getSubMesh</a>(0));
01334 
01335 
01336         <a class="code" href="classOgre_1_1SceneManager.html#Ogre_1_1SceneManagern2">mDestRenderSystem</a>-&gt;<a class="code" href="classOgre_1_1RenderSystem.html#Ogre_1_1RenderSystema47">_endFrame</a>();
01337     }
01338     <font class="comment">//-----------------------------------------------------------------------</font>
<a name="l01339"></a><a class="code" href="classOgre_1_1SceneManager.html#Ogre_1_1SceneManagera50">01339</a>     <font class="keywordtype">void</font> SceneManager::setFog(<a class="code" href="namespaceOgre.html#a429">FogMode</a> mode, <a class="code" href="classOgre_1_1ColourValue.html">ColourValue</a> colour, <a class="code" href="namespaceOgre.html#a281">Real</a> density, <a class="code" href="namespaceOgre.html#a281">Real</a> start, <a class="code" href="namespaceOgre.html#a281">Real</a> end)
01340     {
01341         <a class="code" href="classOgre_1_1SceneManager.html#Ogre_1_1SceneManagern24">mFogMode</a> = mode;
01342         <a class="code" href="classOgre_1_1SceneManager.html#Ogre_1_1SceneManagern25">mFogColour</a> = colour;
01343         <a class="code" href="classOgre_1_1SceneManager.html#Ogre_1_1SceneManagern26">mFogStart</a> = start;
01344         <a class="code" href="classOgre_1_1SceneManager.html#Ogre_1_1SceneManagern27">mFogEnd</a> = end;
01345         <a class="code" href="classOgre_1_1SceneManager.html#Ogre_1_1SceneManagern28">mFogDensity</a> = density;
01346     }
01347     <font class="comment">//-----------------------------------------------------------------------</font>
<a name="l01348"></a><a class="code" href="classOgre_1_1SceneManager.html#Ogre_1_1SceneManagera51">01348</a>     <a class="code" href="namespaceOgre.html#a429">FogMode</a> SceneManager::getFogMode(<font class="keywordtype">void</font>)<font class="keyword"> const</font>
01349 <font class="keyword">    </font>{
01350         <font class="keywordflow">return</font> <a class="code" href="classOgre_1_1SceneManager.html#Ogre_1_1SceneManagern24">mFogMode</a>;
01351     }
01352     <font class="comment">//-----------------------------------------------------------------------</font>
<a name="l01353"></a><a class="code" href="classOgre_1_1SceneManager.html#Ogre_1_1SceneManagera52">01353</a>     <font class="keyword">const</font> <a class="code" href="classOgre_1_1ColourValue.html">ColourValue</a>&amp; SceneManager::getFogColour(<font class="keywordtype">void</font>)<font class="keyword"> const</font>
01354 <font class="keyword">    </font>{
01355         <font class="keywordflow">return</font> <a class="code" href="classOgre_1_1SceneManager.html#Ogre_1_1SceneManagern25">mFogColour</a>;
01356     }
01357     <font class="comment">//-----------------------------------------------------------------------</font>
<a name="l01358"></a><a class="code" href="classOgre_1_1SceneManager.html#Ogre_1_1SceneManagera53">01358</a>     <a class="code" href="namespaceOgre.html#a281">Real</a> SceneManager::getFogStart(<font class="keywordtype">void</font>)<font class="keyword"> const</font>
01359 <font class="keyword">    </font>{
01360         <font class="keywordflow">return</font> <a class="code" href="classOgre_1_1SceneManager.html#Ogre_1_1SceneManagern26">mFogStart</a>;
01361     }
01362     <font class="comment">//-----------------------------------------------------------------------</font>
<a name="l01363"></a><a class="code" href="classOgre_1_1SceneManager.html#Ogre_1_1SceneManagera54">01363</a>     <a class="code" href="namespaceOgre.html#a281">Real</a> SceneManager::getFogEnd(<font class="keywordtype">void</font>)<font class="keyword"> const</font>
01364 <font class="keyword">    </font>{
01365         <font class="keywordflow">return</font> <a class="code" href="classOgre_1_1SceneManager.html#Ogre_1_1SceneManagern27">mFogEnd</a>;
01366     }
01367     <font class="comment">//-----------------------------------------------------------------------</font>
<a name="l01368"></a><a class="code" href="classOgre_1_1SceneManager.html#Ogre_1_1SceneManagera55">01368</a>     <a class="code" href="namespaceOgre.html#a281">Real</a> SceneManager::getFogDensity(<font class="keywordtype">void</font>)<font class="keyword"> const</font>
01369 <font class="keyword">    </font>{
01370         <font class="keywordflow">return</font> <a class="code" href="classOgre_1_1SceneManager.html#Ogre_1_1SceneManagern28">mFogDensity</a>;
01371     }
01372     <font class="comment">//-----------------------------------------------------------------------</font>
<a name="l01373"></a><a class="code" href="classOgre_1_1SceneManager.html#Ogre_1_1SceneManagera57">01373</a>     <a class="code" href="classOgre_1_1BillboardSet.html">BillboardSet</a>* SceneManager::createBillboardSet(<font class="keyword">const</font> <a class="code" href="classOgre_1_1String.html">String</a>&amp; name, <font class="keywordtype">unsigned</font> <font class="keywordtype">int</font> poolSize)
01374     {
01375         <a class="code" href="classOgre_1_1BillboardSet.html">BillboardSet</a>* set = <font class="keyword">new</font> <a class="code" href="classOgre_1_1BillboardSet.html">BillboardSet</a>( name, poolSize );
01376         <a class="code" href="classOgre_1_1SceneManager.html#Ogre_1_1SceneManagern6">mBillboardSets</a>[name] = set;<font class="comment">//.insert(BillboardSetList::value_type(name, set));</font>
01377 
01378         <font class="keywordflow">return</font> set;
01379     }
01380     <font class="comment">//-----------------------------------------------------------------------</font>
<a name="l01381"></a><a class="code" href="classOgre_1_1SceneManager.html#Ogre_1_1SceneManagera58">01381</a>     <a class="code" href="classOgre_1_1BillboardSet.html">BillboardSet</a>* SceneManager::getBillboardSet(<font class="keyword">const</font> <a class="code" href="classOgre_1_1String.html">String</a>&amp; name)
01382     {
01383         BillboardSetList::iterator i = <a class="code" href="classOgre_1_1SceneManager.html#Ogre_1_1SceneManagern6">mBillboardSets</a>.find(name);
01384         <font class="keywordflow">if</font> (i == <a class="code" href="classOgre_1_1SceneManager.html#Ogre_1_1SceneManagern6">mBillboardSets</a>.end())
01385         {
01386             <font class="keywordflow">return</font> 0;
01387         }
01388         <font class="keywordflow">else</font>
01389         {
01390             <font class="keywordflow">return</font> i-&gt;second;
01391         }
01392     }
01393     <font class="comment">//-----------------------------------------------------------------------</font>
<a name="l01394"></a><a class="code" href="classOgre_1_1SceneManager.html#Ogre_1_1SceneManagera59">01394</a>     <font class="keywordtype">void</font> SceneManager::removeBillboardSet(<a class="code" href="classOgre_1_1BillboardSet.html">BillboardSet</a>* set)
01395     {
01396         <font class="comment">// Find in list</font>
01397         BillboardSetList::iterator i = <a class="code" href="classOgre_1_1SceneManager.html#Ogre_1_1SceneManagern6">mBillboardSets</a>.begin();
01398         <font class="keywordflow">for</font> (; i != <a class="code" href="classOgre_1_1SceneManager.html#Ogre_1_1SceneManagern6">mBillboardSets</a>.end(); ++i)
01399         {
01400             <font class="keywordflow">if</font> (i-&gt;second == set)
01401             {
01402                 <a class="code" href="classOgre_1_1SceneManager.html#Ogre_1_1SceneManagern6">mBillboardSets</a>.erase(i);
01403                 <font class="keyword">delete</font> set;
01404                 <font class="keywordflow">break</font>;
01405             }
01406         }
01407 
01408     }
01409     <font class="comment">//-----------------------------------------------------------------------</font>
<a name="l01410"></a><a class="code" href="classOgre_1_1SceneManager.html#Ogre_1_1SceneManagera60">01410</a>     <font class="keywordtype">void</font> SceneManager::removeBillboardSet(<font class="keyword">const</font> <a class="code" href="classOgre_1_1String.html">String</a>&amp; name)
01411     {
01412         <font class="comment">// Find in list</font>
01413         BillboardSetList::iterator i = <a class="code" href="classOgre_1_1SceneManager.html#Ogre_1_1SceneManagern6">mBillboardSets</a>.find(name);
01414         <font class="keywordflow">if</font> (i != <a class="code" href="classOgre_1_1SceneManager.html#Ogre_1_1SceneManagern6">mBillboardSets</a>.end())
01415         {
01416             <font class="keyword">delete</font> i-&gt;second;
01417             <a class="code" href="classOgre_1_1SceneManager.html#Ogre_1_1SceneManagern6">mBillboardSets</a>.erase(i);
01418         }
01419     }
01420 
01421 
01422 }
</pre></div><p>
Copyright &copy; 2002 by The OGRE Team<br />
<script type="text/javascript">
<!--//hide script from old browsers
document.write( "Last modified "+ document.lastModified );
//end hiding contents -->
</script>
</p>
</body>
</html>
