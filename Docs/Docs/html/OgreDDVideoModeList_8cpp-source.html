<html>
<head>
<title>OGRE Documentation</title> <meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1"> 
<link type="text/css" rel="stylesheet" href="style.css">
</head>

<body>
<!-- Generated by Doxygen 1.2.16 -->
<center>
<a class="qindex" href="index.html">Main Page</a> &nbsp; <a class="qindex" href="namespaces.html">Namespace List</a> &nbsp; <a class="qindex" href="hierarchy.html">Class Hierarchy</a> &nbsp; <a class="qindex" href="classes.html">Alphabetical List</a> &nbsp; <a class="qindex" href="annotated.html">Compound List</a> &nbsp; <a class="qindex" href="files.html">File List</a> &nbsp; <a class="qindex" href="namespacemembers.html">Namespace Members</a> &nbsp; <a class="qindex" href="functions.html">Compound Members</a> &nbsp; <a class="qindex" href="globals.html">File Members</a> &nbsp; <a class="qindex" href="pages.html">Related Pages</a> &nbsp; </center>
<hr><h1>OgreDDVideoModeList.cpp</h1><a href="OgreDDVideoModeList_8cpp.html">Go to the documentation of this file.</a><div class="fragment"><pre>00001 <font class="comment">/*</font>
00002 <font class="comment">-----------------------------------------------------------------------------</font>
00003 <font class="comment">This source file is part of OGRE</font>
00004 <font class="comment">    (Object-oriented Graphics Rendering Engine)</font>
00005 <font class="comment">For the latest info, see http://www.stevestreeting.com/ogre/</font>
00006 <font class="comment"></font>
00007 <font class="comment">Copyright © 2000-2001 Steven J. Streeting</font>
00008 <font class="comment">Also see acknowledgements in Readme.html</font>
00009 <font class="comment"></font>
00010 <font class="comment">This program is free software; you can redistribute it and/or modify it under</font>
00011 <font class="comment">the terms of the GNU General Public License as published by the Free Software</font>
00012 <font class="comment">Foundation; either version 2 of the License, or (at your option) any later</font>
00013 <font class="comment">version.</font>
00014 <font class="comment"></font>
00015 <font class="comment">This program is distributed in the hope that it will be useful, but WITHOUT</font>
00016 <font class="comment">ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or FITNESS</font>
00017 <font class="comment">FOR A PARTICULAR PURPOSE. See the GNU General Public License for more details.</font>
00018 <font class="comment"></font>
00019 <font class="comment">You should have received a copy of the GNU General Public License along with</font>
00020 <font class="comment">this program; if not, write to the Free Software Foundation, Inc., 59 Temple</font>
00021 <font class="comment">Place - Suite 330, Boston, MA 02111-1307, USA, or go to</font>
00022 <font class="comment">http://www.gnu.org/copyleft/gpl.html.</font>
00023 <font class="comment">-----------------------------------------------------------------------------</font>
00024 <font class="comment">*/</font>
00025 <font class="preprocessor">#include "<a class="code" href="OgreDDVideoModeList_8h.html">OgreDDVideoModeList.h</a>"</font>
00026 <font class="preprocessor">#include "<a class="code" href="OgreDDVideoMode_8h.html">OgreDDVideoMode.h</a>"</font>
00027 <font class="preprocessor">#include "<a class="code" href="OgreException_8h.html">OgreException.h</a>"</font>
00028 
00029 <font class="keyword">namespace </font>Ogre {
00030 
00031     <font class="comment">// Non-member callback functions</font>
<a name="l00032"></a><a class="code" href="namespaceOgre.html#a414">00032</a>     <font class="keyword">static</font> HRESULT CALLBACK <a class="code" href="namespaceOgre.html#a414">DDEnumModesCallback</a>(
00033                                     LPDDSURFACEDESC2 lpDDSD2,
00034                                     LPVOID lpContext)
00035     {
00036         <a class="code" href="classOgre_1_1DDVideoModeList.html">DDVideoModeList</a>* modeList;
00037 
00038         <font class="comment">// Omit any palettised modes</font>
00039         <font class="keywordflow">if</font> (lpDDSD2-&gt;ddpfPixelFormat.dwRGBBitCount &gt;= 16)
00040         {
00041 
00042             modeList = (<a class="code" href="classOgre_1_1DDVideoModeList.html">DDVideoModeList</a>*) lpContext;
00043 
00044             modeList-&gt;<a class="code" href="classOgre_1_1DDVideoModeList.html#Ogre_1_1DDVideoModeListc0">AddMode</a>(lpDDSD2);
00045         }
00046 
00047         <font class="comment">// Continue enumeration</font>
00048         <font class="keywordflow">return</font> DDENUMRET_OK;
00049     }
00050 
00051 
<a name="l00052"></a><a class="code" href="classOgre_1_1DDVideoModeList.html#Ogre_1_1DDVideoModeLista0">00052</a>     DDVideoModeList::DDVideoModeList(LPDIRECTDRAW7 directDraw)
00053     {
00054         <font class="comment">// Will create a  new driver list and enumerate it</font>
00055         <font class="keywordflow">if</font> (directDraw == NULL)
00056             <font class="keywordflow">throw</font> <a class="code" href="classOgre_1_1Exception.html">Exception</a>(0, <font class="stringliteral">"NULL supplied as "</font>
00057                 <font class="stringliteral">"DD interface pointer."</font>, <font class="stringliteral">"DDVideoModeList Contructor"</font>);
00058 
00059         <a class="code" href="classOgre_1_1DDVideoModeList.html#Ogre_1_1DDVideoModeListo0">lpDD7</a> = directDraw;
00060         <font class="comment">// Enumerate the list</font>
00061         <a class="code" href="classOgre_1_1DDVideoModeList.html#Ogre_1_1DDVideoModeLista2">enumerate</a>();
00062 
00063     }
00064 
<a name="l00065"></a><a class="code" href="classOgre_1_1DDVideoModeList.html#Ogre_1_1DDVideoModeLista1">00065</a>     DDVideoModeList::~DDVideoModeList()
00066     {
00067         <font class="comment">// Release each video mode object</font>
00068         std::vector&lt;DDVideoMode&gt;::iterator p = <a class="code" href="classOgre_1_1DDVideoModeList.html#Ogre_1_1DDVideoModeListo1">mModeList</a>.begin();
00069 
00070         <a class="code" href="classOgre_1_1DDVideoModeList.html#Ogre_1_1DDVideoModeListo1">mModeList</a>.erase(p, p+<a class="code" href="classOgre_1_1DDVideoModeList.html#Ogre_1_1DDVideoModeListo1">mModeList</a>.size()-1);
00071     }
00072 
00073 
00074 
00075 
<a name="l00076"></a><a class="code" href="classOgre_1_1DDVideoModeList.html#Ogre_1_1DDVideoModeLista2">00076</a>     BOOL DDVideoModeList::enumerate()
00077     {
00078         HRESULT hr;
00079 
00080         <font class="comment">// Enumerate display modes</font>
00081         <font class="comment">// Different refresh rates are NOT enumerated (dwFlags = 0)</font>
00082         hr = <a class="code" href="classOgre_1_1DDVideoModeList.html#Ogre_1_1DDVideoModeListo0">lpDD7</a>-&gt;EnumDisplayModes(0, NULL, <font class="keyword">this</font>, <a class="code" href="classOgre_1_1DDVideoModeList.html#a414">DDEnumModesCallback</a>);
00083         <font class="keywordflow">if</font> (FAILED(hr))
00084             <font class="keywordflow">throw</font> <a class="code" href="classOgre_1_1Exception.html">Exception</a>(0, <font class="stringliteral">"Error enumerating display modes"</font>, <font class="stringliteral">"DDVideoModeList - enumerate"</font>);
00085 
00086 
00087         <font class="keywordflow">return</font> TRUE;
00088     }
00089 
<a name="l00090"></a><a class="code" href="classOgre_1_1DDVideoModeList.html#Ogre_1_1DDVideoModeListc0">00090</a>     <font class="keywordtype">void</font> DDVideoModeList::AddMode(LPDDSURFACEDESC2 lpDDSD2)
00091     {
00092         <font class="comment">//DDVideoMode *newMode;</font>
00093 
00094 
00095         <font class="comment">// Create new mode</font>
00096         <font class="comment">//newMode = new DDVideoMode(lpDDSD2);</font>
00097 
00098         <font class="comment">// Add it to my list</font>
00099         <a class="code" href="classOgre_1_1DDVideoModeList.html#Ogre_1_1DDVideoModeListo1">mModeList</a>.push_back(<a class="code" href="classOgre_1_1DDVideoMode.html">DDVideoMode</a>(lpDDSD2));
00100 
00101 
00102     }
00103 
<a name="l00104"></a><a class="code" href="classOgre_1_1DDVideoModeList.html#Ogre_1_1DDVideoModeLista4">00104</a>     <font class="keywordtype">unsigned</font> <font class="keywordtype">int</font> DDVideoModeList::count(<font class="keywordtype">void</font>)
00105     {
00106         <font class="keywordflow">return</font> static_cast&lt; unsigned int &gt;( <a class="code" href="classOgre_1_1DDVideoModeList.html#Ogre_1_1DDVideoModeListo1">mModeList</a>.size() );
00107     }
00108 
<a name="l00109"></a><a class="code" href="classOgre_1_1DDVideoModeList.html#Ogre_1_1DDVideoModeLista3">00109</a>     <a class="code" href="classOgre_1_1DDVideoMode.html">DDVideoMode</a>* DDVideoModeList::item(<font class="keywordtype">int</font> index)
00110     {
00111         <font class="comment">// Get an iterator for the vector</font>
00112         std::vector&lt;DDVideoMode&gt;::iterator p = <a class="code" href="classOgre_1_1DDVideoModeList.html#Ogre_1_1DDVideoModeListo1">mModeList</a>.begin();
00113 
00114         <font class="comment">// Return the indexed driver</font>
00115         <font class="keywordflow">return</font> &amp;p[index];
00116 
00117 
00118     }
00119 
<a name="l00120"></a><a class="code" href="classOgre_1_1DDVideoModeList.html#Ogre_1_1DDVideoModeLista5">00120</a>     <a class="code" href="classOgre_1_1DDVideoMode.html">DDVideoMode</a>* DDVideoModeList::getClosestMatch(<font class="keywordtype">int</font> width, <font class="keywordtype">int</font> height, <font class="keywordtype">int</font> colourDepth)
00121     {
00122         <font class="comment">// Search through looking for closest match</font>
00123         <font class="keywordtype">int</font> bestDiff, currentDiff, bestIndex;
00124         <a class="code" href="classOgre_1_1DDVideoMode.html">DDVideoMode</a> *vm;
00125 
00126         std::vector&lt;DDVideoMode&gt;::iterator p = <a class="code" href="classOgre_1_1DDVideoModeList.html#Ogre_1_1DDVideoModeListo1">mModeList</a>.begin();
00127 
00128 
00129         bestDiff = 9999;
00130         bestIndex = -1;
00131         <font class="keywordflow">for</font>( <font class="keywordtype">unsigned</font> j = 0; j &lt; <a class="code" href="classOgre_1_1DDVideoModeList.html#Ogre_1_1DDVideoModeLista4">count</a>(); j++ )
00132         {
00133             currentDiff = 0;
00134             vm = &amp;p[j];
00135             currentDiff += abs(vm-&gt;<a class="code" href="classOgre_1_1DDVideoMode.html#Ogre_1_1DDVideoModem0">mWidth</a> - width);
00136             currentDiff += abs(vm-&gt;<a class="code" href="classOgre_1_1DDVideoMode.html#Ogre_1_1DDVideoModem1">mHeight</a> - height);
00137             currentDiff += abs(vm-&gt;<a class="code" href="classOgre_1_1DDVideoMode.html#Ogre_1_1DDVideoModem2">mColourDepth</a> - colourDepth);
00138 
00139             <font class="keywordflow">if</font> (currentDiff &lt; bestDiff)
00140             {
00141                 bestDiff = currentDiff;
00142                 bestIndex = j;
00143             }
00144 
00145             <font class="comment">/* We Love Intel's Compilers :) */</font>
00146             <font class="keywordflow">if</font> (currentDiff == 0)
00147                 <font class="keywordflow">break</font>; <font class="comment">// No point continuing, direct match</font>
00148         }
00149 
00150         <font class="keywordflow">return</font> &amp;p[bestIndex];
00151     }
00152 
00153 }
00154 
00155 
</pre></div><p>
Copyright &copy; 2002 by The OGRE Team<br />
<script type="text/javascript">
<!--//hide script from old browsers
document.write( "Last modified "+ document.lastModified );
//end hiding contents -->
</script>
</p>
</body>
</html>
