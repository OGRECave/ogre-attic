<html>
<head>
<title>OGRE Documentation</title> <meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1"> 
<link type="text/css" rel="stylesheet" href="style.css">
</head>

<body>
<!-- Generated by Doxygen 1.2.16 -->
<center>
<a class="qindex" href="index.html">Main Page</a> &nbsp; <a class="qindex" href="namespaces.html">Namespace List</a> &nbsp; <a class="qindex" href="hierarchy.html">Class Hierarchy</a> &nbsp; <a class="qindex" href="classes.html">Alphabetical List</a> &nbsp; <a class="qindex" href="annotated.html">Compound List</a> &nbsp; <a class="qindex" href="files.html">File List</a> &nbsp; <a class="qindex" href="namespacemembers.html">Namespace Members</a> &nbsp; <a class="qindex" href="functions.html">Compound Members</a> &nbsp; <a class="qindex" href="globals.html">File Members</a> &nbsp; <a class="qindex" href="pages.html">Related Pages</a> &nbsp; </center>
<hr><h1>OgreNode.cpp</h1><a href="OgreNode_8cpp.html">Go to the documentation of this file.</a><div class="fragment"><pre>00001 <font class="comment">/*</font>
00002 <font class="comment">-----------------------------------------------------------------------------</font>
00003 <font class="comment">This source file is part of OGRE</font>
00004 <font class="comment">    (Object-oriented Graphics Rendering Engine)</font>
00005 <font class="comment">For the latest info, see http://www.stevestreeting.com/ogre/</font>
00006 <font class="comment"></font>
00007 <font class="comment">Copyright © 2000-2001 Steven J. Streeting</font>
00008 <font class="comment">Also see acknowledgements in Readme.html</font>
00009 <font class="comment"></font>
00010 <font class="comment">This program is free software; you can redistribute it and/or modify it under</font>
00011 <font class="comment">the terms of the GNU General Public License as published by the Free Software</font>
00012 <font class="comment">Foundation; either version 2 of the License, or (at your option) any later</font>
00013 <font class="comment">version.</font>
00014 <font class="comment"></font>
00015 <font class="comment">This program is distributed in the hope that it will be useful, but WITHOUT</font>
00016 <font class="comment">ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or FITNESS</font>
00017 <font class="comment">FOR A PARTICULAR PURPOSE. See the GNU General Public License for more details.</font>
00018 <font class="comment"></font>
00019 <font class="comment">You should have received a copy of the GNU General Public License along with</font>
00020 <font class="comment">this program; if not, write to the Free Software Foundation, Inc., 59 Temple</font>
00021 <font class="comment">Place - Suite 330, Boston, MA 02111-1307, USA, or go to</font>
00022 <font class="comment">http://www.gnu.org/copyleft/gpl.html.</font>
00023 <font class="comment">-----------------------------------------------------------------------------</font>
00024 <font class="comment">*/</font>
00025 <font class="preprocessor">#include "<a class="code" href="OgreNode_8h.html">OgreNode.h</a>"</font>
00026 
00027 <font class="preprocessor">#include "<a class="code" href="OgreException_8h.html">OgreException.h</a>"</font>
00028 <font class="preprocessor">#include "<a class="code" href="OgreEntity_8h.html">OgreEntity.h</a>"</font>
00029 <font class="preprocessor">#include "<a class="code" href="OgreCamera_8h.html">OgreCamera.h</a>"</font>
00030 <font class="preprocessor">#include "<a class="code" href="OgreMath_8h.html">OgreMath.h</a>"</font>
00031 <font class="preprocessor">#include "<a class="code" href="OgreSceneManager_8h.html">OgreSceneManager.h</a>"</font>
00032 <font class="preprocessor">#include "<a class="code" href="OgreMovableObject_8h.html">OgreMovableObject.h</a>"</font>
00033 
00034 <font class="keyword">namespace </font>Ogre {
00035     
<a name="l00036"></a><a class="code" href="classOgre_1_1Node.html#Ogre_1_1SceneNodeq0">00036</a>     <font class="keywordtype">unsigned</font> <font class="keywordtype">long</font> Node::msNextGeneratedNameExt = 1;
00037     <font class="comment">//-----------------------------------------------------------------------</font>
<a name="l00038"></a><a class="code" href="classOgre_1_1Node.html#Ogre_1_1Nodea0">00038</a>     Node::Node()
00039     {
00040         <a class="code" href="classOgre_1_1Node.html#Ogre_1_1SceneNoden4">mParent</a> = 0;
00041         <a class="code" href="classOgre_1_1Node.html#Ogre_1_1SceneNoden7">mOrientation</a> = <a class="code" href="classOgre_1_1Node.html#Ogre_1_1SceneNoden12">mDerivedOrientation</a> = Quaternion::IDENTITY;
00042         <a class="code" href="classOgre_1_1Node.html#Ogre_1_1SceneNoden8">mPosition</a> = <a class="code" href="classOgre_1_1Node.html#Ogre_1_1SceneNoden13">mDerivedPosition</a> = Vector3::ZERO;
00043         <a class="code" href="classOgre_1_1Node.html#Ogre_1_1SceneNoden9">mScale</a> = Vector3::UNIT_SCALE;
00044         <a class="code" href="classOgre_1_1Node.html#Ogre_1_1SceneNoden10">mInheritScale</a> = <font class="keyword">true</font>;
00045         <a class="code" href="classOgre_1_1Node.html#Ogre_1_1SceneNoden11">mDerivedOutOfDate</a> = <font class="keyword">true</font>;
00046 
00047         <font class="comment">// Generate a name</font>
00048         <font class="keyword">static</font> <font class="keywordtype">char</font> temp[64];
00049         sprintf(temp, <font class="stringliteral">"Unnamed_%d"</font>, <a class="code" href="classOgre_1_1Node.html#Ogre_1_1SceneNodeq0">msNextGeneratedNameExt</a>++);
00050         <a class="code" href="classOgre_1_1Node.html#Ogre_1_1SceneNoden6">mName</a> = temp;
00051 
00052     }
00053     <font class="comment">//-----------------------------------------------------------------------</font>
<a name="l00054"></a><a class="code" href="classOgre_1_1Node.html#Ogre_1_1Nodea1">00054</a>     Node::Node(<font class="keyword">const</font> <a class="code" href="classOgre_1_1String.html">String</a>&amp; name)
00055     {
00056         <a class="code" href="classOgre_1_1Node.html#Ogre_1_1SceneNoden6">mName</a> = name;
00057         <a class="code" href="classOgre_1_1Node.html#Ogre_1_1SceneNoden4">mParent</a> = 0;
00058         <a class="code" href="classOgre_1_1Node.html#Ogre_1_1SceneNoden7">mOrientation</a> = <a class="code" href="classOgre_1_1Node.html#Ogre_1_1SceneNoden12">mDerivedOrientation</a> = Quaternion::IDENTITY;
00059         <a class="code" href="classOgre_1_1Node.html#Ogre_1_1SceneNoden8">mPosition</a> = <a class="code" href="classOgre_1_1Node.html#Ogre_1_1SceneNoden13">mDerivedPosition</a> = Vector3::ZERO;
00060         <a class="code" href="classOgre_1_1Node.html#Ogre_1_1SceneNoden9">mScale</a> = Vector3::UNIT_SCALE;
00061         <a class="code" href="classOgre_1_1Node.html#Ogre_1_1SceneNoden10">mInheritScale</a> = <font class="keyword">true</font>;
00062         <a class="code" href="classOgre_1_1Node.html#Ogre_1_1SceneNoden11">mDerivedOutOfDate</a> = <font class="keyword">true</font>;
00063     }
00064 
00065     <font class="comment">//-----------------------------------------------------------------------</font>
<a name="l00066"></a><a class="code" href="classOgre_1_1Node.html#Ogre_1_1Nodea2">00066</a>     Node::~Node()
00067     {
00068     }    
00069 
00070     <font class="comment">//-----------------------------------------------------------------------</font>
<a name="l00071"></a><a class="code" href="classOgre_1_1Node.html#Ogre_1_1SceneNodea19">00071</a>     <a class="code" href="classOgre_1_1Node.html">Node</a>* Node::getParent(<font class="keywordtype">void</font>)<font class="keyword"> const</font>
00072 <font class="keyword">    </font>{
00073         <font class="keywordflow">return</font> <a class="code" href="classOgre_1_1Node.html#Ogre_1_1SceneNoden4">mParent</a>;
00074     }
00075 
00076     <font class="comment">//-----------------------------------------------------------------------</font>
<a name="l00077"></a><a class="code" href="classOgre_1_1Node.html#Ogre_1_1SceneNodeb3">00077</a>     <font class="keywordtype">void</font> Node::setParent(<a class="code" href="classOgre_1_1Node.html">Node</a>* parent)
00078     {
00079         <a class="code" href="classOgre_1_1Node.html#Ogre_1_1SceneNoden4">mParent</a> = parent;
00080     }
00081 
00082     <font class="comment">//-----------------------------------------------------------------------</font>
<a name="l00083"></a><a class="code" href="classOgre_1_1Node.html#Ogre_1_1SceneNodea50">00083</a>     <a class="code" href="classOgre_1_1Matrix4.html">Matrix4</a> Node::_getFullTransform(<font class="keywordtype">void</font>)
00084     {
00085         <font class="comment">// Use derived values </font>
00086         <a class="code" href="classOgre_1_1Matrix4.html">Matrix4</a> result;
00087         <a class="code" href="classOgre_1_1Node.html#Ogre_1_1SceneNodeb5">makeTransform</a>( 
00088             <a class="code" href="classOgre_1_1Node.html#Ogre_1_1SceneNodea48">_getDerivedPosition</a>(), <a class="code" href="classOgre_1_1Node.html#Ogre_1_1SceneNodea49">_getDerivedScale</a>(), 
00089             <a class="code" href="classOgre_1_1Node.html#Ogre_1_1SceneNodea47">_getDerivedOrientation</a>(), result);
00090         <font class="keywordflow">return</font> result;
00091     }
00092     <font class="comment">//-----------------------------------------------------------------------</font>
<a name="l00093"></a><a class="code" href="classOgre_1_1Node.html#Ogre_1_1SceneNodea51">00093</a>     <font class="keywordtype">void</font> Node::_update(<font class="keywordtype">bool</font> updateChildren)
00094     {
00095         <font class="comment">// Update transforms</font>
00096         <a class="code" href="classOgre_1_1Node.html#Ogre_1_1SceneNodeb4">_updateFromParent</a>();
00097 
00098         <font class="keywordflow">if</font> (updateChildren)
00099         {
00100             std::vector&lt;Node*&gt;::iterator i;
00101             <font class="keywordflow">for</font> (i = <a class="code" href="classOgre_1_1Node.html#Ogre_1_1SceneNoden5">mChildren</a>.begin(); i != <a class="code" href="classOgre_1_1Node.html#Ogre_1_1SceneNoden5">mChildren</a>.end(); ++i)
00102             {
00103                 (*i)-&gt;_update(updateChildren);
00104             }
00105         }
00106 
00107     }
00108 
00109     <font class="comment">//-----------------------------------------------------------------------</font>
<a name="l00110"></a><a class="code" href="classOgre_1_1Node.html#Ogre_1_1SceneNodeb4">00110</a>     <font class="keywordtype">void</font> Node::_updateFromParent(<font class="keywordtype">void</font>)
00111     {
00112         <font class="keywordflow">if</font> (mParent)
00113         {
00114             <font class="comment">// Combine orientation with that of parent</font>
00115             <a class="code" href="classOgre_1_1Quaternion.html">Quaternion</a> mParentQ = <a class="code" href="classOgre_1_1Node.html#Ogre_1_1SceneNoden4">mParent</a>-&gt;<a class="code" href="classOgre_1_1Node.html#Ogre_1_1SceneNodea47">_getDerivedOrientation</a>();
00116             <a class="code" href="classOgre_1_1Node.html#Ogre_1_1SceneNoden12">mDerivedOrientation</a> = mParentQ * <a class="code" href="classOgre_1_1Node.html#Ogre_1_1SceneNoden7">mOrientation</a>;
00117 
00118             <font class="comment">// Change position vector based on parent's orientation</font>
00119             <a class="code" href="classOgre_1_1Node.html#Ogre_1_1SceneNoden13">mDerivedPosition</a> = mParentQ * <a class="code" href="classOgre_1_1Node.html#Ogre_1_1SceneNoden8">mPosition</a>;
00120 
00121             <font class="comment">// Update scale</font>
00122             <font class="keywordflow">if</font> (mInheritScale)
00123             {
00124                 <font class="comment">// Scale own position by parent scale</font>
00125                 <a class="code" href="classOgre_1_1Vector3.html">Vector3</a> parentScale = <a class="code" href="classOgre_1_1Node.html#Ogre_1_1SceneNoden4">mParent</a>-&gt;<a class="code" href="classOgre_1_1Node.html#Ogre_1_1SceneNodea49">_getDerivedScale</a>();
00126                 <a class="code" href="classOgre_1_1Node.html#Ogre_1_1SceneNoden13">mDerivedPosition</a> = <a class="code" href="classOgre_1_1Node.html#Ogre_1_1SceneNoden13">mDerivedPosition</a> * parentScale;
00127 
00128                 <font class="comment">// Set own scale, NB just combine as equivalent axes, no shearing</font>
00129                 <a class="code" href="classOgre_1_1Node.html#Ogre_1_1SceneNoden14">mDerivedScale</a> = <a class="code" href="classOgre_1_1Node.html#Ogre_1_1SceneNoden9">mScale</a> * parentScale;
00130 
00131             }
00132             <font class="keywordflow">else</font>
00133             {
00134                 <font class="comment">// No inheritence</font>
00135                 <a class="code" href="classOgre_1_1Node.html#Ogre_1_1SceneNoden14">mDerivedScale</a> = <a class="code" href="classOgre_1_1Node.html#Ogre_1_1SceneNoden9">mScale</a>;
00136             }
00137 
00138             <font class="comment">// Add altered position vector to parents</font>
00139             <a class="code" href="classOgre_1_1Node.html#Ogre_1_1SceneNoden13">mDerivedPosition</a> += <a class="code" href="classOgre_1_1Node.html#Ogre_1_1SceneNoden4">mParent</a>-&gt;<a class="code" href="classOgre_1_1Node.html#Ogre_1_1SceneNodea48">_getDerivedPosition</a>();
00140         }
00141         <font class="keywordflow">else</font>
00142         {
00143             <font class="comment">// Root node, no parent</font>
00144             <a class="code" href="classOgre_1_1Node.html#Ogre_1_1SceneNoden12">mDerivedOrientation</a> = <a class="code" href="classOgre_1_1Node.html#Ogre_1_1SceneNoden7">mOrientation</a>;
00145             <a class="code" href="classOgre_1_1Node.html#Ogre_1_1SceneNoden13">mDerivedPosition</a> = <a class="code" href="classOgre_1_1Node.html#Ogre_1_1SceneNoden8">mPosition</a>;
00146             <a class="code" href="classOgre_1_1Node.html#Ogre_1_1SceneNoden14">mDerivedScale</a> = <a class="code" href="classOgre_1_1Node.html#Ogre_1_1SceneNoden9">mScale</a>;
00147         }
00148 
00149         <a class="code" href="classOgre_1_1Node.html#Ogre_1_1SceneNoden11">mDerivedOutOfDate</a> = <font class="keyword">false</font>;
00150     }
00151     <font class="comment">//-----------------------------------------------------------------------</font>
<a name="l00152"></a><a class="code" href="classOgre_1_1Node.html#Ogre_1_1Nodea28">00152</a>     <a class="code" href="classOgre_1_1Node.html">Node</a>* Node::createChild(<font class="keyword">const</font> <a class="code" href="classOgre_1_1Vector3.html">Vector3</a>&amp; translate, <font class="keyword">const</font> <a class="code" href="classOgre_1_1Quaternion.html">Quaternion</a>&amp; rotate)
00153     {
00154         <a class="code" href="classOgre_1_1Node.html">Node</a>* newNode = <a class="code" href="classOgre_1_1Node.html#Ogre_1_1Nodeb2">createChildImpl</a>();
00155         newNode-&gt;<a class="code" href="classOgre_1_1Node.html#Ogre_1_1SceneNodea33">translate</a>(translate);
00156         newNode-&gt;<a class="code" href="classOgre_1_1Node.html#Ogre_1_1SceneNodea40">rotate</a>(rotate);
00157         this-&gt;<a class="code" href="classOgre_1_1Node.html#Ogre_1_1SceneNodea43">addChild</a>(newNode);
00158 
00159         <font class="keywordflow">return</font> newNode;
00160     }
00161     <font class="comment">//-----------------------------------------------------------------------</font>
<a name="l00162"></a><a class="code" href="classOgre_1_1Node.html#Ogre_1_1Nodea29">00162</a>     <a class="code" href="classOgre_1_1Node.html">Node</a>* Node::createChild(<font class="keyword">const</font> <a class="code" href="classOgre_1_1String.html">String</a>&amp; name, <font class="keyword">const</font> <a class="code" href="classOgre_1_1Vector3.html">Vector3</a>&amp; translate, <font class="keyword">const</font> <a class="code" href="classOgre_1_1Quaternion.html">Quaternion</a>&amp; rotate)
00163     {
00164         <a class="code" href="classOgre_1_1Node.html">Node</a>* newNode = <a class="code" href="classOgre_1_1Node.html#Ogre_1_1Nodeb2">createChildImpl</a>(name);
00165         newNode-&gt;<a class="code" href="classOgre_1_1Node.html#Ogre_1_1SceneNodea33">translate</a>(translate);
00166         newNode-&gt;<a class="code" href="classOgre_1_1Node.html#Ogre_1_1SceneNodea40">rotate</a>(rotate);
00167         this-&gt;<a class="code" href="classOgre_1_1Node.html#Ogre_1_1SceneNodea43">addChild</a>(newNode);
00168 
00169         <font class="keywordflow">return</font> newNode;
00170     }
00171     <font class="comment">//-----------------------------------------------------------------------</font>
<a name="l00172"></a><a class="code" href="classOgre_1_1Node.html#Ogre_1_1SceneNodea43">00172</a>     <font class="keywordtype">void</font> Node::addChild(<a class="code" href="classOgre_1_1Node.html">Node</a>* child)
00173     {
00174         <a class="code" href="classOgre_1_1Node.html#Ogre_1_1SceneNoden5">mChildren</a>.push_back(child);
00175         child-&gt;<a class="code" href="classOgre_1_1Node.html#Ogre_1_1SceneNodeb3">setParent</a>(<font class="keyword">this</font>);
00176         <font class="comment">// Make sure child is up to date first, incase child asks for derived transform</font>
00177         child-&gt;<a class="code" href="classOgre_1_1Node.html#Ogre_1_1SceneNodeb4">_updateFromParent</a>();
00178     }
00179     <font class="comment">//-----------------------------------------------------------------------</font>
<a name="l00180"></a><a class="code" href="classOgre_1_1Node.html#Ogre_1_1SceneNodea44">00180</a>     <font class="keywordtype">unsigned</font> <font class="keywordtype">short</font> Node::numChildren(<font class="keywordtype">void</font>)<font class="keyword"> const</font>
00181 <font class="keyword">    </font>{
00182         <font class="keywordflow">return</font> static_cast&lt; unsigned short &gt;( <a class="code" href="classOgre_1_1Node.html#Ogre_1_1SceneNoden5">mChildren</a>.size() );
00183     }
00184     <font class="comment">//-----------------------------------------------------------------------</font>
<a name="l00185"></a><a class="code" href="classOgre_1_1Node.html#Ogre_1_1SceneNodea45">00185</a>     <a class="code" href="classOgre_1_1Node.html">Node</a>* Node::getChild(<font class="keywordtype">unsigned</font> <font class="keywordtype">short</font> index)<font class="keyword"> const</font>
00186 <font class="keyword">    </font>{
00187         <font class="keywordflow">if</font>( index &lt; <a class="code" href="classOgre_1_1Node.html#Ogre_1_1SceneNoden5">mChildren</a>.size() )
00188             <font class="keywordflow">return</font> <a class="code" href="classOgre_1_1Node.html#Ogre_1_1SceneNoden5">mChildren</a>[index];
00189         <font class="keywordflow">else</font>
00190             <font class="keywordflow">return</font> NULL;
00191     }
00192     <font class="comment">//-----------------------------------------------------------------------</font>
<a name="l00193"></a><a class="code" href="classOgre_1_1Node.html#Ogre_1_1Nodea33">00193</a>     <a class="code" href="classOgre_1_1Node.html">Node</a>* Node::removeChild(<font class="keywordtype">unsigned</font> <font class="keywordtype">short</font> index)
00194     {
00195         <a class="code" href="classOgre_1_1Node.html">Node</a>* ret;
00196         <font class="keywordflow">if</font> (index &lt; <a class="code" href="classOgre_1_1Node.html#Ogre_1_1SceneNoden5">mChildren</a>.size())
00197         {
00198             std::vector&lt;Node*&gt;::iterator i = <a class="code" href="classOgre_1_1Node.html#Ogre_1_1SceneNoden5">mChildren</a>.begin() + index;
00199             ret = *i;
00200             <a class="code" href="classOgre_1_1Node.html#Ogre_1_1SceneNoden5">mChildren</a>.erase(i);
00201             <font class="keywordflow">return</font> ret;            
00202         }
00203         <font class="keywordflow">else</font>
00204         {
00205             <a class="code" href="OgreException_8h.html#a0">Except</a>(
00206                 Exception::ERR_INVALIDPARAMS, 
00207                 <font class="stringliteral">"Child index out of bounds."</font>, 
00208                 <font class="stringliteral">"Node::getChild"</font> );
00209         }
00210         <font class="keywordflow">return</font> 0;
00211     }
00212     <font class="comment">//-----------------------------------------------------------------------</font>
<a name="l00213"></a><a class="code" href="classOgre_1_1Node.html#Ogre_1_1SceneNodea20">00213</a>     <font class="keyword">const</font> <a class="code" href="classOgre_1_1Quaternion.html">Quaternion</a>&amp; Node::getOrientation()<font class="keyword"> const</font>
00214 <font class="keyword">    </font>{
00215         <font class="keywordflow">return</font> <a class="code" href="classOgre_1_1Node.html#Ogre_1_1SceneNoden7">mOrientation</a>;
00216     }
00217 
00218     <font class="comment">//-----------------------------------------------------------------------</font>
<a name="l00219"></a><a class="code" href="classOgre_1_1Node.html#Ogre_1_1SceneNodea21">00219</a>     <font class="keywordtype">void</font> Node::setOrientation( <font class="keyword">const</font> <a class="code" href="classOgre_1_1Quaternion.html">Quaternion</a> &amp; q )
00220     {
00221         <a class="code" href="classOgre_1_1Node.html#Ogre_1_1SceneNoden7">mOrientation</a> = q;
00222         <a class="code" href="classOgre_1_1Node.html#Ogre_1_1SceneNoden11">mDerivedOutOfDate</a> = <font class="keyword">true</font>;
00223     }
00224 
00225     <font class="comment">//-----------------------------------------------------------------------</font>
<a name="l00226"></a><a class="code" href="classOgre_1_1Node.html#Ogre_1_1SceneNodea22">00226</a>     <font class="keywordtype">void</font> Node::resetOrientation(<font class="keywordtype">void</font>)
00227     {
00228         <a class="code" href="classOgre_1_1Node.html#Ogre_1_1SceneNoden7">mOrientation</a> = Quaternion::IDENTITY;
00229         <a class="code" href="classOgre_1_1Node.html#Ogre_1_1SceneNoden11">mDerivedOutOfDate</a> = <font class="keyword">true</font>;
00230     }
00231 
00232     <font class="comment">//-----------------------------------------------------------------------</font>
<a name="l00233"></a><a class="code" href="classOgre_1_1Node.html#Ogre_1_1SceneNodea23">00233</a>     <font class="keywordtype">void</font> Node::setPosition(<font class="keyword">const</font> <a class="code" href="classOgre_1_1Vector3.html">Vector3</a>&amp; pos)
00234     {
00235         <a class="code" href="classOgre_1_1Node.html#Ogre_1_1SceneNoden8">mPosition</a> = pos;
00236         <a class="code" href="classOgre_1_1Node.html#Ogre_1_1SceneNoden11">mDerivedOutOfDate</a> = <font class="keyword">true</font>;
00237     }
00238 
00239 
00240     <font class="comment">//-----------------------------------------------------------------------</font>
<a name="l00241"></a><a class="code" href="classOgre_1_1Node.html#Ogre_1_1SceneNodea24">00241</a>     <font class="keywordtype">void</font> Node::setPosition(<a class="code" href="namespaceOgre.html#a281">Real</a> x, <a class="code" href="namespaceOgre.html#a281">Real</a> y, <a class="code" href="namespaceOgre.html#a281">Real</a> z)
00242     {
00243         <a class="code" href="classOgre_1_1Vector3.html">Vector3</a> v(x,y,z);
00244         <a class="code" href="classOgre_1_1Node.html#Ogre_1_1SceneNodea23">setPosition</a>(v);
00245     }
00246 
00247     <font class="comment">//-----------------------------------------------------------------------</font>
<a name="l00248"></a><a class="code" href="classOgre_1_1Node.html#Ogre_1_1SceneNodea25">00248</a>     <font class="keyword">const</font> <a class="code" href="classOgre_1_1Vector3.html">Vector3</a> &amp; Node::getPosition(<font class="keywordtype">void</font>)<font class="keyword"> const</font>
00249 <font class="keyword">    </font>{
00250         <font class="keywordflow">return</font> <a class="code" href="classOgre_1_1Node.html#Ogre_1_1SceneNoden8">mPosition</a>;
00251     }
00252     <font class="comment">//-----------------------------------------------------------------------</font>
<a name="l00253"></a><a class="code" href="classOgre_1_1Node.html#Ogre_1_1SceneNodea42">00253</a>     <a class="code" href="classOgre_1_1Matrix3.html">Matrix3</a> Node::getLocalAxes(<font class="keywordtype">void</font>)
00254     {
00255         <a class="code" href="classOgre_1_1Vector3.html">Vector3</a> axisX = Vector3::UNIT_X;
00256         <a class="code" href="classOgre_1_1Vector3.html">Vector3</a> axisY = Vector3::UNIT_Y;
00257         <a class="code" href="classOgre_1_1Vector3.html">Vector3</a> axisZ = Vector3::UNIT_Z;
00258 
00259         axisX = <a class="code" href="classOgre_1_1Node.html#Ogre_1_1SceneNoden7">mOrientation</a> * axisX;
00260         axisY = <a class="code" href="classOgre_1_1Node.html#Ogre_1_1SceneNoden7">mOrientation</a> * axisY;
00261         axisZ = <a class="code" href="classOgre_1_1Node.html#Ogre_1_1SceneNoden7">mOrientation</a> * axisZ;
00262 
00263         <font class="keywordflow">return</font> <a class="code" href="classOgre_1_1Matrix3.html">Matrix3</a>(axisX.<a class="code" href="classOgre_1_1Vector3.html#Ogre_1_1Vector3m0">x</a>, axisY.<a class="code" href="classOgre_1_1Vector3.html#Ogre_1_1Vector3m0">x</a>, axisZ.<a class="code" href="classOgre_1_1Vector3.html#Ogre_1_1Vector3m0">x</a>,
00264                        axisX.<a class="code" href="classOgre_1_1Vector3.html#Ogre_1_1Vector3m1">y</a>, axisY.<a class="code" href="classOgre_1_1Vector3.html#Ogre_1_1Vector3m1">y</a>, axisZ.<a class="code" href="classOgre_1_1Vector3.html#Ogre_1_1Vector3m1">y</a>,
00265                        axisX.<a class="code" href="classOgre_1_1Vector3.html#Ogre_1_1Vector3m2">z</a>, axisY.<a class="code" href="classOgre_1_1Vector3.html#Ogre_1_1Vector3m2">z</a>, axisZ.<a class="code" href="classOgre_1_1Vector3.html#Ogre_1_1Vector3m2">z</a>);
00266     }
00267 
00268     <font class="comment">//-----------------------------------------------------------------------</font>
<a name="l00269"></a><a class="code" href="classOgre_1_1Node.html#Ogre_1_1SceneNodea33">00269</a>     <font class="keywordtype">void</font> Node::translate(<font class="keyword">const</font> <a class="code" href="classOgre_1_1Vector3.html">Vector3</a>&amp; d)
00270     {
00271         <a class="code" href="classOgre_1_1Node.html#Ogre_1_1SceneNoden8">mPosition</a> += d;
00272         <a class="code" href="classOgre_1_1Node.html#Ogre_1_1SceneNoden11">mDerivedOutOfDate</a> = <font class="keyword">true</font>;
00273 
00274     }
00275     <font class="comment">//-----------------------------------------------------------------------</font>
<a name="l00276"></a><a class="code" href="classOgre_1_1Node.html#Ogre_1_1SceneNodea34">00276</a>     <font class="keywordtype">void</font> Node::translate(<a class="code" href="namespaceOgre.html#a281">Real</a> x, <a class="code" href="namespaceOgre.html#a281">Real</a> y, <a class="code" href="namespaceOgre.html#a281">Real</a> z)
00277     {
00278         <a class="code" href="classOgre_1_1Vector3.html">Vector3</a> v(x,y,z);
00279         <a class="code" href="classOgre_1_1Node.html#Ogre_1_1SceneNodea33">translate</a>(v);
00280     }
00281     <font class="comment">//-----------------------------------------------------------------------</font>
<a name="l00282"></a><a class="code" href="classOgre_1_1Node.html#Ogre_1_1SceneNodea35">00282</a>     <font class="keywordtype">void</font> Node::translate(<font class="keyword">const</font> <a class="code" href="classOgre_1_1Matrix3.html">Matrix3</a>&amp; axes, <font class="keyword">const</font> <a class="code" href="classOgre_1_1Vector3.html">Vector3</a>&amp; move)
00283     {
00284         <a class="code" href="classOgre_1_1Vector3.html">Vector3</a> derived = axes * move;
00285         <a class="code" href="classOgre_1_1Node.html#Ogre_1_1SceneNodea33">translate</a>(derived);
00286     }
00287     <font class="comment">//-----------------------------------------------------------------------</font>
<a name="l00288"></a><a class="code" href="classOgre_1_1Node.html#Ogre_1_1SceneNodea36">00288</a>     <font class="keywordtype">void</font> Node::translate(<font class="keyword">const</font> <a class="code" href="classOgre_1_1Matrix3.html">Matrix3</a>&amp; axes, <a class="code" href="namespaceOgre.html#a281">Real</a> x, <a class="code" href="namespaceOgre.html#a281">Real</a> y, <a class="code" href="namespaceOgre.html#a281">Real</a> z)
00289     {
00290         <a class="code" href="classOgre_1_1Vector3.html">Vector3</a> d(x,y,z);
00291         <a class="code" href="classOgre_1_1Node.html#Ogre_1_1SceneNodea33">translate</a>(axes,d);
00292     }
00293     <font class="comment">//-----------------------------------------------------------------------</font>
<a name="l00294"></a><a class="code" href="classOgre_1_1Node.html#Ogre_1_1SceneNodea37">00294</a>     <font class="keywordtype">void</font> Node::roll(<a class="code" href="namespaceOgre.html#a281">Real</a> degrees)
00295     {
00296         <font class="comment">// Rotate around local Z axis</font>
00297         <a class="code" href="classOgre_1_1Vector3.html">Vector3</a> zAxis = <a class="code" href="classOgre_1_1Node.html#Ogre_1_1SceneNoden7">mOrientation</a> * Vector3::UNIT_Z;
00298         <a class="code" href="classOgre_1_1Node.html#Ogre_1_1SceneNodea40">rotate</a>(zAxis, degrees);
00299     }
00300     <font class="comment">//-----------------------------------------------------------------------</font>
<a name="l00301"></a><a class="code" href="classOgre_1_1Node.html#Ogre_1_1SceneNodea38">00301</a>     <font class="keywordtype">void</font> Node::pitch(<a class="code" href="namespaceOgre.html#a281">Real</a> degrees)
00302     {
00303         <font class="comment">// Rotate around local X axis</font>
00304         <a class="code" href="classOgre_1_1Vector3.html">Vector3</a> xAxis = <a class="code" href="classOgre_1_1Node.html#Ogre_1_1SceneNoden7">mOrientation</a> * Vector3::UNIT_X;
00305         <a class="code" href="classOgre_1_1Node.html#Ogre_1_1SceneNodea40">rotate</a>(xAxis, degrees);
00306     }
00307     <font class="comment">//-----------------------------------------------------------------------</font>
<a name="l00308"></a><a class="code" href="classOgre_1_1Node.html#Ogre_1_1SceneNodea39">00308</a>     <font class="keywordtype">void</font> Node::yaw(<a class="code" href="namespaceOgre.html#a281">Real</a> degrees)
00309     {
00310         <font class="comment">// Rotate around local Y axis</font>
00311         <a class="code" href="classOgre_1_1Vector3.html">Vector3</a> yAxis = <a class="code" href="classOgre_1_1Node.html#Ogre_1_1SceneNoden7">mOrientation</a> * Vector3::UNIT_Y;
00312         <a class="code" href="classOgre_1_1Node.html#Ogre_1_1SceneNodea40">rotate</a>(yAxis, degrees);
00313 
00314     }
00315     <font class="comment">//-----------------------------------------------------------------------</font>
<a name="l00316"></a><a class="code" href="classOgre_1_1Node.html#Ogre_1_1SceneNodea40">00316</a>     <font class="keywordtype">void</font> Node::rotate(<font class="keyword">const</font> <a class="code" href="classOgre_1_1Vector3.html">Vector3</a>&amp; axis, <a class="code" href="namespaceOgre.html#a281">Real</a> degrees)
00317     {
00318         <a class="code" href="classOgre_1_1Quaternion.html">Quaternion</a> q;
00319         q.<a class="code" href="classOgre_1_1Quaternion.html#Ogre_1_1Quaterniona4">FromAngleAxis</a>(Math::getSingleton().DegreesToRadians(degrees),axis);
00320         <a class="code" href="classOgre_1_1Node.html#Ogre_1_1SceneNodea40">rotate</a>(q);
00321     }
00322 
00323     <font class="comment">//-----------------------------------------------------------------------</font>
<a name="l00324"></a><a class="code" href="classOgre_1_1Node.html#Ogre_1_1SceneNodea41">00324</a>     <font class="keywordtype">void</font> Node::rotate(<font class="keyword">const</font> <a class="code" href="classOgre_1_1Quaternion.html">Quaternion</a>&amp; q)
00325     {
00326         <font class="comment">// Note the order of the mult, i.e. q comes after</font>
00327         <a class="code" href="classOgre_1_1Node.html#Ogre_1_1SceneNoden7">mOrientation</a> = q * <a class="code" href="classOgre_1_1Node.html#Ogre_1_1SceneNoden7">mOrientation</a>;
00328         <a class="code" href="classOgre_1_1Node.html#Ogre_1_1SceneNoden11">mDerivedOutOfDate</a> = <font class="keyword">true</font>;
00329     }
00330     <font class="comment">//-----------------------------------------------------------------------</font>
<a name="l00331"></a><a class="code" href="classOgre_1_1Node.html#Ogre_1_1SceneNodea47">00331</a>     <font class="keyword">const</font> <a class="code" href="classOgre_1_1Quaternion.html">Quaternion</a> &amp; Node::_getDerivedOrientation(<font class="keywordtype">void</font>)
00332     {
00333         <font class="keywordflow">if</font> (mDerivedOutOfDate)
00334         {
00335             <a class="code" href="classOgre_1_1Node.html#Ogre_1_1SceneNodeb4">_updateFromParent</a>();
00336         }
00337         <font class="keywordflow">return</font> <a class="code" href="classOgre_1_1Node.html#Ogre_1_1SceneNoden12">mDerivedOrientation</a>;
00338     }
00339     <font class="comment">//-----------------------------------------------------------------------</font>
<a name="l00340"></a><a class="code" href="classOgre_1_1Node.html#Ogre_1_1SceneNodea48">00340</a>     <font class="keyword">const</font> <a class="code" href="classOgre_1_1Vector3.html">Vector3</a> &amp; Node::_getDerivedPosition(<font class="keywordtype">void</font>)
00341     {
00342         <font class="keywordflow">if</font> (mDerivedOutOfDate)
00343         {
00344             <a class="code" href="classOgre_1_1Node.html#Ogre_1_1SceneNodeb4">_updateFromParent</a>();
00345         }
00346         <font class="keywordflow">return</font> <a class="code" href="classOgre_1_1Node.html#Ogre_1_1SceneNoden13">mDerivedPosition</a>;
00347     }
00348     <font class="comment">//-----------------------------------------------------------------------</font>
<a name="l00349"></a><a class="code" href="classOgre_1_1Node.html#Ogre_1_1SceneNodea49">00349</a>     <font class="keyword">const</font> <a class="code" href="classOgre_1_1Vector3.html">Vector3</a> &amp; Node::_getDerivedScale(<font class="keywordtype">void</font>)
00350     {
00351         <font class="keywordflow">if</font> (mDerivedOutOfDate)
00352         {
00353             <a class="code" href="classOgre_1_1Node.html#Ogre_1_1SceneNodeb4">_updateFromParent</a>();
00354         }
00355         <font class="keywordflow">return</font> <a class="code" href="classOgre_1_1Node.html#Ogre_1_1SceneNoden14">mDerivedScale</a>;
00356     }
00357     <font class="comment">//-----------------------------------------------------------------------</font>
<a name="l00358"></a><a class="code" href="classOgre_1_1Node.html#Ogre_1_1SceneNodea46">00358</a>     <font class="keywordtype">void</font> Node::removeAllChildren(<font class="keywordtype">void</font>)
00359     {
00360         <a class="code" href="classOgre_1_1Node.html#Ogre_1_1SceneNoden5">mChildren</a>.clear();
00361     }
00362     <font class="comment">//-----------------------------------------------------------------------</font>
<a name="l00363"></a><a class="code" href="classOgre_1_1Node.html#Ogre_1_1SceneNodea26">00363</a>     <font class="keywordtype">void</font> Node::setScale(<font class="keyword">const</font> <a class="code" href="classOgre_1_1Vector3.html">Vector3</a>&amp; scale)
00364     {
00365         <a class="code" href="classOgre_1_1Node.html#Ogre_1_1SceneNoden9">mScale</a> = scale;
00366         <a class="code" href="classOgre_1_1Node.html#Ogre_1_1SceneNoden11">mDerivedOutOfDate</a> = <font class="keyword">true</font>;
00367     }
00368     <font class="comment">//-----------------------------------------------------------------------</font>
<a name="l00369"></a><a class="code" href="classOgre_1_1Node.html#Ogre_1_1SceneNodea27">00369</a>     <font class="keywordtype">void</font> Node::setScale(<a class="code" href="namespaceOgre.html#a281">Real</a> x, <a class="code" href="namespaceOgre.html#a281">Real</a> y, <a class="code" href="namespaceOgre.html#a281">Real</a> z)
00370     {
00371         <a class="code" href="classOgre_1_1Node.html#Ogre_1_1SceneNoden9">mScale</a>.<a class="code" href="classOgre_1_1Vector3.html#Ogre_1_1Vector3m0">x</a> = x;
00372         <a class="code" href="classOgre_1_1Node.html#Ogre_1_1SceneNoden9">mScale</a>.<a class="code" href="classOgre_1_1Vector3.html#Ogre_1_1Vector3m1">y</a> = y;
00373         <a class="code" href="classOgre_1_1Node.html#Ogre_1_1SceneNoden9">mScale</a>.<a class="code" href="classOgre_1_1Vector3.html#Ogre_1_1Vector3m2">z</a> = z;
00374         <a class="code" href="classOgre_1_1Node.html#Ogre_1_1SceneNoden11">mDerivedOutOfDate</a> = <font class="keyword">true</font>;
00375     }
00376     <font class="comment">//-----------------------------------------------------------------------</font>
<a name="l00377"></a><a class="code" href="classOgre_1_1Node.html#Ogre_1_1SceneNodea28">00377</a>     <font class="keyword">const</font> <a class="code" href="classOgre_1_1Vector3.html">Vector3</a> &amp; Node::getScale(<font class="keywordtype">void</font>)<font class="keyword"> const</font>
00378 <font class="keyword">    </font>{
00379         <font class="keywordflow">return</font> <a class="code" href="classOgre_1_1Node.html#Ogre_1_1SceneNoden9">mScale</a>;
00380     }
00381     <font class="comment">//-----------------------------------------------------------------------</font>
<a name="l00382"></a><a class="code" href="classOgre_1_1Node.html#Ogre_1_1SceneNodea29">00382</a>     <font class="keywordtype">void</font> Node::setInheritScale(<font class="keywordtype">bool</font> inherit)
00383     {
00384         <a class="code" href="classOgre_1_1Node.html#Ogre_1_1SceneNoden10">mInheritScale</a> = inherit;
00385         <a class="code" href="classOgre_1_1Node.html#Ogre_1_1SceneNoden11">mDerivedOutOfDate</a> = <font class="keyword">true</font>;
00386     }
00387     <font class="comment">//-----------------------------------------------------------------------</font>
<a name="l00388"></a><a class="code" href="classOgre_1_1Node.html#Ogre_1_1SceneNodea30">00388</a>     <font class="keywordtype">bool</font> Node::getInheritScale(<font class="keywordtype">void</font>)<font class="keyword"> const</font>
00389 <font class="keyword">    </font>{
00390         <font class="keywordflow">return</font> <a class="code" href="classOgre_1_1Node.html#Ogre_1_1SceneNoden10">mInheritScale</a>;
00391     }
00392     <font class="comment">//-----------------------------------------------------------------------</font>
<a name="l00393"></a><a class="code" href="classOgre_1_1Node.html#Ogre_1_1SceneNodea31">00393</a>     <font class="keywordtype">void</font> Node::scale(<font class="keyword">const</font> <a class="code" href="classOgre_1_1Vector3.html">Vector3</a>&amp; scale)
00394     {
00395         <a class="code" href="classOgre_1_1Node.html#Ogre_1_1SceneNoden9">mScale</a> = <a class="code" href="classOgre_1_1Node.html#Ogre_1_1SceneNoden9">mScale</a> * scale;
00396         <a class="code" href="classOgre_1_1Node.html#Ogre_1_1SceneNoden11">mDerivedOutOfDate</a> = <font class="keyword">true</font>;
00397 
00398     }
00399     <font class="comment">//-----------------------------------------------------------------------</font>
<a name="l00400"></a><a class="code" href="classOgre_1_1Node.html#Ogre_1_1SceneNodea32">00400</a>     <font class="keywordtype">void</font> Node::scale(<a class="code" href="namespaceOgre.html#a281">Real</a> x, <a class="code" href="namespaceOgre.html#a281">Real</a> y, <a class="code" href="namespaceOgre.html#a281">Real</a> z)
00401     {
00402         <a class="code" href="classOgre_1_1Node.html#Ogre_1_1SceneNoden9">mScale</a>.<a class="code" href="classOgre_1_1Vector3.html#Ogre_1_1Vector3m0">x</a> *= x;
00403         <a class="code" href="classOgre_1_1Node.html#Ogre_1_1SceneNoden9">mScale</a>.<a class="code" href="classOgre_1_1Vector3.html#Ogre_1_1Vector3m1">y</a> *= y;
00404         <a class="code" href="classOgre_1_1Node.html#Ogre_1_1SceneNoden9">mScale</a>.<a class="code" href="classOgre_1_1Vector3.html#Ogre_1_1Vector3m2">z</a> *= z;
00405         <a class="code" href="classOgre_1_1Node.html#Ogre_1_1SceneNoden11">mDerivedOutOfDate</a> = <font class="keyword">true</font>;
00406 
00407     }
00408     <font class="comment">//-----------------------------------------------------------------------</font>
<a name="l00409"></a><a class="code" href="classOgre_1_1Node.html#Ogre_1_1SceneNodeb5">00409</a>     <font class="keywordtype">void</font> Node::makeTransform(<font class="keyword">const</font> <a class="code" href="classOgre_1_1Vector3.html">Vector3</a>&amp; position, <font class="keyword">const</font> <a class="code" href="classOgre_1_1Vector3.html">Vector3</a>&amp; scale, <font class="keyword">const</font> <a class="code" href="classOgre_1_1Quaternion.html">Quaternion</a>&amp; orientation, 
00410         <a class="code" href="classOgre_1_1Matrix4.html">Matrix4</a>&amp; destMatrix)
00411     {
00412         destMatrix = Matrix4::IDENTITY;
00413         <font class="comment">// Note that translation is always after rotation.</font>
00414         <font class="comment">// Parent scaling is already applied to derived position</font>
00415         <font class="comment">// Own scale is applied after rotation</font>
00416         <a class="code" href="classOgre_1_1Matrix3.html">Matrix3</a> rot_scale;
00417         orientation.<a class="code" href="classOgre_1_1Quaternion.html#Ogre_1_1Quaterniona3">ToRotationMatrix</a>(rot_scale);
00418         <font class="comment">// Apply scale</font>
00419         rot_scale[0][0] *= scale.<a class="code" href="classOgre_1_1Vector3.html#Ogre_1_1Vector3m0">x</a>;
00420         rot_scale[1][1] *= scale.<a class="code" href="classOgre_1_1Vector3.html#Ogre_1_1Vector3m1">y</a>;
00421         rot_scale[2][2] *= scale.<a class="code" href="classOgre_1_1Vector3.html#Ogre_1_1Vector3m2">z</a>;
00422 
00423         destMatrix = rot_scale;
00424         destMatrix.<a class="code" href="classOgre_1_1Matrix4.html#Ogre_1_1Matrix4a13">setTrans</a>(position);
00425     }
00426 }
</pre></div><p>
Copyright &copy; 2002 by The OGRE Team<br />
<script type="text/javascript">
<!--//hide script from old browsers
document.write( "Last modified "+ document.lastModified );
//end hiding contents -->
</script>
</p>
</body>
</html>
