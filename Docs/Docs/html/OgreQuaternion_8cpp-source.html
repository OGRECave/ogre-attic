<html>
<head>
<title>OGRE Documentation</title> <meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1"> 
<link type="text/css" rel="stylesheet" href="style.css">
</head>

<body>
<!-- Generated by Doxygen 1.2.16 -->
<center>
<a class="qindex" href="index.html">Main Page</a> &nbsp; <a class="qindex" href="namespaces.html">Namespace List</a> &nbsp; <a class="qindex" href="hierarchy.html">Class Hierarchy</a> &nbsp; <a class="qindex" href="classes.html">Alphabetical List</a> &nbsp; <a class="qindex" href="annotated.html">Compound List</a> &nbsp; <a class="qindex" href="files.html">File List</a> &nbsp; <a class="qindex" href="namespacemembers.html">Namespace Members</a> &nbsp; <a class="qindex" href="functions.html">Compound Members</a> &nbsp; <a class="qindex" href="globals.html">File Members</a> &nbsp; <a class="qindex" href="pages.html">Related Pages</a> &nbsp; </center>
<hr><h1>OgreQuaternion.cpp</h1><a href="OgreQuaternion_8cpp.html">Go to the documentation of this file.</a><div class="fragment"><pre>00001 <font class="comment">/*</font>
00002 <font class="comment">-----------------------------------------------------------------------------</font>
00003 <font class="comment">This source file is part of OGRE</font>
00004 <font class="comment">    (Object-oriented Graphics Rendering Engine)</font>
00005 <font class="comment">For the latest info, see http://www.stevestreeting.com/ogre/</font>
00006 <font class="comment"></font>
00007 <font class="comment">Copyright © 2000-2001 Steven J. Streeting</font>
00008 <font class="comment">Also see acknowledgements in Readme.html</font>
00009 <font class="comment"></font>
00010 <font class="comment">This program is free software; you can redistribute it and/or modify it under</font>
00011 <font class="comment">the terms of the GNU General Public License as published by the Free Software</font>
00012 <font class="comment">Foundation; either version 2 of the License, or (at your option) any later</font>
00013 <font class="comment">version.</font>
00014 <font class="comment"></font>
00015 <font class="comment">This program is distributed in the hope that it will be useful, but WITHOUT</font>
00016 <font class="comment">ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or FITNESS</font>
00017 <font class="comment">FOR A PARTICULAR PURPOSE. See the GNU General Public License for more details.</font>
00018 <font class="comment"></font>
00019 <font class="comment">You should have received a copy of the GNU General Public License along with</font>
00020 <font class="comment">this program; if not, write to the Free Software Foundation, Inc., 59 Temple</font>
00021 <font class="comment">Place - Suite 330, Boston, MA 02111-1307, USA, or go to</font>
00022 <font class="comment">http://www.gnu.org/copyleft/gpl.html.</font>
00023 <font class="comment">-----------------------------------------------------------------------------</font>
00024 <font class="comment">*/</font>
00025 <font class="comment">// NOTE THAT THIS FILE IS BASED ON MATERIAL FROM:</font>
00026 
00027 <font class="comment">// Magic Software, Inc.</font>
00028 <font class="comment">// http://www.magic-software.com</font>
00029 <font class="comment">// Copyright (c) 2000, All Rights Reserved</font>
00030 <font class="comment">//</font>
00031 <font class="comment">// Source code from Magic Software is supplied under the terms of a license</font>
00032 <font class="comment">// agreement and may not be copied or disclosed except in accordance with the</font>
00033 <font class="comment">// terms of that agreement.  The various license agreements may be found at</font>
00034 <font class="comment">// the Magic Software web site.  This file is subject to the license</font>
00035 <font class="comment">//</font>
00036 <font class="comment">// FREE SOURCE CODE</font>
00037 <font class="comment">// http://www.magic-software.com/License/free.pdf</font>
00038 
00039 <font class="preprocessor">#include "<a class="code" href="OgreQuaternion_8h.html">OgreQuaternion.h</a>"</font>
00040 
00041 <font class="preprocessor">#include "<a class="code" href="OgreMath_8h.html">OgreMath.h</a>"</font>
00042 <font class="preprocessor">#include "<a class="code" href="OgreMatrix3_8h.html">OgreMatrix3.h</a>"</font>
00043 <font class="preprocessor">#include "<a class="code" href="OgreVector3_8h.html">OgreVector3.h</a>"</font>
00044 
00045 <font class="keyword">namespace </font>Ogre {
00046 
<a name="l00047"></a><a class="code" href="classOgre_1_1Quaternion.html#Ogre_1_1Quaternionp0">00047</a>     <a class="code" href="namespaceOgre.html#a281">Real</a> Quaternion::ms_fEpsilon = 1e-03;
00048     <a class="code" href="classOgre_1_1Quaternion.html">Quaternion</a> Quaternion::ZERO(0.0,0.0,0.0,0.0);
00049     <a class="code" href="classOgre_1_1Quaternion.html">Quaternion</a> Quaternion::IDENTITY(1.0,0.0,0.0,0.0);
00050 
00051     <font class="comment">//-----------------------------------------------------------------------</font>
<a name="l00052"></a><a class="code" href="classOgre_1_1Quaternion.html#Ogre_1_1Quaterniona0">00052</a>     Quaternion::Quaternion (<a class="code" href="namespaceOgre.html#a281">Real</a> fW, <a class="code" href="namespaceOgre.html#a281">Real</a> fX, <a class="code" href="namespaceOgre.html#a281">Real</a> fY, <a class="code" href="namespaceOgre.html#a281">Real</a> fZ)
00053     {
00054         <a class="code" href="classOgre_1_1Quaternion.html#Ogre_1_1Quaternionm0">w</a> = fW;
00055         <a class="code" href="classOgre_1_1Quaternion.html#Ogre_1_1Quaternionm1">x</a> = fX;
00056         <a class="code" href="classOgre_1_1Quaternion.html#Ogre_1_1Quaternionm2">y</a> = fY;
00057         <a class="code" href="classOgre_1_1Quaternion.html#Ogre_1_1Quaternionm3">z</a> = fZ;
00058     }
00059     <font class="comment">//-----------------------------------------------------------------------</font>
<a name="l00060"></a><a class="code" href="classOgre_1_1Quaternion.html#Ogre_1_1Quaterniona1">00060</a>     Quaternion::Quaternion (<font class="keyword">const</font> <a class="code" href="classOgre_1_1Quaternion.html">Quaternion</a>&amp; rkQ)
00061     {
00062         <a class="code" href="classOgre_1_1Quaternion.html#Ogre_1_1Quaternionm0">w</a> = rkQ.<a class="code" href="classOgre_1_1Quaternion.html#Ogre_1_1Quaternionm0">w</a>;
00063         <a class="code" href="classOgre_1_1Quaternion.html#Ogre_1_1Quaternionm1">x</a> = rkQ.<a class="code" href="classOgre_1_1Quaternion.html#Ogre_1_1Quaternionm1">x</a>;
00064         <a class="code" href="classOgre_1_1Quaternion.html#Ogre_1_1Quaternionm2">y</a> = rkQ.<a class="code" href="classOgre_1_1Quaternion.html#Ogre_1_1Quaternionm2">y</a>;
00065         <a class="code" href="classOgre_1_1Quaternion.html#Ogre_1_1Quaternionm3">z</a> = rkQ.<a class="code" href="classOgre_1_1Quaternion.html#Ogre_1_1Quaternionm3">z</a>;
00066     }
00067     <font class="comment">//-----------------------------------------------------------------------</font>
<a name="l00068"></a><a class="code" href="classOgre_1_1Quaternion.html#Ogre_1_1Quaterniona2">00068</a>     <font class="keywordtype">void</font> Quaternion::FromRotationMatrix (<font class="keyword">const</font> <a class="code" href="classOgre_1_1Matrix3.html">Matrix3</a>&amp; kRot)
00069     {
00070         <font class="comment">// Algorithm in Ken Shoemake's article in 1987 SIGGRAPH course notes</font>
00071         <font class="comment">// article "Quaternion Calculus and Fast Animation".</font>
00072 
00073         <a class="code" href="namespaceOgre.html#a281">Real</a> fTrace = kRot[0][0]+kRot[1][1]+kRot[2][2];
00074         <a class="code" href="namespaceOgre.html#a281">Real</a> fRoot;
00075 
00076         <font class="keywordflow">if</font> ( fTrace &gt; 0.0 )
00077         {
00078             <font class="comment">// |w| &gt; 1/2, may as well choose w &gt; 1/2</font>
00079             fRoot = Math::getSingleton().Sqrt(fTrace + 1.0);  <font class="comment">// 2w</font>
00080             <a class="code" href="classOgre_1_1Quaternion.html#Ogre_1_1Quaternionm0">w</a> = 0.5*fRoot;
00081             fRoot = 0.5/fRoot;  <font class="comment">// 1/(4w)</font>
00082             <a class="code" href="classOgre_1_1Quaternion.html#Ogre_1_1Quaternionm1">x</a> = (kRot[2][1]-kRot[1][2])*fRoot;
00083             <a class="code" href="classOgre_1_1Quaternion.html#Ogre_1_1Quaternionm2">y</a> = (kRot[0][2]-kRot[2][0])*fRoot;
00084             <a class="code" href="classOgre_1_1Quaternion.html#Ogre_1_1Quaternionm3">z</a> = (kRot[1][0]-kRot[0][1])*fRoot;
00085         }
00086         <font class="keywordflow">else</font>
00087         {
00088             <font class="comment">// |w| &lt;= 1/2</font>
00089             <font class="keyword">static</font> <font class="keywordtype">int</font> s_iNext[3] = { 1, 2, 0 };
00090             <font class="keywordtype">int</font> i = 0;
00091             <font class="keywordflow">if</font> ( kRot[1][1] &gt; kRot[0][0] )
00092                 i = 1;
00093             <font class="keywordflow">if</font> ( kRot[2][2] &gt; kRot[i][i] )
00094                 i = 2;
00095             <font class="keywordtype">int</font> j = s_iNext[i];
00096             <font class="keywordtype">int</font> k = s_iNext[j];
00097 
00098             fRoot = Math::getSingleton().Sqrt(kRot[i][i]-kRot[j][j]-kRot[k][k] + 1.0);
00099             <a class="code" href="namespaceOgre.html#a281">Real</a>* apkQuat[3] = { &amp;<a class="code" href="classOgre_1_1Quaternion.html#Ogre_1_1Quaternionm1">x</a>, &amp;<a class="code" href="classOgre_1_1Quaternion.html#Ogre_1_1Quaternionm2">y</a>, &amp;<a class="code" href="classOgre_1_1Quaternion.html#Ogre_1_1Quaternionm3">z</a> };
00100             *apkQuat[i] = 0.5*fRoot;
00101             fRoot = 0.5/fRoot;
00102             <a class="code" href="classOgre_1_1Quaternion.html#Ogre_1_1Quaternionm0">w</a> = (kRot[k][j]-kRot[j][k])*fRoot;
00103             *apkQuat[j] = (kRot[j][i]+kRot[i][j])*fRoot;
00104             *apkQuat[k] = (kRot[k][i]+kRot[i][k])*fRoot;
00105         }
00106     }
00107     <font class="comment">//-----------------------------------------------------------------------</font>
<a name="l00108"></a><a class="code" href="classOgre_1_1Quaternion.html#Ogre_1_1Quaterniona3">00108</a>     <font class="keywordtype">void</font> Quaternion::ToRotationMatrix (<a class="code" href="classOgre_1_1Matrix3.html">Matrix3</a>&amp; kRot)<font class="keyword"> const</font>
00109 <font class="keyword">    </font>{
00110         <a class="code" href="namespaceOgre.html#a281">Real</a> fTx  = 2.0*<a class="code" href="classOgre_1_1Quaternion.html#Ogre_1_1Quaternionm1">x</a>;
00111         <a class="code" href="namespaceOgre.html#a281">Real</a> fTy  = 2.0*<a class="code" href="classOgre_1_1Quaternion.html#Ogre_1_1Quaternionm2">y</a>;
00112         <a class="code" href="namespaceOgre.html#a281">Real</a> fTz  = 2.0*<a class="code" href="classOgre_1_1Quaternion.html#Ogre_1_1Quaternionm3">z</a>;
00113         <a class="code" href="namespaceOgre.html#a281">Real</a> fTwx = fTx*<a class="code" href="classOgre_1_1Quaternion.html#Ogre_1_1Quaternionm0">w</a>;
00114         <a class="code" href="namespaceOgre.html#a281">Real</a> fTwy = fTy*<a class="code" href="classOgre_1_1Quaternion.html#Ogre_1_1Quaternionm0">w</a>;
00115         <a class="code" href="namespaceOgre.html#a281">Real</a> fTwz = fTz*<a class="code" href="classOgre_1_1Quaternion.html#Ogre_1_1Quaternionm0">w</a>;
00116         <a class="code" href="namespaceOgre.html#a281">Real</a> fTxx = fTx*<a class="code" href="classOgre_1_1Quaternion.html#Ogre_1_1Quaternionm1">x</a>;
00117         <a class="code" href="namespaceOgre.html#a281">Real</a> fTxy = fTy*<a class="code" href="classOgre_1_1Quaternion.html#Ogre_1_1Quaternionm1">x</a>;
00118         <a class="code" href="namespaceOgre.html#a281">Real</a> fTxz = fTz*<a class="code" href="classOgre_1_1Quaternion.html#Ogre_1_1Quaternionm1">x</a>;
00119         <a class="code" href="namespaceOgre.html#a281">Real</a> fTyy = fTy*<a class="code" href="classOgre_1_1Quaternion.html#Ogre_1_1Quaternionm2">y</a>;
00120         <a class="code" href="namespaceOgre.html#a281">Real</a> fTyz = fTz*<a class="code" href="classOgre_1_1Quaternion.html#Ogre_1_1Quaternionm2">y</a>;
00121         <a class="code" href="namespaceOgre.html#a281">Real</a> fTzz = fTz*<a class="code" href="classOgre_1_1Quaternion.html#Ogre_1_1Quaternionm3">z</a>;
00122 
00123         kRot[0][0] = 1.0-(fTyy+fTzz);
00124         kRot[0][1] = fTxy-fTwz;
00125         kRot[0][2] = fTxz+fTwy;
00126         kRot[1][0] = fTxy+fTwz;
00127         kRot[1][1] = 1.0-(fTxx+fTzz);
00128         kRot[1][2] = fTyz-fTwx;
00129         kRot[2][0] = fTxz-fTwy;
00130         kRot[2][1] = fTyz+fTwx;
00131         kRot[2][2] = 1.0-(fTxx+fTyy);
00132     }
00133     <font class="comment">//-----------------------------------------------------------------------</font>
<a name="l00134"></a><a class="code" href="classOgre_1_1Quaternion.html#Ogre_1_1Quaterniona4">00134</a>     <font class="keywordtype">void</font> Quaternion::FromAngleAxis (<font class="keyword">const</font> <a class="code" href="namespaceOgre.html#a281">Real</a>&amp; rfAngle,
00135         <font class="keyword">const</font> <a class="code" href="classOgre_1_1Vector3.html">Vector3</a>&amp; rkAxis)
00136     {
00137         <font class="comment">// assert:  axis[] is unit length</font>
00138         <font class="comment">//</font>
00139         <font class="comment">// The quaternion representing the rotation is</font>
00140         <font class="comment">//   q = cos(A/2)+sin(A/2)*(x*i+y*j+z*k)</font>
00141 
00142         <a class="code" href="namespaceOgre.html#a281">Real</a> fHalfAngle = 0.5*rfAngle;
00143         <a class="code" href="namespaceOgre.html#a281">Real</a> fSin = Math::getSingleton().Sin(fHalfAngle);
00144         <a class="code" href="classOgre_1_1Quaternion.html#Ogre_1_1Quaternionm0">w</a> = Math::getSingleton().Cos(fHalfAngle);
00145         <a class="code" href="classOgre_1_1Quaternion.html#Ogre_1_1Quaternionm1">x</a> = fSin*rkAxis.<a class="code" href="classOgre_1_1Vector3.html#Ogre_1_1Vector3m0">x</a>;
00146         <a class="code" href="classOgre_1_1Quaternion.html#Ogre_1_1Quaternionm2">y</a> = fSin*rkAxis.<a class="code" href="classOgre_1_1Vector3.html#Ogre_1_1Vector3m1">y</a>;
00147         <a class="code" href="classOgre_1_1Quaternion.html#Ogre_1_1Quaternionm3">z</a> = fSin*rkAxis.<a class="code" href="classOgre_1_1Vector3.html#Ogre_1_1Vector3m2">z</a>;
00148     }
00149     <font class="comment">//-----------------------------------------------------------------------</font>
<a name="l00150"></a><a class="code" href="classOgre_1_1Quaternion.html#Ogre_1_1Quaterniona5">00150</a>     <font class="keywordtype">void</font> Quaternion::ToAngleAxis (<a class="code" href="namespaceOgre.html#a281">Real</a>&amp; rfAngle, <a class="code" href="classOgre_1_1Vector3.html">Vector3</a>&amp; rkAxis)<font class="keyword"> const</font>
00151 <font class="keyword">    </font>{
00152         <font class="comment">// The quaternion representing the rotation is</font>
00153         <font class="comment">//   q = cos(A/2)+sin(A/2)*(x*i+y*j+z*k)</font>
00154 
00155         <a class="code" href="namespaceOgre.html#a281">Real</a> fSqrLength = <a class="code" href="classOgre_1_1Quaternion.html#Ogre_1_1Quaternionm1">x</a>*<a class="code" href="classOgre_1_1Quaternion.html#Ogre_1_1Quaternionm1">x</a>+<a class="code" href="classOgre_1_1Quaternion.html#Ogre_1_1Quaternionm2">y</a>*<a class="code" href="classOgre_1_1Quaternion.html#Ogre_1_1Quaternionm2">y</a>+<a class="code" href="classOgre_1_1Quaternion.html#Ogre_1_1Quaternionm3">z</a>*<a class="code" href="classOgre_1_1Quaternion.html#Ogre_1_1Quaternionm3">z</a>;
00156         <font class="keywordflow">if</font> ( fSqrLength &gt; 0.0 )
00157         {
00158             rfAngle = 2.0*Math::getSingleton().ACos(<a class="code" href="classOgre_1_1Quaternion.html#Ogre_1_1Quaternionm0">w</a>);
00159             <a class="code" href="namespaceOgre.html#a281">Real</a> fInvLength = 1.0/Math::getSingleton().Sqrt(fSqrLength);
00160             rkAxis.<a class="code" href="classOgre_1_1Vector3.html#Ogre_1_1Vector3m0">x</a> = <a class="code" href="classOgre_1_1Quaternion.html#Ogre_1_1Quaternionm1">x</a>*fInvLength;
00161             rkAxis.<a class="code" href="classOgre_1_1Vector3.html#Ogre_1_1Vector3m1">y</a> = <a class="code" href="classOgre_1_1Quaternion.html#Ogre_1_1Quaternionm2">y</a>*fInvLength;
00162             rkAxis.<a class="code" href="classOgre_1_1Vector3.html#Ogre_1_1Vector3m2">z</a> = <a class="code" href="classOgre_1_1Quaternion.html#Ogre_1_1Quaternionm3">z</a>*fInvLength;
00163         }
00164         <font class="keywordflow">else</font>
00165         {
00166             <font class="comment">// angle is 0 (mod 2*pi), so any axis will do</font>
00167             rfAngle = 0.0;
00168             rkAxis.<a class="code" href="classOgre_1_1Vector3.html#Ogre_1_1Vector3m0">x</a> = 1.0;
00169             rkAxis.<a class="code" href="classOgre_1_1Vector3.html#Ogre_1_1Vector3m1">y</a> = 0.0;
00170             rkAxis.<a class="code" href="classOgre_1_1Vector3.html#Ogre_1_1Vector3m2">z</a> = 0.0;
00171         }
00172     }
00173     <font class="comment">//-----------------------------------------------------------------------</font>
<a name="l00174"></a><a class="code" href="classOgre_1_1Quaternion.html#Ogre_1_1Quaterniona6">00174</a>     <font class="keywordtype">void</font> Quaternion::FromAxes (<font class="keyword">const</font> <a class="code" href="classOgre_1_1Vector3.html">Vector3</a>* akAxis)
00175     {
00176         <a class="code" href="classOgre_1_1Matrix3.html">Matrix3</a> kRot;
00177 
00178         <font class="keywordflow">for</font> (<font class="keywordtype">int</font> iCol = 0; iCol &lt; 3; iCol++)
00179         {
00180             kRot[0][iCol] = akAxis[iCol].<a class="code" href="classOgre_1_1Vector3.html#Ogre_1_1Vector3m0">x</a>;
00181             kRot[1][iCol] = akAxis[iCol].<a class="code" href="classOgre_1_1Vector3.html#Ogre_1_1Vector3m1">y</a>;
00182             kRot[2][iCol] = akAxis[iCol].<a class="code" href="classOgre_1_1Vector3.html#Ogre_1_1Vector3m2">z</a>;
00183         }
00184 
00185         <a class="code" href="classOgre_1_1Quaternion.html#Ogre_1_1Quaterniona2">FromRotationMatrix</a>(kRot);
00186     }
00187     <font class="comment">//-----------------------------------------------------------------------</font>
<a name="l00188"></a><a class="code" href="classOgre_1_1Quaternion.html#Ogre_1_1Quaterniona7">00188</a>     <font class="keywordtype">void</font> Quaternion::FromAxes (<font class="keyword">const</font> <a class="code" href="classOgre_1_1Vector3.html">Vector3</a>&amp; xAxis, <font class="keyword">const</font> <a class="code" href="classOgre_1_1Vector3.html">Vector3</a>&amp; yAxis, <font class="keyword">const</font> <a class="code" href="classOgre_1_1Vector3.html">Vector3</a>&amp; zAxis)
00189     {
00190         <a class="code" href="classOgre_1_1Matrix3.html">Matrix3</a> kRot;
00191 
00192         kRot[0][0] = xAxis.<a class="code" href="classOgre_1_1Vector3.html#Ogre_1_1Vector3m0">x</a>;
00193         kRot[1][0] = xAxis.<a class="code" href="classOgre_1_1Vector3.html#Ogre_1_1Vector3m1">y</a>;
00194         kRot[2][0] = xAxis.<a class="code" href="classOgre_1_1Vector3.html#Ogre_1_1Vector3m2">z</a>;
00195 
00196         kRot[0][1] = yAxis.<a class="code" href="classOgre_1_1Vector3.html#Ogre_1_1Vector3m0">x</a>;
00197         kRot[1][1] = yAxis.<a class="code" href="classOgre_1_1Vector3.html#Ogre_1_1Vector3m1">y</a>;
00198         kRot[2][1] = yAxis.<a class="code" href="classOgre_1_1Vector3.html#Ogre_1_1Vector3m2">z</a>;
00199 
00200         kRot[0][2] = zAxis.<a class="code" href="classOgre_1_1Vector3.html#Ogre_1_1Vector3m0">x</a>;
00201         kRot[1][2] = zAxis.<a class="code" href="classOgre_1_1Vector3.html#Ogre_1_1Vector3m1">y</a>;
00202         kRot[2][2] = zAxis.<a class="code" href="classOgre_1_1Vector3.html#Ogre_1_1Vector3m2">z</a>;
00203 
00204         <a class="code" href="classOgre_1_1Quaternion.html#Ogre_1_1Quaterniona2">FromRotationMatrix</a>(kRot);
00205 
00206     }
00207     <font class="comment">//-----------------------------------------------------------------------</font>
<a name="l00208"></a><a class="code" href="classOgre_1_1Quaternion.html#Ogre_1_1Quaterniona8">00208</a>     <font class="keywordtype">void</font> Quaternion::ToAxes (<a class="code" href="classOgre_1_1Vector3.html">Vector3</a>* akAxis)<font class="keyword"> const</font>
00209 <font class="keyword">    </font>{
00210         <a class="code" href="classOgre_1_1Matrix3.html">Matrix3</a> kRot;
00211 
00212         <a class="code" href="classOgre_1_1Quaternion.html#Ogre_1_1Quaterniona3">ToRotationMatrix</a>(kRot);
00213 
00214         <font class="keywordflow">for</font> (<font class="keywordtype">int</font> iCol = 0; iCol &lt; 3; iCol++)
00215         {
00216             akAxis[iCol].<a class="code" href="classOgre_1_1Vector3.html#Ogre_1_1Vector3m0">x</a> = kRot[0][iCol];
00217             akAxis[iCol].<a class="code" href="classOgre_1_1Vector3.html#Ogre_1_1Vector3m1">y</a> = kRot[1][iCol];
00218             akAxis[iCol].<a class="code" href="classOgre_1_1Vector3.html#Ogre_1_1Vector3m2">z</a> = kRot[2][iCol];
00219         }
00220     }
00221     <font class="comment">//-----------------------------------------------------------------------</font>
<a name="l00222"></a><a class="code" href="classOgre_1_1Quaternion.html#Ogre_1_1Quaterniona9">00222</a>     <font class="keywordtype">void</font> Quaternion::ToAxes (<a class="code" href="classOgre_1_1Vector3.html">Vector3</a>&amp; xAxis, <a class="code" href="classOgre_1_1Vector3.html">Vector3</a>&amp; yAxis, <a class="code" href="classOgre_1_1Vector3.html">Vector3</a>&amp; zAxis)
00223     {
00224         <a class="code" href="classOgre_1_1Matrix3.html">Matrix3</a> kRot;
00225 
00226         <a class="code" href="classOgre_1_1Quaternion.html#Ogre_1_1Quaterniona3">ToRotationMatrix</a>(kRot);
00227 
00228         xAxis.<a class="code" href="classOgre_1_1Vector3.html#Ogre_1_1Vector3m0">x</a> = kRot[0][0];
00229         xAxis.<a class="code" href="classOgre_1_1Vector3.html#Ogre_1_1Vector3m1">y</a> = kRot[1][0];
00230         xAxis.<a class="code" href="classOgre_1_1Vector3.html#Ogre_1_1Vector3m2">z</a> = kRot[2][0];
00231 
00232         yAxis.<a class="code" href="classOgre_1_1Vector3.html#Ogre_1_1Vector3m0">x</a> = kRot[0][1];
00233         yAxis.<a class="code" href="classOgre_1_1Vector3.html#Ogre_1_1Vector3m1">y</a> = kRot[1][1];
00234         yAxis.<a class="code" href="classOgre_1_1Vector3.html#Ogre_1_1Vector3m2">z</a> = kRot[2][1];
00235 
00236         zAxis.<a class="code" href="classOgre_1_1Vector3.html#Ogre_1_1Vector3m0">x</a> = kRot[0][2];
00237         zAxis.<a class="code" href="classOgre_1_1Vector3.html#Ogre_1_1Vector3m1">y</a> = kRot[1][2];
00238         zAxis.<a class="code" href="classOgre_1_1Vector3.html#Ogre_1_1Vector3m2">z</a> = kRot[2][2];
00239     }
00240 
00241     <font class="comment">//-----------------------------------------------------------------------</font>
<a name="l00242"></a><a class="code" href="classOgre_1_1Quaternion.html#Ogre_1_1Quaterniona10">00242</a>     <a class="code" href="classOgre_1_1Quaternion.html">Quaternion</a>&amp; Quaternion::operator= (<font class="keyword">const</font> <a class="code" href="classOgre_1_1Quaternion.html">Quaternion</a>&amp; rkQ)
00243     {
00244         <a class="code" href="classOgre_1_1Quaternion.html#Ogre_1_1Quaternionm0">w</a> = rkQ.<a class="code" href="classOgre_1_1Quaternion.html#Ogre_1_1Quaternionm0">w</a>;
00245         <a class="code" href="classOgre_1_1Quaternion.html#Ogre_1_1Quaternionm1">x</a> = rkQ.<a class="code" href="classOgre_1_1Quaternion.html#Ogre_1_1Quaternionm1">x</a>;
00246         <a class="code" href="classOgre_1_1Quaternion.html#Ogre_1_1Quaternionm2">y</a> = rkQ.<a class="code" href="classOgre_1_1Quaternion.html#Ogre_1_1Quaternionm2">y</a>;
00247         <a class="code" href="classOgre_1_1Quaternion.html#Ogre_1_1Quaternionm3">z</a> = rkQ.<a class="code" href="classOgre_1_1Quaternion.html#Ogre_1_1Quaternionm3">z</a>;
00248         <font class="keywordflow">return</font> *<font class="keyword">this</font>;
00249     }
00250     <font class="comment">//-----------------------------------------------------------------------</font>
<a name="l00251"></a><a class="code" href="classOgre_1_1Quaternion.html#Ogre_1_1Quaterniona11">00251</a>     <a class="code" href="classOgre_1_1Quaternion.html">Quaternion</a> Quaternion::operator+ (<font class="keyword">const</font> <a class="code" href="classOgre_1_1Quaternion.html">Quaternion</a>&amp; rkQ)<font class="keyword"> const</font>
00252 <font class="keyword">    </font>{
00253         <font class="keywordflow">return</font> <a class="code" href="classOgre_1_1Quaternion.html#Ogre_1_1Quaterniona0">Quaternion</a>(<a class="code" href="classOgre_1_1Quaternion.html#Ogre_1_1Quaternionm0">w</a>+rkQ.<a class="code" href="classOgre_1_1Quaternion.html#Ogre_1_1Quaternionm0">w</a>,<a class="code" href="classOgre_1_1Quaternion.html#Ogre_1_1Quaternionm1">x</a>+rkQ.<a class="code" href="classOgre_1_1Quaternion.html#Ogre_1_1Quaternionm1">x</a>,<a class="code" href="classOgre_1_1Quaternion.html#Ogre_1_1Quaternionm2">y</a>+rkQ.<a class="code" href="classOgre_1_1Quaternion.html#Ogre_1_1Quaternionm2">y</a>,<a class="code" href="classOgre_1_1Quaternion.html#Ogre_1_1Quaternionm3">z</a>+rkQ.<a class="code" href="classOgre_1_1Quaternion.html#Ogre_1_1Quaternionm3">z</a>);
00254     }
00255     <font class="comment">//-----------------------------------------------------------------------</font>
<a name="l00256"></a><a class="code" href="classOgre_1_1Quaternion.html#Ogre_1_1Quaterniona12">00256</a>     <a class="code" href="classOgre_1_1Quaternion.html">Quaternion</a> Quaternion::operator- (<font class="keyword">const</font> <a class="code" href="classOgre_1_1Quaternion.html">Quaternion</a>&amp; rkQ)<font class="keyword"> const</font>
00257 <font class="keyword">    </font>{
00258         <font class="keywordflow">return</font> <a class="code" href="classOgre_1_1Quaternion.html#Ogre_1_1Quaterniona0">Quaternion</a>(<a class="code" href="classOgre_1_1Quaternion.html#Ogre_1_1Quaternionm0">w</a>-rkQ.<a class="code" href="classOgre_1_1Quaternion.html#Ogre_1_1Quaternionm0">w</a>,<a class="code" href="classOgre_1_1Quaternion.html#Ogre_1_1Quaternionm1">x</a>-rkQ.<a class="code" href="classOgre_1_1Quaternion.html#Ogre_1_1Quaternionm1">x</a>,<a class="code" href="classOgre_1_1Quaternion.html#Ogre_1_1Quaternionm2">y</a>-rkQ.<a class="code" href="classOgre_1_1Quaternion.html#Ogre_1_1Quaternionm2">y</a>,<a class="code" href="classOgre_1_1Quaternion.html#Ogre_1_1Quaternionm3">z</a>-rkQ.<a class="code" href="classOgre_1_1Quaternion.html#Ogre_1_1Quaternionm3">z</a>);
00259     }
00260     <font class="comment">//-----------------------------------------------------------------------</font>
<a name="l00261"></a><a class="code" href="classOgre_1_1Quaternion.html#Ogre_1_1Quaterniona13">00261</a>     <a class="code" href="classOgre_1_1Quaternion.html">Quaternion</a> Quaternion::operator* (<font class="keyword">const</font> <a class="code" href="classOgre_1_1Quaternion.html">Quaternion</a>&amp; rkQ)<font class="keyword"> const</font>
00262 <font class="keyword">    </font>{
00263         <font class="comment">// NOTE:  Multiplication is not generally commutative, so in most</font>
00264         <font class="comment">// cases p*q != q*p.</font>
00265 
00266         <font class="keywordflow">return</font> <a class="code" href="classOgre_1_1Quaternion.html">Quaternion</a>
00267         (
00268             <a class="code" href="classOgre_1_1Quaternion.html#Ogre_1_1Quaternionm0">w</a> * rkQ.<a class="code" href="classOgre_1_1Quaternion.html#Ogre_1_1Quaternionm0">w</a> - <a class="code" href="classOgre_1_1Quaternion.html#Ogre_1_1Quaternionm1">x</a> * rkQ.<a class="code" href="classOgre_1_1Quaternion.html#Ogre_1_1Quaternionm1">x</a> - <a class="code" href="classOgre_1_1Quaternion.html#Ogre_1_1Quaternionm2">y</a> * rkQ.<a class="code" href="classOgre_1_1Quaternion.html#Ogre_1_1Quaternionm2">y</a> - <a class="code" href="classOgre_1_1Quaternion.html#Ogre_1_1Quaternionm3">z</a> * rkQ.<a class="code" href="classOgre_1_1Quaternion.html#Ogre_1_1Quaternionm3">z</a>,
00269             <a class="code" href="classOgre_1_1Quaternion.html#Ogre_1_1Quaternionm0">w</a> * rkQ.<a class="code" href="classOgre_1_1Quaternion.html#Ogre_1_1Quaternionm1">x</a> + <a class="code" href="classOgre_1_1Quaternion.html#Ogre_1_1Quaternionm1">x</a> * rkQ.<a class="code" href="classOgre_1_1Quaternion.html#Ogre_1_1Quaternionm0">w</a> + <a class="code" href="classOgre_1_1Quaternion.html#Ogre_1_1Quaternionm2">y</a> * rkQ.<a class="code" href="classOgre_1_1Quaternion.html#Ogre_1_1Quaternionm3">z</a> - <a class="code" href="classOgre_1_1Quaternion.html#Ogre_1_1Quaternionm3">z</a> * rkQ.<a class="code" href="classOgre_1_1Quaternion.html#Ogre_1_1Quaternionm2">y</a>,
00270             <a class="code" href="classOgre_1_1Quaternion.html#Ogre_1_1Quaternionm0">w</a> * rkQ.<a class="code" href="classOgre_1_1Quaternion.html#Ogre_1_1Quaternionm2">y</a> + <a class="code" href="classOgre_1_1Quaternion.html#Ogre_1_1Quaternionm2">y</a> * rkQ.<a class="code" href="classOgre_1_1Quaternion.html#Ogre_1_1Quaternionm0">w</a> + <a class="code" href="classOgre_1_1Quaternion.html#Ogre_1_1Quaternionm3">z</a> * rkQ.<a class="code" href="classOgre_1_1Quaternion.html#Ogre_1_1Quaternionm1">x</a> - <a class="code" href="classOgre_1_1Quaternion.html#Ogre_1_1Quaternionm1">x</a> * rkQ.<a class="code" href="classOgre_1_1Quaternion.html#Ogre_1_1Quaternionm3">z</a>,
00271             <a class="code" href="classOgre_1_1Quaternion.html#Ogre_1_1Quaternionm0">w</a> * rkQ.<a class="code" href="classOgre_1_1Quaternion.html#Ogre_1_1Quaternionm3">z</a> + <a class="code" href="classOgre_1_1Quaternion.html#Ogre_1_1Quaternionm3">z</a> * rkQ.<a class="code" href="classOgre_1_1Quaternion.html#Ogre_1_1Quaternionm0">w</a> + <a class="code" href="classOgre_1_1Quaternion.html#Ogre_1_1Quaternionm1">x</a> * rkQ.<a class="code" href="classOgre_1_1Quaternion.html#Ogre_1_1Quaternionm2">y</a> - <a class="code" href="classOgre_1_1Quaternion.html#Ogre_1_1Quaternionm2">y</a> * rkQ.<a class="code" href="classOgre_1_1Quaternion.html#Ogre_1_1Quaternionm1">x</a>
00272         );
00273     }
00274     <font class="comment">//-----------------------------------------------------------------------</font>
<a name="l00275"></a><a class="code" href="classOgre_1_1Quaternion.html#Ogre_1_1Quaterniona14">00275</a>     <a class="code" href="classOgre_1_1Quaternion.html">Quaternion</a> Quaternion::operator* (<a class="code" href="namespaceOgre.html#a281">Real</a> fScalar)<font class="keyword"> const</font>
00276 <font class="keyword">    </font>{
00277         <font class="keywordflow">return</font> <a class="code" href="classOgre_1_1Quaternion.html#Ogre_1_1Quaterniona0">Quaternion</a>(fScalar*<a class="code" href="classOgre_1_1Quaternion.html#Ogre_1_1Quaternionm0">w</a>,fScalar*<a class="code" href="classOgre_1_1Quaternion.html#Ogre_1_1Quaternionm1">x</a>,fScalar*<a class="code" href="classOgre_1_1Quaternion.html#Ogre_1_1Quaternionm2">y</a>,fScalar*<a class="code" href="classOgre_1_1Quaternion.html#Ogre_1_1Quaternionm3">z</a>);
00278     }
00279     <font class="comment">//-----------------------------------------------------------------------</font>
<a name="l00280"></a><a class="code" href="namespaceOgre.html#a388">00280</a>     <a class="code" href="classOgre_1_1Quaternion.html">Quaternion</a> <a class="code" href="namespaceOgre.html#a385">operator* </a>(<a class="code" href="namespaceOgre.html#a281">Real</a> fScalar, <font class="keyword">const</font> <a class="code" href="classOgre_1_1Quaternion.html">Quaternion</a>&amp; rkQ)
00281     {
00282         <font class="keywordflow">return</font> <a class="code" href="classOgre_1_1Quaternion.html">Quaternion</a>(fScalar*rkQ.<a class="code" href="classOgre_1_1Quaternion.html#Ogre_1_1Quaternionm0">w</a>,fScalar*rkQ.<a class="code" href="classOgre_1_1Quaternion.html#Ogre_1_1Quaternionm1">x</a>,fScalar*rkQ.<a class="code" href="classOgre_1_1Quaternion.html#Ogre_1_1Quaternionm2">y</a>,
00283             fScalar*rkQ.<a class="code" href="classOgre_1_1Quaternion.html#Ogre_1_1Quaternionm3">z</a>);
00284     }
00285     <font class="comment">//-----------------------------------------------------------------------</font>
<a name="l00286"></a><a class="code" href="classOgre_1_1Quaternion.html#Ogre_1_1Quaterniona15">00286</a>     <a class="code" href="classOgre_1_1Quaternion.html">Quaternion</a> Quaternion::operator- ()<font class="keyword"> const</font>
00287 <font class="keyword">    </font>{
00288         <font class="keywordflow">return</font> <a class="code" href="classOgre_1_1Quaternion.html#Ogre_1_1Quaterniona0">Quaternion</a>(-<a class="code" href="classOgre_1_1Quaternion.html#Ogre_1_1Quaternionm0">w</a>,-<a class="code" href="classOgre_1_1Quaternion.html#Ogre_1_1Quaternionm1">x</a>,-<a class="code" href="classOgre_1_1Quaternion.html#Ogre_1_1Quaternionm2">y</a>,-<a class="code" href="classOgre_1_1Quaternion.html#Ogre_1_1Quaternionm3">z</a>);
00289     }
00290     <font class="comment">//-----------------------------------------------------------------------</font>
<a name="l00291"></a><a class="code" href="classOgre_1_1Quaternion.html#Ogre_1_1Quaterniona17">00291</a>     <a class="code" href="namespaceOgre.html#a281">Real</a> Quaternion::Dot (<font class="keyword">const</font> <a class="code" href="classOgre_1_1Quaternion.html">Quaternion</a>&amp; rkQ)<font class="keyword"> const</font>
00292 <font class="keyword">    </font>{
00293         <font class="keywordflow">return</font> <a class="code" href="classOgre_1_1Quaternion.html#Ogre_1_1Quaternionm0">w</a>*rkQ.<a class="code" href="classOgre_1_1Quaternion.html#Ogre_1_1Quaternionm0">w</a>+<a class="code" href="classOgre_1_1Quaternion.html#Ogre_1_1Quaternionm1">x</a>*rkQ.<a class="code" href="classOgre_1_1Quaternion.html#Ogre_1_1Quaternionm1">x</a>+<a class="code" href="classOgre_1_1Quaternion.html#Ogre_1_1Quaternionm2">y</a>*rkQ.<a class="code" href="classOgre_1_1Quaternion.html#Ogre_1_1Quaternionm2">y</a>+<a class="code" href="classOgre_1_1Quaternion.html#Ogre_1_1Quaternionm3">z</a>*rkQ.<a class="code" href="classOgre_1_1Quaternion.html#Ogre_1_1Quaternionm3">z</a>;
00294     }
00295     <font class="comment">//-----------------------------------------------------------------------</font>
<a name="l00296"></a><a class="code" href="classOgre_1_1Quaternion.html#Ogre_1_1Quaterniona18">00296</a>     <a class="code" href="namespaceOgre.html#a281">Real</a> Quaternion::Norm ()<font class="keyword"> const</font>
00297 <font class="keyword">    </font>{
00298         <font class="keywordflow">return</font> <a class="code" href="classOgre_1_1Quaternion.html#Ogre_1_1Quaternionm0">w</a>*<a class="code" href="classOgre_1_1Quaternion.html#Ogre_1_1Quaternionm0">w</a>+<a class="code" href="classOgre_1_1Quaternion.html#Ogre_1_1Quaternionm1">x</a>*<a class="code" href="classOgre_1_1Quaternion.html#Ogre_1_1Quaternionm1">x</a>+<a class="code" href="classOgre_1_1Quaternion.html#Ogre_1_1Quaternionm2">y</a>*<a class="code" href="classOgre_1_1Quaternion.html#Ogre_1_1Quaternionm2">y</a>+<a class="code" href="classOgre_1_1Quaternion.html#Ogre_1_1Quaternionm3">z</a>*<a class="code" href="classOgre_1_1Quaternion.html#Ogre_1_1Quaternionm3">z</a>;
00299     }
00300     <font class="comment">//-----------------------------------------------------------------------</font>
<a name="l00301"></a><a class="code" href="classOgre_1_1Quaternion.html#Ogre_1_1Quaterniona19">00301</a>     <a class="code" href="classOgre_1_1Quaternion.html">Quaternion</a> Quaternion::Inverse ()<font class="keyword"> const</font>
00302 <font class="keyword">    </font>{
00303         <a class="code" href="namespaceOgre.html#a281">Real</a> fNorm = <a class="code" href="classOgre_1_1Quaternion.html#Ogre_1_1Quaternionm0">w</a>*<a class="code" href="classOgre_1_1Quaternion.html#Ogre_1_1Quaternionm0">w</a>+<a class="code" href="classOgre_1_1Quaternion.html#Ogre_1_1Quaternionm1">x</a>*<a class="code" href="classOgre_1_1Quaternion.html#Ogre_1_1Quaternionm1">x</a>+<a class="code" href="classOgre_1_1Quaternion.html#Ogre_1_1Quaternionm2">y</a>*<a class="code" href="classOgre_1_1Quaternion.html#Ogre_1_1Quaternionm2">y</a>+<a class="code" href="classOgre_1_1Quaternion.html#Ogre_1_1Quaternionm3">z</a>*<a class="code" href="classOgre_1_1Quaternion.html#Ogre_1_1Quaternionm3">z</a>;
00304         <font class="keywordflow">if</font> ( fNorm &gt; 0.0 )
00305         {
00306             <a class="code" href="namespaceOgre.html#a281">Real</a> fInvNorm = 1.0/fNorm;
00307             <font class="keywordflow">return</font> <a class="code" href="classOgre_1_1Quaternion.html#Ogre_1_1Quaterniona0">Quaternion</a>(<a class="code" href="classOgre_1_1Quaternion.html#Ogre_1_1Quaternionm0">w</a>*fInvNorm,-<a class="code" href="classOgre_1_1Quaternion.html#Ogre_1_1Quaternionm1">x</a>*fInvNorm,-<a class="code" href="classOgre_1_1Quaternion.html#Ogre_1_1Quaternionm2">y</a>*fInvNorm,-<a class="code" href="classOgre_1_1Quaternion.html#Ogre_1_1Quaternionm3">z</a>*fInvNorm);
00308         }
00309         <font class="keywordflow">else</font>
00310         {
00311             <font class="comment">// return an invalid result to flag the error</font>
00312             <font class="keywordflow">return</font> <a class="code" href="classOgre_1_1Quaternion.html#Ogre_1_1Quaternionp1">ZERO</a>;
00313         }
00314     }
00315     <font class="comment">//-----------------------------------------------------------------------</font>
<a name="l00316"></a><a class="code" href="classOgre_1_1Quaternion.html#Ogre_1_1Quaterniona20">00316</a>     <a class="code" href="classOgre_1_1Quaternion.html">Quaternion</a> Quaternion::UnitInverse ()<font class="keyword"> const</font>
00317 <font class="keyword">    </font>{
00318         <font class="comment">// assert:  'this' is unit length</font>
00319         <font class="keywordflow">return</font> <a class="code" href="classOgre_1_1Quaternion.html#Ogre_1_1Quaterniona0">Quaternion</a>(<a class="code" href="classOgre_1_1Quaternion.html#Ogre_1_1Quaternionm0">w</a>,-<a class="code" href="classOgre_1_1Quaternion.html#Ogre_1_1Quaternionm1">x</a>,-<a class="code" href="classOgre_1_1Quaternion.html#Ogre_1_1Quaternionm2">y</a>,-<a class="code" href="classOgre_1_1Quaternion.html#Ogre_1_1Quaternionm3">z</a>);
00320     }
00321     <font class="comment">//-----------------------------------------------------------------------</font>
<a name="l00322"></a><a class="code" href="classOgre_1_1Quaternion.html#Ogre_1_1Quaterniona21">00322</a>     <a class="code" href="classOgre_1_1Quaternion.html">Quaternion</a> Quaternion::Exp ()<font class="keyword"> const</font>
00323 <font class="keyword">    </font>{
00324         <font class="comment">// If q = A*(x*i+y*j+z*k) where (x,y,z) is unit length, then</font>
00325         <font class="comment">// exp(q) = cos(A)+sin(A)*(x*i+y*j+z*k).  If sin(A) is near zero,</font>
00326         <font class="comment">// use exp(q) = cos(A)+A*(x*i+y*j+z*k) since A/sin(A) has limit 1.</font>
00327 
00328         <a class="code" href="namespaceOgre.html#a281">Real</a> fAngle = Math::getSingleton().Sqrt(<a class="code" href="classOgre_1_1Quaternion.html#Ogre_1_1Quaternionm1">x</a>*<a class="code" href="classOgre_1_1Quaternion.html#Ogre_1_1Quaternionm1">x</a>+<a class="code" href="classOgre_1_1Quaternion.html#Ogre_1_1Quaternionm2">y</a>*<a class="code" href="classOgre_1_1Quaternion.html#Ogre_1_1Quaternionm2">y</a>+<a class="code" href="classOgre_1_1Quaternion.html#Ogre_1_1Quaternionm3">z</a>*<a class="code" href="classOgre_1_1Quaternion.html#Ogre_1_1Quaternionm3">z</a>);
00329         <a class="code" href="namespaceOgre.html#a281">Real</a> fSin = Math::getSingleton().Sin(fAngle);
00330 
00331         <a class="code" href="classOgre_1_1Quaternion.html">Quaternion</a> kResult;
00332         kResult.<a class="code" href="classOgre_1_1Quaternion.html#Ogre_1_1Quaternionm0">w</a> = Math::getSingleton().Cos(fAngle);
00333 
00334         <font class="keywordflow">if</font> ( Math::getSingleton().Abs(fSin) &gt;= <a class="code" href="classOgre_1_1Quaternion.html#Ogre_1_1Quaternionp0">ms_fEpsilon</a> )
00335         {
00336             <a class="code" href="namespaceOgre.html#a281">Real</a> fCoeff = fSin/fAngle;
00337             kResult.<a class="code" href="classOgre_1_1Quaternion.html#Ogre_1_1Quaternionm1">x</a> = fCoeff*<a class="code" href="classOgre_1_1Quaternion.html#Ogre_1_1Quaternionm1">x</a>;
00338             kResult.<a class="code" href="classOgre_1_1Quaternion.html#Ogre_1_1Quaternionm2">y</a> = fCoeff*<a class="code" href="classOgre_1_1Quaternion.html#Ogre_1_1Quaternionm2">y</a>;
00339             kResult.<a class="code" href="classOgre_1_1Quaternion.html#Ogre_1_1Quaternionm3">z</a> = fCoeff*<a class="code" href="classOgre_1_1Quaternion.html#Ogre_1_1Quaternionm3">z</a>;
00340         }
00341         <font class="keywordflow">else</font>
00342         {
00343             kResult.<a class="code" href="classOgre_1_1Quaternion.html#Ogre_1_1Quaternionm1">x</a> = <a class="code" href="classOgre_1_1Quaternion.html#Ogre_1_1Quaternionm1">x</a>;
00344             kResult.<a class="code" href="classOgre_1_1Quaternion.html#Ogre_1_1Quaternionm2">y</a> = <a class="code" href="classOgre_1_1Quaternion.html#Ogre_1_1Quaternionm2">y</a>;
00345             kResult.<a class="code" href="classOgre_1_1Quaternion.html#Ogre_1_1Quaternionm3">z</a> = <a class="code" href="classOgre_1_1Quaternion.html#Ogre_1_1Quaternionm3">z</a>;
00346         }
00347 
00348         <font class="keywordflow">return</font> kResult;
00349     }
00350     <font class="comment">//-----------------------------------------------------------------------</font>
<a name="l00351"></a><a class="code" href="classOgre_1_1Quaternion.html#Ogre_1_1Quaterniona22">00351</a>     <a class="code" href="classOgre_1_1Quaternion.html">Quaternion</a> Quaternion::Log ()<font class="keyword"> const</font>
00352 <font class="keyword">    </font>{
00353         <font class="comment">// If q = cos(A)+sin(A)*(x*i+y*j+z*k) where (x,y,z) is unit length, then</font>
00354         <font class="comment">// log(q) = A*(x*i+y*j+z*k).  If sin(A) is near zero, use log(q) =</font>
00355         <font class="comment">// sin(A)*(x*i+y*j+z*k) since sin(A)/A has limit 1.</font>
00356 
00357         <a class="code" href="classOgre_1_1Quaternion.html">Quaternion</a> kResult;
00358         kResult.<a class="code" href="classOgre_1_1Quaternion.html#Ogre_1_1Quaternionm0">w</a> = 0.0;
00359 
00360         <font class="keywordflow">if</font> ( Math::getSingleton().Abs(<a class="code" href="classOgre_1_1Quaternion.html#Ogre_1_1Quaternionm0">w</a>) &lt; 1.0 )
00361         {
00362             <a class="code" href="namespaceOgre.html#a281">Real</a> fAngle = Math::getSingleton().ACos(<a class="code" href="classOgre_1_1Quaternion.html#Ogre_1_1Quaternionm0">w</a>);
00363             <a class="code" href="namespaceOgre.html#a281">Real</a> fSin = Math::getSingleton().Sin(fAngle);
00364             <font class="keywordflow">if</font> ( Math::getSingleton().Abs(fSin) &gt;= <a class="code" href="classOgre_1_1Quaternion.html#Ogre_1_1Quaternionp0">ms_fEpsilon</a> )
00365             {
00366                 <a class="code" href="namespaceOgre.html#a281">Real</a> fCoeff = fAngle/fSin;
00367                 kResult.<a class="code" href="classOgre_1_1Quaternion.html#Ogre_1_1Quaternionm1">x</a> = fCoeff*<a class="code" href="classOgre_1_1Quaternion.html#Ogre_1_1Quaternionm1">x</a>;
00368                 kResult.<a class="code" href="classOgre_1_1Quaternion.html#Ogre_1_1Quaternionm2">y</a> = fCoeff*<a class="code" href="classOgre_1_1Quaternion.html#Ogre_1_1Quaternionm2">y</a>;
00369                 kResult.<a class="code" href="classOgre_1_1Quaternion.html#Ogre_1_1Quaternionm3">z</a> = fCoeff*<a class="code" href="classOgre_1_1Quaternion.html#Ogre_1_1Quaternionm3">z</a>;
00370                 <font class="keywordflow">return</font> kResult;
00371             }
00372         }
00373 
00374         kResult.<a class="code" href="classOgre_1_1Quaternion.html#Ogre_1_1Quaternionm1">x</a> = <a class="code" href="classOgre_1_1Quaternion.html#Ogre_1_1Quaternionm1">x</a>;
00375         kResult.<a class="code" href="classOgre_1_1Quaternion.html#Ogre_1_1Quaternionm2">y</a> = <a class="code" href="classOgre_1_1Quaternion.html#Ogre_1_1Quaternionm2">y</a>;
00376         kResult.<a class="code" href="classOgre_1_1Quaternion.html#Ogre_1_1Quaternionm3">z</a> = <a class="code" href="classOgre_1_1Quaternion.html#Ogre_1_1Quaternionm3">z</a>;
00377 
00378         <font class="keywordflow">return</font> kResult;
00379     }
00380     <font class="comment">//-----------------------------------------------------------------------</font>
<a name="l00381"></a><a class="code" href="classOgre_1_1Quaternion.html#Ogre_1_1Quaterniona23">00381</a>     <a class="code" href="classOgre_1_1Vector3.html">Vector3</a> Quaternion::operator* (<font class="keyword">const</font> <a class="code" href="classOgre_1_1Vector3.html">Vector3</a>&amp; rkVector)<font class="keyword"> const</font>
00382 <font class="keyword">    </font>{
00383         <font class="comment">// Given a vector u = (x0,y0,z0) and a unit length quaternion</font>
00384         <font class="comment">// q = &lt;w,x,y,z&gt;, the vector v = (x1,y1,z1) which represents the</font>
00385         <font class="comment">// rotation of u by q is v = q*u*q^{-1} where * indicates quaternion</font>
00386         <font class="comment">// multiplication and where u is treated as the quaternion &lt;0,x0,y0,z0&gt;.</font>
00387         <font class="comment">// Note that q^{-1} = &lt;w,-x,-y,-z&gt;, so no real work is required to</font>
00388         <font class="comment">// invert q.  Now</font>
00389         <font class="comment">//</font>
00390         <font class="comment">//   q*u*q^{-1} = q*&lt;0,x0,y0,z0&gt;*q^{-1}</font>
00391         <font class="comment">//     = q*(x0*i+y0*j+z0*k)*q^{-1}</font>
00392         <font class="comment">//     = x0*(q*i*q^{-1})+y0*(q*j*q^{-1})+z0*(q*k*q^{-1})</font>
00393         <font class="comment">//</font>
00394         <font class="comment">// As 3-vectors, q*i*q^{-1}, q*j*q^{-1}, and 2*k*q^{-1} are the columns</font>
00395         <font class="comment">// of the rotation matrix computed in Quaternion::ToRotationMatrix.</font>
00396         <font class="comment">// The vector v is obtained as the product of that rotation matrix with</font>
00397         <font class="comment">// vector u.  As such, the quaternion representation of a rotation</font>
00398         <font class="comment">// matrix requires less space than the matrix and more time to compute</font>
00399         <font class="comment">// the rotated vector.  Typical space-time tradeoff...</font>
00400 
00401         <a class="code" href="classOgre_1_1Matrix3.html">Matrix3</a> kRot;
00402         <a class="code" href="classOgre_1_1Quaternion.html#Ogre_1_1Quaterniona3">ToRotationMatrix</a>(kRot);
00403         <font class="keywordflow">return</font> kRot*rkVector;
00404     }
00405     <font class="comment">//-----------------------------------------------------------------------</font>
<a name="l00406"></a><a class="code" href="classOgre_1_1Quaternion.html#Ogre_1_1Quaterniond0">00406</a>     <a class="code" href="classOgre_1_1Quaternion.html">Quaternion</a> Quaternion::Slerp (<a class="code" href="namespaceOgre.html#a281">Real</a> fT, <font class="keyword">const</font> <a class="code" href="classOgre_1_1Quaternion.html">Quaternion</a>&amp; rkP,
00407         <font class="keyword">const</font> <a class="code" href="classOgre_1_1Quaternion.html">Quaternion</a>&amp; rkQ)
00408     {
00409         <a class="code" href="namespaceOgre.html#a281">Real</a> fCos = rkP.<a class="code" href="classOgre_1_1Quaternion.html#Ogre_1_1Quaterniona17">Dot</a>(rkQ);
00410         <a class="code" href="namespaceOgre.html#a281">Real</a> fAngle = Math::getSingleton().ACos(fCos);
00411 
00412         <font class="keywordflow">if</font> ( Math::getSingleton().Abs(fAngle) &lt; <a class="code" href="classOgre_1_1Quaternion.html#Ogre_1_1Quaternionp0">ms_fEpsilon</a> )
00413             <font class="keywordflow">return</font> rkP;
00414 
00415         <a class="code" href="namespaceOgre.html#a281">Real</a> fSin = Math::getSingleton().Sin(fAngle);
00416         <a class="code" href="namespaceOgre.html#a281">Real</a> fInvSin = 1.0/fSin;
00417         <a class="code" href="namespaceOgre.html#a281">Real</a> fCoeff0 = Math::getSingleton().Sin((1.0-fT)*fAngle)*fInvSin;
00418         <a class="code" href="namespaceOgre.html#a281">Real</a> fCoeff1 = Math::getSingleton().Sin(fT*fAngle)*fInvSin;
00419         <font class="keywordflow">return</font> fCoeff0*rkP + fCoeff1*rkQ;
00420     }
00421     <font class="comment">//-----------------------------------------------------------------------</font>
<a name="l00422"></a><a class="code" href="classOgre_1_1Quaternion.html#Ogre_1_1Quaterniond1">00422</a>     <a class="code" href="classOgre_1_1Quaternion.html">Quaternion</a> Quaternion::SlerpExtraSpins (<a class="code" href="namespaceOgre.html#a281">Real</a> fT,
00423         <font class="keyword">const</font> <a class="code" href="classOgre_1_1Quaternion.html">Quaternion</a>&amp; rkP, <font class="keyword">const</font> <a class="code" href="classOgre_1_1Quaternion.html">Quaternion</a>&amp; rkQ, <font class="keywordtype">int</font> iExtraSpins)
00424     {
00425         <a class="code" href="namespaceOgre.html#a281">Real</a> fCos = rkP.<a class="code" href="classOgre_1_1Quaternion.html#Ogre_1_1Quaterniona17">Dot</a>(rkQ);
00426         <a class="code" href="namespaceOgre.html#a281">Real</a> fAngle = Math::getSingleton().ACos(fCos);
00427 
00428         <font class="keywordflow">if</font> ( Math::getSingleton().Abs(fAngle) &lt; <a class="code" href="classOgre_1_1Quaternion.html#Ogre_1_1Quaternionp0">ms_fEpsilon</a> )
00429             <font class="keywordflow">return</font> rkP;
00430 
00431         <a class="code" href="namespaceOgre.html#a281">Real</a> fSin = Math::getSingleton().Sin(fAngle);
00432         <a class="code" href="namespaceOgre.html#a281">Real</a> fPhase = Math::PI*iExtraSpins*fT;
00433         <a class="code" href="namespaceOgre.html#a281">Real</a> fInvSin = 1.0/fSin;
00434         <a class="code" href="namespaceOgre.html#a281">Real</a> fCoeff0 = Math::getSingleton().Sin((1.0-fT)*fAngle - fPhase)*fInvSin;
00435         <a class="code" href="namespaceOgre.html#a281">Real</a> fCoeff1 = Math::getSingleton().Sin(fT*fAngle + fPhase)*fInvSin;
00436         <font class="keywordflow">return</font> fCoeff0*rkP + fCoeff1*rkQ;
00437     }
00438     <font class="comment">//-----------------------------------------------------------------------</font>
<a name="l00439"></a><a class="code" href="classOgre_1_1Quaternion.html#Ogre_1_1Quaterniond2">00439</a>     <font class="keywordtype">void</font> Quaternion::Intermediate (<font class="keyword">const</font> <a class="code" href="classOgre_1_1Quaternion.html">Quaternion</a>&amp; rkQ0,
00440         <font class="keyword">const</font> <a class="code" href="classOgre_1_1Quaternion.html">Quaternion</a>&amp; rkQ1, <font class="keyword">const</font> <a class="code" href="classOgre_1_1Quaternion.html">Quaternion</a>&amp; rkQ2,
00441         <a class="code" href="classOgre_1_1Quaternion.html">Quaternion</a>&amp; rkA, <a class="code" href="classOgre_1_1Quaternion.html">Quaternion</a>&amp; rkB)
00442     {
00443         <font class="comment">// assert:  q0, q1, q2 are unit quaternions</font>
00444 
00445         <a class="code" href="classOgre_1_1Quaternion.html">Quaternion</a> kQ0inv = rkQ0.<a class="code" href="classOgre_1_1Quaternion.html#Ogre_1_1Quaterniona20">UnitInverse</a>();
00446         <a class="code" href="classOgre_1_1Quaternion.html">Quaternion</a> kQ1inv = rkQ1.<a class="code" href="classOgre_1_1Quaternion.html#Ogre_1_1Quaterniona20">UnitInverse</a>();
00447         <a class="code" href="classOgre_1_1Quaternion.html">Quaternion</a> rkP0 = kQ0inv*rkQ1;
00448         <a class="code" href="classOgre_1_1Quaternion.html">Quaternion</a> rkP1 = kQ1inv*rkQ2;
00449         <a class="code" href="classOgre_1_1Quaternion.html">Quaternion</a> kArg = 0.25*(rkP0.<a class="code" href="classOgre_1_1Quaternion.html#Ogre_1_1Quaterniona22">Log</a>()-rkP1.<a class="code" href="classOgre_1_1Quaternion.html#Ogre_1_1Quaterniona22">Log</a>());
00450         <a class="code" href="classOgre_1_1Quaternion.html">Quaternion</a> kMinusArg = -kArg;
00451 
00452         rkA = rkQ1*kArg.<a class="code" href="classOgre_1_1Quaternion.html#Ogre_1_1Quaterniona21">Exp</a>();
00453         rkB = rkQ1*kMinusArg.<a class="code" href="classOgre_1_1Quaternion.html#Ogre_1_1Quaterniona21">Exp</a>();
00454     }
00455     <font class="comment">//-----------------------------------------------------------------------</font>
<a name="l00456"></a><a class="code" href="classOgre_1_1Quaternion.html#Ogre_1_1Quaterniond3">00456</a>     <a class="code" href="classOgre_1_1Quaternion.html">Quaternion</a> Quaternion::Squad (<a class="code" href="namespaceOgre.html#a281">Real</a> fT,
00457         <font class="keyword">const</font> <a class="code" href="classOgre_1_1Quaternion.html">Quaternion</a>&amp; rkP, <font class="keyword">const</font> <a class="code" href="classOgre_1_1Quaternion.html">Quaternion</a>&amp; rkA,
00458         <font class="keyword">const</font> <a class="code" href="classOgre_1_1Quaternion.html">Quaternion</a>&amp; rkB, <font class="keyword">const</font> <a class="code" href="classOgre_1_1Quaternion.html">Quaternion</a>&amp; rkQ)
00459     {
00460         <a class="code" href="namespaceOgre.html#a281">Real</a> fSlerpT = 2.0*fT*(1.0-fT);
00461         <a class="code" href="classOgre_1_1Quaternion.html">Quaternion</a> kSlerpP = <a class="code" href="classOgre_1_1Quaternion.html#Ogre_1_1Quaterniond0">Slerp</a>(fT,rkP,rkQ);
00462         <a class="code" href="classOgre_1_1Quaternion.html">Quaternion</a> kSlerpQ = <a class="code" href="classOgre_1_1Quaternion.html#Ogre_1_1Quaterniond0">Slerp</a>(fT,rkA,rkB);
00463         <font class="keywordflow">return</font> <a class="code" href="classOgre_1_1Quaternion.html#Ogre_1_1Quaterniond0">Slerp</a>(fSlerpT,kSlerpP,kSlerpQ);
00464     }
00465     <font class="comment">//-----------------------------------------------------------------------</font>
<a name="l00466"></a><a class="code" href="classOgre_1_1Quaternion.html#Ogre_1_1Quaterniona16">00466</a>     <font class="keywordtype">bool</font> Quaternion::operator== (<font class="keyword">const</font> <a class="code" href="classOgre_1_1Quaternion.html">Quaternion</a>&amp; rhs)<font class="keyword"> const</font>
00467 <font class="keyword">    </font>{
00468         <font class="keywordflow">return</font> (rhs.<a class="code" href="classOgre_1_1Quaternion.html#Ogre_1_1Quaternionm1">x</a> == <a class="code" href="classOgre_1_1Quaternion.html#Ogre_1_1Quaternionm1">x</a>) &amp;&amp; (rhs.<a class="code" href="classOgre_1_1Quaternion.html#Ogre_1_1Quaternionm2">y</a> == <a class="code" href="classOgre_1_1Quaternion.html#Ogre_1_1Quaternionm2">y</a>) &amp;&amp;
00469             (rhs.<a class="code" href="classOgre_1_1Quaternion.html#Ogre_1_1Quaternionm3">z</a> == <a class="code" href="classOgre_1_1Quaternion.html#Ogre_1_1Quaternionm3">z</a>) &amp;&amp; (rhs.<a class="code" href="classOgre_1_1Quaternion.html#Ogre_1_1Quaternionm0">w</a> == <a class="code" href="classOgre_1_1Quaternion.html#Ogre_1_1Quaternionm0">w</a>);
00470     }
00471 
00472 }
</pre></div><p>
Copyright &copy; 2002 by The OGRE Team<br />
<script type="text/javascript">
<!--//hide script from old browsers
document.write( "Last modified "+ document.lastModified );
//end hiding contents -->
</script>
</p>
</body>
</html>
