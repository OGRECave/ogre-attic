<html>
<head>
<title>OGRE Documentation</title> <meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1"> 
<link type="text/css" rel="stylesheet" href="style.css">
</head>

<body>
<!-- Generated by Doxygen 1.2.16 -->
<center>
<a class="qindex" href="index.html">Main Page</a> &nbsp; <a class="qindex" href="namespaces.html">Namespace List</a> &nbsp; <a class="qindex" href="hierarchy.html">Class Hierarchy</a> &nbsp; <a class="qindex" href="classes.html">Alphabetical List</a> &nbsp; <a class="qindex" href="annotated.html">Compound List</a> &nbsp; <a class="qindex" href="files.html">File List</a> &nbsp; <a class="qindex" href="namespacemembers.html">Namespace Members</a> &nbsp; <a class="qindex" href="functions.html">Compound Members</a> &nbsp; <a class="qindex" href="globals.html">File Members</a> &nbsp; <a class="qindex" href="pages.html">Related Pages</a> &nbsp; </center>
<hr><h1>OgreTextureLayer.cpp</h1><a href="OgreTextureLayer_8cpp.html">Go to the documentation of this file.</a><div class="fragment"><pre>00001 <font class="comment">/*</font>
00002 <font class="comment">-----------------------------------------------------------------------------</font>
00003 <font class="comment">This source file is part of OGRE</font>
00004 <font class="comment">    (Object-oriented Graphics Rendering Engine)</font>
00005 <font class="comment">For the latest info, see http://www.stevestreeting.com/ogre/</font>
00006 <font class="comment"></font>
00007 <font class="comment">Copyright © 2000-2001 Steven J. Streeting</font>
00008 <font class="comment">Also see acknowledgements in Readme.html</font>
00009 <font class="comment"></font>
00010 <font class="comment">This program is free software; you can redistribute it and/or modify it under</font>
00011 <font class="comment">the terms of the GNU General Public License as published by the Free Software</font>
00012 <font class="comment">Foundation; either version 2 of the License, or (at your option) any later</font>
00013 <font class="comment">version.</font>
00014 <font class="comment"></font>
00015 <font class="comment">This program is distributed in the hope that it will be useful, but WITHOUT</font>
00016 <font class="comment">ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or FITNESS</font>
00017 <font class="comment">FOR A PARTICULAR PURPOSE. See the GNU General Public License for more details.</font>
00018 <font class="comment"></font>
00019 <font class="comment">You should have received a copy of the GNU General Public License along with</font>
00020 <font class="comment">this program; if not, write to the Free Software Foundation, Inc., 59 Temple</font>
00021 <font class="comment">Place - Suite 330, Boston, MA 02111-1307, USA, or go to</font>
00022 <font class="comment">http://www.gnu.org/copyleft/gpl.html.</font>
00023 <font class="comment">-----------------------------------------------------------------------------</font>
00024 <font class="comment">*/</font>
00025 <font class="preprocessor">#include "<a class="code" href="OgreMaterial_8h.html">OgreMaterial.h</a>"</font>
00026 
00027 <font class="preprocessor">#include "<a class="code" href="OgreLogManager_8h.html">OgreLogManager.h</a>"</font>
00028 <font class="preprocessor">#include "<a class="code" href="OgreMath_8h.html">OgreMath.h</a>"</font>
00029 <font class="preprocessor">#include "<a class="code" href="OgreControllerManager_8h.html">OgreControllerManager.h</a>"</font>
00030 
00031 <font class="keyword">namespace </font>Ogre {
00032 
00033     <font class="comment">//-----------------------------------------------------------------------</font>
<a name="l00034"></a><a class="code" href="classOgre_1_1Material_1_1TextureLayer.html#Ogre_1_1Material_1_1TextureLayera0">00034</a>     Material::TextureLayer::TextureLayer(<font class="keywordtype">bool</font> deferLoad)
00035     {
00036         <a class="code" href="classOgre_1_1Material_1_1TextureLayer.html#Ogre_1_1Material_1_1TextureLayern11">mIsBlank</a> = <font class="keyword">true</font>;
00037         <a class="code" href="classOgre_1_1Material_1_1TextureLayer.html#Ogre_1_1Material_1_1TextureLayern7">colourBlendMode</a>.<a class="code" href="classOgre_1_1LayerBlendModeEx.html#Ogre_1_1LayerBlendModeExm0">blendType</a> = <a class="code" href="namespaceOgre.html#a417a13">LBT_COLOUR</a>;
00038         <a class="code" href="classOgre_1_1Material_1_1TextureLayer.html#Ogre_1_1Material_1_1TextureLayera32">setColourOperation</a>(<a class="code" href="namespaceOgre.html#a418a17">LBO_MODULATE</a>);
00039         <a class="code" href="classOgre_1_1Material_1_1TextureLayer.html#Ogre_1_1Material_1_1TextureLayera30">setTextureAddressingMode</a>(<a class="code" href="classOgre_1_1Material_1_1TextureLayer.html#Ogre_1_1Material_1_1TextureLayers24Ogre_1_1Material_1_1TextureLayers12">TAM_WRAP</a>);
00040 
00041         <a class="code" href="classOgre_1_1Material_1_1TextureLayer.html#Ogre_1_1Material_1_1TextureLayern10">alphaBlendMode</a>.<a class="code" href="classOgre_1_1LayerBlendModeEx.html#Ogre_1_1LayerBlendModeExm1">operation</a> = <a class="code" href="namespaceOgre.html#a419a21">LBX_MODULATE</a>;
00042         <a class="code" href="classOgre_1_1Material_1_1TextureLayer.html#Ogre_1_1Material_1_1TextureLayern10">alphaBlendMode</a>.<a class="code" href="classOgre_1_1LayerBlendModeEx.html#Ogre_1_1LayerBlendModeExm0">blendType</a> = <a class="code" href="namespaceOgre.html#a417a14">LBT_ALPHA</a>;
00043         <a class="code" href="classOgre_1_1Material_1_1TextureLayer.html#Ogre_1_1Material_1_1TextureLayern10">alphaBlendMode</a>.<a class="code" href="classOgre_1_1LayerBlendModeEx.html#Ogre_1_1LayerBlendModeExm2">source1</a> = <a class="code" href="namespaceOgre.html#a420a33">LBS_TEXTURE</a>;
00044         <a class="code" href="classOgre_1_1Material_1_1TextureLayer.html#Ogre_1_1Material_1_1TextureLayern10">alphaBlendMode</a>.<a class="code" href="classOgre_1_1LayerBlendModeEx.html#Ogre_1_1LayerBlendModeExm3">source2</a> = <a class="code" href="namespaceOgre.html#a420a32">LBS_CURRENT</a>;
00045 
00046         <a class="code" href="classOgre_1_1Material_1_1TextureLayer.html#Ogre_1_1Material_1_1TextureLayern14">mUMod</a> = <a class="code" href="classOgre_1_1Material_1_1TextureLayer.html#Ogre_1_1Material_1_1TextureLayern15">mVMod</a> = 0;
00047         <a class="code" href="classOgre_1_1Material_1_1TextureLayer.html#Ogre_1_1Material_1_1TextureLayern16">mUScale</a> = <a class="code" href="classOgre_1_1Material_1_1TextureLayer.html#Ogre_1_1Material_1_1TextureLayern17">mVScale</a> = 1;
00048         <a class="code" href="classOgre_1_1Material_1_1TextureLayer.html#Ogre_1_1Material_1_1TextureLayern18">mRotate</a> = 0;
00049         <a class="code" href="classOgre_1_1Material_1_1TextureLayer.html#Ogre_1_1Material_1_1TextureLayern19">mTexModMatrix</a> = Matrix4::IDENTITY;
00050         <a class="code" href="classOgre_1_1Material_1_1TextureLayer.html#Ogre_1_1Material_1_1TextureLayern13">mRecalcTexMatrix</a> = <font class="keyword">false</font>;
00051         <a class="code" href="classOgre_1_1Material_1_1TextureLayer.html#Ogre_1_1Material_1_1TextureLayern20">mAlphaRejectFunc</a> = <a class="code" href="namespaceOgre.html#a426a67">CMPF_ALWAYS_PASS</a>;
00052         <a class="code" href="classOgre_1_1Material_1_1TextureLayer.html#Ogre_1_1Material_1_1TextureLayern21">mAlphaRejectVal</a> = 0;
00053 
00054         <a class="code" href="classOgre_1_1Material_1_1TextureLayer.html#Ogre_1_1Material_1_1TextureLayern0">mNumFrames</a> = 0;
00055         <a class="code" href="classOgre_1_1Material_1_1TextureLayer.html#Ogre_1_1Material_1_1TextureLayern2">mAnimDuration</a> = 0;
00056         <a class="code" href="classOgre_1_1Material_1_1TextureLayer.html#Ogre_1_1Material_1_1TextureLayern3">mAnimController</a> = 0;
00057         <a class="code" href="classOgre_1_1Material_1_1TextureLayer.html#Ogre_1_1Material_1_1TextureLayern4">mCubic</a> = <font class="keyword">false</font>;
00058 
00059         <a class="code" href="classOgre_1_1Material_1_1TextureLayer.html#Ogre_1_1Material_1_1TextureLayern12">mDeferLoad</a> = deferLoad;
00060     }
00061 
00062     <font class="comment">//-----------------------------------------------------------------------</font>
<a name="l00063"></a><a class="code" href="classOgre_1_1Material_1_1TextureLayer.html#Ogre_1_1Material_1_1TextureLayera1">00063</a>     Material::TextureLayer::TextureLayer( <font class="keyword">const</font> <a class="code" href="classOgre_1_1Material_1_1TextureLayer.html">TextureLayer</a>&amp; oth )
00064     {
00065         *<font class="keyword">this</font> = oth;
00066     }
00067 
00068     <font class="comment">//-----------------------------------------------------------------------</font>
<a name="l00069"></a><a class="code" href="classOgre_1_1Material_1_1TextureLayer.html#Ogre_1_1Material_1_1TextureLayera4">00069</a>     Material::TextureLayer::TextureLayer( <font class="keyword">const</font> <a class="code" href="classOgre_1_1String.html">String</a>&amp; texName, <font class="keywordtype">int</font> texCoordSet, <font class="keywordtype">bool</font> deferLoad)
00070     {
00071         <a class="code" href="classOgre_1_1Material_1_1TextureLayer.html#Ogre_1_1Material_1_1TextureLayern11">mIsBlank</a> = <font class="keyword">true</font>;
00072         <a class="code" href="classOgre_1_1Material_1_1TextureLayer.html#Ogre_1_1Material_1_1TextureLayern7">colourBlendMode</a>.<a class="code" href="classOgre_1_1LayerBlendModeEx.html#Ogre_1_1LayerBlendModeExm0">blendType</a> = <a class="code" href="namespaceOgre.html#a417a13">LBT_COLOUR</a>;
00073         <a class="code" href="classOgre_1_1Material_1_1TextureLayer.html#Ogre_1_1Material_1_1TextureLayera32">setColourOperation</a>(<a class="code" href="namespaceOgre.html#a418a17">LBO_MODULATE</a>);
00074         <a class="code" href="classOgre_1_1Material_1_1TextureLayer.html#Ogre_1_1Material_1_1TextureLayera30">setTextureAddressingMode</a>(<a class="code" href="classOgre_1_1Material_1_1TextureLayer.html#Ogre_1_1Material_1_1TextureLayers24Ogre_1_1Material_1_1TextureLayers12">TAM_WRAP</a>);
00075 
00076         <a class="code" href="classOgre_1_1Material_1_1TextureLayer.html#Ogre_1_1Material_1_1TextureLayern10">alphaBlendMode</a>.<a class="code" href="classOgre_1_1LayerBlendModeEx.html#Ogre_1_1LayerBlendModeExm1">operation</a> = <a class="code" href="namespaceOgre.html#a419a21">LBX_MODULATE</a>;
00077         <a class="code" href="classOgre_1_1Material_1_1TextureLayer.html#Ogre_1_1Material_1_1TextureLayern10">alphaBlendMode</a>.<a class="code" href="classOgre_1_1LayerBlendModeEx.html#Ogre_1_1LayerBlendModeExm0">blendType</a> = <a class="code" href="namespaceOgre.html#a417a14">LBT_ALPHA</a>;
00078         <a class="code" href="classOgre_1_1Material_1_1TextureLayer.html#Ogre_1_1Material_1_1TextureLayern10">alphaBlendMode</a>.<a class="code" href="classOgre_1_1LayerBlendModeEx.html#Ogre_1_1LayerBlendModeExm2">source1</a> = <a class="code" href="namespaceOgre.html#a420a33">LBS_TEXTURE</a>;
00079         <a class="code" href="classOgre_1_1Material_1_1TextureLayer.html#Ogre_1_1Material_1_1TextureLayern10">alphaBlendMode</a>.<a class="code" href="classOgre_1_1LayerBlendModeEx.html#Ogre_1_1LayerBlendModeExm3">source2</a> = <a class="code" href="namespaceOgre.html#a420a32">LBS_CURRENT</a>;
00080 
00081         <a class="code" href="classOgre_1_1Material_1_1TextureLayer.html#Ogre_1_1Material_1_1TextureLayern14">mUMod</a> = <a class="code" href="classOgre_1_1Material_1_1TextureLayer.html#Ogre_1_1Material_1_1TextureLayern15">mVMod</a> = 0;
00082         <a class="code" href="classOgre_1_1Material_1_1TextureLayer.html#Ogre_1_1Material_1_1TextureLayern16">mUScale</a> = <a class="code" href="classOgre_1_1Material_1_1TextureLayer.html#Ogre_1_1Material_1_1TextureLayern17">mVScale</a> = 1;
00083         <a class="code" href="classOgre_1_1Material_1_1TextureLayer.html#Ogre_1_1Material_1_1TextureLayern18">mRotate</a> = 0;
00084         <a class="code" href="classOgre_1_1Material_1_1TextureLayer.html#Ogre_1_1Material_1_1TextureLayern2">mAnimDuration</a> = 0;
00085         <a class="code" href="classOgre_1_1Material_1_1TextureLayer.html#Ogre_1_1Material_1_1TextureLayern3">mAnimController</a> = 0;
00086         <a class="code" href="classOgre_1_1Material_1_1TextureLayer.html#Ogre_1_1Material_1_1TextureLayern19">mTexModMatrix</a> = Matrix4::IDENTITY;
00087         <a class="code" href="classOgre_1_1Material_1_1TextureLayer.html#Ogre_1_1Material_1_1TextureLayern13">mRecalcTexMatrix</a> = <font class="keyword">false</font>;
00088         <a class="code" href="classOgre_1_1Material_1_1TextureLayer.html#Ogre_1_1Material_1_1TextureLayern20">mAlphaRejectFunc</a> = <a class="code" href="namespaceOgre.html#a426a67">CMPF_ALWAYS_PASS</a>;
00089         <a class="code" href="classOgre_1_1Material_1_1TextureLayer.html#Ogre_1_1Material_1_1TextureLayern21">mAlphaRejectVal</a> = 0;
00090         <a class="code" href="classOgre_1_1Material_1_1TextureLayer.html#Ogre_1_1Material_1_1TextureLayern12">mDeferLoad</a> = deferLoad;
00091 
00092         <a class="code" href="classOgre_1_1Material_1_1TextureLayer.html#Ogre_1_1Material_1_1TextureLayera7">setTextureName</a>(texName);
00093         <a class="code" href="classOgre_1_1Material_1_1TextureLayer.html#Ogre_1_1Material_1_1TextureLayera19">setTextureCoordSet</a>(texCoordSet);
00094     }
00095 
<a name="l00096"></a><a class="code" href="classOgre_1_1Material_1_1TextureLayer.html#Ogre_1_1Material_1_1TextureLayera3">00096</a>     Material::TextureLayer::~TextureLayer()
00097     {
00098         <font class="comment">/*</font>
00099 <font class="comment">        // Destroy controllers</font>
00100 <font class="comment">        if (mAnimController)</font>
00101 <font class="comment">        {</font>
00102 <font class="comment">            ControllerManager::getSingleton().destroyController(mAnimController);</font>
00103 <font class="comment">        }</font>
00104 <font class="comment">        // Destroy effect controllers</font>
00105 <font class="comment">        for (EffectMap::iterator i = mEffects.begin(); i != mEffects.end(); ++i)</font>
00106 <font class="comment">        {</font>
00107 <font class="comment">            if (i-&gt;second.controller)</font>
00108 <font class="comment">            {</font>
00109 <font class="comment">                ControllerManager::getSingleton().destroyController(i-&gt;second.controller);</font>
00110 <font class="comment">            }</font>
00111 <font class="comment"></font>
00112 <font class="comment">        }</font>
00113 <font class="comment">        // Don't unload textures. may be used elsewhere</font>
00114 <font class="comment">        */</font>
00115 
00116     }
00117     <font class="comment">//-----------------------------------------------------------------------</font>
<a name="l00118"></a><a class="code" href="classOgre_1_1Material_1_1TextureLayer.html#Ogre_1_1Material_1_1TextureLayera2">00118</a>     <a class="code" href="classOgre_1_1Material_1_1TextureLayer.html">Material::TextureLayer</a> &amp; Material::TextureLayer::operator = ( 
00119         <font class="keyword">const</font> <a class="code" href="classOgre_1_1Material_1_1TextureLayer.html">Material::TextureLayer</a> &amp;oth )
00120     {
00121         <font class="comment">// copy basic members (int's, real's)</font>
00122         memcpy( <font class="keyword">this</font>, &amp;oth, (<a class="code" href="namespaceOgre.html#a292">uchar</a> *)(&amp;oth.<a class="code" href="classOgre_1_1Material_1_1TextureLayer.html#Ogre_1_1Material_1_1TextureLayern25">mFrames</a>[0]) - (<a class="code" href="namespaceOgre.html#a292">uchar</a> *)(&amp;oth) );
00123 
00124         <font class="comment">// copy complex members</font>
00125         <font class="keywordflow">for</font>( <a class="code" href="namespaceOgre.html#a293">ushort</a> i = 0; i&lt;<a class="code" href="classOgre_1_1Material_1_1TextureLayer.html#Ogre_1_1Material_1_1TextureLayern0">mNumFrames</a>; i++ )
00126             <a class="code" href="classOgre_1_1Material_1_1TextureLayer.html#Ogre_1_1Material_1_1TextureLayern25">mFrames</a>[i] = oth.<a class="code" href="classOgre_1_1Material_1_1TextureLayer.html#Ogre_1_1Material_1_1TextureLayern25">mFrames</a>[i];
00127 
00128         <a class="code" href="classOgre_1_1Material_1_1TextureLayer.html#Ogre_1_1Material_1_1TextureLayern26">mEffects</a> = oth.<a class="code" href="classOgre_1_1Material_1_1TextureLayer.html#Ogre_1_1Material_1_1TextureLayern26">mEffects</a>;
00129 
00130         <font class="keywordflow">return</font> *<font class="keyword">this</font>;
00131     }
00132     <font class="comment">//-----------------------------------------------------------------------</font>
<a name="l00133"></a><a class="code" href="classOgre_1_1Material_1_1TextureLayer.html#Ogre_1_1Material_1_1TextureLayera6">00133</a>     <font class="keyword">const</font> <a class="code" href="classOgre_1_1String.html">String</a>&amp; Material::TextureLayer::getTextureName(<font class="keywordtype">void</font>)<font class="keyword"> const</font>
00134 <font class="keyword">    </font>{
00135         <font class="comment">// Return name of current frame</font>
00136         <font class="keywordflow">return</font> <a class="code" href="classOgre_1_1Material_1_1TextureLayer.html#Ogre_1_1Material_1_1TextureLayern25">mFrames</a>[<a class="code" href="classOgre_1_1Material_1_1TextureLayer.html#Ogre_1_1Material_1_1TextureLayern1">mCurrentFrame</a>];
00137     }
00138     <font class="comment">//-----------------------------------------------------------------------</font>
<a name="l00139"></a><a class="code" href="classOgre_1_1Material_1_1TextureLayer.html#Ogre_1_1Material_1_1TextureLayera7">00139</a>     <font class="keywordtype">void</font> Material::TextureLayer::setTextureName( <font class="keyword">const</font> <a class="code" href="classOgre_1_1String.html">String</a>&amp; name)
00140     {
00141         <a class="code" href="classOgre_1_1Material_1_1TextureLayer.html#Ogre_1_1Material_1_1TextureLayern25">mFrames</a>[0] = name;
00142         <a class="code" href="classOgre_1_1Material_1_1TextureLayer.html#Ogre_1_1Material_1_1TextureLayern0">mNumFrames</a> = 1;
00143         <a class="code" href="classOgre_1_1Material_1_1TextureLayer.html#Ogre_1_1Material_1_1TextureLayern1">mCurrentFrame</a> = 0;
00144         <a class="code" href="classOgre_1_1Material_1_1TextureLayer.html#Ogre_1_1Material_1_1TextureLayern4">mCubic</a> = <font class="keyword">false</font>;
00145 
00146         <font class="keywordflow">if</font> (name == <font class="stringliteral">""</font>)
00147         {
00148             <a class="code" href="classOgre_1_1Material_1_1TextureLayer.html#Ogre_1_1Material_1_1TextureLayern11">mIsBlank</a> = <font class="keyword">true</font>;
00149         }
00150         <font class="keywordflow">else</font> <font class="keywordflow">if</font> (!<a class="code" href="classOgre_1_1Material_1_1TextureLayer.html#Ogre_1_1Material_1_1TextureLayern12">mDeferLoad</a>)
00151         {
00152             <font class="comment">// Ensure texture is loaded, default MipMaps and priority</font>
00153             <font class="keywordflow">if</font>( TextureManager::getSingleton().getByName( name ) != NULL )
00154             {
00155                 <a class="code" href="classOgre_1_1Material_1_1TextureLayer.html#Ogre_1_1Material_1_1TextureLayern11">mIsBlank</a> = <font class="keyword">false</font>;
00156                 <font class="keywordflow">return</font>;
00157             }
00158 
00159             <font class="keywordflow">try</font> {                
00160                 TextureManager::getSingleton().load(name);
00161                 <a class="code" href="classOgre_1_1Material_1_1TextureLayer.html#Ogre_1_1Material_1_1TextureLayern11">mIsBlank</a> = <font class="keyword">false</font>;
00162             }
00163             <font class="keywordflow">catch</font> (...) {
00164                 <a class="code" href="classOgre_1_1String.html">String</a> msg;
00165                 msg = msg + <font class="stringliteral">"Error loading texture "</font> + name  + <font class="stringliteral">". Texture layer will be blank."</font>;
00166                 LogManager::getSingleton().logMessage(msg);
00167                 <a class="code" href="classOgre_1_1Material_1_1TextureLayer.html#Ogre_1_1Material_1_1TextureLayern11">mIsBlank</a> = <font class="keyword">true</font>;
00168             }
00169         }
00170 
00171     }
00172     <font class="comment">//-----------------------------------------------------------------------</font>
<a name="l00173"></a><a class="code" href="classOgre_1_1Material_1_1TextureLayer.html#Ogre_1_1Material_1_1TextureLayera8">00173</a>     <font class="keywordtype">void</font> Material::TextureLayer::setCubicTextureName( <font class="keyword">const</font> <a class="code" href="classOgre_1_1String.html">String</a>&amp; name, <font class="keywordtype">bool</font> forUVW)
00174     {
00175         <a class="code" href="classOgre_1_1String.html">String</a> ext;
00176         <a class="code" href="classOgre_1_1String.html">String</a> suffixes[6] = {<font class="stringliteral">"_fr"</font>, <font class="stringliteral">"_bk"</font>, <font class="stringliteral">"_lf"</font>, <font class="stringliteral">"_rt"</font>, <font class="stringliteral">"_up"</font>, <font class="stringliteral">"_dn"</font>};
00177         <a class="code" href="classOgre_1_1String.html">String</a> baseName;
00178         <a class="code" href="classOgre_1_1String.html">String</a> fullNames[6];
00179 
00180 
00181         size_t pos = name.find_last_of(<font class="stringliteral">"."</font>);
00182         baseName = name.substr(0, pos);
00183         ext = name.substr(pos);
00184 
00185         <font class="keywordflow">for</font> (<font class="keywordtype">int</font> i = 0; i &lt; 6; ++i)
00186         {
00187             fullNames[i] = baseName + suffixes[i] + ext;
00188         }
00189 
00190         <a class="code" href="classOgre_1_1Material_1_1TextureLayer.html#Ogre_1_1Material_1_1TextureLayera8">setCubicTextureName</a>(fullNames, forUVW);
00191 
00192     }
00193     <font class="comment">//-----------------------------------------------------------------------</font>
<a name="l00194"></a><a class="code" href="classOgre_1_1Material_1_1TextureLayer.html#Ogre_1_1Material_1_1TextureLayera9">00194</a>     <font class="keywordtype">void</font> Material::TextureLayer::setCubicTextureName(<font class="keyword">const</font> <a class="code" href="classOgre_1_1String.html">String</a>* <font class="keyword">const</font> names, <font class="keywordtype">bool</font> forUVW)
00195     {
00196         <font class="keywordflow">if</font> (forUVW)
00197         {
00198             <font class="comment">// TODO - build single cubic texture</font>
00199         }
00200         <font class="keywordflow">else</font>
00201         {
00202 
00203             <a class="code" href="classOgre_1_1Material_1_1TextureLayer.html#Ogre_1_1Material_1_1TextureLayern0">mNumFrames</a> = 6;
00204             <a class="code" href="classOgre_1_1Material_1_1TextureLayer.html#Ogre_1_1Material_1_1TextureLayern1">mCurrentFrame</a> = 0;
00205             <a class="code" href="classOgre_1_1Material_1_1TextureLayer.html#Ogre_1_1Material_1_1TextureLayern4">mCubic</a> = <font class="keyword">true</font>;
00206 
00207             <font class="keywordflow">for</font> (<font class="keywordtype">int</font> i = 0; i &lt; 6; ++i)
00208             {
00209                 <a class="code" href="classOgre_1_1Material_1_1TextureLayer.html#Ogre_1_1Material_1_1TextureLayern25">mFrames</a>[i] = names[i];
00210                 <font class="keywordflow">if</font> (!<a class="code" href="classOgre_1_1Material_1_1TextureLayer.html#Ogre_1_1Material_1_1TextureLayern12">mDeferLoad</a>)
00211                 {
00212                     <font class="comment">// Ensure texture is loaded, default MipMaps and priority</font>
00213                     <font class="keywordflow">try</font> {
00214 
00215                         TextureManager::getSingleton().load(<a class="code" href="classOgre_1_1Material_1_1TextureLayer.html#Ogre_1_1Material_1_1TextureLayern25">mFrames</a>[i]);
00216                         <a class="code" href="classOgre_1_1Material_1_1TextureLayer.html#Ogre_1_1Material_1_1TextureLayern11">mIsBlank</a> = <font class="keyword">false</font>;
00217                     }
00218                     <font class="keywordflow">catch</font> (...) {
00219                         <a class="code" href="classOgre_1_1String.html">String</a> msg;
00220                         msg = msg + <font class="stringliteral">"Error loading texture "</font> + <a class="code" href="classOgre_1_1Material_1_1TextureLayer.html#Ogre_1_1Material_1_1TextureLayern25">mFrames</a>[i]  + <font class="stringliteral">". Texture layer will be blank."</font>;
00221                         LogManager::getSingleton().logMessage(msg);
00222                         <a class="code" href="classOgre_1_1Material_1_1TextureLayer.html#Ogre_1_1Material_1_1TextureLayern11">mIsBlank</a> = <font class="keyword">true</font>;
00223                     }
00224                 }
00225             }
00226 
00227         }
00228     }
00229     <font class="comment">//-----------------------------------------------------------------------</font>
<a name="l00230"></a><a class="code" href="classOgre_1_1Material_1_1TextureLayer.html#Ogre_1_1Material_1_1TextureLayera16">00230</a>     <font class="keywordtype">bool</font> Material::TextureLayer::isCubic(<font class="keywordtype">void</font>)<font class="keyword"> const</font>
00231 <font class="keyword">    </font>{
00232         <font class="keywordflow">return</font> <a class="code" href="classOgre_1_1Material_1_1TextureLayer.html#Ogre_1_1Material_1_1TextureLayern4">mCubic</a>;
00233     }
00234     <font class="comment">//-----------------------------------------------------------------------</font>
<a name="l00235"></a><a class="code" href="classOgre_1_1Material_1_1TextureLayer.html#Ogre_1_1Material_1_1TextureLayera17">00235</a>     <font class="keywordtype">bool</font> Material::TextureLayer::is3D(<font class="keywordtype">void</font>)<font class="keyword"> const</font>
00236 <font class="keyword">    </font>{
00237         <font class="keywordflow">return</font> <a class="code" href="classOgre_1_1Material_1_1TextureLayer.html#Ogre_1_1Material_1_1TextureLayern4">mCubic</a> &amp;&amp; (<a class="code" href="classOgre_1_1Material_1_1TextureLayer.html#Ogre_1_1Material_1_1TextureLayern0">mNumFrames</a> == 1);
00238 
00239     }
00240     <font class="comment">//-----------------------------------------------------------------------</font>
<a name="l00241"></a><a class="code" href="classOgre_1_1Material_1_1TextureLayer.html#Ogre_1_1Material_1_1TextureLayera10">00241</a>     <font class="keywordtype">void</font> Material::TextureLayer::setAnimatedTextureName( <font class="keyword">const</font> <a class="code" href="classOgre_1_1String.html">String</a>&amp; name, <font class="keywordtype">int</font> numFrames, <a class="code" href="namespaceOgre.html#a281">Real</a> duration)
00242     {
00243         <a class="code" href="classOgre_1_1String.html">String</a> ext;
00244         <a class="code" href="classOgre_1_1String.html">String</a> baseName;
00245 
00246         size_t pos = name.find_last_of(<font class="stringliteral">"."</font>);
00247         baseName = name.substr(0, pos);
00248         ext = name.substr(pos);
00249 
00250         <font class="keywordflow">if</font> (numFrames &gt; <a class="code" href="OgreMaterial_8h.html#a0">MAX_FRAMES</a>)
00251         {
00252             <font class="keywordtype">char</font> cmsg[128];
00253             sprintf(cmsg, <font class="stringliteral">"Maximum number of frames is %d."</font>, <a class="code" href="OgreMaterial_8h.html#a0">MAX_FRAMES</a>);
00254             <a class="code" href="OgreException_8h.html#a0">Except</a>(Exception::ERR_INVALIDPARAMS, cmsg, <font class="stringliteral">"TextureLayer::setAnimatedTextureName"</font>);
00255         }
00256         <a class="code" href="classOgre_1_1Material_1_1TextureLayer.html#Ogre_1_1Material_1_1TextureLayern0">mNumFrames</a> = numFrames;
00257         <a class="code" href="classOgre_1_1Material_1_1TextureLayer.html#Ogre_1_1Material_1_1TextureLayern2">mAnimDuration</a> = duration;
00258         <a class="code" href="classOgre_1_1Material_1_1TextureLayer.html#Ogre_1_1Material_1_1TextureLayern1">mCurrentFrame</a> = 0;
00259         <a class="code" href="classOgre_1_1Material_1_1TextureLayer.html#Ogre_1_1Material_1_1TextureLayern4">mCubic</a> = <font class="keyword">false</font>;
00260 
00261         <font class="keywordflow">for</font> (<font class="keywordtype">int</font> i = 0; i &lt; <a class="code" href="classOgre_1_1Material_1_1TextureLayer.html#Ogre_1_1Material_1_1TextureLayern0">mNumFrames</a>; ++i)
00262         {
00263             <font class="keywordtype">char</font> suffix[5];
00264             sprintf(suffix, <font class="stringliteral">"_%d"</font>, i);
00265 
00266             <a class="code" href="classOgre_1_1Material_1_1TextureLayer.html#Ogre_1_1Material_1_1TextureLayern25">mFrames</a>[i] = baseName + suffix + ext;
00267             <font class="keywordflow">if</font> (!<a class="code" href="classOgre_1_1Material_1_1TextureLayer.html#Ogre_1_1Material_1_1TextureLayern12">mDeferLoad</a>)
00268             {
00269                 <font class="comment">// Ensure texture is loaded, default MipMaps and priority</font>
00270                 <font class="keywordflow">try</font> {
00271 
00272                     TextureManager::getSingleton().load(<a class="code" href="classOgre_1_1Material_1_1TextureLayer.html#Ogre_1_1Material_1_1TextureLayern25">mFrames</a>[i]);
00273                     <a class="code" href="classOgre_1_1Material_1_1TextureLayer.html#Ogre_1_1Material_1_1TextureLayern11">mIsBlank</a> = <font class="keyword">false</font>;
00274                 }
00275                 <font class="keywordflow">catch</font> (...) {
00276                     <a class="code" href="classOgre_1_1String.html">String</a> msg;
00277                     msg = msg + <font class="stringliteral">"Error loading texture "</font> + <a class="code" href="classOgre_1_1Material_1_1TextureLayer.html#Ogre_1_1Material_1_1TextureLayern25">mFrames</a>[i]  + <font class="stringliteral">". Texture layer will be blank."</font>;
00278                     LogManager::getSingleton().logMessage(msg);
00279                     <a class="code" href="classOgre_1_1Material_1_1TextureLayer.html#Ogre_1_1Material_1_1TextureLayern11">mIsBlank</a> = <font class="keyword">true</font>;
00280                 }
00281             }
00282         }
00283 
00284         <font class="comment">// Set up automatic transition</font>
00285         <font class="keywordflow">if</font> (<a class="code" href="classOgre_1_1Material_1_1TextureLayer.html#Ogre_1_1Material_1_1TextureLayern2">mAnimDuration</a> != 0 &amp;&amp; !<a class="code" href="classOgre_1_1Material_1_1TextureLayer.html#Ogre_1_1Material_1_1TextureLayern12">mDeferLoad</a>)
00286         {
00287             <a class="code" href="classOgre_1_1Material_1_1TextureLayer.html#Ogre_1_1Material_1_1TextureLayerb1">createAnimController</a>();
00288         }
00289     }
00290     <font class="comment">//-----------------------------------------------------------------------</font>
<a name="l00291"></a><a class="code" href="classOgre_1_1Material_1_1TextureLayer.html#Ogre_1_1Material_1_1TextureLayera11">00291</a>     <font class="keywordtype">void</font> Material::TextureLayer::setAnimatedTextureName(<font class="keyword">const</font> <a class="code" href="classOgre_1_1String.html">String</a>* <font class="keyword">const</font> names, <font class="keywordtype">int</font> numFrames, <a class="code" href="namespaceOgre.html#a281">Real</a> duration)
00292     {
00293         <font class="keywordflow">if</font> (numFrames &gt; <a class="code" href="OgreMaterial_8h.html#a0">MAX_FRAMES</a>)
00294         {
00295             <font class="keywordtype">char</font> cmsg[128];
00296             sprintf(cmsg, <font class="stringliteral">"Maximum number of frames is %d."</font>, <a class="code" href="OgreMaterial_8h.html#a0">MAX_FRAMES</a>);
00297             <a class="code" href="OgreException_8h.html#a0">Except</a>(Exception::ERR_INVALIDPARAMS, cmsg, <font class="stringliteral">"TextureLayer::setAnimatedTextureName"</font>);
00298         }
00299         <a class="code" href="classOgre_1_1Material_1_1TextureLayer.html#Ogre_1_1Material_1_1TextureLayern0">mNumFrames</a> = numFrames;
00300         <a class="code" href="classOgre_1_1Material_1_1TextureLayer.html#Ogre_1_1Material_1_1TextureLayern2">mAnimDuration</a> = duration;
00301         <a class="code" href="classOgre_1_1Material_1_1TextureLayer.html#Ogre_1_1Material_1_1TextureLayern1">mCurrentFrame</a> = 0;
00302         <a class="code" href="classOgre_1_1Material_1_1TextureLayer.html#Ogre_1_1Material_1_1TextureLayern4">mCubic</a> = <font class="keyword">false</font>;
00303 
00304         <font class="keywordflow">for</font> (<font class="keywordtype">int</font> i = 0; i &lt; <a class="code" href="classOgre_1_1Material_1_1TextureLayer.html#Ogre_1_1Material_1_1TextureLayern0">mNumFrames</a>; ++i)
00305         {
00306             <a class="code" href="classOgre_1_1Material_1_1TextureLayer.html#Ogre_1_1Material_1_1TextureLayern25">mFrames</a>[i] = names[i];
00307 
00308             <font class="keywordflow">if</font> (!<a class="code" href="classOgre_1_1Material_1_1TextureLayer.html#Ogre_1_1Material_1_1TextureLayern12">mDeferLoad</a>)
00309             {
00310                 <font class="comment">// Ensure texture is loaded, default MipMaps and priority</font>
00311                 <font class="keywordflow">try</font> {
00312 
00313                     TextureManager::getSingleton().load(<a class="code" href="classOgre_1_1Material_1_1TextureLayer.html#Ogre_1_1Material_1_1TextureLayern25">mFrames</a>[i]);
00314                     <a class="code" href="classOgre_1_1Material_1_1TextureLayer.html#Ogre_1_1Material_1_1TextureLayern11">mIsBlank</a> = <font class="keyword">false</font>;
00315                 }
00316                 <font class="keywordflow">catch</font> (...) {
00317                     <a class="code" href="classOgre_1_1String.html">String</a> msg;
00318                     msg = msg + <font class="stringliteral">"Error loading texture "</font> + <a class="code" href="classOgre_1_1Material_1_1TextureLayer.html#Ogre_1_1Material_1_1TextureLayern25">mFrames</a>[i]  + <font class="stringliteral">". Texture layer will be blank."</font>;
00319                     LogManager::getSingleton().logMessage(msg);
00320                     <a class="code" href="classOgre_1_1Material_1_1TextureLayer.html#Ogre_1_1Material_1_1TextureLayern11">mIsBlank</a> = <font class="keyword">true</font>;
00321                 }
00322             }
00323         }
00324         <font class="comment">// Set up automatic transition</font>
00325         <font class="keywordflow">if</font> (<a class="code" href="classOgre_1_1Material_1_1TextureLayer.html#Ogre_1_1Material_1_1TextureLayern2">mAnimDuration</a> != 0 &amp;&amp; !<a class="code" href="classOgre_1_1Material_1_1TextureLayer.html#Ogre_1_1Material_1_1TextureLayern12">mDeferLoad</a>)
00326         {
00327             <a class="code" href="classOgre_1_1Material_1_1TextureLayer.html#Ogre_1_1Material_1_1TextureLayerb1">createAnimController</a>();
00328         }
00329     }
00330     <font class="comment">//-----------------------------------------------------------------------</font>
<a name="l00331"></a><a class="code" href="classOgre_1_1Material_1_1TextureLayer.html#Ogre_1_1Material_1_1TextureLayera12">00331</a>     <font class="keywordtype">void</font> Material::TextureLayer::setCurrentFrame(<font class="keywordtype">int</font> frameNumber)
00332     {
00333         assert(frameNumber &lt; <a class="code" href="classOgre_1_1Material_1_1TextureLayer.html#Ogre_1_1Material_1_1TextureLayern0">mNumFrames</a>);
00334         <a class="code" href="classOgre_1_1Material_1_1TextureLayer.html#Ogre_1_1Material_1_1TextureLayern1">mCurrentFrame</a> = frameNumber;
00335 
00336     }
00337     <font class="comment">//-----------------------------------------------------------------------</font>
<a name="l00338"></a><a class="code" href="classOgre_1_1Material_1_1TextureLayer.html#Ogre_1_1Material_1_1TextureLayera13">00338</a>     <font class="keywordtype">int</font> Material::TextureLayer::getCurrentFrame(<font class="keywordtype">void</font>)<font class="keyword"> const</font>
00339 <font class="keyword">    </font>{
00340         <font class="keywordflow">return</font> <a class="code" href="classOgre_1_1Material_1_1TextureLayer.html#Ogre_1_1Material_1_1TextureLayern1">mCurrentFrame</a>;
00341     }
00342     <font class="comment">//-----------------------------------------------------------------------</font>
<a name="l00343"></a><a class="code" href="classOgre_1_1Material_1_1TextureLayer.html#Ogre_1_1Material_1_1TextureLayera15">00343</a>     <font class="keywordtype">int</font> Material::TextureLayer::getNumFrames(<font class="keywordtype">void</font>)<font class="keyword"> const</font>
00344 <font class="keyword">    </font>{
00345         <font class="keywordflow">return</font> <a class="code" href="classOgre_1_1Material_1_1TextureLayer.html#Ogre_1_1Material_1_1TextureLayern0">mNumFrames</a>;
00346     }
00347     <font class="comment">//-----------------------------------------------------------------------</font>
<a name="l00348"></a><a class="code" href="classOgre_1_1Material_1_1TextureLayer.html#Ogre_1_1Material_1_1TextureLayera14">00348</a>     <font class="keyword">const</font> <a class="code" href="classOgre_1_1String.html">String</a>&amp; Material::TextureLayer::getFrameTextureName(<font class="keywordtype">int</font> frameNumber)<font class="keyword"> const</font>
00349 <font class="keyword">    </font>{
00350         assert(frameNumber &lt; <a class="code" href="classOgre_1_1Material_1_1TextureLayer.html#Ogre_1_1Material_1_1TextureLayern0">mNumFrames</a>);
00351         <font class="keywordflow">return</font> <a class="code" href="classOgre_1_1Material_1_1TextureLayer.html#Ogre_1_1Material_1_1TextureLayern25">mFrames</a>[frameNumber];
00352     }
00353     <font class="comment">//-----------------------------------------------------------------------</font>
<a name="l00354"></a><a class="code" href="classOgre_1_1Material_1_1TextureLayer.html#Ogre_1_1Material_1_1TextureLayera18">00354</a>     <font class="keywordtype">int</font> Material::TextureLayer::getTextureCoordSet(<font class="keywordtype">void</font>)<font class="keyword"> const</font>
00355 <font class="keyword">    </font>{
00356         <font class="keywordflow">return</font> <a class="code" href="classOgre_1_1Material_1_1TextureLayer.html#Ogre_1_1Material_1_1TextureLayern5">textureCoordSetIndex</a>;
00357     }
00358     <font class="comment">//-----------------------------------------------------------------------</font>
<a name="l00359"></a><a class="code" href="classOgre_1_1Material_1_1TextureLayer.html#Ogre_1_1Material_1_1TextureLayera19">00359</a>     <font class="keywordtype">void</font> Material::TextureLayer::setTextureCoordSet(<font class="keywordtype">int</font> set)
00360     {
00361         <a class="code" href="classOgre_1_1Material_1_1TextureLayer.html#Ogre_1_1Material_1_1TextureLayern5">textureCoordSetIndex</a> = set;
00362     }
00363     <font class="comment">//-----------------------------------------------------------------------</font>
<a name="l00364"></a><a class="code" href="classOgre_1_1Material_1_1TextureLayer.html#Ogre_1_1Material_1_1TextureLayera31">00364</a>     <font class="keywordtype">void</font> Material::TextureLayer::setColourOperationEx(<a class="code" href="namespaceOgre.html#a419">LayerBlendOperationEx</a> op,
00365         <a class="code" href="namespaceOgre.html#a420">LayerBlendSource</a> source1,
00366         <a class="code" href="namespaceOgre.html#a420">LayerBlendSource</a> source2,
00367         <font class="keyword">const</font> <a class="code" href="classOgre_1_1ColourValue.html">ColourValue</a>&amp; arg1,
00368         <font class="keyword">const</font> <a class="code" href="classOgre_1_1ColourValue.html">ColourValue</a>&amp; arg2,
00369         <a class="code" href="namespaceOgre.html#a281">Real</a> manualBlend)
00370     {
00371         <a class="code" href="classOgre_1_1Material_1_1TextureLayer.html#Ogre_1_1Material_1_1TextureLayern7">colourBlendMode</a>.<a class="code" href="classOgre_1_1LayerBlendModeEx.html#Ogre_1_1LayerBlendModeExm1">operation</a> = op;
00372         <a class="code" href="classOgre_1_1Material_1_1TextureLayer.html#Ogre_1_1Material_1_1TextureLayern7">colourBlendMode</a>.<a class="code" href="classOgre_1_1LayerBlendModeEx.html#Ogre_1_1LayerBlendModeExm2">source1</a> = source1;
00373         <a class="code" href="classOgre_1_1Material_1_1TextureLayer.html#Ogre_1_1Material_1_1TextureLayern7">colourBlendMode</a>.<a class="code" href="classOgre_1_1LayerBlendModeEx.html#Ogre_1_1LayerBlendModeExm3">source2</a> = source2;
00374         <a class="code" href="classOgre_1_1Material_1_1TextureLayer.html#Ogre_1_1Material_1_1TextureLayern7">colourBlendMode</a>.<a class="code" href="classOgre_1_1LayerBlendModeEx.html#Ogre_1_1LayerBlendModeExm4">colourArg1</a> = arg1;
00375         <a class="code" href="classOgre_1_1Material_1_1TextureLayer.html#Ogre_1_1Material_1_1TextureLayern7">colourBlendMode</a>.<a class="code" href="classOgre_1_1LayerBlendModeEx.html#Ogre_1_1LayerBlendModeExm5">colourArg2</a> = arg2;
00376         <a class="code" href="classOgre_1_1Material_1_1TextureLayer.html#Ogre_1_1Material_1_1TextureLayern7">colourBlendMode</a>.<a class="code" href="classOgre_1_1LayerBlendModeEx.html#Ogre_1_1LayerBlendModeExm8">factor</a> = manualBlend;
00377 
00378     }
00379     <font class="comment">//-----------------------------------------------------------------------</font>
<a name="l00380"></a><a class="code" href="classOgre_1_1Material_1_1TextureLayer.html#Ogre_1_1Material_1_1TextureLayera32">00380</a>     <font class="keywordtype">void</font> Material::TextureLayer::setColourOperation(<a class="code" href="namespaceOgre.html#a418">LayerBlendOperation</a> op)
00381     {
00382         <font class="comment">// Set up the multitexture and multipass blending operations</font>
00383         <font class="keywordflow">switch</font> (op)
00384         {
00385         <font class="keywordflow">case</font> <a class="code" href="namespaceOgre.html#a418a15">LBO_REPLACE</a>:
00386             <a class="code" href="classOgre_1_1Material_1_1TextureLayer.html#Ogre_1_1Material_1_1TextureLayera31">setColourOperationEx</a>(<a class="code" href="namespaceOgre.html#a419a19">LBX_SOURCE1</a>, <a class="code" href="namespaceOgre.html#a420a33">LBS_TEXTURE</a>, <a class="code" href="namespaceOgre.html#a420a32">LBS_CURRENT</a>);
00387             <a class="code" href="classOgre_1_1Material_1_1TextureLayer.html#Ogre_1_1Material_1_1TextureLayera33">setColourOpMultipassFallback</a>(<a class="code" href="namespaceOgre.html#a422a40">SBF_ONE</a>, <a class="code" href="namespaceOgre.html#a422a41">SBF_ZERO</a>);
00388             <font class="keywordflow">break</font>;
00389         <font class="keywordflow">case</font> <a class="code" href="namespaceOgre.html#a418a16">LBO_ADD</a>:
00390             <a class="code" href="classOgre_1_1Material_1_1TextureLayer.html#Ogre_1_1Material_1_1TextureLayera31">setColourOperationEx</a>(<a class="code" href="namespaceOgre.html#a419a24">LBX_ADD</a>, <a class="code" href="namespaceOgre.html#a420a33">LBS_TEXTURE</a>, <a class="code" href="namespaceOgre.html#a420a32">LBS_CURRENT</a>);
00391             <a class="code" href="classOgre_1_1Material_1_1TextureLayer.html#Ogre_1_1Material_1_1TextureLayera33">setColourOpMultipassFallback</a>(<a class="code" href="namespaceOgre.html#a422a40">SBF_ONE</a>, <a class="code" href="namespaceOgre.html#a422a40">SBF_ONE</a>);
00392             <font class="keywordflow">break</font>;
00393         <font class="keywordflow">case</font> <a class="code" href="namespaceOgre.html#a418a17">LBO_MODULATE</a>:
00394             <a class="code" href="classOgre_1_1Material_1_1TextureLayer.html#Ogre_1_1Material_1_1TextureLayera31">setColourOperationEx</a>(<a class="code" href="namespaceOgre.html#a419a21">LBX_MODULATE</a>, <a class="code" href="namespaceOgre.html#a420a33">LBS_TEXTURE</a>, <a class="code" href="namespaceOgre.html#a420a32">LBS_CURRENT</a>);
00395             <a class="code" href="classOgre_1_1Material_1_1TextureLayer.html#Ogre_1_1Material_1_1TextureLayera33">setColourOpMultipassFallback</a>(<a class="code" href="namespaceOgre.html#a422a42">SBF_DEST_COLOUR</a>, <a class="code" href="namespaceOgre.html#a422a41">SBF_ZERO</a>);
00396             <font class="keywordflow">break</font>;
00397         <font class="keywordflow">case</font> <a class="code" href="namespaceOgre.html#a418a18">LBO_ALPHA_BLEND</a>:
00398             <a class="code" href="classOgre_1_1Material_1_1TextureLayer.html#Ogre_1_1Material_1_1TextureLayera31">setColourOperationEx</a>(<a class="code" href="namespaceOgre.html#a419a29">LBX_BLEND_TEXTURE_ALPHA</a>, <a class="code" href="namespaceOgre.html#a420a33">LBS_TEXTURE</a>, <a class="code" href="namespaceOgre.html#a420a32">LBS_CURRENT</a>);
00399             <a class="code" href="classOgre_1_1Material_1_1TextureLayer.html#Ogre_1_1Material_1_1TextureLayera33">setColourOpMultipassFallback</a>(<a class="code" href="namespaceOgre.html#a422a47">SBF_SOURCE_ALPHA</a>, <a class="code" href="namespaceOgre.html#a422a49">SBF_ONE_MINUS_SOURCE_ALPHA</a>);
00400             <font class="keywordflow">break</font>;
00401         }
00402 
00403 
00404     }
00405     <font class="comment">//-----------------------------------------------------------------------</font>
<a name="l00406"></a><a class="code" href="classOgre_1_1Material_1_1TextureLayer.html#Ogre_1_1Material_1_1TextureLayera33">00406</a>     <font class="keywordtype">void</font> Material::TextureLayer::setColourOpMultipassFallback(<a class="code" href="namespaceOgre.html#a422">SceneBlendFactor</a> sourceFactor, <a class="code" href="namespaceOgre.html#a422">SceneBlendFactor</a> destFactor)
00407     {
00408         <a class="code" href="classOgre_1_1Material_1_1TextureLayer.html#Ogre_1_1Material_1_1TextureLayern8">colourBlendFallbackSrc</a> = sourceFactor;
00409         <a class="code" href="classOgre_1_1Material_1_1TextureLayer.html#Ogre_1_1Material_1_1TextureLayern9">colourBlendFallbackDest</a> = destFactor;
00410     }
00411     <font class="comment">//-----------------------------------------------------------------------</font>
<a name="l00412"></a><a class="code" href="classOgre_1_1Material_1_1TextureLayer.html#Ogre_1_1Material_1_1TextureLayera38">00412</a>     <font class="keywordtype">void</font> Material::TextureLayer::setAlphaOperation(<a class="code" href="namespaceOgre.html#a419">LayerBlendOperationEx</a> op,
00413         <a class="code" href="namespaceOgre.html#a420">LayerBlendSource</a> source1,
00414         <a class="code" href="namespaceOgre.html#a420">LayerBlendSource</a> source2,
00415         <a class="code" href="namespaceOgre.html#a281">Real</a> arg1,
00416         <a class="code" href="namespaceOgre.html#a281">Real</a> arg2,
00417         <a class="code" href="namespaceOgre.html#a281">Real</a> manualBlend)
00418     {
00419         <a class="code" href="classOgre_1_1Material_1_1TextureLayer.html#Ogre_1_1Material_1_1TextureLayern10">alphaBlendMode</a>.<a class="code" href="classOgre_1_1LayerBlendModeEx.html#Ogre_1_1LayerBlendModeExm1">operation</a> = op;
00420         <a class="code" href="classOgre_1_1Material_1_1TextureLayer.html#Ogre_1_1Material_1_1TextureLayern10">alphaBlendMode</a>.<a class="code" href="classOgre_1_1LayerBlendModeEx.html#Ogre_1_1LayerBlendModeExm2">source1</a> = source1;
00421         <a class="code" href="classOgre_1_1Material_1_1TextureLayer.html#Ogre_1_1Material_1_1TextureLayern10">alphaBlendMode</a>.<a class="code" href="classOgre_1_1LayerBlendModeEx.html#Ogre_1_1LayerBlendModeExm3">source2</a> = source2;
00422         <a class="code" href="classOgre_1_1Material_1_1TextureLayer.html#Ogre_1_1Material_1_1TextureLayern10">alphaBlendMode</a>.<a class="code" href="classOgre_1_1LayerBlendModeEx.html#Ogre_1_1LayerBlendModeExm6">alphaArg1</a> = arg1;
00423         <a class="code" href="classOgre_1_1Material_1_1TextureLayer.html#Ogre_1_1Material_1_1TextureLayern10">alphaBlendMode</a>.<a class="code" href="classOgre_1_1LayerBlendModeEx.html#Ogre_1_1LayerBlendModeExm7">alphaArg2</a> = arg2;
00424         <a class="code" href="classOgre_1_1Material_1_1TextureLayer.html#Ogre_1_1Material_1_1TextureLayern10">alphaBlendMode</a>.<a class="code" href="classOgre_1_1LayerBlendModeEx.html#Ogre_1_1LayerBlendModeExm8">factor</a> = manualBlend;
00425     }
00426     <font class="comment">//-----------------------------------------------------------------------</font>
<a name="l00427"></a><a class="code" href="classOgre_1_1Material_1_1TextureLayer.html#Ogre_1_1Material_1_1TextureLayera39">00427</a>     <font class="keywordtype">void</font> Material::TextureLayer::addEffect(<a class="code" href="structOgre_1_1Material_1_1TextureLayer_1_1TextureEffect.html">TextureEffect</a>&amp; effect)
00428     {
00429         <font class="comment">// Ensure controller pointer is null</font>
00430         effect.<a class="code" href="structOgre_1_1Material_1_1TextureLayer_1_1TextureEffect.html#Ogre_1_1Material_1_1TextureLayer_1_1TextureEffectm9">controller</a> = 0;
00431 
00432         <font class="keywordflow">if</font> (effect.<a class="code" href="structOgre_1_1Material_1_1TextureLayer_1_1TextureEffect.html#Ogre_1_1Material_1_1TextureLayer_1_1TextureEffectm0">type</a> == <a class="code" href="classOgre_1_1Material_1_1TextureLayer.html#Ogre_1_1Material_1_1TextureLayers21Ogre_1_1Material_1_1TextureLayers1">ET_ENVIRONMENT_MAP</a> || effect.<a class="code" href="structOgre_1_1Material_1_1TextureLayer_1_1TextureEffect.html#Ogre_1_1Material_1_1TextureLayer_1_1TextureEffectm0">type</a> == <a class="code" href="classOgre_1_1Material_1_1TextureLayer.html#Ogre_1_1Material_1_1TextureLayers21Ogre_1_1Material_1_1TextureLayers2">ET_SCROLL</a> || effect.<a class="code" href="structOgre_1_1Material_1_1TextureLayer_1_1TextureEffect.html#Ogre_1_1Material_1_1TextureLayer_1_1TextureEffectm0">type</a> == <a class="code" href="classOgre_1_1Material_1_1TextureLayer.html#Ogre_1_1Material_1_1TextureLayers21Ogre_1_1Material_1_1TextureLayers3">ET_ROTATE</a>)
00433         {
00434             <font class="comment">// Replace - must be unique</font>
00435             <font class="comment">// Search for existing effect of this type</font>
00436             EffectMap::iterator i = <a class="code" href="classOgre_1_1Material_1_1TextureLayer.html#Ogre_1_1Material_1_1TextureLayern26">mEffects</a>.find(effect.<a class="code" href="structOgre_1_1Material_1_1TextureLayer_1_1TextureEffect.html#Ogre_1_1Material_1_1TextureLayer_1_1TextureEffectm0">type</a>);
00437             <font class="keywordflow">if</font> (i != <a class="code" href="classOgre_1_1Material_1_1TextureLayer.html#Ogre_1_1Material_1_1TextureLayern26">mEffects</a>.end())
00438             {
00439                 <a class="code" href="classOgre_1_1Material_1_1TextureLayer.html#Ogre_1_1Material_1_1TextureLayern26">mEffects</a>.erase(i);
00440             }
00441         }
00442 
00443         <font class="keywordflow">if</font> (!<a class="code" href="classOgre_1_1Material_1_1TextureLayer.html#Ogre_1_1Material_1_1TextureLayern12">mDeferLoad</a>)
00444         {
00445             <font class="comment">// Create controller</font>
00446             <a class="code" href="classOgre_1_1Material_1_1TextureLayer.html#Ogre_1_1Material_1_1TextureLayerb2">createEffectController</a>(effect);
00447         }
00448 
00449         <font class="comment">// Record new effect</font>
00450         <a class="code" href="classOgre_1_1Material_1_1TextureLayer.html#Ogre_1_1Material_1_1TextureLayern26">mEffects</a>.insert(EffectMap::value_type(effect.<a class="code" href="structOgre_1_1Material_1_1TextureLayer_1_1TextureEffect.html#Ogre_1_1Material_1_1TextureLayer_1_1TextureEffectm0">type</a>, effect));
00451 
00452     }
00453     <font class="comment">//-----------------------------------------------------------------------</font>
<a name="l00454"></a><a class="code" href="classOgre_1_1Material_1_1TextureLayer.html#Ogre_1_1Material_1_1TextureLayera47">00454</a>     <font class="keywordtype">void</font> Material::TextureLayer::removeAllEffects(<font class="keywordtype">void</font>)
00455     {
00456         <a class="code" href="classOgre_1_1Material_1_1TextureLayer.html#Ogre_1_1Material_1_1TextureLayern26">mEffects</a>.clear();
00457     }
00458 
00459     <font class="comment">//-----------------------------------------------------------------------</font>
<a name="l00460"></a><a class="code" href="classOgre_1_1Material_1_1TextureLayer.html#Ogre_1_1Material_1_1TextureLayera49">00460</a>     <font class="keywordtype">bool</font> Material::TextureLayer::isBlank(<font class="keywordtype">void</font>)<font class="keyword"> const</font>
00461 <font class="keyword">    </font>{
00462         <font class="keywordflow">return</font> <a class="code" href="classOgre_1_1Material_1_1TextureLayer.html#Ogre_1_1Material_1_1TextureLayern11">mIsBlank</a>;
00463     }
00464 
00465     <font class="comment">//-----------------------------------------------------------------------</font>
<a name="l00466"></a><a class="code" href="classOgre_1_1Material_1_1TextureLayer.html#Ogre_1_1Material_1_1TextureLayera36">00466</a>     <a class="code" href="namespaceOgre.html#a422">SceneBlendFactor</a> Material::TextureLayer::getColourBlendFallbackSrc(<font class="keywordtype">void</font>)<font class="keyword"> const</font>
00467 <font class="keyword">    </font>{
00468         <font class="keywordflow">return</font> <a class="code" href="classOgre_1_1Material_1_1TextureLayer.html#Ogre_1_1Material_1_1TextureLayern8">colourBlendFallbackSrc</a>;
00469     }
00470     <font class="comment">//-----------------------------------------------------------------------</font>
<a name="l00471"></a><a class="code" href="classOgre_1_1Material_1_1TextureLayer.html#Ogre_1_1Material_1_1TextureLayera37">00471</a>     <a class="code" href="namespaceOgre.html#a422">SceneBlendFactor</a> Material::TextureLayer::getColourBlendFallbackDest(<font class="keywordtype">void</font>)<font class="keyword"> const</font>
00472 <font class="keyword">    </font>{
00473         <font class="keywordflow">return</font> <a class="code" href="classOgre_1_1Material_1_1TextureLayer.html#Ogre_1_1Material_1_1TextureLayern9">colourBlendFallbackDest</a>;
00474     }
00475     <font class="comment">//-----------------------------------------------------------------------</font>
<a name="l00476"></a><a class="code" href="classOgre_1_1Material_1_1TextureLayer.html#Ogre_1_1Material_1_1TextureLayera34">00476</a>     <a class="code" href="classOgre_1_1LayerBlendModeEx.html">LayerBlendModeEx</a> Material::TextureLayer::getColourBlendMode(<font class="keywordtype">void</font>)<font class="keyword"> const</font>
00477 <font class="keyword">    </font>{
00478         <font class="keywordflow">return</font> <a class="code" href="classOgre_1_1Material_1_1TextureLayer.html#Ogre_1_1Material_1_1TextureLayern7">colourBlendMode</a>;
00479     }
00480     <font class="comment">//-----------------------------------------------------------------------</font>
<a name="l00481"></a><a class="code" href="classOgre_1_1Material_1_1TextureLayer.html#Ogre_1_1Material_1_1TextureLayera35">00481</a>     <a class="code" href="classOgre_1_1LayerBlendModeEx.html">LayerBlendModeEx</a> Material::TextureLayer::getAlphaBlendMode(<font class="keywordtype">void</font>)<font class="keyword"> const</font>
00482 <font class="keyword">    </font>{
00483         <font class="keywordflow">return</font> <a class="code" href="classOgre_1_1Material_1_1TextureLayer.html#Ogre_1_1Material_1_1TextureLayern10">alphaBlendMode</a>;
00484     }
00485     <font class="comment">//-----------------------------------------------------------------------</font>
<a name="l00486"></a><a class="code" href="classOgre_1_1Material_1_1TextureLayer.html#Ogre_1_1Material_1_1TextureLayera29">00486</a>     Material::TextureLayer::TextureAddressingMode Material::TextureLayer::getTextureAddressingMode(<font class="keywordtype">void</font>)<font class="keyword"> const</font>
00487 <font class="keyword">    </font>{
00488         <font class="keywordflow">return</font> <a class="code" href="classOgre_1_1Material_1_1TextureLayer.html#Ogre_1_1Material_1_1TextureLayern6">mAddressMode</a>;
00489     }
00490     <font class="comment">//-----------------------------------------------------------------------</font>
<a name="l00491"></a><a class="code" href="classOgre_1_1Material_1_1TextureLayer.html#Ogre_1_1Material_1_1TextureLayera30">00491</a>     <font class="keywordtype">void</font> Material::TextureLayer::setTextureAddressingMode(Material::TextureLayer::TextureAddressingMode tam)
00492     {
00493         <a class="code" href="classOgre_1_1Material_1_1TextureLayer.html#Ogre_1_1Material_1_1TextureLayern6">mAddressMode</a> = tam;
00494     }
00495     <font class="comment">//-----------------------------------------------------------------------</font>
<a name="l00496"></a><a class="code" href="classOgre_1_1Material_1_1TextureLayer.html#Ogre_1_1Material_1_1TextureLayera40">00496</a>     <font class="keywordtype">void</font> Material::TextureLayer::setEnvironmentMap(<font class="keywordtype">bool</font> enable, <font class="keywordtype">bool</font> planar)
00497     {
00498         <a class="code" href="structOgre_1_1Material_1_1TextureLayer_1_1TextureEffect.html">TextureEffect</a> eff;
00499         eff.<a class="code" href="structOgre_1_1Material_1_1TextureLayer_1_1TextureEffect.html#Ogre_1_1Material_1_1TextureLayer_1_1TextureEffectm0">type</a> = <a class="code" href="classOgre_1_1Material_1_1TextureLayer.html#Ogre_1_1Material_1_1TextureLayers21Ogre_1_1Material_1_1TextureLayers1">ET_ENVIRONMENT_MAP</a>;
00500 
00501         <font class="keywordflow">if</font> (enable)
00502         {
00503             <font class="keywordflow">if</font> (planar)
00504             {
00505                 eff.<a class="code" href="structOgre_1_1Material_1_1TextureLayer_1_1TextureEffect.html#Ogre_1_1Material_1_1TextureLayer_1_1TextureEffectm1">subtype</a> = <a class="code" href="classOgre_1_1Material_1_1TextureLayer.html#Ogre_1_1Material_1_1TextureLayers22Ogre_1_1Material_1_1TextureLayers5">ENV_PLANAR</a>;
00506                 <a class="code" href="classOgre_1_1Material_1_1TextureLayer.html#Ogre_1_1Material_1_1TextureLayera39">addEffect</a>(eff);
00507             }
00508             <font class="keywordflow">else</font>
00509             {
00510                 eff.<a class="code" href="structOgre_1_1Material_1_1TextureLayer_1_1TextureEffect.html#Ogre_1_1Material_1_1TextureLayer_1_1TextureEffectm1">subtype</a> = <a class="code" href="classOgre_1_1Material_1_1TextureLayer.html#Ogre_1_1Material_1_1TextureLayers22Ogre_1_1Material_1_1TextureLayers6">ENV_CURVED</a>;
00511                 <a class="code" href="classOgre_1_1Material_1_1TextureLayer.html#Ogre_1_1Material_1_1TextureLayera39">addEffect</a>(eff);
00512             }
00513         }
00514         <font class="keywordflow">else</font>
00515         {
00516             <a class="code" href="classOgre_1_1Material_1_1TextureLayer.html#Ogre_1_1Material_1_1TextureLayera48">removeEffect</a>(<a class="code" href="classOgre_1_1Material_1_1TextureLayer.html#Ogre_1_1Material_1_1TextureLayers21Ogre_1_1Material_1_1TextureLayers1">ET_ENVIRONMENT_MAP</a>);
00517         }
00518     }
00519     <font class="comment">//-----------------------------------------------------------------------</font>
<a name="l00520"></a><a class="code" href="classOgre_1_1Material_1_1TextureLayer.html#Ogre_1_1Material_1_1TextureLayera48">00520</a>     <font class="keywordtype">void</font> Material::TextureLayer::removeEffect(TextureEffectType type)
00521     {
00522       <font class="comment">// EffectMap::iterator i = mEffects.find(type);</font>
00523         std::pair&lt; EffectMap::iterator, EffectMap::iterator &gt; remPair = <a class="code" href="classOgre_1_1Material_1_1TextureLayer.html#Ogre_1_1Material_1_1TextureLayern26">mEffects</a>.equal_range( type );
00524         <a class="code" href="classOgre_1_1Material_1_1TextureLayer.html#Ogre_1_1Material_1_1TextureLayern26">mEffects</a>.erase( remPair.first, remPair.second );
00525         <font class="comment">//EffectMap::iterator i = mEffects.find(type);</font>
00526 <font class="comment">/*        for (; i != mEffects.end() &amp;&amp; i-&gt;first == type; ++i)</font>
00527 <font class="comment">        {</font>
00528 <font class="comment">            // Remove all instances of this type</font>
00529 <font class="comment">#ifdef __GNUC__</font>
00530 <font class="comment">            assert(0);</font>
00531 <font class="comment">            // Why do I get an error here???</font>
00532 <font class="comment">            //i = mEffects.erase(i);</font>
00533 <font class="comment">#else</font>
00534 <font class="comment">            i++;</font>
00535 <font class="comment">            EffectMap::iterator j = i;</font>
00536 <font class="comment">            i--;</font>
00537 <font class="comment">            mEffects.erase( i );</font>
00538 <font class="comment">            i = j;</font>
00539 <font class="comment">#endif</font>
00540 <font class="comment">        }</font>
00541 <font class="comment">*/</font>
00542     }
00543     <font class="comment">//-----------------------------------------------------------------------</font>
<a name="l00544"></a><a class="code" href="classOgre_1_1Material_1_1TextureLayer.html#Ogre_1_1Material_1_1TextureLayera50">00544</a>     <font class="keywordtype">void</font> Material::TextureLayer::setBlank(<font class="keywordtype">void</font>)
00545     {
00546         <a class="code" href="classOgre_1_1Material_1_1TextureLayer.html#Ogre_1_1Material_1_1TextureLayern11">mIsBlank</a> = <font class="keyword">true</font>;
00547     }
00548     <font class="comment">//-----------------------------------------------------------------------</font>
<a name="l00549"></a><a class="code" href="classOgre_1_1Material_1_1TextureLayer.html#Ogre_1_1Material_1_1TextureLayera20">00549</a>     <font class="keywordtype">void</font> Material::TextureLayer::setTextureTransform(<font class="keyword">const</font> <a class="code" href="classOgre_1_1Matrix4.html">Matrix4</a>&amp; xform)
00550     {
00551         <a class="code" href="classOgre_1_1Material_1_1TextureLayer.html#Ogre_1_1Material_1_1TextureLayern19">mTexModMatrix</a> = xform;
00552         <a class="code" href="classOgre_1_1Material_1_1TextureLayer.html#Ogre_1_1Material_1_1TextureLayern13">mRecalcTexMatrix</a> = <font class="keyword">false</font>;
00553     }
00554     <font class="comment">//-----------------------------------------------------------------------</font>
<a name="l00555"></a><a class="code" href="classOgre_1_1Material_1_1TextureLayer.html#Ogre_1_1Material_1_1TextureLayera22">00555</a>     <font class="keywordtype">void</font> Material::TextureLayer::setTextureScroll(<a class="code" href="namespaceOgre.html#a281">Real</a> u, <a class="code" href="namespaceOgre.html#a281">Real</a> v)
00556     {
00557         <a class="code" href="classOgre_1_1Material_1_1TextureLayer.html#Ogre_1_1Material_1_1TextureLayern14">mUMod</a> = u;
00558         <a class="code" href="classOgre_1_1Material_1_1TextureLayer.html#Ogre_1_1Material_1_1TextureLayern15">mVMod</a> = v;
00559         <a class="code" href="classOgre_1_1Material_1_1TextureLayer.html#Ogre_1_1Material_1_1TextureLayern13">mRecalcTexMatrix</a> = <font class="keyword">true</font>;
00560     }
00561     <font class="comment">//-----------------------------------------------------------------------</font>
<a name="l00562"></a><a class="code" href="classOgre_1_1Material_1_1TextureLayer.html#Ogre_1_1Material_1_1TextureLayera27">00562</a>     <font class="keywordtype">void</font> Material::TextureLayer::setTextureScale(<a class="code" href="namespaceOgre.html#a281">Real</a> uScale, <a class="code" href="namespaceOgre.html#a281">Real</a> vScale)
00563     {
00564         <a class="code" href="classOgre_1_1Material_1_1TextureLayer.html#Ogre_1_1Material_1_1TextureLayern16">mUScale</a> = uScale;
00565         <a class="code" href="classOgre_1_1Material_1_1TextureLayer.html#Ogre_1_1Material_1_1TextureLayern17">mVScale</a> = vScale;
00566         <a class="code" href="classOgre_1_1Material_1_1TextureLayer.html#Ogre_1_1Material_1_1TextureLayern13">mRecalcTexMatrix</a> = <font class="keyword">true</font>;
00567     }
00568     <font class="comment">//-----------------------------------------------------------------------</font>
<a name="l00569"></a><a class="code" href="classOgre_1_1Material_1_1TextureLayer.html#Ogre_1_1Material_1_1TextureLayera28">00569</a>     <font class="keywordtype">void</font> Material::TextureLayer::setTextureRotate(<a class="code" href="namespaceOgre.html#a281">Real</a> degrees)
00570     {
00571         <a class="code" href="classOgre_1_1Material_1_1TextureLayer.html#Ogre_1_1Material_1_1TextureLayern18">mRotate</a> = degrees;
00572         <a class="code" href="classOgre_1_1Material_1_1TextureLayer.html#Ogre_1_1Material_1_1TextureLayern13">mRecalcTexMatrix</a> = <font class="keyword">true</font>;
00573     }
00574     <font class="comment">//-----------------------------------------------------------------------</font>
<a name="l00575"></a><a class="code" href="classOgre_1_1Material_1_1TextureLayer.html#Ogre_1_1Material_1_1TextureLayera21">00575</a>     <font class="keyword">const</font> <a class="code" href="classOgre_1_1Matrix4.html">Matrix4</a>&amp; Material::TextureLayer::getTextureTransform()
00576     {
00577         <font class="keywordflow">if</font> (mRecalcTexMatrix)
00578             <a class="code" href="classOgre_1_1Material_1_1TextureLayer.html#Ogre_1_1Material_1_1TextureLayerb0">recalcTextureMatrix</a>();
00579         <font class="keywordflow">return</font> <a class="code" href="classOgre_1_1Material_1_1TextureLayer.html#Ogre_1_1Material_1_1TextureLayern19">mTexModMatrix</a>;
00580 
00581     }
00582     <font class="comment">//-----------------------------------------------------------------------</font>
<a name="l00583"></a><a class="code" href="classOgre_1_1Material_1_1TextureLayer.html#Ogre_1_1Material_1_1TextureLayerb0">00583</a>     <font class="keywordtype">void</font> Material::TextureLayer::recalcTextureMatrix()
00584     {
00585         <font class="comment">// Assumption: 2D texture coords</font>
00586         <a class="code" href="classOgre_1_1Matrix3.html">Matrix3</a> xform, rot;
00587 
00588         xform = Matrix3::IDENTITY;
00589         <font class="keywordflow">if</font> (<a class="code" href="classOgre_1_1Material_1_1TextureLayer.html#Ogre_1_1Material_1_1TextureLayern16">mUScale</a> || <a class="code" href="classOgre_1_1Material_1_1TextureLayer.html#Ogre_1_1Material_1_1TextureLayern17">mVScale</a>)
00590         {
00591             <font class="comment">// Offset to center of texture</font>
00592             xform[0][0] = 1/<a class="code" href="classOgre_1_1Material_1_1TextureLayer.html#Ogre_1_1Material_1_1TextureLayern16">mUScale</a>;
00593             xform[1][1] = 1/<a class="code" href="classOgre_1_1Material_1_1TextureLayer.html#Ogre_1_1Material_1_1TextureLayern17">mVScale</a>;
00594             <font class="comment">// Skip matrix concat since first matrix update</font>
00595             xform[0][2] = (-0.5 * xform[0][0]) + 0.5;
00596             xform[1][2] = (-0.5 * xform[1][1]) + 0.5;
00597 
00598         }
00599 
00600         <font class="keywordflow">if</font> (<a class="code" href="classOgre_1_1Material_1_1TextureLayer.html#Ogre_1_1Material_1_1TextureLayern14">mUMod</a> || <a class="code" href="classOgre_1_1Material_1_1TextureLayer.html#Ogre_1_1Material_1_1TextureLayern15">mVMod</a>)
00601         {
00602             <a class="code" href="classOgre_1_1Matrix3.html">Matrix3</a> xlate = Matrix3::IDENTITY;
00603 
00604             xlate[0][2] = <a class="code" href="classOgre_1_1Material_1_1TextureLayer.html#Ogre_1_1Material_1_1TextureLayern14">mUMod</a>;
00605             xlate[1][2] = <a class="code" href="classOgre_1_1Material_1_1TextureLayer.html#Ogre_1_1Material_1_1TextureLayern15">mVMod</a>;
00606 
00607             xform = xlate * xform;
00608         }
00609 
00610         <font class="keywordflow">if</font> (<a class="code" href="classOgre_1_1Material_1_1TextureLayer.html#Ogre_1_1Material_1_1TextureLayern18">mRotate</a> != 0)
00611         {
00612             rot = Matrix3::IDENTITY;
00613             <a class="code" href="namespaceOgre.html#a281">Real</a> theta = Math::getSingleton().DegreesToRadians(<a class="code" href="classOgre_1_1Material_1_1TextureLayer.html#Ogre_1_1Material_1_1TextureLayern18">mRotate</a>);
00614             <a class="code" href="namespaceOgre.html#a281">Real</a> cosTheta = Math::getSingleton().Cos(theta);
00615             <a class="code" href="namespaceOgre.html#a281">Real</a> sinTheta = Math::getSingleton().Sin(theta);
00616 
00617             rot[0][0] = cosTheta;
00618             rot[0][1] = -sinTheta;
00619             rot[1][0] = sinTheta;
00620             rot[1][1] = cosTheta;
00621             <font class="comment">// Offset center of rotation to center of texture</font>
00622             <a class="code" href="namespaceOgre.html#a281">Real</a> cosThetaOff = cosTheta * -0.5;
00623             <a class="code" href="namespaceOgre.html#a281">Real</a> sinThetaOff = sinTheta * -0.5;
00624             rot[0][2] = cosThetaOff - sinThetaOff;
00625             rot[1][2] = sinThetaOff + cosThetaOff;
00626 
00627 
00628             xform = xform * rot;
00629         }
00630 
00631         <a class="code" href="classOgre_1_1Material_1_1TextureLayer.html#Ogre_1_1Material_1_1TextureLayern19">mTexModMatrix</a> = xform;
00632 
00633     }
00634     <font class="comment">//-----------------------------------------------------------------------</font>
<a name="l00635"></a><a class="code" href="classOgre_1_1Material_1_1TextureLayer.html#Ogre_1_1Material_1_1TextureLayera23">00635</a>     <font class="keywordtype">void</font> Material::TextureLayer::setTextureUScroll(<a class="code" href="namespaceOgre.html#a281">Real</a> value)
00636     {
00637         <a class="code" href="classOgre_1_1Material_1_1TextureLayer.html#Ogre_1_1Material_1_1TextureLayern14">mUMod</a> = value;
00638         <a class="code" href="classOgre_1_1Material_1_1TextureLayer.html#Ogre_1_1Material_1_1TextureLayern13">mRecalcTexMatrix</a> = <font class="keyword">true</font>;
00639     }
00640     <font class="comment">//-----------------------------------------------------------------------</font>
<a name="l00641"></a><a class="code" href="classOgre_1_1Material_1_1TextureLayer.html#Ogre_1_1Material_1_1TextureLayera24">00641</a>     <font class="keywordtype">void</font> Material::TextureLayer::setTextureVScroll(<a class="code" href="namespaceOgre.html#a281">Real</a> value)
00642     {
00643         <a class="code" href="classOgre_1_1Material_1_1TextureLayer.html#Ogre_1_1Material_1_1TextureLayern15">mVMod</a> = value;
00644         <a class="code" href="classOgre_1_1Material_1_1TextureLayer.html#Ogre_1_1Material_1_1TextureLayern13">mRecalcTexMatrix</a> = <font class="keyword">true</font>;
00645     }
00646     <font class="comment">//-----------------------------------------------------------------------</font>
<a name="l00647"></a><a class="code" href="classOgre_1_1Material_1_1TextureLayer.html#Ogre_1_1Material_1_1TextureLayera25">00647</a>     <font class="keywordtype">void</font> Material::TextureLayer::setTextureUScale(<a class="code" href="namespaceOgre.html#a281">Real</a> value)
00648     {
00649         <a class="code" href="classOgre_1_1Material_1_1TextureLayer.html#Ogre_1_1Material_1_1TextureLayern16">mUScale</a> = value;
00650         <a class="code" href="classOgre_1_1Material_1_1TextureLayer.html#Ogre_1_1Material_1_1TextureLayern13">mRecalcTexMatrix</a> = <font class="keyword">true</font>;
00651     }
00652     <font class="comment">//-----------------------------------------------------------------------</font>
<a name="l00653"></a><a class="code" href="classOgre_1_1Material_1_1TextureLayer.html#Ogre_1_1Material_1_1TextureLayera26">00653</a>     <font class="keywordtype">void</font> Material::TextureLayer::setTextureVScale(<a class="code" href="namespaceOgre.html#a281">Real</a> value)
00654     {
00655         <a class="code" href="classOgre_1_1Material_1_1TextureLayer.html#Ogre_1_1Material_1_1TextureLayern17">mVScale</a> = value;
00656         <a class="code" href="classOgre_1_1Material_1_1TextureLayer.html#Ogre_1_1Material_1_1TextureLayern13">mRecalcTexMatrix</a> = <font class="keyword">true</font>;
00657     }
00658     <font class="comment">//-----------------------------------------------------------------------</font>
<a name="l00659"></a><a class="code" href="classOgre_1_1Material_1_1TextureLayer.html#Ogre_1_1Material_1_1TextureLayera44">00659</a>     <font class="keywordtype">void</font> Material::TextureLayer::setAlphaRejectSettings(<a class="code" href="namespaceOgre.html#a426">CompareFunction</a> func, <font class="keywordtype">unsigned</font> <font class="keywordtype">char</font> value)
00660     {
00661         <a class="code" href="classOgre_1_1Material_1_1TextureLayer.html#Ogre_1_1Material_1_1TextureLayern20">mAlphaRejectFunc</a> = func;
00662         <a class="code" href="classOgre_1_1Material_1_1TextureLayer.html#Ogre_1_1Material_1_1TextureLayern21">mAlphaRejectVal</a> = value;
00663     }
00664     <font class="comment">//-----------------------------------------------------------------------</font>
<a name="l00665"></a><a class="code" href="classOgre_1_1Material_1_1TextureLayer.html#Ogre_1_1Material_1_1TextureLayera45">00665</a>     <a class="code" href="namespaceOgre.html#a426">CompareFunction</a> Material::TextureLayer::getAlphaRejectFunction(<font class="keywordtype">void</font>)<font class="keyword"> const</font>
00666 <font class="keyword">    </font>{
00667         <font class="keywordflow">return</font> <a class="code" href="classOgre_1_1Material_1_1TextureLayer.html#Ogre_1_1Material_1_1TextureLayern20">mAlphaRejectFunc</a>;
00668     }
00669     <font class="comment">//-----------------------------------------------------------------------</font>
<a name="l00670"></a><a class="code" href="classOgre_1_1Material_1_1TextureLayer.html#Ogre_1_1Material_1_1TextureLayera46">00670</a>     <font class="keywordtype">unsigned</font> <font class="keywordtype">char</font> Material::TextureLayer::getAlphaRejectValue(<font class="keywordtype">void</font>)<font class="keyword"> const</font>
00671 <font class="keyword">    </font>{
00672         <font class="keywordflow">return</font> <a class="code" href="classOgre_1_1Material_1_1TextureLayer.html#Ogre_1_1Material_1_1TextureLayern21">mAlphaRejectVal</a>;
00673     }
00674     <font class="comment">//-----------------------------------------------------------------------</font>
<a name="l00675"></a><a class="code" href="classOgre_1_1Material_1_1TextureLayer.html#Ogre_1_1Material_1_1TextureLayera41">00675</a>     <font class="keywordtype">void</font> Material::TextureLayer::setScrollAnimation(<a class="code" href="namespaceOgre.html#a281">Real</a> uSpeed, <a class="code" href="namespaceOgre.html#a281">Real</a> vSpeed)
00676     {
00677         <a class="code" href="structOgre_1_1Material_1_1TextureLayer_1_1TextureEffect.html">TextureEffect</a> eff;
00678         eff.<a class="code" href="structOgre_1_1Material_1_1TextureLayer_1_1TextureEffect.html#Ogre_1_1Material_1_1TextureLayer_1_1TextureEffectm0">type</a> = <a class="code" href="classOgre_1_1Material_1_1TextureLayer.html#Ogre_1_1Material_1_1TextureLayers21Ogre_1_1Material_1_1TextureLayers2">ET_SCROLL</a>;
00679         eff.<a class="code" href="structOgre_1_1Material_1_1TextureLayer_1_1TextureEffect.html#Ogre_1_1Material_1_1TextureLayer_1_1TextureEffectm2">arg1</a> = uSpeed;
00680         eff.<a class="code" href="structOgre_1_1Material_1_1TextureLayer_1_1TextureEffect.html#Ogre_1_1Material_1_1TextureLayer_1_1TextureEffectm3">arg2</a> = vSpeed;
00681         <a class="code" href="classOgre_1_1Material_1_1TextureLayer.html#Ogre_1_1Material_1_1TextureLayera39">addEffect</a>(eff);
00682     }
00683     <font class="comment">//-----------------------------------------------------------------------</font>
<a name="l00684"></a><a class="code" href="classOgre_1_1Material_1_1TextureLayer.html#Ogre_1_1Material_1_1TextureLayera42">00684</a>     <font class="keywordtype">void</font> Material::TextureLayer::setRotateAnimation(<a class="code" href="namespaceOgre.html#a281">Real</a> speed)
00685     {
00686         <a class="code" href="structOgre_1_1Material_1_1TextureLayer_1_1TextureEffect.html">TextureEffect</a> eff;
00687         eff.<a class="code" href="structOgre_1_1Material_1_1TextureLayer_1_1TextureEffect.html#Ogre_1_1Material_1_1TextureLayer_1_1TextureEffectm0">type</a> = <a class="code" href="classOgre_1_1Material_1_1TextureLayer.html#Ogre_1_1Material_1_1TextureLayers21Ogre_1_1Material_1_1TextureLayers3">ET_ROTATE</a>;
00688         eff.<a class="code" href="structOgre_1_1Material_1_1TextureLayer_1_1TextureEffect.html#Ogre_1_1Material_1_1TextureLayer_1_1TextureEffectm2">arg1</a> = speed;
00689         <a class="code" href="classOgre_1_1Material_1_1TextureLayer.html#Ogre_1_1Material_1_1TextureLayera39">addEffect</a>(eff);
00690     }
00691     <font class="comment">//-----------------------------------------------------------------------</font>
<a name="l00692"></a><a class="code" href="classOgre_1_1Material_1_1TextureLayer.html#Ogre_1_1Material_1_1TextureLayera43">00692</a>     <font class="keywordtype">void</font> Material::TextureLayer::setTransformAnimation(TextureTransformType ttype,
00693         <a class="code" href="namespaceOgre.html#a432">WaveformType</a> waveType, <a class="code" href="namespaceOgre.html#a281">Real</a> base, <a class="code" href="namespaceOgre.html#a281">Real</a> frequency, <a class="code" href="namespaceOgre.html#a281">Real</a> phase, <a class="code" href="namespaceOgre.html#a281">Real</a> amplitude)
00694     {
00695         <a class="code" href="structOgre_1_1Material_1_1TextureLayer_1_1TextureEffect.html">TextureEffect</a> eff;
00696         eff.<a class="code" href="structOgre_1_1Material_1_1TextureLayer_1_1TextureEffect.html#Ogre_1_1Material_1_1TextureLayer_1_1TextureEffectm0">type</a> = <a class="code" href="classOgre_1_1Material_1_1TextureLayer.html#Ogre_1_1Material_1_1TextureLayers21Ogre_1_1Material_1_1TextureLayers4">ET_TRANSFORM</a>;
00697         eff.<a class="code" href="structOgre_1_1Material_1_1TextureLayer_1_1TextureEffect.html#Ogre_1_1Material_1_1TextureLayer_1_1TextureEffectm1">subtype</a> = ttype;
00698         eff.<a class="code" href="structOgre_1_1Material_1_1TextureLayer_1_1TextureEffect.html#Ogre_1_1Material_1_1TextureLayer_1_1TextureEffectm4">waveType</a> = waveType;
00699         eff.<a class="code" href="structOgre_1_1Material_1_1TextureLayer_1_1TextureEffect.html#Ogre_1_1Material_1_1TextureLayer_1_1TextureEffectm5">base</a> = base;
00700         eff.<a class="code" href="structOgre_1_1Material_1_1TextureLayer_1_1TextureEffect.html#Ogre_1_1Material_1_1TextureLayer_1_1TextureEffectm6">frequency</a> = frequency;
00701         eff.<a class="code" href="structOgre_1_1Material_1_1TextureLayer_1_1TextureEffect.html#Ogre_1_1Material_1_1TextureLayer_1_1TextureEffectm7">phase</a> = phase;
00702         eff.<a class="code" href="structOgre_1_1Material_1_1TextureLayer_1_1TextureEffect.html#Ogre_1_1Material_1_1TextureLayer_1_1TextureEffectm8">amplitude</a> = amplitude;
00703         <a class="code" href="classOgre_1_1Material_1_1TextureLayer.html#Ogre_1_1Material_1_1TextureLayera39">addEffect</a>(eff);
00704     }
00705     <font class="comment">//-----------------------------------------------------------------------</font>
<a name="l00706"></a><a class="code" href="classOgre_1_1Material_1_1TextureLayer.html#Ogre_1_1Material_1_1TextureLayera51">00706</a>     <font class="keywordtype">void</font> Material::TextureLayer::_load(<font class="keywordtype">void</font>)
00707     {
00708         <font class="comment">// Load textures</font>
00709         <font class="keywordflow">for</font> (<font class="keywordtype">int</font> i = 0; i &lt; <a class="code" href="classOgre_1_1Material_1_1TextureLayer.html#Ogre_1_1Material_1_1TextureLayern0">mNumFrames</a>; ++i)
00710         {
00711             <font class="keywordflow">if</font> (<a class="code" href="classOgre_1_1Material_1_1TextureLayer.html#Ogre_1_1Material_1_1TextureLayern25">mFrames</a>[i] != <font class="stringliteral">""</font>)
00712             {
00713                 <font class="comment">// Ensure texture is loaded, default MipMaps and priority</font>
00714                 <font class="keywordflow">try</font> {
00715 
00716                     TextureManager::getSingleton().load(<a class="code" href="classOgre_1_1Material_1_1TextureLayer.html#Ogre_1_1Material_1_1TextureLayern25">mFrames</a>[i]);
00717                     <a class="code" href="classOgre_1_1Material_1_1TextureLayer.html#Ogre_1_1Material_1_1TextureLayern11">mIsBlank</a> = <font class="keyword">false</font>;
00718                 }
00719                 <font class="keywordflow">catch</font> (...) {
00720                     <a class="code" href="classOgre_1_1String.html">String</a> msg;
00721                     msg = msg + <font class="stringliteral">"Error loading texture "</font> + <a class="code" href="classOgre_1_1Material_1_1TextureLayer.html#Ogre_1_1Material_1_1TextureLayern25">mFrames</a>[i]  + <font class="stringliteral">". Texture layer will be blank."</font>;
00722                     LogManager::getSingleton().logMessage(msg);
00723                     <a class="code" href="classOgre_1_1Material_1_1TextureLayer.html#Ogre_1_1Material_1_1TextureLayern11">mIsBlank</a> = <font class="keyword">true</font>;
00724                 }
00725             }
00726         }
00727         <font class="comment">// Animation controller</font>
00728         <font class="keywordflow">if</font> (<a class="code" href="classOgre_1_1Material_1_1TextureLayer.html#Ogre_1_1Material_1_1TextureLayern2">mAnimDuration</a> != 0)
00729         {
00730             <a class="code" href="classOgre_1_1Material_1_1TextureLayer.html#Ogre_1_1Material_1_1TextureLayerb1">createAnimController</a>();
00731         }
00732         <font class="comment">// Effect controllers</font>
00733         <font class="keywordflow">for</font> (EffectMap::iterator it = <a class="code" href="classOgre_1_1Material_1_1TextureLayer.html#Ogre_1_1Material_1_1TextureLayern26">mEffects</a>.begin(); it != <a class="code" href="classOgre_1_1Material_1_1TextureLayer.html#Ogre_1_1Material_1_1TextureLayern26">mEffects</a>.end(); ++it)
00734         {
00735             <a class="code" href="classOgre_1_1Material_1_1TextureLayer.html#Ogre_1_1Material_1_1TextureLayerb2">createEffectController</a>(it-&gt;second);
00736         }
00737 
00738         <a class="code" href="classOgre_1_1Material_1_1TextureLayer.html#Ogre_1_1Material_1_1TextureLayern12">mDeferLoad</a> = <font class="keyword">false</font>;
00739 
00740     }
00741     <font class="comment">//-----------------------------------------------------------------------</font>
<a name="l00742"></a><a class="code" href="classOgre_1_1Material_1_1TextureLayer.html#Ogre_1_1Material_1_1TextureLayerb1">00742</a>     <font class="keywordtype">void</font> Material::TextureLayer::createAnimController(<font class="keywordtype">void</font>)
00743     {
00744         <a class="code" href="classOgre_1_1Material_1_1TextureLayer.html#Ogre_1_1Material_1_1TextureLayern3">mAnimController</a> = ControllerManager::getSingleton().createTextureAnimator(<font class="keyword">this</font>, <a class="code" href="classOgre_1_1Material_1_1TextureLayer.html#Ogre_1_1Material_1_1TextureLayern2">mAnimDuration</a>);
00745 
00746     }
00747     <font class="comment">//-----------------------------------------------------------------------</font>
<a name="l00748"></a><a class="code" href="classOgre_1_1Material_1_1TextureLayer.html#Ogre_1_1Material_1_1TextureLayerb2">00748</a>     <font class="keywordtype">void</font> Material::TextureLayer::createEffectController(<a class="code" href="structOgre_1_1Material_1_1TextureLayer_1_1TextureEffect.html">TextureEffect</a>&amp; effect)
00749     {
00750         <a class="code" href="classOgre_1_1ControllerManager.html">ControllerManager</a>&amp; cMgr = ControllerManager::getSingleton();
00751         <font class="keywordflow">switch</font> (effect.<a class="code" href="structOgre_1_1Material_1_1TextureLayer_1_1TextureEffect.html#Ogre_1_1Material_1_1TextureLayer_1_1TextureEffectm0">type</a>)
00752         {
00753         <font class="keywordflow">case</font> <a class="code" href="classOgre_1_1Material_1_1TextureLayer.html#Ogre_1_1Material_1_1TextureLayers21Ogre_1_1Material_1_1TextureLayers2">ET_SCROLL</a>:
00754             effect.<a class="code" href="structOgre_1_1Material_1_1TextureLayer_1_1TextureEffect.html#Ogre_1_1Material_1_1TextureLayer_1_1TextureEffectm9">controller</a> = cMgr.<a class="code" href="classOgre_1_1ControllerManager.html#Ogre_1_1ControllerManagera7">createTextureScroller</a>(<font class="keyword">this</font>, effect.<a class="code" href="structOgre_1_1Material_1_1TextureLayer_1_1TextureEffect.html#Ogre_1_1Material_1_1TextureLayer_1_1TextureEffectm2">arg1</a>, effect.<a class="code" href="structOgre_1_1Material_1_1TextureLayer_1_1TextureEffect.html#Ogre_1_1Material_1_1TextureLayer_1_1TextureEffectm3">arg2</a>);
00755             <font class="keywordflow">break</font>;
00756         <font class="keywordflow">case</font> <a class="code" href="classOgre_1_1Material_1_1TextureLayer.html#Ogre_1_1Material_1_1TextureLayers21Ogre_1_1Material_1_1TextureLayers3">ET_ROTATE</a>:
00757             effect.<a class="code" href="structOgre_1_1Material_1_1TextureLayer_1_1TextureEffect.html#Ogre_1_1Material_1_1TextureLayer_1_1TextureEffectm9">controller</a> = cMgr.<a class="code" href="classOgre_1_1ControllerManager.html#Ogre_1_1ControllerManagera8">createTextureRotater</a>(<font class="keyword">this</font>, effect.<a class="code" href="structOgre_1_1Material_1_1TextureLayer_1_1TextureEffect.html#Ogre_1_1Material_1_1TextureLayer_1_1TextureEffectm2">arg1</a>);
00758             <font class="keywordflow">break</font>;
00759         <font class="keywordflow">case</font> <a class="code" href="classOgre_1_1Material_1_1TextureLayer.html#Ogre_1_1Material_1_1TextureLayers21Ogre_1_1Material_1_1TextureLayers4">ET_TRANSFORM</a>:
00760             effect.<a class="code" href="structOgre_1_1Material_1_1TextureLayer_1_1TextureEffect.html#Ogre_1_1Material_1_1TextureLayer_1_1TextureEffectm9">controller</a> = cMgr.<a class="code" href="classOgre_1_1ControllerManager.html#Ogre_1_1ControllerManagera9">createTextureWaveTransformer</a>(<font class="keyword">this</font>, (Material::TextureLayer::TextureTransformType)effect.<a class="code" href="structOgre_1_1Material_1_1TextureLayer_1_1TextureEffect.html#Ogre_1_1Material_1_1TextureLayer_1_1TextureEffectm1">subtype</a>, effect.<a class="code" href="structOgre_1_1Material_1_1TextureLayer_1_1TextureEffect.html#Ogre_1_1Material_1_1TextureLayer_1_1TextureEffectm4">waveType</a>, effect.<a class="code" href="structOgre_1_1Material_1_1TextureLayer_1_1TextureEffect.html#Ogre_1_1Material_1_1TextureLayer_1_1TextureEffectm5">base</a>,
00761                 effect.<a class="code" href="structOgre_1_1Material_1_1TextureLayer_1_1TextureEffect.html#Ogre_1_1Material_1_1TextureLayer_1_1TextureEffectm6">frequency</a>, effect.<a class="code" href="structOgre_1_1Material_1_1TextureLayer_1_1TextureEffect.html#Ogre_1_1Material_1_1TextureLayer_1_1TextureEffectm7">phase</a>, effect.<a class="code" href="structOgre_1_1Material_1_1TextureLayer_1_1TextureEffect.html#Ogre_1_1Material_1_1TextureLayer_1_1TextureEffectm8">amplitude</a>);
00762             <font class="keywordflow">break</font>;
00763     <font class="keywordflow">case</font> <a class="code" href="classOgre_1_1Material_1_1TextureLayer.html#Ogre_1_1Material_1_1TextureLayers21Ogre_1_1Material_1_1TextureLayers1">ET_ENVIRONMENT_MAP</a>:
00764     <font class="keywordflow">case</font> <a class="code" href="classOgre_1_1Material_1_1TextureLayer.html#Ogre_1_1Material_1_1TextureLayers21Ogre_1_1Material_1_1TextureLayers0">ET_BUMP_MAP</a>:
00765         <font class="keywordflow">break</font>;
00766         }
00767     }
00768     <font class="comment">//-----------------------------------------------------------------------</font>
<a name="l00769"></a><a class="code" href="classOgre_1_1Material_1_1TextureLayer.html#Ogre_1_1Material_1_1TextureLayera5">00769</a>     <font class="keywordtype">void</font> Material::TextureLayer::setDeferredLoad(<font class="keywordtype">bool</font> defer)
00770     {
00771         <a class="code" href="classOgre_1_1Material_1_1TextureLayer.html#Ogre_1_1Material_1_1TextureLayern12">mDeferLoad</a> = defer;
00772     }
00773 
00774 }
</pre></div><p>
Copyright &copy; 2002 by The OGRE Team<br />
<script type="text/javascript">
<!--//hide script from old browsers
document.write( "Last modified "+ document.lastModified );
//end hiding contents -->
</script>
</p>
</body>
</html>
